"use strict";function createDirective(s){return{restrict:"E",require:["?^lo"],link:function(e,t,n,o){if(o[0]){var a=o[0].getDataCollector();e.onError=function(e){s.error(a,e)},t.on("error",e.onError),e.$on("$destroy",function(){t.off("error",e.onError)})}}}}function customplayer(a,s,r,i,e){return{scope:{urls:"=",radius:"=",onStart:"&?",onEnd:"&?",stroke:"=",engineAutoplay:"=?",useSharedAudio:"=?"},restrict:"E",templateUrl:"app/common/directives/custom-player.tpl.html",link:function(n,o){var t=e.getLoCtrl();n.trustedSources=[],n.timer=null,n.playToggle=!1,n.currentTime=0,n.$watch("urls",function(){if(s.isString(n.urls)){var e,t=n.urls.match(/.*\.(\w*)/)[1];"mp3"===t?e="audio/mpeg":"ogg"===t&&(e="audio/ogg"),n.trustedSources.push({url:r.trustAsResourceUrl(n.urls),type:e})}else n.trustedSources=s.map(n.urls,function(e){return{type:e.mime||e.type,url:r.trustAsResourceUrl(e.url)}});n.useSharedAudio?(n.audio=i.getAudio(),i.setSrc(n.trustedSources)):n.audio=o.find("audio")[0],n.pause(),n.audio.load(),n.audio.addEventListener("play",n.startedCallback),n.audio.addEventListener("ended",n.endedCallback),n.playToggle=!1,n.currentTime=0,n.durationTime=0,n.engineAutoplay&&n.play()}),n.play=function(e){e&&e.stopPropagation(),t.stopAllAudioAssets(),n.playToggle=!0,n.audio.play(),n.timer=a(function(){n.currentTime=n.audio.currentTime,n.durationTime=n.audio.duration,n.currentTime===n.durationTime&&(a.cancel(n.timer),n.timer=null,n.playToggle=!1)},50)},n.pause=function(e){e&&e.stopPropagation(),n.playToggle=!1,n.audio.pause(),n.timer&&(a.cancel(n.timer),n.timer=null)},n.$on("engine-mediaPause",function(){n.pause()}),n.endedCallback=function(){n.onEnd&&n.onEnd()},n.startedCallback=function(){n.onStart&&n.onStart()},n.$on("$destroy",function(){n.audio.removeEventListener("play",n.startedCallback),n.audio.removeEventListener("ended",n.endedCallback),n.pause(),n.currentTime=0})}}}angular.module("atoolEngineCrossword",[]).constant("underscore",window._),angular.module("atoolEngineCrossword").factory("CrosswordViewStructure",function(){return function(e,t){this.seed=e,this.crossword=t,this.name=t.getHeight()+"x"+t.getWidth()}}),angular.module("atoolEngineCrossword").service("CrosswordRankSorter",["underscore",function(t){return{sort:function(e){return t.first(t.sortBy(e,function(e){return Math.max(e.crossword.getWidth(),e.crossword.getHeight())}),5)}}}]),angular.module("atoolEngineCrossword").service("CrosswordPositionValidator",function(){var u=function(e,t,n,o){return!(!e.isCellFilled(t,o)&&(e.isCellFilled(t+1,o)||e.isCellFilled(t-1,o)))&&!(!e.isCellFilled(t,n)&&(e.isCellFilled(t+1,n)||e.isCellFilled(t-1,n)))},g=function(e,t,n,o){return!e.isCellFilled(t,n-1)&&!e.isCellFilled(t,o+1)},m=function(e,t,n,o,a){return e.isCellOutsideMatrix(t,n)||e.isCellOutsideMatrix(o,a)};return{canWordIntersectVertically:function(e,t,n,o,a){var s=n.word.replace(/\s+/g,""),r=t-o,i=r+s.length-1;if(m(a,e,r,e,i))return!1;for(var l=0;l<s.length;l++){var c=t-o+l,d=s[l].toLowerCase(),p="string"==typeof a.getCell(e,c).letter?a.getCell(e,c).letter.toLowerCase():void 0;if(a.isCellFilled(e,c)&&c!==t&&p!==d)return!1;if((a.isCellFilled(e+1,c)||a.isCellFilled(e-1,c))&&r<c&&c!==t&&p!==d)return!1}return g(a,e,r,i)&&u(a,e,r,i)},canWordIntersectHorizontally:function(e,t,n,o,a){var s=n.word.replace(/\s+/g,""),r=e-o,i=r+s.length-1;if(m(a,r,t,i,t))return!1;for(var l=0;l<s.length;l++){var c=e-o+l,d=s[l].toLowerCase(),p="string"==typeof a.getCell(c,t).letter?a.getCell(c,t).letter.toLowerCase():void 0;if(a.isCellFilled(c,t)&&c!==e&&p!==d)return!1;if((a.isCellFilled(c,t-1)||a.isCellFilled(c,t+1))&&c!==e&&p!==d)return!1}return!a.isCellFilled(r-1,t)&&!a.isCellFilled(i+1,t)},findRandomValidIntersection:function(e,t){for(var n=[],o=e.word.replace(/\s+/g,""),a=0;a<o.length;a++)if(void 0!==t.letters[o[a].toLowerCase()])for(var s=0;s<t.letters[o[a].toLowerCase()].length;s++){var r=t.letters[o[a].toLowerCase()][s].x,i=t.letters[o[a].toLowerCase()][s].y;(t.isCellFilled(r+1,i)||t.isCellFilled(r-1,i))&&this.canWordIntersectVertically(r,i,e,a,t)?n.push({x:r,y:i,letterIndex:a,vertical:!0}):this.canWordIntersectHorizontally(r,i,e,a,t)&&n.push({x:r,y:i,letterIndex:a,vertical:!1})}return 0<n.length?n[Math.floor(Math.random()*n.length)]:null}}}),angular.module("atoolEngineCrossword").factory("CrosswordMatrix",["underscore","CrosswordCell",function(h,v){var e=function(e,t,n){this.startX=e,this.startY=t,this.endX=0,this.endY=0,this.structure=[],this.clues=[],this.locked=!1,this.letters={},this.number=1,this.hiddenWord=n||"",this.letterPositions=[];for(var o=0;o<t;o++){this.structure[o]=[];for(var a=0;a<e;a++)this.structure[o][a]={}}};return angular.extend(e.prototype,{_findClueForWord:function(e){for(var t=0;t<this.clues.length;t++)if(this.clues[t].id===e)return this.clues[t]},_isCellOutsideCrosswordBox:function(e,t){return e<this.startX||e>this.endX||e>=this.startX&&e<=this.endX&&(t<this.startY||t>this.endY)},_markEmptyCells:function(){for(var e=0;e<this.structure.length;e++)for(var t=0;t<this.structure[e].length;t++)this.isCellFilled(t,e)||this._isCellOutsideCrosswordBox(t,e)&&(this.structure[e][t]="empty")},_removeEmptyCells:function(){for(var e=0;e<this.structure.length;e++){for(var t=!0,n=0;n<this.structure[e].length;n++)"empty"===this.structure[e][n]?(this.structure[e].splice(n,1),n--):t=!1;t&&(this.structure.splice(e,1),e--)}},_recalculateCoordinates:function(){for(var e=0;e<this.structure.length;e++)for(var t=0;t<this.structure[e].length;t++)this.structure[e][t].coordinates&&(this.structure[e][t].coordinates=[e,t])},_recalculateNumbers:function(){this.number=1;for(var e=0;e<this.letterPositions.length;e++)if(h.isArray(this.letterPositions[e]))for(var t=0;t<this.letterPositions[e].length;t++)h.isArray(this.letterPositions[e][t])&&(h.each(this.letterPositions[e][t],function(e){this._findClueForWord(e.id).number=this.number,this.getCell(e.x,e.y).number.push(this.number),2===this.getCell(e.x,e.y).word.length&&this.getCell(e.x,e.y).word[0]===e.id&&0===this.getCell(e.x,e.y).index[0]&&(this.getCell(e.x,e.y).number=this.getCell(e.x,e.y).number.reverse())},this),this.number++)},_findSpacePositions:function(e){for(var t=[],n=0;n<e.length;n++)" "===e[n]&&(e.splice(n,1),n--,t.push(n));return t},_recalculateFields:function(){this._recalculateNumbers()},_setHiddenWordLetters:function(){for(var e=h.extend({},this.letters),t=0;t<this.hiddenWord.length;t++){if(!h.isArray(e[this.hiddenWord[t]])||h.isEmpty(e[this.hiddenWord[t]]))return!1;var n=Math.floor(Math.random()*e[this.hiddenWord[t]].length),o=e[this.hiddenWord[t]][n];this.structure[o.y][o.x].hidden=!0,e[this.hiddenWord[t]].splice(n,1)}return!0},insertWord:function(e,t,n,o,a){for(var s=this._findSpacePositions(e.word.trim().split("")),r=e.word.replace(/\s+/g,""),i=0;i<r.length;i++){var l,c;r[i].toLowerCase();c=a?(l=n,o+i):(l=n+i,o),h.isArray(this.letterPositions[o])||(this.letterPositions[o]=[]),h.isArray(this.letterPositions[o][n])||(this.letterPositions[o][n]=[]),this.letterPositions[o][n].push({x:l,y:c,id:t});var d=[t],p=[i],u=[i===r.length-1],g=[!a],m=(this.number,this.number,e.example),f=-1!==s.indexOf(i)?[!0]:[!1];this.isCellFilled(l,c)&&(m=!!this.getCell(l,c).example||m,(d=this.getCell(l,c).word).push(t),(p=this.getCell(l,c).index).push(i),(u=this.getCell(l,c).isLastIndex).push(i===r.length-1),(g=this.getCell(l,c).horizontal).push(!a),this.getCell(l,c).number.push(this.number),(f=this.getCell(l,c).spaceAfter).push(-1!==s.indexOf(i))),this.fillCell(l,c,new v(r[i],m,-1!==e.fixed.indexOf(i),d,[],[c,l],!1,p,u,g,f))}this.clues.push({id:t,number:this.number,clue:e.clue,type:e.type,horizontal:!a}),this.number++},isCellFilled:function(e,t){return!!this.structure[t][e].letter},fillCell:function(e,t,n){if(this.locked)throw new Error("Cannot fill locked structure");n.coordinates=[t,e],this.structure[t][e]=n,this.startX=e<this.startX?e:this.startX,this.startY=t<this.startY?t:this.startY,this.endX=e>this.endX?e:this.endX,this.endY=t>this.endY?t:this.endY,Array.isArray(this.letters[n.letter.toLowerCase()])?this.letters[n.letter.toLowerCase()].push({x:e,y:t}):this.letters[n.letter.toLowerCase()]=[{x:e,y:t}]},isCellOutsideMatrix:function(e,t){return t>this.getHeight()||t<0||e>this.getWidth()||e<0},getCell:function(e,t){return this.structure[t][e]},finalize:function(){return!!this._setHiddenWordLetters()&&(this._recalculateFields(),this._markEmptyCells(),this._removeEmptyCells(),this._recalculateCoordinates(),this.locked=!0)},getStructure:function(){return this.locked||this.finalize(),this.structure},getClues:function(){return this.clues},getWidth:function(){return this.structure[0].length},getHeight:function(){return this.structure.length},getLetters:function(){return this.letters}}),e}]),angular.module("atoolEngineCrossword").service("HorizontalCrosswordPositionValidator",function(){return{canWordIntersectHorizontally:function(e,t,n,o,a){return!a.isCellFilled(e,t)},findRandomValidIntersection:function(e,t,n){for(var o=e.word.replace(/\s+/g,""),a=[],s=0;s<o.length;s++)if(void 0!==t.hiddenWordArray[o[s].toLowerCase()])for(var r=0;r<t.hiddenWordArray[o[s].toLowerCase()].length;r++){var i=t.hiddenWordArray[o[s].toLowerCase()][r].x,l=t.hiddenWordArray[o[s].toLowerCase()][r].y;this.canWordIntersectHorizontally(i,l,e,s,t)&&a.push({x:i,y:l,letterIndex:s,vertical:!1})}return n&&(a=_.sortBy(a,function(e){return e.y})),0<a.length?n?a[0]:a[Math.floor(Math.random()*a.length)]:null}}}),angular.module("atoolEngineCrossword").factory("HorizontalCrosswordMatrix",["CrosswordMatrix","underscore","CrosswordCell",function(o,l,e){var t=function(e,t,n){o.apply(this,arguments),this.hiddenWordArray={}};return angular.extend(t.prototype,o.prototype),angular.extend(t.prototype,{_setHiddenWordLetters:function(){var t=!0;return l.each(this.hiddenWordArray,function(e){l.each(e,function(e){this.structure[e.y][e.x].hidden=!0,this.isCellFilled(e.x,e.y)||(t=!1)},this)},this),t},insertHiddenWord:function(e,t,n){for(var o,a,s=e.replace(/\s+/g,""),r=0;r<s.length;r++){var i=s[r].toLowerCase();o=t,a=n+r,l.isEmpty(this.hiddenWordArray[i])?this.hiddenWordArray[i]=[{letter:i,x:o,y:a}]:this.hiddenWordArray[i].push({letter:i,x:o,y:a})}return{sx:t,sy:n,ex:o,ey:a}}}),t}]),angular.module("atoolEngineCrossword").factory("HorizontalCrossword",["underscore","GeneralCrossword","HorizontalCrosswordMatrix","HorizontalCrosswordPositionValidator","CrosswordRankSorter","CrosswordViewStructure",function(d,n,p,u,e,t){var g=100,m=100,o=function(e,t){this.editorsOrder="editorsOrder"===e.answers.seed&&!t,n.apply(this,arguments)};return angular.extend(o.prototype,n.prototype),angular.extend(o.prototype,{_createStructure:function(e){var t,n=new p(g,g,e.answers.hiddenWord),o=0;t=this.editorsOrder?e.answers.words:d.isEmpty(e.answers.hiddenWord)&&this.randomize?d.shuffle(e.answers.words):d.sortBy(e.answers.words,function(e){return e.word.length}).reverse();var a=[],s=e.answers.hiddenWord?n.insertHiddenWord(e.answers.hiddenWord,g/2-Math.floor(e.answers.hiddenWord.length/2),m/2):{sx:g/2,sy:m/2};a.push(t);for(var r=0;r<a.length;r++){for(var i=!1,l=0;l<a[r].length;l++){var c=u.findRandomValidIntersection(a[r][l],n,this.editorsOrder);d.isEmpty(c)?(a.length-1==r&&a.push([]),a[r+1].push(a[r][l])):(c.vertical?n.insertWord(a[r][l],a[r][l].id,c.x,c.y-c.letterIndex,!0):n.insertWord(a[r][l],a[r][l].id,c.x-c.letterIndex,c.y,!1),o++,i=!0)}if(!i){l=1;s.ex||(s.ex=s.sx,s.ey=s.sy),a[a.length-1].forEach(function(e){n.insertWord(e,e.id,s.ex-Math.floor(e.word.length/2),s.ey+l,!1),l++,o++});break}}return!!(o>=t.length&&n.finalize())&&n}}),o}]),angular.module("atoolEngineCrossword").factory("GeneralCrossword",["underscore","CrosswordMatrix","CrosswordPositionValidator","CrosswordRankSorter","CrosswordViewStructure",function(d,p,u,e,l){var g=100,m=100,t=function(e,t){this.validStructures=[],this.randomize=t;var n=this._createSquareCrossword(50,e);if(!n)throw new Error("Cannot generate crossword");this.structure=n.getStructure(),this.clues=n.getClues()};return angular.extend(t.prototype,{_createSquareCrossword:function(e,t){var n,o,a,s=0,r=null,i=100;if(!this.randomize)return""!==t.answers.seed&&Math.seedrandom(t.answers.seed),this._createStructure(t);for(;s<e;)s++,a=Math.seedrandom(),(n=this._createStructure(t))&&(this.validStructures.push(new l(a,n)),(o=Math.max(n.getStructure().length,n.getStructure()[0].length))<i&&(i=o,r=n));return r},_createStructure:function(e){var t=new p(g,g,e.answers.hiddenWord),n=0,o=d.sortBy(e.answers.words,function(e){return e.word.length}).reverse(),a=[],s=!1!==this.randomize&&Math.floor(2*Math.random());t.insertWord(o[0],o[0].id,g/2-Math.floor(o[0].word.length/2),m/2,s),a.push(o.slice(1)),n++;for(var r=0;r<a.length;r++){for(var i=!1,l=0;l<a[r].length;l++){var c=u.findRandomValidIntersection(a[r][l],t);d.isEmpty(c)?(a.length-1==r&&a.push([]),a[r+1].push(a[r][l])):(c.vertical?t.insertWord(a[r][l],a[r][l].id,c.x,c.y-c.letterIndex,!0):t.insertWord(a[r][l],a[r][l].id,c.x-c.letterIndex,c.y,!1),n++,i=!0)}if(!i)break}return!(n!==o.length||!t.finalize())&&t},getStructure:function(){return this.structure},getClues:function(){return this.clues},getRankedStructures:function(){return e.sort(this.validStructures)}}),t}]),angular.module("atoolEngineCrossword").factory("CrosswordFactory",["GeneralCrossword","HorizontalCrossword",function(n,o){return function(e,t){return"horizontal"===e.display||"horizontal-keyboard"===e.display?new o(e,t):new n(e,t)}}]),angular.module("atoolEngineCrossword").factory("CrosswordCell",function(){return function(e,t,n,o,a,s,r,i,l,c,d){this.letter=e,this.example=t,this.fixed=n,this.word=o,this.number=a,this.coordinates=s,this.hidden=r,this.index=i,this.isLastIndex=l,this.horizontal=c,this.spaceAfter=d}}),angular.module("atoolEngine",["ngCookies","ngSanitize","ui.router","ui.keypress","ui.bootstrap","uuid","LocalStorageModule","angular-svg-round-progressbar","ui.tinymce","ngDragDrop","atoolEngineCrossword"]).config(["localStorageServiceProvider","$rootScopeProvider","$compileProvider",function(e,t,n){e.setPrefix(""),t.digestTtl(30),n.imgSrcSanitizationWhitelist(/^\s*((https?|ftp|file|blob|chrome-extension):|data:image\/)/),n.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|tel|file|chrome-extension):/)}]),angular.module("atoolEngine").directive("engineCengageWritingExperience",["Gap","underscore","afterViews","$interval","$uibModal","$window","adapterProxy","mobileDetector",function(i,l,c,d,p,e,u,g){return{require:["^lo","^task","?^nonmarkableBlock","?^engineSegmented"],scope:{options:"="},restrict:"E",replace:"true",templateUrl:"app/formats/cengage/writingExperience/writingExperience.tpl.html",link:function(o,e,t,n){var a,s=n[0],r=n[1];null!==n[2]&&(o.options.nonmarkableBlockController=n[2]),null!==n[3]&&(a=n[3]),o.dataCollector=s.getDataCollector(),o.loState=s.getLoState(),o.saveManager=s.getSaveManager(),o.footerManager=s.getFooterManager(),o.gapModel=new i(o,o.options,null,{loState:s.getLoState()},function(){o.timerData&&o.timerData.handler&&d.cancel(o.timerData.handler),o.initWritingExperience()}),r.getTaskModel().addGap(o.gapModel),"system"===o.options.markedBy&&o.gapModel.registerState(0,function(){return!1},function(){return!0},function(){return o.gapModel.getPointsToGain()}),o.gapModel.evaluateStates(),o.loState.addObserver(function(e,t){"solving"===e&&"report"===t&&o.switchToNextScreen(o.options.blocks.length-1)}),o.gapModel.registerCustomSave(function(){return{timerData:o.timerData,currentScreenIndex:o.currentScreenIndex,blocks:l.map(o.options.blocks,function(e){return{id:e.id,visited:e.visited,prompts:e.prompts,overallTime:e.overallTime,startTime:e.startTime,endTime:e.endTime}})}}),o.gapModel.registerCustomRestore(function(e){var n=new Date-new Date(e.timerData.start)-e.timerData.current;l.each(e.blocks,function(t){var e=l.find(o.options.blocks,function(e){return e.id===t.id});e.visited=t.visited,e.prompts=t.prompts,e.overallTime=t.overallTime||0,t.startTime&&(e.startTime=new Date(new Date(t.startTime).getTime()+n)),t.endTime&&(e.endTime=new Date(new Date(t.endTime).getTime()+n))}),o.timerData.start=new Date(new Date(e.timerData.start).getTime()+n),o.timerData.current=e.timerData.current,o.timerData.left=e.timerData.left,e.timerData.handler&&o.startTimer(),o.changeScreen(0,e.currentScreenIndex)}),o.findCurrentScreenSubblocks=function(){o.currentScreenModel=null,o.currentScreenStimulus=null,o.currentScreenModel=l.find(o.currentScreen.blocks,function(e){return"model"===e.type}),o.currentScreenStimulus=l.find(o.currentScreen.blocks,function(e){return"stimulus"===e.type})},o.initWritingExperience=function(){o.gapModel.userAnswer="",o.currentScreenIndex=0,o.currentScreen=o.options.blocks[0],o.findCurrentScreenSubblocks(),o.customStimulusPrompts=null,o.timerData={total:0,start:null,current:0,left:null,percent:0,handler:null},l.each(o.options.blocks,function(e){o.timerData.total+=60*(e.time||0)*1e3,l.each(e.prompts,function(e){e.value=null}),e.overallTime=0,e.startTime=null,e.endTime=null,delete e.active,delete e.visited}),o.timerData.left=o.timerData.total,o.currentScreen.active=!0,o.tinymceOptions=l.defaults(u.getTinymceDefaultConfig(this.dataCollector),{menu:{},toolbar:"bold | italic | underline",skin:!1,statusbar:!1,plugins:"wordcount",height:"500",content_style:"* {font-family: 'Open Sans', Tahoma, Verdana, sans-serif;}",setup:function(e){o.editor=e}}),a&&(g.isPhone()?(o.activityElement=a.compileElement("app/formats/cengage/writingExperience/writingExperience.phone.tpl.html",o,s,r),a.replaceCustomActivity(o.activityElement)):(o.activityElement=a.compileElement("app/formats/cengage/writingExperience/writingExperience.activity.tpl.html",o,s,r),a.replaceCustomActivity(o.activityElement),o.menuElement=a.compileElement("app/formats/cengage/writingExperience/writingExperience.menu.tpl.html",o,s,r),a.replaceCustomMenu(o.menuElement),o.headerElement=a.compileElement("app/formats/cengage/writingExperience/writingExperience.header.tpl.html",o,s,r),a.replaceCustomHeader(o.headerElement),a.clearCustomStimulus(),a.clearCustomStimulusData(),a.clearCustomModelData())),o.footerManager.get("submit").modifyAttr("visible","writingActivity",!1),o.footerManager.get("showAnswers").modifyAttr("visible","writingActivity",!1),o.footerManager.get("viewTimeSpentWriting").modifyAttr("visible","writingActivitySubmited",!1),o.footerManager.get("printWriting").modifyAttr("visible","writingActivityScreens",!1)},o.shouldShowNextButton=function(){return"nglWE-welcome"!==o.currentScreen.type&&o.currentScreenIndex<o.options.blocks.length-2},o.startTimer=function(){o.timerData.handler=d(function(){o.timerData.current=new Date-o.timerData.start,o.timerData.left=o.timerData.total-o.timerData.current,o.timerData.percent=Math.min(100,Math.floor(o.timerData.current/o.timerData.total*100))},100)},o.handleTimer=function(e,t){o.options.timer&&("nglWE-welcome"===e.type&&(o.timerData.start=new Date,o.startTimer()),"nglWE-final"===t.type&&d.cancel(o.timerData.handler))},o.viewTimeSpent=function(){p.open({templateUrl:"app/formats/cengage/writingExperience/viewTimeSpent.popup.tpl.html",scope:o,appendTo:s.getModalPlaceholder(),controller:["$scope","$uibModalInstance",function(e,t){e.modalInstance=t,e.sections=l.chain(e.options.blocks).map(function(e){if(e.time)return{total:60*e.time*1e3,spent:e.overallTime,name:e.pageName,overtimed:e.overallTime>60*e.time*1e3}}).compact().value(),e.summary=l.reduce(e.sections,function(e,t){return e.total+=t.total,e.spent+=t.spent,e.overtimed=e.spent>e.total,e},{total:0,spent:0,overtimed:!1})}]})},o.print=function(){o.options.timer&&d.cancel(o.timerData.handler);var t="<html><body>";"nglWE-plan"===o.currentScreen.type?l.each(o.currentScreen.prompts,function(e){t+="<strong>"+e.name+"</strong><br />"+(e.value||"")+"<br /><br />"}):t+=o.gapModel.userAnswer,t+="</body></html>";var e=document.createElement("iframe");angular.element(e).css({visibility:"hidden",position:"absolute"}),document.body.appendChild(e),e.contentWindow.document.open(),e.contentWindow.document.write(t),e.contentWindow.document.close(),e.contentWindow.document.execCommand("print",!1,null)||e.contentWindow.print(),o.options.timer&&o.startTimer(),c.chain(function(){e.remove()})},o.changeScreen=function(e,t){var n=o.options.blocks[e];n.active=!1,n.visited=!0,0<t&&"nglWE-plan"===o.options.blocks[t-1].type?o.customStimulusPrompts=o.options.blocks[t-1].prompts:o.customStimulusPrompts=null,o.currentScreenIndex=t,o.currentScreen=o.options.blocks[o.currentScreenIndex],o.currentScreen.active=!0,o.findCurrentScreenSubblocks(),a.replaceCustomModelData(this.currentScreenModel),o.customStimulusPrompts?(o.stimulusElement=a.compileElement("app/formats/cengage/writingExperience/writingExperience.custom.stimulus.tpl.html",o,s,r),a.replaceCustomStimulus(o.stimulusElement)):a.replaceCustomStimulusData(this.currentScreenStimulus),o.currentScreenIndex===o.options.blocks.length-2?o.footerManager.get("submit").modifyAttr("visible","writingActivity",!0):o.footerManager.get("submit").modifyAttr("visible","writingActivity",!1),"nglWE-welcome"!==o.currentScreen.type&&o.footerManager.get("printWriting").modifyAttr("visible","writingActivityScreens",!0),a.recalcColumnSizes()},o.switchToNextScreen=function(e){var t=o.currentScreen;t.endTime=new Date,t.startTime&&(t.overallTime+=t.endTime-t.startTime),o.changeScreen(o.currentScreenIndex,e||o.currentScreenIndex+1),o.currentScreen.startTime=new Date,o.handleTimer(t,o.currentScreen),o.saveManager.subscribeForPeriodicSave()},o.canNavigateFree=function(e){if(o.options.forwardOnlyNavigation||"nglWE-welcome"===o.currentScreen.type||"nglWE-final"===o.currentScreen.type)return!1;var t=o.options.blocks[e];return!("nglWE-welcome"===t.type||"nglWE-final"===t.type)},o.loState.addObserver(function(e,t){"solving"===e&&"report"===t&&o.options.timer&&o.footerManager.get("viewTimeSpentWriting").modifyAttr("visible","writingActivitySubmited",!0)}),o.footerManager.registerButton("viewTimeSpentWriting",250).addText("cengage_we_finish_viewtimespent").addAttr("visible").addAttr("enabled").addClass("we-time-btn").addCallback("click",o.viewTimeSpent),o.footerManager.registerButton("printWriting",260).addText("cengage_we_finish_print").addAttr("visible").addAttr("enabled").addClass("we-print-btn").addCallback("click",o.print).attrWatchModify("enabled","writingNotEmpty",function(){return"nglWE-plan"===o.currentScreen.type?l.any(o.currentScreen.prompts,"value"):!!o.gapModel.userAnswer}),o.footerManager.get("submit").attrWatchModify("enabled",o.options.id+"-answerModified",function(){return!!o.gapModel.userAnswer}),o.initWritingExperience()}}}]),angular.module("atoolEngine").directive("engineCengageTicTacToe",["Gap","underscore","$uibModal","$timeout","afterViews","blockTypesHelper","ticTacToeLabelService","objectHelper","HtmlAudioPlayer","adapterProxy",function(i,l,d,p,u,g,m,f,h,v){return{require:["^lo","^task","?^nonmarkableBlock"],scope:{options:"="},restrict:"E",templateUrl:"app/formats/cengage/tic-tac-toe/tic-tac-toe.tpl.html",link:function(o,c,e,t){var a=t[0],n=t[1];null!==t[2]&&(o.options.nonmarkableBlockController=t[2]),o.dataCollector=a.getDataCollector(),o.loState=a.getLoState(),o.saveManager=a.getSaveManager(),o.footerManager=a.getFooterManager(),o.cpt=a.getCpt(),o.innerGapReportTime=4e3;var s=[{url:v.getAudioUriPrefix(o.dataCollector)+"TicTacToeNegative.ogg",type:"audio/ogg"},{url:v.getAudioUriPrefix(o.dataCollector)+"TicTacToeNegative.mp3",type:"audio/mpeg"}],r=[{url:v.getAudioUriPrefix(o.dataCollector)+"TicTacToePositive.ogg",type:"audio/ogg"},{url:v.getAudioUriPrefix(o.dataCollector)+"TicTacToePositive.mp3",type:"audio/mpeg"}];o.negativeAudio=new h(s,o.dataCollector),o.positiveAudio=new h(r,o.dataCollector),o.gapModel=new i(o,o.options,[],{loState:a.getLoState()},function(){o.initTicTacToe()}),n.getTaskModel().addGap(o.gapModel),o.cpt.enable(),"system"===o.options.markedBy&&o.gapModel.registerState(0,function(){return!1},function(){return!0},function(e){return e.isCorrect()?1:0}),o.footerManager.registerButton("checkGap",250).addText("cengage_check_button").addAttr("visible").addAttr("enabled").addClass("check-gap-button").addCallback("click",function(){o.checkGap()}),o.footerManager.registerButton("skipGap",260).addText("cengage_skip_button").addAttr("visible").addAttr("enabled").addClass("skip-gap-button").addCallback("click",function(){o.skipGap()}),o.solutions=[{cells:[0,1,2],strike:[0,1,6,1],strikePadding:[0,1,2,1]},{cells:[3,4,5],strike:[0,3,6,3],strikePadding:[0,1,2,1]},{cells:[6,7,8],strike:[0,5,6,5],strikePadding:[0,1,2,1]},{cells:[0,3,6],strike:[1,0,1,6],strikePadding:[1,0,1,2]},{cells:[1,4,7],strike:[3,0,3,6],strikePadding:[1,0,1,2]},{cells:[2,5,8],strike:[5,0,5,6],strikePadding:[1,0,1,2]},{cells:[0,4,8],strike:[0,0,6,6],strikePadding:[0,0,2,2]},{cells:[2,4,6],strike:[6,0,0,6],strikePadding:[2,0,0,2]}],o.hasGameFinished=function(){return o.getWinningSolution(0)||o.getWinningSolution(1)||0===o.game.availableQuestions},o.getWinningSolution=function(n){return l.find(o.solutions,function(e){return l.every(e.cells,function(e){var t=o.questions[e];return o.isQuestionCorrect(t)&&o.getLastTeamAnsweringQuestion(t)===n})})},o.strikeBoard=function(e){for(var t=c.find(".board-strike"),n=c.find(".board"),o=[n.width(),n.height()],a=c.find(".board-overlay"),s=[a.width(),a.height()],r=[(s[0]-o[0])/2,(s[1]-o[1])/2],i=["x1","y1","x2","y2"],l=0;l<4;l++)t.attr(i[l],e.strike[l]/6*o[l%2]+e.strikePadding[l]*r[l%2])},o.pickNewQuestions=function(){return l.chain(o.options.blocks).filter({type:"cptQS"}).shuffle().first(9).map(function(e){return{exercise:e,attempts:[]}}).value()},o.initTicTacToe=function(){o.footerManager.get("submit").modifyAttr("visible","TicTacToeActivity",!1),o.footerManager.get("showAnswers").modifyAttr("visible","TicTacToeActivity",!1),o.footerManager.get("tryAgain").modifyAttr("visible","TicTacToeActivity",!1),o.footerManager.get("checkGap").modifyAttr("visible","exerciseDisplayed",!1),o.footerManager.get("skipGap").modifyAttr("visible","exerciseDisplayed",!1),o.questions=o.pickNewQuestions(),o.mode="ttt",o.isItADraw=!1,o.game={teams:[{name:"X"},{name:"O"}],turn:0,currentQuestion:null,availableQuestions:9},o.footerManager.registerButton("resetGame",250).addText("cengage_cpt_reset_game").addAttr("visible").addAttr("enabled").addClass("reset-game-button").addCallback("click",function(){o.restartGame(!1)}),o.footerManager.registerButton("newGame",260).addText("cengage_cpt_new_game").addAttr("visible").addAttr("enabled").addClass("new-game-button").addCallback("click",function(){o.restartGame(!0)}),o.assignLabels(),o.footerManager.get("newGame").modifyAttr("visible","oneExercisePerQuestion",!o.oneExercisePerQuestion),o.footerManager.get("newGame").modifyAttr("enabled","gameStarted",!1),o.footerManager.get("resetGame").modifyAttr("enabled","gameStarted",!1)},o.restartGame=function(e){o.footerManager.get("checkGap").modifyAttr("visible","exerciseDisplayed",!1),o.footerManager.get("skipGap").modifyAttr("visible","exerciseDisplayed",!1),o.feedbackTimeout&&(p.cancel(o.feedbackTimeout),o.feedbackTimeout=null),o.mode="ttt",o.winner=null,o.game.turn=0,o.isItADraw=!1,o.game.currentQuestion=null,o.game.availableQuestions=9,e?o.questions=o.pickNewQuestions():l.each(o.questions,function(e){e.attempts=[]}),o.assignLabels(),o.footerManager.get("newGame").modifyAttr("enabled","gameStarted",!1),o.footerManager.get("resetGame").modifyAttr("enabled","gameStarted",!1)},o.assignLabels=function(){l.each(o.questions,function(e){if(e.exercise.squareName)e.label=e.exercise.squareName;else{var t=f.getPairs(e.exercise,["type","display"],function(e){return g.isGap(e.type)},!0)[0];e.label=m.getLabel(o.dataCollector,t.type,t.display)}})},o.showGap=function(e){o.mode="exercise",o.footerManager.get("checkGap").modifyAttr("visible","exerciseDisplayed",!0),o.footerManager.get("skipGap").modifyAttr("visible","exerciseDisplayed",!0),o.footerManager.get("resetGame").modifyAttr("visible","exerciseDisplayed",!1),o.footerManager.get("newGame").modifyAttr("visible","exerciseDisplayed",!1),o.game.currentQuestion=e},o.skipGap=function(){o.lastCorrectlyAnswered=null,o.footerManager.get("checkGap").modifyAttr("visible","exerciseDisplayed",!1),o.footerManager.get("skipGap").modifyAttr("visible","exerciseDisplayed",!1),o.footerManager.get("resetGame").modifyAttr("visible","exerciseDisplayed",!0),o.footerManager.get("newGame").modifyAttr("visible","exerciseDisplayed",!0),o.mode="ttt",o.game.currentQuestion=null},o.showFinishModal=function(){d.open({templateUrl:"app/formats/cengage/tic-tac-toe/finish.popup.tpl.html",scope:o,appendTo:a.getModalPlaceholder(),controller:["$scope","$uibModalInstance","cptPopupTimeout",function(e,t,n){e.modalInstance=t,e.winner=o.getWinner(),e.isItADraw=o.isItADraw,a.isCptMode()&&p(function(){e.modalInstance.dismiss()},n)}]})},o.getClassesForTeam=function(e,t){var n={active:o.game.turn===t};return n["team-"+e.name]=!0,n},o.checkGap=function(){o.footerManager.get("checkGap").modifyAttr("visible","exerciseDisplayed",!1),o.footerManager.get("skipGap").modifyAttr("visible","exerciseDisplayed",!1),o.lastCorrectlyAnswered=null,o.cpt.renderGapAsReport(),o.exerciseClass="exercise-report",o.game.currentQuestion.exercise.result=o.cpt.getGapState(),o.game.currentQuestion.attempts.unshift({team:o.game.turn,result:o.cpt.getGapState()}),o.game.currentQuestion.exercise.result.isCorrect()?o.positiveAudio.play():o.negativeAudio.play(),o.isQuestionAttemptedTwice(o.game.currentQuestion)&&!o.isQuestionCorrect(o.game.currentQuestion)?o.feedbackTimeout=p(function(){o.cpt.renderGapAsShowAnswer(),o.exerciseClass="exercise-show-answer",o.handleSolvedExerciseAfterTimeout(),o.positiveAudio.play()},o.innerGapReportTime):o.handleSolvedExerciseAfterTimeout()},o.handleSolvedExerciseAfterTimeout=function(){o.feedbackTimeout=p(function(){o.exerciseClass="",o.footerManager.get("newGame").modifyAttr("enabled","gameStarted",!0),o.footerManager.get("resetGame").modifyAttr("enabled","gameStarted",!0),o.footerManager.get("resetGame").modifyAttr("visible","exerciseDisplayed",!0),o.footerManager.get("newGame").modifyAttr("visible","exerciseDisplayed",!0);var e=o.getWinningSolution(o.game.turn);o.isQuestionCorrect(o.game.currentQuestion)&&(o.lastCorrectlyAnswered=o.game.currentQuestion),(o.isQuestionAttemptedTwice(o.game.currentQuestion)||o.isQuestionCorrect(o.game.currentQuestion))&&o.game.availableQuestions--,e?(o.winner=o.game.turn,u.chain(function(){o.strikeBoard(e)}),o.mode="finish",o.showFinishModal()):0===o.game.availableQuestions?(o.mode="finish",o.isItADraw=!0,o.showFinishModal()):(o.game.turn=(o.game.turn+1)%o.game.teams.length,o.mode="ttt",o.game.currentQuestion=null),o.feedbackTimeout=null},o.innerGapReportTime)},o.isQuestionAttempted=function(e){return 0<e.attempts.length},o.isQuestionAttemptedOnce=function(e){return 1===e.attempts.length},o.isQuestionAttemptedTwice=function(e){return 2===e.attempts.length},o.isQuestionCorrect=function(e){return o.isQuestionAttempted(e)&&e.attempts[0].result.isCorrect()},o.getLastTeamAnsweringQuestion=function(e){return e.attempts[0].team},o.getQuestionLabel=function(e){return o.isQuestionCorrect(e)?o.game.teams[o.getLastTeamAnsweringQuestion(e)].name:e.label},o.getClassesForQuestion=function(e){var t=o.isQuestionCorrect(e);return{solved:t,"team-X":t&&"X"===o.game.teams[o.getLastTeamAnsweringQuestion(e)].name,"team-O":t&&"O"===o.game.teams[o.getLastTeamAnsweringQuestion(e)].name,"attempted-once":o.isQuestionAttemptedOnce(e)&&!t,"attempted-by-X":o.isQuestionAttemptedOnce(e)&&!t&&"X"===o.game.teams[o.getLastTeamAnsweringQuestion(e)].name,"attempted-by-O":o.isQuestionAttemptedOnce(e)&&!t&&"O"===o.game.teams[o.getLastTeamAnsweringQuestion(e)].name,"attempted-twice":o.isQuestionAttemptedTwice(e)&&!t,"last-solved":o.lastCorrectlyAnswered===e}},o.shouldQuestionBeDisabled=function(e){return"ttt"!==o.mode||o.isQuestionAttemptedTwice(e)||o.isQuestionCorrect(e)},o.getWinner=function(){return o.game.teams[o.winner]},o.$on("$destroy",function(){o.positiveAudio.destroy(),o.negativeAudio.destroy()}),o.initTicTacToe()}}}]),angular.module("atoolEngine").service("ticTacToeLabelService",["underscore","$filter",function(a,e){var s=[{type:"GF",display:"dnd",label:"cengage_ttt_label_gf_dnd"},{type:"GF",display:"fillin",label:"cengage_ttt_label_gf_fillin"},{type:"SC",display:"dropdown",label:"cengage_ttt_label_sc_dropodown"},{type:"SC",label:"cengage_ttt_label_sc"},{type:"MC",label:"cengage_ttt_label_mc"},{type:"MAT",label:"cengage_ttt_label_mat"},{type:"COR",label:"cengage_ttt_label_cor"},{type:"CAT",label:"cengage_ttt_label_cat"},{type:"ORD",display:"sentenceScramble",label:"cengage_ttt_label_ord_sentenceScramble"},{type:"ORD",display:"sequencing",label:"cengage_ttt_label_ord_sequencing"},{type:"ORD",label:"cengage_ttt_label_ord"},{type:"WR",label:"cengage_ttt_label_wr"},{type:"CW",label:"cengage_ttt_label_cw"},{type:"ML",label:"cengage_ttt_label_ml"},{type:"FC",label:"cengage_ttt_label_fc"},{type:"WS",label:"cengage_ttt_label_ws"},{type:"nglSP",label:"cengage_ttt_label_nglSP"},{type:"nglDIA",label:"cengage_ttt_label_nglDIA"},{type:"nglCOR",label:"cengage_ttt_label_nglCOR"},{type:"nglHL",label:"cengage_ttt_label_nglHL"},{type:"nglESS",label:"cengage_ttt_label_nglESS"},{type:"nglSI",label:"cengage_ttt_label_nglSI"},{type:"sriMC",label:"cengage_ttt_label_sriMC"}],r=e("engineTranslate");return{getLabel:function(e,t,n){var o=a.find(s,{type:t,display:n})||a.find(s,function(e){return e.type===t&&a.isUndefined(e.display)});return r(o.label,e)}}}]),angular.module("atoolEngine").directive("engineCengageSriMultipleChoice",["Gap","underscore","$uibModal","rfc4122","$timeout","$interval","audioCheckingService","adapterProxy",function(i,l,c,d,p,u,g,m){return{require:["^lo","^task","?^nonmarkableBlock"],scope:{options:"="},restrict:"E",templateUrl:"app/formats/cengage/sri-multiple-choice/sri-multiple-choice.tpl.html",link:function(n,e,t,o){var a=o[0],s=o[1];null!==o[2]&&(n.options.nonmarkableBlockController=o[2]),n.dataCollector=a.getDataCollector(),n.loState=a.getLoState(),n.saveManager=a.getSaveManager();var r=m.getSRIUrls(n.dataCollector);n.correctAnswer=(l.find(n.options.answers,function(e){return e.isCorrect})||{}).option,n.gapModel=new i(n,n.options,n.correctAnswer,{loState:a.getLoState()},function(){n.initSriMultipleChoice()}),s.getTaskModel().addGap(n.gapModel),n.busy=!1,"system"===n.options.markedBy&&n.gapModel.registerState(0,function(){return void 0===l.find(n.options.answers,function(e){return e.selected})},function(){return void 0!==l.find(n.options.answers,function(e){return e.selected&&e.isCorrect})},function(e){return e.isCorrect()?n.gapModel.getPointsToGain():0}),n.gapModel.evaluateStates(),n.gapModel.registerCustomSave(function(){return{audioUri:n.audioUri}}),n.gapModel.registerCustomRestore(function(e){n.gapModel.userAnswer&&(l.find(n.options.answers,function(e){return e.option===n.gapModel.userAnswer}).selected=!0),n.audioUri=e.audioUri}),n.loState.addObserver(function(e,t){"solving"===e&&"report"===t&&n.recording&&n.stopRecording()}),n.getGrammarInfo=function(){return{grammarID:n.options.grammarID,questionData:{type:"MCQ",text:l.map(n.options.answers,function(e){return e.option}).join("~~")}}},n.showWarningModal=function(o){c.open({templateUrl:"app/formats/cengage/sri-multiple-choice/warning.popup.tpl.html",scope:n,appendTo:a.getModalPlaceholder(),controller:["$scope","$uibModalInstance","cptPopupTimeout",function(e,t,n){e.modalInstance=t,e.warningCode=o.warningCode,e.showCross=!a.isCptMode(),a.isCptMode()&&p(function(){e.modalInstance.dismiss()},n)}]})},n.showErrorModal=function(o){c.open({templateUrl:"app/formats/cengage/sri-multiple-choice/error.popup.tpl.html",scope:n,appendTo:a.getModalPlaceholder(),controller:["$scope","$uibModalInstance","cptPopupTimeout",function(e,t,n){e.modalInstance=t,e.errorCode=o.errorCode,e.showCross=!a.isCptMode(),a.isCptMode()&&p(function(){e.modalInstance.dismiss()},n)}]})},n.interpretResult=function(e){n.clearAnswers();var t=l.find(e.answerInterpretation,function(e){return e.wasSpoken}).input;n.gapModel.userAnswer=t,l.find(n.options.answers,function(e){return e.option===t}).selected=!0,p(function(){})},n.clearAnswers=function(){l.each(n.options.answers,function(e){e.selected=!1}),n.gapModel.userAnswer=null},n.analyzeSpeech=function(e){n.grammarInfo=n.getGrammarInfo(),n.recognizer=a.getSRISpeechClient().Recognizer({productID:n.options.productID}),n.recognizer.score(e.audioUri,n.grammarInfo).then(function(e){var t=e.result;n.clearAnswers(),t.isWarning()?n.showWarningModal(t.warning()):t.isError()?(console.log(t.error()),n.showErrorModal(t.error())):n.interpretResult(t.score()),n.busy=!1,n.gapModel.evaluateStates(),n.saveManager.saveOnEvent()}).catch(function(e){console.log("ERROR WHILE TRYING TO RECOGNIZE!"),console.log(e)})},n.recordingTimerCallback=function(e){var t=new Date;n.currentRecordingTime=Math.min(n.recordingTimeLimit,Math.floor((t-e)/1e3)),n.currentTimePercent=Math.floor(n.currentRecordingTime/n.recordingTimeLimit*100),n.currentRecordingTime===n.recordingTimeLimit&&(n.stopRecording(),u.cancel(n.recordingTimerPromise))},n.startRecordingProgressBar=function(){n.currentRecordingTime=0,n.currentTimePercent=0,n.recordingTimerPromise=u(n.recordingTimerCallback.bind(this,new Date),200)},n.stopRecordingProgressBar=function(){n.recordingTimerPromise&&u.cancel(n.recordingTimerPromise)},n.getClassesForGap=function(){return{solving:n.gapModel.shouldBeRenderedAsSolving(),"show-answer":n.gapModel.shouldBeRenderedAsShowAnswer(),report:n.gapModel.shouldBeRenderedAsReport()}},n.getClassesForAnswer=function(e){return{selected:n.gapModel.shouldBeRenderedAsSolving()&&e.selected,correct:n.gapModel.shouldBeRenderedAsReport()&&e.selected&&e.isCorrect||n.gapModel.shouldBeRenderedAsShowAnswer()&&e.isCorrect,wrong:n.gapModel.shouldBeRenderedAsReport()&&e.selected&&!e.isCorrect}},n.stopRecording=function(){n.stopButtonDisabled=!0,n.recording=!1,n.stopRecordingProgressBar(),n.busy=!0,n.recorder.stop().then(function(e){n.recorder.close(),n.stopButtonDisabled=!1,p(function(){}),n.analyzeSpeech(e),n.audioUri=r.dynaBucket+e.audioUri})},n.startRecording=function(){n.audioUri=null,n.startButtonDisabled=!0,n.uniqueRecordingID=d.v4(),n.recorder.newSession(n.activityID,n.uniqueRecordingID).then(function(){n.recording=!0,n.startButtonDisabled=!1,n.startRecordingProgressBar(),p(function(){}),n.recorder.start()}).catch(function(e){console.log(e)})},n.startPlayback=function(){n.currentAudio&&n.currentAudio.pause(),n.currentAudio=new Audio(n.audioUri),n.currentAudio.play(),n.currentAudio.addEventListener("ended",function(){n.$apply(function(){n.playing=!1})}),n.playing=!0},n.stopPlayback=function(){n.currentAudio&&n.currentAudio.pause(),n.playing=!1},n.initSriMultipleChoice=function(){n.recorder=a.getRecorder(),n.recordingTimeLimit=120,n.activityID=d.v4(),n.clearAnswers(),n.audioUri=null,g.showPopup(a)},n.initSriMultipleChoice()}}}]),angular.module("atoolEngine").directive("engineCengageSpeaking",["Gap","underscore","AudioPlayer","audioCheckingService","audioContextManager","rfc4122","$timeout","$interval","adapterProxy",function(i,l,e,c,d,p,u,g,m){return{require:["^lo","^task","?^nonmarkableBlock"],scope:{options:"="},restrict:"E",replace:"true",templateUrl:"app/formats/cengage/speaking/speaking.tpl.html",link:function(n,e,t,o){var a=o[0],s=o[1];null!==o[2]&&(n.options.nonmarkableBlockController=o[2]),n.dataCollector=a.getDataCollector(),n.loState=a.getLoState(),n.saveManager=a.getSaveManager(),n.footerManager=a.getFooterManager(),n.recordingLimit=180,n.hasModelAnswer=!!n.options.modelAnswer.links,n.busy=!1;var r=m.getSRIUrls(n.dataCollector);n.gapModel=new i(n,n.options,[],{loState:a.getLoState()},function(){n.cleanSpeaking(),n.initSpeaking()}),s.getTaskModel().addGap(n.gapModel),n.loState.addObserver(function(e,t){"solving"===e&&"report"===t&&n.cleanSpeaking()}),n.$on("engine-SegmentedScreen-OnLeave",function(){n.cleanSpeaking()}),"system"===n.options.markedBy&&n.gapModel.registerState(0,function(){return!n.gapModel.userAnswer},function(){return!0},function(e){return e.isCorrect()?n.gapModel.getPointsToGain():0}),n.gapModel.registerCustomRestore(function(){n.gapModel.userAnswer&&n.footerManager.get("submit").modifyAttr("enabled",n.options.id+"-answerModified",!0)}),n.startRecording=function(){n.uniqueRecordingID=p.v4(),n.recorder.newSession(n.activityID,n.uniqueRecordingID).then(function(){n.footerManager.get("submit").modifyAttr("enabled",n.options.id+"-answerModified",!1),n.gapModel.userAnswer="",n.recording=!0,n.recorder.start();var t=Date.now();n.currentTime=0,n.currentTimePercent=0,n.progressInterval=g(function(){var e=new Date;n.currentTime=Math.min(n.recordingLimit,Math.floor((e-t)/1e3)),n.currentTimePercent=Math.floor(n.currentTime/n.recordingLimit*100)},200),n.recordingTimeout=u(function(){n.recordingTimeout=null,n.stopRecording()},1e3*n.recordingLimit),u(function(){})}).catch(function(e){console.log(e)})},n.stopRecording=function(){n.recordingTimeout&&(u.cancel(n.recordingTimeout),n.recordingTimeout=null),n.recording=!1,n.busy=!0,n.recorder.stop().then(function(e){n.recorder.close(),n.busy=!1,n.gapModel.userAnswer=r.dynaBucket+e.audioUri,n.gapModel.evaluateStates(),n.saveManager.saveOnEvent(),n.footerManager.get("submit").modifyAttr("enabled",n.options.id+"-answerModified",!0),g.cancel(n.progressInterval),u(function(){})})},n.audioContextAvailable=function(){return!d.audioContextUsed},n.playRecording=function(){n.currentAudio&&n.currentAudio.pause(),n.playingRecording=!0,n.currentAudio=new Audio(n.gapModel.userAnswer),n.currentAudio.play(),n.currentAudio.addEventListener("ended",function(){n.$apply(function(){n.playingRecording=!1,n.currentAudio=null})})},n.stopPlaying=function(){n.currentAudio&&(n.currentAudio.pause(),n.currentAudio=null,n.playingRecording=!1,n.playingModelAnswer=!1)},n.playModelAnswer=function(){n.currentAudio&&n.currentAudio.pause(),n.playingModelAnswer=!0;var e=l.find(n.options.modelAnswer.links,{mime:"audio/mpeg"}).url;n.currentAudio=new Audio(e),n.currentAudio.play(),n.currentAudio.addEventListener("ended",function(){n.$apply(function(){n.playingModelAnswer=!1,n.currentAudio=null})})},n.initSpeaking=function(){n.sriSpeechClient=a.getSRISpeechClient(),n.recorder=a.getRecorder(),n.activityID=p.v4(),n.footerManager.get("showAnswers").modifyAttr("visible","speakingActivity",!1),n.footerManager.get("submit").modifyAttr("enabled",n.options.id+"-answerModified",!1),c.showPopup(a)},n.initSpeaking(),n.cleanSpeaking=function(){n.stopPlaying(),n.recording&&n.stopRecording()}}}}]),angular.module("atoolEngine").directive("engineCengageSentenceInsertion",["Gap","underscore","$compile",function(p,u,g){return{require:["^lo","^task","?^nonmarkableBlock"],scope:{options:"="},restrict:"E",templateUrl:"app/formats/cengage/sentence-insertion/sentence-insertion.tpl.html",link:function(i,l,e,t){var n=t[0],o=t[1];null!==t[2]&&(i.options.nonmarkableBlockController=t[2]),i.dataCollector=n.getDataCollector(),i.saveManager=n.getSaveManager(),i.footerManager=n.getFooterManager();var a=function(e,t,n,o){var a=0,s=e.replace(t,function(e){return n.replace(/#{index}/g,a++)}),r=g("<span>"+s+"</span>")(i);l.find(o).append(r)},s=/<input.+?(\/>|><\/input>|>)/g,r='<span class="sen-ins-answer" ng-click="selectGap(#{index})">{{getGapText(#{index}, "fromUserAnswer")}}</span>',c='<span class="sen-ins-answer" ng-class="getGapReportClass(#{index})">{{getGapText(#{index}, "fromUserAnswer")}}</span>',d='<span class="sen-ins-answer" ng-class="{correct: answers[#{index}].isCorrect}">{{getGapText(#{index}, "fromCorrectAnswer")}}</span>';i.answers=[],u.each(i.options.answers.match(s),function(e,t){var n=angular.element(e),o="correct"===n.attr("markertype");i.answers.push({isCorrect:o}),o&&(i.correctAnswer={value:n.val(),index:t})}),a(i.options.answers,s,r,".js-solving"),a(i.options.answers,s,c,".js-report"),a(i.options.answers,s,d,".js-show-answer"),i.gapModel=new p(i,i.options,i.correctAnswer,{loState:n.getLoState()},function(){i.initSentenceInsertion()}),o.getTaskModel().addGap(i.gapModel),"system"===i.options.markedBy&&i.gapModel.registerState(0,function(){return null===i.gapModel.userAnswer.index},function(){return i.gapModel.userAnswer.index===i.correctAnswer.index},function(e){return e.isCorrect()?i.gapModel.getPointsToGain():0}),i.gapModel.registerCustomRestore(function(){null!==i.gapModel.userAnswer.index&&i.footerManager.get("submit").modifyAttr("enabled",i.options.id+"-answerModified",!0)}),i.getGapText=function(e,t){return"fromUserAnswer"===t&&i.gapModel.userAnswer.index===e?"["+i.correctAnswer.value+"]":"fromCorrectAnswer"===t&&i.correctAnswer.index===e?"["+i.correctAnswer.value+"]":"⬛"},i.getGapReportClass=function(e){return e===i.gapModel.userAnswer.index?{correct:i.gapModel.userAnswer.index===i.correctAnswer.index,wrong:i.gapModel.userAnswer.index!==i.correctAnswer.index}:{}},i.selectGap=function(e){i.gapModel.userAnswer.index=e,i.gapModel.evaluateStates(),i.saveManager.saveOnEvent(),i.footerManager.get("submit").modifyAttr("enabled",i.options.id+"-answerModified",!0)},i.initSentenceInsertion=function(){i.gapModel.userAnswer={index:null,value:i.correctAnswer.value},i.footerManager.get("submit").modifyAttr("enabled",i.options.id+"-answerModified",!1)},i.initSentenceInsertion()}}}]),angular.module("atoolEngine").directive("engineCengageSentenceCorrection",["Gap","underscore","AnswerFilter","$uibModal","$compile","$rootScope",function(g,m,f,h,v,w){return{require:["^lo","^task","?^nonmarkableBlock"],scope:{options:"="},restrict:"E",templateUrl:"app/formats/cengage/sentence-correction/sentence-correction.tpl.html",link:function(a,s,e,t){var n=t[0],o=t[1];null!==t[2]&&(a.options.nonmarkableBlockController=t[2]),a.dataCollector=n.getDataCollector(),a.loState=n.getLoState(),a.saveManager=n.getSaveManager(),a.footerManager=n.getFooterManager(),a.editAnswerPopupUrl="app/formats/cengage/sentence-correction/edit-answer-popup.tpl.html",a.answerFilter=new f({caseSensitive:!0,punctuationSensitive:!0});var r=function(e,n){var o=-1;return a.options.answers.replace(e,function(e){var t=angular.element(e);return o++,n.replace(/#{index}/g,o).replace(/#{correct}/g,t.filter('[markertype="correct"]').val().trim()).replace(/#{incorrect}/g,t.filter('[markertype="incorrect"]').val().trim())})},i=function(e,t,n){var o=v("<span>"+r(e,t)+"</span>")(a);s.find(n).append(o)},l=/(<input.+?(\/>|><\/input>|>)){2}/g,c="#{incorrect}",d='<span engine-new-scope class="editable" ng-init="answer = answers[#{index}]" ng-class="generateClassesForAnswer(answer)" ng-click="openAnswerForEdit(answer)" uib-popover-template="editAnswerPopupUrl" popover-append-to-body="true" popover-placement="auto top-center" popover-class="exercise-wrapper-body ngl-sen-cor-popover" popover-trigger="\'none\'" popover-is-open="answer.isOpenForEdit">{{answer.value || answer.text}}</span>',p='<span class="editable" ng-class="generateClassesForAnswer(answers[#{index}])">{{answers[#{index}].value || answers[#{index}].text}}</span>',u="{{ answers[#{index}].correctText }}";a.answers=[],m.each(a.options.answers.match(l),function(e){var t=angular.element(e);a.answers.push({text:t.filter('[markertype="incorrect"]').val().trim(),correctText:t.filter('[markertype="correct"]').val().trim(),filteredCorrectText:a.answerFilter.filter(t.filter('[markertype="correct"]').val().trim())})}),a.originalText=r(l,c),i(l,d,".js-solving"),i(l,p,".js-report"),i(l,u,".js-show-answer"),a.correctAnswers=m.map(a.answers,"correctText"),a.gapModel=new g(a,a.options,a.correctAnswers,{loState:n.getLoState()},function(){a.initSentenceCorrection()}),o.getTaskModel().addGap(a.gapModel),a.loState.addObserver(function(e,t){"solving"===e&&"report"===t&&(a.hideAllEditPopovers(),a.footerManager.get("check").modifyAttr("visible","isInSolvingNglCor"+a.options.id,!1),a.footerManager.get("showAnswers").modifyAttr("visible","nglCorSubmitted",!0))}),"system"===a.options.markedBy&&a.gapModel.registerState(0,function(){return 0<a.answers.length&&m.every(a.answers,function(e){return e.value===e.text})},function(){return m.every(a.answers,function(e){return a.answerFilter.filter(e.value)===e.filteredCorrectText})},function(e){return e.isCorrect()?a.gapModel.getPointsToGain():0}),a.gapModel.registerCustomSave(function(){return{answers:m.map(a.answers,function(e){return m.pick(e,["value","checked"])}),checks:a.footerManager.get("check").getData("maxChecks"),submitEnabledState:a.footerManager.get("submit").getAttrModifier("enabled","nglCorNotChecked-"+a.options.id),checkEnabledState:a.footerManager.get("check").getAttrModifier("enabled","checkExhausted"),isChecked:a.isChecked}}),a.gapModel.registerCustomRestore(function(e){var t=a.footerManager.get("check"),n=a.footerManager.get("submit");t.setData("maxChecks",e.checks),t.modifyAttr("enabled","checkExhausted",e.checkEnabledState),n.modifyAttr("enabled","nglCorNotChecked-"+a.options.id,e.submitEnabledState),a.isChecked=e.isChecked,m.each(e.answers,function(e,t){m.extend(a.answers[t],e)})}),a.generateClassesForAnswer=function(e){return{changed:e.text!==e.value,removed:0===e.value.length,"changed-wrong":e.checked&&e.filteredCorrectText!==a.answerFilter.filter(e.value)}},a.showOriginalText=function(){h.open({templateUrl:"app/formats/cengage/sentence-correction/show-original-text-modal.tpl.html",scope:a,appendTo:n.getModalPlaceholder(),controller:["$scope","$uibModalInstance",function(e,t){e.modalInstance=t}]})},a.rewriteAnswersAndEvaluate=function(){a.gapModel.userAnswer=m.map(a.answers,"value"),a.gapModel.evaluateStates()},a.showResetModal=function(){h.open({templateUrl:"app/formats/cengage/sentence-correction/reset-modal.tpl.html",scope:a,appendTo:n.getModalPlaceholder(),controller:["$scope","$uibModalInstance",function(e,t){e.modalInstance=t}]}).result.then(function(){a.reset()})},a.reset=function(){m.each(a.answers,function(e,t){e.value=e.text,e.checked=!1}),a.rewriteAnswersAndEvaluate(),a.isChecked=!1},a.hideAllEditPopovers=function(){m.each(a.answers,function(e){e.isOpenForEdit&&a.rejectEditedAnswer(e)})},a.$on("engine-SentenceCorrection-HideEditPopovers",a.hideAllEditPopovers),a.openAnswerForEdit=function(e){e.isOpenForEdit||(w.$broadcast("engine-SentenceCorrection-HideEditPopovers"),e.isOpenForEdit=!0,e.tmpValue=e.value)},a.acceptEditedAnswer=function(e,t){t&&"touchend"===t.type||(e.value!==e.tmpValue&&(a.footerManager.get("check").modifyAttr("enabled","answerModified",!0),a.disableReset=!1),e.value=e.tmpValue,e.tmpValue=null,e.isOpenForEdit=!1,e.checked=!1,a.rewriteAnswersAndEvaluate())},a.rejectEditedAnswer=function(e){e.tmpValue=null,e.isOpenForEdit=!1},a.footerManager.registerButton("check",250).addAttr("enabled").addAttr("visible").addClass("check-button").addData("maxChecks",a.options.checks,function(e,t,n){return t<=0||n<t&&0<n?n:t}).setDataCallback("maxChecks","click",function(n){n.setData("maxChecks",function(e){if(e<=0)return e;var t=e-1;return 0===t&&n.modifyAttr("enabled","checkExhausted",!1),t})}).addCallback("click",function(){a.hideAllEditPopovers(),m.each(a.answers,function(e){e.checked=!0}),a.isChecked=!0,a.footerManager.get("submit").modifyAttr("enabled","nglCorNotChecked-"+a.options.id,!0),a.footerManager.get("check").modifyAttr("enabled","answerModified",!1)}),0<a.footerManager.get("check").getData("maxChecks")?a.footerManager.get("check").addText("cengage_check_button_with_badge"):a.footerManager.get("check").addText("cengage_check_button"),a.initSentenceCorrection=function(){m.each(a.answers,function(e,t){e.value=e.text,e.checked=!1,e.isOpenForEdit=!1}),a.isChecked=!1,a.disableReset=!0,a.rewriteAnswersAndEvaluate(),a.footerManager.get("submit").modifyAttr("enabled","nglCorNotChecked-"+a.options.id,!1),a.footerManager.get("showAnswers").modifyAttr("visible","nglCorSubmitted",!1),a.footerManager.get("check").modifyAttr("visible","isInSolvingNglCor"+a.options.id,!0).modifyAttr("enabled","checkExhausted",!0).modifyAttr("enabled","answerModified",!1).resetDataToInitialValue("maxChecks"),a.saveManager.subscribeForPeriodicSave()},a.initSentenceCorrection()}}}]),angular.module("atoolEngine").directive("engineCengageQuizShow",["Gap","underscore","$uibModal","$timeout","HtmlAudioPlayer","adapterProxy",function(l,c,d,p,u,g){return{require:["^lo","^task","?^nonmarkableBlock"],scope:{options:"="},restrict:"E",templateUrl:"app/formats/cengage/quizShow/quizShow.tpl.html",link:function(o,e,t,n){var a=n[0],s=n[1];null!==n[2]&&(o.options.nonmarkableBlockController=n[2]),o.dataCollector=a.getDataCollector(),o.loState=a.getLoState(),o.saveManager=a.getSaveManager(),o.footerManager=a.getFooterManager(),o.cpt=a.getCpt(),o.innerGapReportTime=4e3;var r=[{url:g.getAudioUriPrefix(o.dataCollector)+"QuizShowNegative.ogg",type:"audio/ogg"},{url:g.getAudioUriPrefix(o.dataCollector)+"QuizShowNegative.mp3",type:"audio/mpeg"}],i=[{url:g.getAudioUriPrefix(o.dataCollector)+"QuizShowPositive.ogg",type:"audio/ogg"},{url:g.getAudioUriPrefix(o.dataCollector)+"QuizShowPositive.mp3",type:"audio/mpeg"}];o.negativeAudio=new u(r,o.dataCollector),o.positiveAudio=new u(i,o.dataCollector),o.gapModel=new l(o,o.options,[],{loState:a.getLoState()},function(){o.initQuizShow()}),s.getTaskModel().addGap(o.gapModel),o.cpt.enable(),"system"===o.options.markedBy&&o.gapModel.registerState(0,function(){return!1},function(){return!0},function(e){return e.isCorrect()?1:0}),o.footerManager.registerButton("checkGap",250).addText("cengage_check_button").addAttr("visible").addAttr("enabled").addClass("check-gap-button").addCallback("click",function(){o.checkGap()}).attrWatchModify("enabled","quizShowExerciseSolved",function(){return!!o.game.currentQuestion&&(o.cpt.getGapState()&&!o.cpt.getGapState().isMissing())}),o.footerManager.registerButton("skipGap",260).addText("cengage_skip_button").addAttr("visible").addAttr("enabled").addClass("skip-gap-button").addCallback("click",function(){o.skipGap()}),o.countAvailableQuestions=function(){return c.reduce(o.categories,function(e,t){return e+t.questions.length},0)},o.initQuizShow=function(){o.footerManager.get("submit").modifyAttr("visible","quizShowActivity",!1),o.footerManager.get("showAnswers").modifyAttr("visible","quizShowActivity",!1),o.footerManager.get("tryAgain").modifyAttr("visible","quizShowActivity",!1),o.footerManager.get("checkGap").modifyAttr("visible","exerciseDisplayed",!1),o.footerManager.get("skipGap").modifyAttr("visible","exerciseDisplayed",!1),o.mode="quiz",o.game={teams:[{name:"A",score:0},{name:"B",score:0}],turn:0,currentQuestion:null},o.oneExercisePerQuestion=!0,o.categories=c.map(o.options.blocks,function(t){var e=c.map(t.blocks,function(e){return 1<e.blocks.length&&(o.oneExercisePerQuestion=!1),{pointsToGet:e.value,exercise:c.sample(e.blocks),exercises:e.blocks,category:t.categoryName,attempts:[]}});return{name:t.categoryName,questions:e}}),o.game.availableQuestions=o.countAvailableQuestions(),o.footerManager.registerButton("resetGame",250).addText("cengage_cpt_reset_game").addAttr("visible").addAttr("enabled").addClass("reset-game-button").addCallback("click",function(){o.restartGame(!1)}),o.footerManager.registerButton("newGame",260).addText("cengage_cpt_new_game").addAttr("visible").addAttr("enabled").addClass("new-game-button").addCallback("click",function(){o.restartGame(!0)}),o.footerManager.get("newGame").modifyAttr("visible","oneExercisePerQuestion",!o.oneExercisePerQuestion),o.footerManager.get("newGame").modifyAttr("enabled","gameStarted",!1),o.footerManager.get("resetGame").modifyAttr("enabled","gameStarted",!1)},o.showFinishModal=function(){d.open({templateUrl:"app/formats/cengage/quizShow/finish.popup.tpl.html",scope:o,appendTo:a.getModalPlaceholder(),controller:["$scope","$uibModalInstance","cptPopupTimeout",function(e,t,n){e.modalInstance=t,e.winner=o.getWinner(),e.isItADraw=o.isItADraw(),a.isCptMode()&&p(function(){e.modalInstance.dismiss()},n)}]})},o.restartGame=function(t){o.footerManager.get("checkGap").modifyAttr("visible","exerciseDisplayed",!1),o.footerManager.get("skipGap").modifyAttr("visible","exerciseDisplayed",!1),o.feedbackTimeout&&(p.cancel(o.feedbackTimeout),o.feedbackTimeout=null),o.mode="quiz",c.each(o.game.teams,function(e){e.score=0}),o.game.turn=0,o.game.currentQuestion=null,c.each(o.categories,function(e){c.each(e.questions,function(e){e.attempts=[],t&&(e.exercise=c.sample(e.exercises))})}),o.game.availableQuestions=o.countAvailableQuestions(),o.footerManager.get("newGame").modifyAttr("enabled","gameStarted",!1),o.footerManager.get("resetGame").modifyAttr("enabled","gameStarted",!1)},o.checkGap=function(){o.footerManager.get("checkGap").modifyAttr("visible","exerciseDisplayed",!1),o.footerManager.get("skipGap").modifyAttr("visible","exerciseDisplayed",!1),o.cpt.renderGapAsReport(),o.exerciseClass="exercise-report",o.game.currentQuestion.exercise.result=o.cpt.getGapState(),o.game.currentQuestion.attempts.unshift({team:o.game.turn,result:o.cpt.getGapState()}),o.game.currentQuestion.exercise.result.isCorrect()?o.positiveAudio.play():o.negativeAudio.play(),o.isQuestionAttemptedTwice(o.game.currentQuestion)&&!o.isQuestionCorrect(o.game.currentQuestion)?o.feedbackTimeout=p(function(){o.cpt.renderGapAsShowAnswer(),o.exerciseClass="exercise-show-answer",o.handleSolvedExerciseAfterTimeout(),o.positiveAudio.play()},o.innerGapReportTime):o.handleSolvedExerciseAfterTimeout()},o.handleSolvedExerciseAfterTimeout=function(){o.feedbackTimeout=p(function(){o.exerciseClass="",o.footerManager.get("newGame").modifyAttr("enabled","gameStarted",!0),o.footerManager.get("resetGame").modifyAttr("enabled","gameStarted",!0),o.footerManager.get("resetGame").modifyAttr("visible","exerciseDisplayed",!0),o.footerManager.get("newGame").modifyAttr("visible","exerciseDisplayed",!0),o.cpt.getGapState().isCorrect()&&(o.game.teams[o.game.turn].score+=o.game.currentQuestion.pointsToGet),(o.isQuestionAttemptedTwice(o.game.currentQuestion)||o.isQuestionCorrect(o.game.currentQuestion))&&o.game.availableQuestions--,0===o.game.availableQuestions?(o.mode="finish",o.showFinishModal()):(o.game.turn=(o.game.turn+1)%o.game.teams.length,o.mode="quiz",o.game.currentQuestion=null),o.feedbackTimeout=null},o.innerGapReportTime)},o.showGap=function(e){o.mode="exercise",o.footerManager.get("checkGap").modifyAttr("visible","exerciseDisplayed",!0),o.footerManager.get("skipGap").modifyAttr("visible","exerciseDisplayed",!0),o.footerManager.get("resetGame").modifyAttr("visible","exerciseDisplayed",!1),o.footerManager.get("newGame").modifyAttr("visible","exerciseDisplayed",!1),o.game.currentQuestion=e},o.skipGap=function(){o.footerManager.get("checkGap").modifyAttr("visible","exerciseDisplayed",!1),o.footerManager.get("skipGap").modifyAttr("visible","exerciseDisplayed",!1),o.footerManager.get("resetGame").modifyAttr("visible","exerciseDisplayed",!0),o.footerManager.get("newGame").modifyAttr("visible","exerciseDisplayed",!0),o.mode="quiz",o.game.currentQuestion=null},o.getClassesForTeam=function(e,t){var n={active:o.game.turn===t};return n["team-"+e.name]=!0,n},o.getClassesForQuestion=function(e){var t=o.isQuestionCorrect(e);return{correct_A:t&&0===o.getLastTeamAnsweringQuestion(e),correct_B:t&&1===o.getLastTeamAnsweringQuestion(e),attempted:o.isQuestionAttemptedOnceButNotCorrect(e),"attempted-by-A":o.isQuestionAttemptedOnceButNotCorrect(e)&&0===o.getLastTeamAnsweringQuestion(e),"attempted-by-B":o.isQuestionAttemptedOnceButNotCorrect(e)&&1===o.getLastTeamAnsweringQuestion(e),wrong:o.isQuestionAttemptedTwice(e)&&!t,untouched:!o.isQuestionAttempted(e)}},o.isQuestionAttemptedOnceButNotCorrect=function(e){return o.isQuestionAttemptedOnce(e)&&!o.isQuestionCorrect(e)},o.isQuestionAttempted=function(e){return 0<e.attempts.length},o.isQuestionAttemptedOnce=function(e){return 1===e.attempts.length},o.isQuestionAttemptedTwice=function(e){return 2===e.attempts.length},o.isQuestionCorrect=function(e){return o.isQuestionAttempted(e)&&e.attempts[0].result.isCorrect()},o.getLastTeamAnsweringQuestion=function(e){return e.attempts[0].team},o.shouldQuestionBeDisabled=function(e){return"finish"===o.mode||o.isQuestionAttemptedTwice(e)||o.isQuestionCorrect(e)},o.getWinner=function(){return c.max(o.game.teams,function(e){return e.score})},o.isItADraw=function(){return o.game.teams[0].score==o.game.teams[1].score},o.$on("$destroy",function(){o.positiveAudio.destroy(),o.negativeAudio.destroy()}),o.initQuizShow()}}}]),angular.module("atoolEngine").directive("engineCengageOpenDialogue",["Gap","underscore","afterViews","$interval","$uibModal","$window","$timeout","rfc4122","adapterProxy","mobileDetector","audioCheckingService","BreadcrumbsVisibility",function(l,c,d,e,p,t,u,g,m,f,h,v){return{require:["^lo","^task","?^nonmarkableBlock","?^engineSegmented"],scope:{options:"="},restrict:"E",replace:"true",templateUrl:"app/formats/cengage/openDialogue/openDialogue.tpl.html",link:function(o,e,t,n){var a,s=n[0],r=n[1];null!==n[2]&&(o.options.nonmarkableBlockController=n[2]),null!==n[3]&&(a=n[3]),o.dataCollector=s.getDataCollector(),o.loState=s.getLoState(),o.saveManager=s.getSaveManager(),o.footerManager=s.getFooterManager(),o.breadcrumbsVisibility=new v(o,f.isPhone()),o.selectAvatarPopupUrl="app/formats/cengage/openDialogue/select-avatar-popup.tpl.html",o.selectAvatarPopupDisappearingTime=500,o.avatars=c.find(o.options.blocks,{type:"nglOD-welcome"}).avatars,c.isEmpty(o.avatars)&&(o.avatars=[{name:"male",default:!0,links:[{format:"png",mime:"image/png",url:"../assets/images/cengage/male_avatar.png"}]},{name:"female",default:!0,links:[{format:"png",mime:"image/png",url:"../assets/images/cengage/female_avatar.png"}]}]),o.selectAvatarTimeout=null,o.recordingLimit=120,o.busy=!1;var i=m.getSRIUrls(o.dataCollector);o.gapModel=new l(o,o.options,[],{loState:s.getLoState()},function(){o.cleanOpenDialog(),o.initOpenDialogue()}),r.getTaskModel().addGap(o.gapModel),o.loState.addObserver(function(e,t){"solving"===e&&"report"===t&&(o.cleanOpenDialog(),s.isTeacherReportMode()||o.showOnSubmitPopup())}),"system"===o.options.markedBy&&o.gapModel.registerState(0,function(){return!1},function(){return!0},function(){return o.gapModel.getPointsToGain()}),o.gapModel.evaluateStates(),o.gapModel.registerCustomSave(function(){return{name:o.commons.name,recordings:c.map(o.options.blocks,function(e){return e.recording||null}),currentScreen:o.currentScreenIndex,userAvatar:o.userAvatar}}),o.gapModel.registerCustomRestore(function(e){o.commons.name=e.name,c.each(e.recordings,function(e,t){e&&(o.options.blocks[t].recording=e)}),o.changeScreen(o.currentScreenIndex,e.currentScreen),o.userAvatar=e.userAvatar}),o.evaluateUserAnswer=function(){o.gapModel.userAnswer=c.chain(o.options.blocks).map(function(e){return e.recording}).compact().value()},o.openSelectAvatarPopup=function(){o.commons.selectingAvatar=!0},o.selectAvatar=function(e){o.selectAvatarTimeout&&(u.cancel(o.selectAvatarTimeout),o.selectAvatarTimeout=null),o.userAvatar=e,o.selectAvatarTimeout=u(function(){o.commons.selectingAvatar=!1},o.selectAvatarPopupDisappearingTime)},o.cleanOpenDialog=function(){o.recording&&o.stopRecording(!0),o.currentAudio&&o.currentAudio.pause()},o.$on("$destroy",function(){o.cleanOpenDialog()}),o.recalculateVisibleButtons=function(){o.breadcrumbsVisibility.recalculate()},o.getBreadcrumbsWidth=function(){return o.menuElement.find(".breadcrumbs").innerWidth()},o.$watch(o.getBreadcrumbsWidth,function(e){o.recalculateVisibleButtons()}),o.findCurrentScreenSubblocks=function(){o.currentScreenStimulus=c.find(o.currentScreen.blocks,function(e){return"stimulus"===e.type}),o.currentScreenModel=c.find(o.currentScreen.blocks,function(e){return"model"===e.type})},o.scrollNameInput=function(){var e=o.activityElement.closest(".activity-container");e.animate({scrollTop:e.prop("scrollHeight")})},o.defaultAvatarClass=function(e){var t={};return t["od-avatar-"+e.name]=!0,t},o.mergeClasses=function(){var e=Array.prototype.slice.call(arguments);return e.unshift({}),c.defaults.apply(c,e)},o.showAudioNotAvailablePopup=function(){p.open({templateUrl:"app/formats/cengage/openDialogue/audioNotAvailable.popup.tpl.html",scope:o,appendTo:s.getModalPlaceholder(),controller:["$scope","$uibModalInstance","cptPopupTimeout",function(e,t,n){e.modalInstance=t,e.showCross=!s.isCptMode(),s.isCptMode()&&u(function(){e.modalInstance.dismiss()},n)}]})},o.changeScreen=function(e,t){var n=o.options.blocks[e];n.active=!1,n.visited=!0,o.currentScreenIndex=t,o.currentScreen=o.options.blocks[o.currentScreenIndex],o.findCurrentScreenSubblocks(),o.currentScreen.active=!0,a.replaceCustomStimulusData(this.currentScreenStimulus),a.replaceCustomModelData(this.currentScreenModel).then(function(){o.currentScreenModel&&"after"===o.currentScreen.modelAudio&&a.getModelElement().scope().$broadcast("engine-toogleAudioAvailability",!1,function(){o.showAudioNotAvailablePopup()})}),"nglOD-final"===o.currentScreen.type&&(o.playFinalRecordingFromScreen(0),o.footerManager.get("submit").modifyAttr("visible","openDialogueActivity",!0),o.footerManager.get("footer").modifyAttr("visible","openDialogueActivity",!0)),o.firstSpeaker||"nglOD-user"!==o.currentScreen.type&&"nglOD-host"!==o.currentScreen.type||(o.firstSpeaker="od-"+o.currentScreen.type.substring(6,10)+"-first"),o.recalculateVisibleButtons(),a.recalcColumnSizes()},o.switchToNextScreen=function(e){o.changeScreen(o.currentScreenIndex,e||o.currentScreenIndex+1),o.evaluateUserAnswer(),o.saveManager.saveOnEvent()},o.shouldShowNextButton=function(){switch(o.currentScreen.type){case"nglOD-welcome":return!1;case"nglOD-user":case"nglOD-host":return!0;case"nglOD-final":return!1}},o.isFinishScreen=function(){return"nglOD-final"===o.currentScreen.type},o.shouldNextButtonBeInactive=function(){return"nglOD-user"===o.currentScreen.type&&!o.currentScreen.recording},o.startRecording=function(){o.currentScreen.recording="",o.uniqueRecordingID=g.v4(),o.recorder.newSession(o.activityID,o.uniqueRecordingID).then(function(){o.recording=!0,o.isRecordingStoppable=!1,o.recordingMaximumTimeTimeout=u(function(){o.recordingMaximumTimeTimeout=null,o.stopRecording()},1e3*o.recordingLimit),o.recorder.start(),u(function(){})}).catch(function(e){console.log(e)})},o.stopRecording=function(t){o.recording=!1,o.recordingMaximumTimeTimeout&&(u.cancel(o.recordingMaximumTimeTimeout),o.recordingMaximumTimeTimeout=null),o.busy=!0,o.recorder.stop().then(function(e){o.recorder.close(),o.busy=!1,t||(o.recorded=!0,o.currentScreen.recording=i.dynaBucket+e.audioUri),u(function(){})}),o.currentScreenModel&&"after"===o.currentScreen.modelAudio&&a.getModelElement().scope().$broadcast("engine-toogleAudioAvailability",!0)},o.playRecording=function(){o.currentAudio&&o.currentAudio.pause(),o.currentAudio=new Audio(o.currentScreen.recording),o.currentAudio.play(),o.currentAudio.addEventListener("ended",function(){o.$apply(function(){o.playing=!1})}),o.playing=!0},o.stopPlayingRecording=function(){o.currentAudio&&o.currentAudio.pause(),o.playing=!1},o.onFinalRecordingPartStarted=function(){o.finalRecording.playing=!0},o.onFinalRecordingPartEnded=function(){o.playFinalRecordingFromScreen(o.finalRecording.index+1)},o.startFinalPlayback=function(){o.finalRecording.playing=!0,o.playFinalRecordingFromScreen(0)},o.stopPlayingFinalRecording=function(){o.finalRecording.playing=!1,o.playFinalRecordingFromScreen(0),o.finalRecording.type="",o.finalRecording.media=null},o.playFinalRecordingFromScreen=function(e){if(e>o.options.blocks.length-1)return o.finalRecording.playing=!1,void o.playFinalRecordingFromScreen(0);var t=o.options.blocks[e];switch(o.finalRecording.index=e,t.type){case"nglOD-welcome":d.chain(function(){o.playFinalRecordingFromScreen(e+1)});break;case"nglOD-final":o.finalRecording.type="",o.finalRecording.media=null,d.chain(function(){o.playFinalRecordingFromScreen(e+1)});break;case"nglOD-host":o.finalRecording.type="host",o.finalRecording.media=t.media;break;case"nglOD-user":o.finalRecording.type="user",o.finalRecording.media={links:[{mime:"audio/mpeg",url:t.recording}]}}a.recalcColumnSizes()},o.showOnSubmitPopup=function(){p.open({templateUrl:"app/formats/cengage/openDialogue/submitted.popup.tpl.html",scope:o,appendTo:s.getModalPlaceholder(),controller:["$scope","$uibModalInstance","cptPopupTimeout",function(e,t,n){e.modalInstance=t,e.showCross=!s.isCptMode(),s.isCptMode()&&u(function(){e.modalInstance.dismiss()},n)}]})},o.initOpenDialogue=function(){o.footerManager.get("showAnswers").modifyAttr("visible","openDialogueActivity",!1),o.footerManager.get("submit").modifyAttr("visible","openDialogueActivity",!1),f.isMobile()?o.footerManager.get("footer").modifyAttr("visible","openDialogueActivity",!1):o.footerManager.get("footer").modifyAttr("visible","openDialogueActivity",!0),o.commons={name:"",selectingAvatar:!1},o.userAvatar=null,o.currentAudio=null,o.firstSpeaker=null,o.currentScreenIndex=0,o.currentScreen=o.options.blocks[0],o.playing=!1,c.each(o.options.blocks,function(e){delete e.recording,delete e.visited,delete e.active}),o.currentScreen.active=!0,o.finalRecording={playing:!1,currentType:"",media:null,index:0},o.sriSpeechClient=s.getSRISpeechClient(),o.recorder=s.getRecorder(),o.activityID=g.v4(),a&&(o.activityElement=a.compileElement("app/formats/cengage/openDialogue/openDialogue.activity.tpl.html",o,s,r),a.replaceCustomActivity(o.activityElement),o.menuElement=a.compileElement("app/formats/cengage/openDialogue/openDialogue.menu.tpl.html",o,s,r),a.replaceCustomMenu(o.menuElement),o.headerElement=a.compileElement("app/formats/cengage/openDialogue/openDialogue.header.tpl.html",o,s,r),a.replaceCustomHeader(o.headerElement),a.clearCustomStimulusData(),a.clearCustomModelData()),h.showPopup(s),o.recalculateVisibleButtons()},o.initOpenDialogue()}}}]),angular.module("atoolEngine").directive("engineCengageHighlighting",["Gap","underscore","$uibModal","$compile",function(u,g,e,m){return{require:["^lo","^task","?^nonmarkableBlock"],scope:{options:"="},restrict:"E",templateUrl:"app/formats/cengage/highlighting/highlighting.tpl.html",link:function(i,l,e,t){var n=t[0],o=t[1];null!==t[2]&&(i.options.nonmarkableBlockController=t[2]),i.dataCollector=n.getDataCollector(),i.loState=n.getLoState(),i.saveManager=n.getSaveManager(),i.footerManager=n.getFooterManager();var a=function(e,o,a,t){var s=-1,n=i.options.text.replace(e,function(e){var t=angular.element(e),n="";switch(t.attr("markertype")){case"correct":case"incorrect":s++,n=o;break;case"example":n=a}return n.replace(/#{value}/g,t.val()).replace(/#{index}/g,s)}),r=m("<span>"+n+"</span>")(i);l.find(t).append(r)},s=/<input.+?(\/>|><\/input>|>)/g,r='<span class="example">#{value}</span>',c='<span class="highlightable" ng-click="highlightAnswer(answers[#{index}])" ng-class="{highlighted: answers[#{index}].highlighted}">{{answers[#{index}].text}}</span>',d='<span class="highlightable" ng-class="{higlighted: answers[#{index}].highlighted, correct: answers[#{index}].correct && answers[#{index}].highlighted, wrong: !answers[#{index}].correct && answers[#{index}].highlighted }">{{answers[#{index}].text}}</span>',p='<span class="highlightable" ng-class="{correct: answers[#{index}].correct, highlighted: answers[#{index}].correct}">{{answers[#{index}].text}}</span>';i.answers=[],g.each(i.options.text.match(s),function(e){var t=angular.element(e);g.contains(["correct","incorrect"],t.attr("markertype"))&&i.answers.push({text:t.val(),correct:"correct"===t.attr("markertype"),highlighted:!1})}),a(s,c,r,".js-solving"),a(s,d,r,".js-report"),a(s,p,r,".js-show-answer"),i.correctHighlights=g.filter(i.answers,{correct:!0}),i.correctAnswers=g.map(i.correctHighlights,"text"),i.gapModel=new u(i,i.options,i.correctAnswers,{loState:n.getLoState()},function(){i.initHighlighting()}),o.getTaskModel().addGap(i.gapModel),i.rewriteUserAnswerAndEvaluate=function(){i.gapModel.userAnswer=g.chain(i.answers).filter({highlighted:!0}).map("text").value(),i.gapModel.evaluateStates()},i.highlightAnswer=function(e){e.highlighted=!e.highlighted,i.rewriteUserAnswerAndEvaluate(),i.footerManager.get("submit").modifyAttr("enabled",i.options.id+"-answerModified",!0)},"system"!==i.options.markedBy&&"system-option"!==i.options.markedBy||g.each(i.correctHighlights,function(e,t){i.gapModel.registerState(t,function(){return!1},function(){return e.correct===e.highlighted},function(e){return e.isCorrect()?i.gapModel.getPointsToGain()/i.correctHighlights.length:0})}),i.gapModel.registerCustomSave(function(){return{answers:g.map(i.answers,function(e){return g.pick(e,["highlighted"])})}}),i.gapModel.registerCustomRestore(function(e){g.each(e.answers,function(e,t){g.extend(i.answers[t],e)}),g.any(i.answers,function(e){return e.highlighted})&&i.footerManager.get("submit").modifyAttr("enabled",i.options.id+"-answerModified",!0)}),i.initHighlighting=function(){g.each(i.answers,function(e){e.highlighted=!1}),i.rewriteUserAnswerAndEvaluate(),i.saveManager.subscribeForPeriodicSave(),i.footerManager.get("submit").modifyAttr("enabled",i.options.id+"-answerModified",!1)},i.initHighlighting()}}}]),angular.module("atoolEngine").directive("engineCengageEssay",["Gap","underscore","$uibModal","adapterProxy",function(r,i,e,l){return{require:["^lo","^task","?^nonmarkableBlock"],scope:{options:"="},restrict:"E",templateUrl:"app/formats/cengage/essay/essay.tpl.html",link:function(o,e,t,n){var a=n[0],s=n[1];null!==n[2]&&(o.options.nonmarkableBlockController=n[2]),o.dataCollector=a.getDataCollector(),o.loState=a.getLoState(),o.saveManager=a.getSaveManager(),o.footerManager=a.getFooterManager(),o.gapModel=new r(o,o.options,[],{loState:a.getLoState()},function(){o.initEssay()}),s.getTaskModel().addGap(o.gapModel),"system"===o.options.markedBy&&i.each(o.options.stems,function(e,t){o.gapModel.registerState(t,function(){return!1},function(){return""!=o.gapModel.userAnswer[t]},function(e){return e.isCorrect()?o.gapModel.getPointsToGain()/o.options.stems.length:0})}),o.loState.addObserver(function(e,n){i.each(o.stems,function(e,t){"report"!==n&&"showAnswer"!==n||e.editor.setMode("readonly")})}),o.initEssay=function(){o.footerManager.get("showAnswers").modifyAttr("visible","essayActivity",!1),o.footerManager.get("submit").addClass("submit-lo-button-essay"),o.gapModel.userAnswer=[],o.stems=angular.copy(o.options.stems),i.each(o.stems,function(t,e){o.gapModel.userAnswer[e]="",t.tinymceOptions=i.defaults(l.getTinymceDefaultConfig(o.dataCollector),{menu:{},toolbar:"bold | italic | underline",skin:!1,statusbar:!1,plugins:"enginetinywordcount",height:"350",content_style:"* {font-family: 'Open Sans', Tahoma, Verdana, sans-serif;}",setup:function(e){t.editor=e}})}),o.saveManager.subscribeForPeriodicSave(),o.gapModel.evaluateStates()},o.initEssay()}}}]),angular.module("atoolEngine").directive("engineCengageDialogue",["Gap","underscore","$uibModal","afterViews","audioCheckingService","$timeout","rfc4122","$interval","adapterProxy",function(i,l,c,d,p,u,g,e,m){return{require:["^lo","^task","?^nonmarkableBlock"],scope:{options:"="},restrict:"E",replace:"true",templateUrl:"app/formats/cengage/dialogue/dialogue.tpl.html",link:function(n,t,e,o){var a=o[0],s=o[1];null!==o[2]&&(n.options.nonmarkableBlockController=o[2]),n.dataCollector=a.getDataCollector(),n.loState=a.getLoState(),n.saveManager=a.getSaveManager(),n.footerManager=a.getFooterManager(),n.recorded=!1,n.recordingLimit=45,n.recordingMinimumTIme=2,n.busy=!1;var r=m.getSRIUrls(n.dataCollector);n.gapModel=new i(n,n.options,[],{loState:a.getLoState()},function(){n.cleanDialogue(),n.initDialogue()}),s.getTaskModel().addGap(n.gapModel),n.$on("engine-SegmentedScreen-OnLeave",function(){n.recording&&n.stopRecordingSentence()}),"system"===n.options.markedBy&&n.gapModel.registerState(0,function(){return!n.config.conversationRecorded},function(){return n.config.conversationRecorded},function(e){return e.isCorrect()?n.gapModel.getPointsToGain():0}),n.gapModel.registerCustomSave(function(){return{conversation:n.conversation,config:n.config,recordings:n.recordings}}),n.gapModel.registerCustomRestore(function(e){n.conversation=e.conversation,n.config=e.config,n.recordings=e.recordings,"record"==n.config.screen&&(n.footerManager.get("nextDialogue").modifyAttr("visible","dialogueListened",!1),n.footerManager.get("redo").modifyAttr("visible","onRecordingScreen",!0),n.footerManager.get("submit").modifyAttr("visible","dialogueActivityRecorder",!0),0<l.size(n.recordings)&&n.footerManager.get("redo").modifyAttr("enabled","recordedSentence",!0),n.config.conversationRecorded&&n.footerManager.get("submit").modifyAttr("enabled","dialogueActivityRecorder",!0))}),n.loState.addObserver(function(e,t){"solving"===e&&"report"===t&&(n.footerManager.get("redo").modifyAttr("enabled","recordedSentence",!1),n.cleanDialogue(),a.isTeacherReportMode()||n.showOnSubmitPopup())}),n.clearConversation=function(){n.conversation={playing:!1,sentence:null,audio:null,index:null}},n.showRedoPopup=function(){c.open({templateUrl:"app/formats/cengage/dialogue/redo.popup.tpl.html",scope:n,appendTo:a.getModalPlaceholder(),controller:["$scope","$uibModalInstance",function(e,t){e.modalInstance=t}]}).result.then(function(){n.cleanDialogue(),n.initDialogue(),n.moveToRecordScreen()})},n.initDialogue=function(){n.footerManager.get("redo").modifyAttr("enabled","recordedSentence",!1),n.footerManager.get("redo").modifyAttr("visible","onRecordingScreen",!1),n.footerManager.get("submit").modifyAttr("enabled","dialogueActivityRecorder",!1),n.footerManager.get("submit").modifyAttr("visible","dialogueActivityRecorder",!1),n.footerManager.get("showAnswers").modifyAttr("visible","dialogueActivity",!1),n.footerManager.get("nextDialogue").modifyAttr("enabled","dialogueListened",!1),n.footerManager.get("nextDialogue").modifyAttr("visible","dialogueListened",!0),n.recorder=a.getRecorder(),n.activityID=g.v4(),n.clearConversation(),n.recordings={},n.config={screen:"first",conversationListened:!1,conversationRecorded:!1,started:!1},n.config.label=n.options.config.userLabel,n.config.labels=l.chain(n.options.sentences).map(function(e){return e.label}).uniq().map(function(e){return{value:e,selected:!1}}).value(),p.showPopup(a)},n.cleanDialogue=function(){n.recording&&n.stopRecordingSentence(!0),n.clearConversation()},n.moveToRecordScreen=function(){n.clearConversation(),n.config.screen="record",n.footerManager.get("nextDialogue").modifyAttr("visible","dialogueListened",!1),n.footerManager.get("redo").modifyAttr("visible","onRecordingScreen",!0),n.footerManager.get("submit").modifyAttr("visible","dialogueActivityRecorder",!0)},n.moveToNextSentence=function(){n.recorded=!1,n.conversation.index+1<n.options.sentences.length?n.moveToSentence(n.conversation.index+1):("first"===n.config.screen?(n.config.conversationListened=!0,n.footerManager.get("nextDialogue").modifyAttr("enabled","dialogueListened",!0)):"record"===n.config.screen&&(n.config.conversationRecorded=!0,n.gapModel.evaluateStates(),n.footerManager.get("submit").modifyAttr("enabled","dialogueActivityRecorder",!0)),t.scrollParent().animate({scrollTop:0}),n.clearConversation())},n.moveToSentence=function(e){d.chain(function(){},function(){t.find(".js-dialogue-line").eq(e).scrollintoview({direction:"vertical",extraScroll:{y:"record"===n.config.screen?1:0}})}),n.conversation.index=e,n.conversation.sentence=n.options.sentences[e],n.conversation.audio=n.conversation.sentence.media.links},n.startConversation=function(e){n.moveToSentence(0),"playback"===e?n.conversation.playing=!0:"recording"===e&&(n.config.started=!0)},n.startRecordingSentence=function(){n.recordings[n.conversation.index]="",n.uniqueRecordingID=g.v4(),n.recorder.newSession(n.activityID,n.uniqueRecordingID).then(function(){n.recording=!0,n.isRecordingStoppable=!1,n.recordingMinimumTimeTimeout=u(function(){n.recordingMinimumTimeTimeout=null,n.isRecordingStoppable=!0},1e3*n.recordingMinimumTIme),n.recordingMaximumTimeTimeout=u(function(){n.recordingMaximumTimeTimeout=null,n.stopRecordingSentence()},1e3*n.recordingLimit),n.recorder.start(),u(function(){})}).catch(function(e){console.log(e)})},n.stopRecordingSentence=function(t){n.recording=!1,n.recordingMinimumTimeTimeout&&(u.cancel(n.recordingMinimumTimeTimeout),n.recordingMinimumTimeTimeout=null),n.recordingMaximumTimeTimeout&&(u.cancel(n.recordingMaximumTimeTimeout),n.recordingMaximumTimeTimeout=null),n.busy=!0,n.recorder.stop().then(function(e){n.recorder.close(),n.busy=!1,t||(n.recorded=!0,n.recordings[n.conversation.index]=r.dynaBucket+e.audioUri,n.footerManager.get("redo").modifyAttr("enabled","recordedSentence",!0),n.moveToNextSentence(),n.saveManager.saveOnEvent()),u(function(){})})},n.showOnSubmitPopup=function(){c.open({templateUrl:"app/formats/cengage/dialogue/submitted.popup.tpl.html",scope:n,appendTo:a.getModalPlaceholder(),controller:["$scope","$uibModalInstance","cptPopupTimeout",function(e,t,n){e.modalInstance=t,e.showCross=!a.isCptMode(),a.isCptMode()&&u(function(){e.modalInstance.dismiss()},n)}]})},n.footerManager.registerButton("redo",250).addText("cengage_dia_redo").addAttr("enabled").addAttr("visible").addClass("redo-button").addCallback("click",function(){n.showRedoPopup()}),n.footerManager.registerButton("nextDialogue",250).addText("cengage_dia_next").addAttr("visible").addAttr("enabled").addClass("dialogue-next-btn").addCallback("click",n.moveToRecordScreen),n.initDialogue()}}}]),angular.module("atoolEngine").directive("engineCarouselSlide",["underscore",function(e){return{restrict:"A",require:["^engineCarousel","engineCarouselSlide"],scope:{active:"=?engineCarouselSlideActive"},link:function(e,t,n,o){var a=o[0],s=o[1];a.addSlide(s),e.$watch(function(){return n.engineCarouselSlide},function(e,t){e!==t&&a.swapSlides(parseInt(e,10),parseInt(t,10))})},controller:["$scope","$element","$attrs",function(e,t,n){angular.extend(this,{getIndex:function(){return parseInt(n.engineCarouselSlide,10)},activate:function(){e.active=!0},deactivate:function(){e.$parent.$broadcast("engine-mediaPause"),e.active=!1},getLeftOffset:function(){return t.position().left},setWidth:function(e){t.outerWidth(e)}})}]}}]),angular.module("atoolEngine").directive("engineCarousel",["underscore","$window",function(e,s){return{restrict:"E",transclude:!0,controllerAs:"carouselCtrl",templateUrl:"app/common/directives/carousel/engineCarousel.tpl.html",scope:{limit:"=?limit",hasCounter:"=?counter"},require:["engineCarousel","^lo"],link:function(e,t,n,o){var a=o[0];o[1].getLoState().addObserver(function(e,t){"solving"===t&&e!==t&&a.resetPosition()}),angular.element(s).bind("resize",function(){e.$$phase||e.$root.$$phase||(a.updateWidth(),a.fixCurrentOffset(),e.$digest())})},controller:"engineCarouselController"}}]),angular.module("atoolEngine").controller("engineCarouselController",["$scope","underscore","$element",function(e,n,o){var a=[],s=0,r=[];angular.extend(this,{updateWidth:function(){var e=100*a.length+"%",t=100/a.length+"%";o.find(".carousel-inner-inner").width(e),n.each(a,function(e){e.setWidth(t)})},addSlide:function(e){a.push(e),e.getIndex()===s?e.activate():e.deactivate(),this.updateWidth()},getMaxSize:function(){return n.isUndefined(e.limit)?a.length:Math.min(a.length,e.limit)},isFirst:function(){return s<=0},isLast:function(){return s>=this.getMaxSize()-1},nextSlide:function(){if(!this.isLast()){var e=o.find(".carousel-inner-inner"),t="translate(-"+a[s+1].getLeftOffset()+"px, 0px)";a[s].deactivate(),a[s+1].activate(),e.css({"-webkit-transform":t,"-moz-transform":t,"-ms-transform":t,"-o-transform":t,transform:t}),s++}},prevSlide:function(){if(!this.isFirst()){var e=o.find(".carousel-inner-inner"),t="translate(-"+a[s-1].getLeftOffset()+"px, 0px)";a[s].deactivate(),a[s-1].activate(),e.css({"-webkit-transform":t,"-moz-transform":t,"-ms-transform":t,"-o-transform":t,transform:t}),s--}},fixCurrentOffset:function(){var e=o.find(".carousel-inner-inner"),t=a[s].getLeftOffset(),n="translate(-"+t+"px, 0px)";0<t?(e.addClass("notransition"),e.css({"-webkit-transform":n,"-moz-transform":n,"-ms-transform":n,"-o-transform":n,transform:n}),e[0].offsetHeight,e.removeClass("notransition")):(e.css({"-webkit-transform":"","-moz-transform":"","-ms-transform":"","-o-transform":"",transform:""}),e[0].offsetHeight)},resetPosition:function(){0!==s&&a[s].deactivate(),s=0,o.find(".carousel-inner-inner").css({"-webkit-transform":"","-moz-transform":"","-ms-transform":"","-o-transform":"",transform:""}),a[s].activate(),r=angular.extend([],a)},swapSlides:function(e,t){a[e]=r[t],e===s&&(r[e].deactivate(),a[e].activate())},getCurrentPosition:function(){return s+1}})}]),angular.module("atoolEngine").directive("engineSegmented",["mobileDetector","underscore","afterViews","$compile","$uibModal","objectHelper","blockTypesHelper","$timeout","$document",function(h,v,w,y,b,k,S,M,A){return{scope:{content:"="},restrict:"E",require:["^lo","^task","engineSegmented"],templateUrl:"app/blocks/cengage/segmented/segmented.tpl.html",controller:"engineSegmentedController",link:function(i,l,e,t){var c=t[0],n=t[1],o=t[2];c.registerSegmentedController(o);var s=function(e){return v.find(i.screens[e].blocks,function(e){return"stimulus"==e.type})};i.hasScreenStimulus=function(e){return 0<s(e).blocks.length};var r=function(e){return v.find(i.screens[e].blocks,function(e){return"activity"==e.type})},d=function(e){var t=r(e);return!!t&&0<t.blocks.length},a=function(){var e=r(0);return e&&e.blocks[0]?e.blocks[0].type:null},p=function(){return v.include(["nglOD","nglFCWL","nglWE"],a())},u=function(){return v.include(["nglOD","nglFCWL","nglWE"],a())},g=function(){return v.include(["cptCON","cptTTT","cptQSH"],a())},m=function(){return v.every(i.screens,function(e){return e.state.visited})},f=function(e,t){return i.content.autonumbered&&1<i.screens.length&&0<e.blocks.length&&(1!==e.blocks.length||!S.isList(e.blocks[0].type))&&(e.blocks=[S.createList(e.blocks,t+1)]),e};i.loState=c.getLoState(),i.dataCollector=c.getDataCollector(),i.footerManager=c.getFooterManager(),i.detectedType=h.getType(),i.extendedElement=null,i.currentTab=0,i.isCptMode=c.isCptMode(),i.screensSizes={solving:{}},i.header=v.find(i.content.blocks,function(e){return"header"==e.type}),i.instruction=v.find(i.content.blocks,function(e){return"instruction"==e.type}),i.instructionMobile=v.find(i.content.blocks,function(e){return"instruction-mobile"==e.type}),i.globalStimulus=v.find(i.content.blocks,function(e){return"stimulus"==e.type}),i.screens=v.filter(i.content.blocks,function(e){return"screen"==e.type}),i.activities=v.chain(i.screens).map(function(e,t){return{data:f(r(t),t),index:t}}).filter(function(e){return e.data}).value(),i.stimuluses=v.chain(i.screens).map(function(e,t){return{data:s(t),index:t}}).filter(function(e){return e.data}).value(),i.mergeSegmentedClasses=function(){i.hasExtendedFunctionality?i.segmentedClasses=v.extend({},i.extendedClasses,i.layoutClasses):i.segmentedClasses=v.extend({},i.gapClasses,i.layoutClasses)},i.handleTabsVisibility=function(){i.hasStimulus=i.hasExtendedFunctionality&&(i.customStimulusData||i.customStimulus)||!i.hasExtendedFunctionality&&(i.hasCurrentScreenStimulus||i.hasGlobalStimulus),i.hasActivity=i.hasExtendedFunctionality&&i.customActivity||!i.hasExtendedFunctionality&&i.hasCurrentScreenActivity,1!=i.currentTab||i.hasStimulus?2!=i.currentTab||i.hasActivity||(i.currentTab=i.hasStimulus?1:0):i.currentTab=i.hasActivity?2:0},i.reflowPage=function(){A[0].body.style.zoom=1.00000001,M(function(){A[0].body.style.zoom=1},50)},i.setColumnSizes=function(e){if(!h.isPhone()){var t=function(){l.find(".js-activity-container").removeAttr("style"),l.find(".js-stimulus-container").removeAttr("style")},n=function(){var e=l.find(".js-activity-container"),t=l.find(".js-stimulus-container").eq(i.hasGlobalStimulus?0:i.currentScreen);if(i.isCptMode&&i.loState.isSolving()&&0<i.screensSizes.solving[i.currentScreen])e.css("width",i.screensSizes.solving[i.currentScreen]),t.css("width",i.screensSizes.solving[i.currentScreen]);else{var n=0,o=0;if(0<e.size()){n=e[0].scrollWidth;var a=e[0].getBoundingClientRect();.5<Math.ceil(a.width)-a.width&&(n+=1),n+=e[0].offsetWidth-e[0].clientWidth}if(0<t.size()){o=t[0].scrollWidth;var s=t[0].getBoundingClientRect();.5<Math.ceil(s.width)-s.width&&(o+=1),o+=t[0].offsetWidth-t[0].clientWidth}var r=Math.max(n,o);e.css("width",r),t.css("width",r),i.loState.isSolving()&&(i.screensSizes.solving[i.currentScreen]=r)}c.getStickTopManager().recalculateAll(),i.reflowPage()};e?w.chain(t,n):(t(),w.chain(n))}},i.scrollActivityToTop=function(){var e=l.find(".js-activity-container");0<e.size()&&(e[0].scrollTop=0)},i.isAudioOnlyStimulus=function(){var e=[];return i.hasCurrentScreenStimulus?e=s(i.currentScreen).blocks:i.hasGlobalStimulus&&(e=i.globalStimulus.blocks),1===e.length&&"asset"===e[0].type&&"audio"===e[0].model.type},i.resetSegmented=function(){i.hasExtendedFunctionality?(i.mergeSegmentedClasses(),i.extendedElement||(i.firstActivity=r(0).blocks[0],i.extendedElement=y('<block-element content="firstActivity"></block-element>')(i,void 0,{transcludeControllers:{lo:{instance:c},task:{instance:n},engineSegmented:{instance:o}}}))):(v.each(i.screens,function(e){e.state={activityStates:[],visited:!1,correct:!1,wrong:!1,points:0,pointsToGain:0,clearActivityStates:function(){this.activityStates=[]},addActivityState:function(e){this.activityStates.push(e)},recalculateStates:function(){this.correct=i.loState.isReport()&&v.every(this.activityStates,function(e){return"correct"===e}),this.wrong=i.loState.isReport()&&!this.correct}}}),i.currentScreen=0,i.footerManager.get("submit").modifyAttr("enabled","segmentedScreensVisited",!1),i.isCptMode||i.footerManager.get("showAnswers").modifyAttr("enabled","segmentedSubmitted",!1),i.hasGlobalStimulus&&(i.hasNewStimulus=!0),i.changeScreen(0)),i.isCptMode||i.footerManager.get("viewFeedback").modifyAttr("enabled","exerciseSubmitted",!1)},i.hasMultipleScreens=1<i.screens.length,i.segmentedClasses={},i.gapClasses={},i.extendedClasses={},i.layoutClasses={},i.hasExtendedFunctionality=p(),i.hasExtendedFunctionality&&(i.extendedClasses["extended-segmented-"+a()]=!0),i.layoutClasses["ngl-fullscreen"]=u(),i.layoutClasses["cpt-fullscreen"]=g(),i.layoutClasses["pagination-present"]=!i.hasExtendedFunctionality&&i.hasMultipleScreens,i.layoutClasses["pagination-absent"]=!i.hasExtendedFunctionality&&!i.hasMultipleScreens,i.layoutClasses["activity-fullscreen"]=i.layoutClasses["ngl-fullscreen"]||i.layoutClasses["cpt-fullscreen"],i.layoutClasses["has-activity"]=!1,i.layoutClasses["has-stimulus"]=!1,i.footerManager.get("footer").addAttrObserver("visible",function(e){i.layoutClasses["no-footer"]=!e,i.mergeSegmentedClasses()},!0),i.footerManager.get("footer").addClass("segmented-footer-"+i.detectedType),i.footerManager.registerButton("viewFeedback",150).addText("cengage_view_feedback_button").addAttr("visible").addAttr("enabled").addClass("view-feedback-button").addCallback("click",function(){i.showFeedback()}),i.content.feedback||i.footerManager.get("viewFeedback").modifyAttr("visible","feedbackAvailable",!1),i.isCptMode||i.footerManager.get("viewFeedback").modifyAttr("enabled","exerciseSubmitted",!1),i.hasGlobalStimulus=0<i.globalStimulus.blocks.length,i.instructionSwitchState=i.isCptMode?"collapsed":"open",i.hasCurrentScreenStimulus=!0,i.hasCurrentScreenActivity=!0,i.hasStimulus=!0,i.hasActivity=!0,i.changeScreen=function(e){e<0&&(e=0),e>=i.screens.length&&(e=i.screens.length-1);var o=i.currentScreen;i.currentScreen=e,v.each(l.find(".js-stimulus, .js-activity"),function(e){angular.element(e).scope().$broadcast("engine-mediaPause")}),i.screens[e].state.visited=!0,i.hasCurrentScreenStimulus=i.hasScreenStimulus(i.currentScreen),i.hasCurrentScreenActivity=d(i.currentScreen),i.handleTabsVisibility();var t=s(i.currentScreen),n=r(i.currentScreen);if(i.hasCurrentScreenStimulus&&(1===i.currentTab?(t.visited=!0,i.hasNewStimulus=!1):i.hasNewStimulus=!t.visited),i.hasCurrentScreenActivity&&(2===i.currentTab?(n.visited=!0,i.hasNewActivity=!1):i.hasNewActivity=!n.visited),i.loState.isSolving()){i.screens[o].state.clearActivityStates(),i.screens[o].state.recalculateStates();var a=l.find(".js-activity").eq(o);0<a.size()&&(a.scope().$broadcast("engine-SegmentedScreen-OnLeave"),a.scope().$broadcast("engine-GapResult",{stateCallback:function(e,t,n){i.screens[o].state.addActivityState(e),i.screens[o].state.recalculateStates()}}))}i.gapClasses={},v.each(v.uniq(k.getPairs(i.screens[e],["type"],function(e){return S.isGap(e.type)},!0)),function(e){i.gapClasses["segmented-"+e.type]=!0}),v.each(v.uniq(k.getPairs(i.screens[e],["display"],function(e){return!0},!0)),function(e){i.gapClasses["segmented-display-"+e.display]=!0}),i.audioOnlyStimulus=i.isAudioOnlyStimulus(),i.layoutClasses["audio-only-stimulus"]=i.audioOnlyStimulus&&"phone"!==i.detectedType,i.layoutClasses["has-activity"]=i.hasCurrentScreenActivity,i.layoutClasses["has-stimulus"]=i.hasCurrentScreenStimulus||i.hasGlobalStimulus,i.mergeSegmentedClasses(),i.footerManager.get("submit").modifyAttr("enabled","segmentedScreensVisited",m()),i.scrollActivityToTop(),w.chain(function(){var e=l.find(".js-activity");v.each(e,function(e,t){var n=angular.element(e);t===i.currentScreen?n.scope().$broadcast("engine-SegmentedScreen-OnEnter"):n.scope().$broadcast("engine-SegmentedScreen-Hidden")})},function(){},i.setColumnSizes.bind(!0))},i.loState.addObserver(function(e,t){"solving"===e&&"report"===t?(i.hasExtendedFunctionality||(c.isCptMode()||i.footerManager.get("showAnswers").modifyAttr("enabled","segmentedSubmitted",!0),v.each(l.find(".js-activity"),function(e,o){i.screens[o].state.clearActivityStates(),i.screens[o].state.recalculateStates(),angular.element(e).scope().$broadcast("engine-GapResult",{stateCallback:function(e,t,n){i.screens[o].state.addActivityState(e),i.screens[o].state.recalculateStates(),i.screens[o].state.points+=t,i.screens[o].state.pointsToGain+=n}})})),!c.isTeacherReportMode()&&i.content.feedback&&(i.footerManager.get("viewFeedback").modifyAttr("enabled","exerciseSubmitted",!0),i.content.autoFeedback&&i.showFeedback())):"report"!==e&&"showAnswer"!==e||"solving"!==t||i.resetSegmented(),i.setColumnSizes(!0),i.scrollActivityToTop()}),i.showFeedback=function(){b.open({templateUrl:"app/blocks/cengage/segmented/feedback.popup.tpl.html",scope:i,appendTo:c.getModalPlaceholder(),controller:["$scope","$uibModalInstance",function(e,t){e.modalInstance=t}]})},i.toogleInstruction=function(){"collapsed"==i.instructionSwitchState?i.instructionSwitchState="open":i.instructionSwitchState="collapsed",i.setColumnSizes(!0),l.scope().$broadcast("engine-Segmented-InstructionSwitch")},i.hasContent=function(e){return e&&0<e.blocks.length},i.tabSelect=function(t){var e,n;i.footerManager.get("footer").modifyAttr("visible","hidingFooterOnMobileInstructions",2==t),i.currentTab=t,i.hasExtendedFunctionality||(e=s(i.currentScreen),n=r(i.currentScreen)),1==i.currentTab&&(i.hasNewStimulus=!1,e&&(e.visited=!0)),2==i.currentTab&&(i.hasNewActivity=!1,n&&(n.visited=!0)),w.chain(function(){if(2===t){var e=l.find(".js-activity").eq(i.currentScreen);0<e.size()&&e.scope().$broadcast("engine-SegmentedTab-OnEnter")}})},i.$on("engine-image-Loaded",function(){i.screensSizes.solving={},i.setColumnSizes(!0)}),i.$on("engine-window-Resize",function(){i.screensSizes.solving={},i.setColumnSizes(!0)}),A[0].fonts&&(A[0].fonts.onloadingdone=function(){i.screensSizes.solving={},i.setColumnSizes(!0)}),i.resetSegmented()}}}]),angular.module("atoolEngine").controller("engineSegmentedController",["$scope","$element","afterViews","$q","$compile","$templateCache",function(o,n,a,s,r,i){var t=function(e,t){n.find("."+e).append(t)},l=function(e,t){o[t]&&_.isFunction(o[t].scope)&&o[t].scope()&&o[t].scope().$destroy(),o[t]=null,n.find("."+e).empty()};angular.extend(this,{getScreens:function(){return o.screens},registerCustomActivity:function(e){2!==o.currentTab&&(o.hasNewActivity=!0),o.customActivity=e,a.chain(t.bind(this,"js-extended-activity",e),o.handleTabsVisibility,o.setColumnSizes.bind(!0))},clearCustomActivity:function(){o.customActivity=null,a.chain(l.bind(this,"js-extended-activity","customActivity"),o.handleTabsVisibility,o.setColumnSizes.bind(!0))},replaceCustomActivity:function(e){2!==o.currentTab&&(o.hasNewActivity=!0),a.chain(l.bind(this,"js-extended-activity","customActivity"),function(){o.customActivity=e},o.handleTabsVisibility,t.bind(this,"js-extended-activity",e),o.setColumnSizes.bind(!0))},registerCustomMenu:function(e){o.customMenu=e,a.chain(t.bind(this,"js-extended-menu",e))},clearCustomMenu:function(){o.customMenu=null,a.chain(l.bind(this,"js-extended-menu","customMenu"))},replaceCustomMenu:function(e){o.customMenu=null,a.chain(l.bind(this,"js-extended-menu","customMenu"),function(){o.customMenu=e},t.bind(this,"js-extended-menu",e))},registerCustomHeader:function(e){o.customHeader=e,a.chain(t.bind(this,"js-extended-header",e))},clearCustomHeader:function(){o.customHeader=null,a.chain(l.bind(this,"js-extended-header","customHeader"))},replaceCustomHeader:function(e){o.customHeader=null,a.chain(l.bind(this,"js-extended-header","customHeader"),function(){o.customHeader=e},t.bind(this,"js-extended-header",e))},registerCustomStimulus:function(e){1!==o.currentTab&&(o.hasNewStimulus=!0),o.customStimulus=e,a.chain(t.bind(this,"js-extended-stimulus",e),o.handleTabsVisibility,o.setColumnSizes.bind(!0))},clearCustomStimulus:function(){o.customStimulusData=null,a.chain(l.bind(this,"js-extended-stimulus","customStimulus"),o.handleTabsVisibility,o.setColumnSizes.bind(!0))},replaceCustomStimulus:function(e){1!==o.currentTab&&(o.hasNewStimulus=!0),o.customStimulusData=null,o.customStimulus=null,o.stimulusChain&&o.stimulusChain.cancel(),o.stimulusChain=a.chain(l.bind(this,"js-extended-stimulus"),function(){o.customStimulus=e},o.handleTabsVisibility,t.bind(this,"js-extended-stimulus",e),o.setColumnSizes.bind(!0))},registerCustomStimulusData:function(e){1!==o.currentTab&&(o.hasNewStimulus=!0),o.customStimulusData=e,o.handleTabsVisibility(),a.chain(o.setColumnSizes.bind(!0))},clearCustomStimulusData:function(){o.customStimulusData=null,a.chain(l.bind(this,"js-extended-stimulus","customStimulus"),o.handleTabsVisibility,o.setColumnSizes.bind(!0))},replaceCustomStimulusData:function(e){o.customStimulusData!==e&&(1!==o.currentTab&&(o.hasNewStimulus=!0),o.customStimulusData=null,o.stimulusDataChain&&o.stimulusDataChain.cancel(),o.stimulusDataChain=a.chain(l.bind(this,"js-extended-stimulus","customStimulus"),function(){o.customStimulusData=e},o.handleTabsVisibility,o.setColumnSizes.bind(!0)))},registerCustomModelData:function(e){o.customModelData=e},clearCustomModelData:function(){o.customModelData=null},replaceCustomModelData:function(e){var t=s.defer();if(o.customModelData===e)t.resolve();else{var n=this;n.clearCustomModelData(),o.modelDataChain&&o.modelDataChain.cancel(),o.modelDataChain=a.chain(function(){n.registerCustomModelData(e)},function(){t.resolve()})}return t.promise},getModelElement:function(){return n.find(".js-extended-model")},getActivityElement:function(){return n.find(".js-activity-container")},compileElement:function(e,t,n,o){var a={lo:{instance:n},task:{instance:o},engineSegmented:{instance:this}};return r(i.get(e))(t.$new(),void 0,{transcludeControllers:a})},recalcColumnSizes:function(){o.setColumnSizes(!0)}})}]),angular.module("atoolEngine").directive("engineSegmentedPager",["underscore",function(d){return{restrict:"E",templateUrl:"app/blocks/cengage/segmented/segmented-pager.tpl.html",link:function(i,e,t){var n=e.find(".js-segmented-pager"),o=function(){return n.innerWidth()},a=e.find(".js-first-segmented-button"),s=function(){return a.outerWidth(!0)},l=null,c=null;i.firstScreensTruncated=!1,i.lastScreensTruncated=!1,d.each(i.screens,function(e){e.pager={visible:!0}});var r=function(){if(0<l&&0<c){var e=Math.floor(l/c)-2;e%2==0&&e--;var s=(e+1)/2,t=i.currentScreen+1,r=e;s<t&&e<i.screens.length?(i.firstScreensTruncated=!0,r--):i.firstScreensTruncated=!1,t<i.screens.length-s+1&&e<i.screens.length?(i.lastScreensTruncated=!0,r--):i.lastScreensTruncated=!1,d.each(i.screens,function(e,t){var n=t+1,o=s-2,a=i.currentScreen+1;i.firstScreensTruncated&&i.lastScreensTruncated?e.pager.visible=a-o<=n&&n<=a+o:i.firstScreensTruncated?e.pager.visible=n>i.screens.length-r:i.lastScreensTruncated?e.pager.visible=n<=r:e.pager.visible=!0})}};i.$watch(o,function(e){l=e,r()}),i.$watch(s,function(e){c=e,r()}),i.handleChangeScreen=function(e){i.changeScreen(e),r()}}}}]),angular.module("atoolEngine").directive("engineCengageModel",["adapterProxy",function(e){return{scope:{content:"="},restrict:"E",require:"^lo",templateUrl:"app/blocks/cengage/model/model.tpl.html",link:function(e,t,n,o){e.dataCollector=o.getDataCollector(),e.collapsed=!0,e.toogleCollapsed=function(){e.collapsed=!e.collapsed,e.collapsed&&t.find(".js-model-content").scope().$broadcast("engine-mediaPause")}}}}]),angular.module("atoolEngine").directive("wordsearch",["Gap","underscore",function(f,h){return{require:["^lo","^task","?^nonmarkableBlock"],scope:{options:"="},restrict:"E",replace:"true",templateUrl:"app/formats/wordsearch/wordsearch.tpl.html",link:function(l,e,t,n){var o=n[0],a=n[1];null!==n[2]&&(l.options.nonmarkableBlockController=n[2]);var s=h.filter(l.options.answers.answers,function(e){return!e.example});l.selectedLetter=[],l.answerWords=[],l.gapModel=new f(l,l.options,s,{loState:o.getLoState()},function(){angular.forEach(l.answerWords,function(e){p(e,l.gapModel.attrs.answers.structure,!1)}),l.answerWords=[],l.selectedLetter=[],l.clearActive("selected"),r()}),a.getTaskModel().addGap(l.gapModel),angular.forEach(l.gapModel.attrs.answers.structure,function(e){angular.forEach(e,function(e){e.directions=[]})});var r=function(){angular.forEach(l.gapModel.attrs.answers.answers,function(e){e.example&&(m(e,"selected",!0,l.gapModel.attrs.answers.structure),m(e,"example",!0,l.gapModel.attrs.answers.structure),p(e,l.gapModel.attrs.answers.structure,!0),l.answerWords.push(angular.copy(e)))})},i=function(){angular.forEach(l.answerWords,function(e){m(e,"selected",!0,l.gapModel.attrs.answers.structure)})};if("system"===l.options.markedBy)l.gapModel.registerState(0,function(){return 0===h.filter(l.answerWords,function(e){return!e.example}).length},function(){return h.every(l.gapModel.attrs.answers.answers,function(t){return h.some(l.answerWords,function(e){return e.answer===t.answer})})&&l.gapModel.attrs.answers.answers.length===l.answerWords.length},function(e){return e.isCorrect()?l.gapModel.getPointsToGain():0});else if("system-option"===l.options.markedBy){var c=h.filter(l.gapModel.attrs.answers.answers,function(e){return!e.example});l.gapModel.registerState(0,function(){return 0===h.filter(l.answerWords,function(e){return!e.example}).length},function(){return h.every(l.gapModel.attrs.answers.answers,function(t){return h.some(l.answerWords,function(e){return e.answer===t.answer})})&&l.gapModel.attrs.answers.answers.length===l.answerWords.length},function(e){var o=angular.copy(c),t=h.filter(l.answerWords,function(n){if(!n.example)return h.some(o,function(e,t){return e.answer===n.answer?(o.splice(t,1),n.isCorrect=!0):n.isCorrect=!1})}).length,n=l.gapModel.getPointsToGain()/c.length;return n*t-(l.answerWords.length>l.gapModel.attrs.answers.answers.length?l.answerWords.length-l.gapModel.attrs.answers.answers.length:0)*n})}l.getDirectionClasses=function(e){var t={};return t.horizontal="horizontal"===e.class,t.vertical="vertical"===e.class,t["diagonal-right"]="diagonal-right"===e.class,t["diagonal-left"]="diagonal-left"===e.class,t["first-horizontal"]="first-horizontal"===e.class,t["first-vertical"]="first-vertical"===e.class,t["first-diagonal-right"]="first-diagonal-right"===e.class,t["first-diagonal-left"]="first-diagonal-left"===e.class,t["last-horizontal"]="last-horizontal"===e.class,t["last-vertical"]="last-vertical"===e.class,t["last-diagonal-right"]="last-diagonal-right"===e.class,t["last-diagonal-left"]="last-diagonal-left"===e.class,t};var d=function(e,t,n){if(t)e.push({class:n});else{var o=h.findIndex(e,function(e){return e.class===n});e.splice(o,1)}},p=function(e,t,n){var o;if("horizontal"===e.direction){for(d(t[e.startIndex[0]][e.startIndex[1]].directions,n,"first-horizontal"),o=e.startIndex[1]+1;o<e.startIndex[1]+e.length-1;o++)d(t[e.startIndex[0]][o].directions,n,"horizontal");d(t[e.startIndex[0]][e.startIndex[1]+e.length-1].directions,n,"last-horizontal")}if("vertical"===e.direction){for(d(t[e.startIndex[0]][e.startIndex[1]].directions,n,"first-vertical"),o=e.startIndex[0]+1;o<e.startIndex[0]+e.length-1;o++)d(t[o][e.startIndex[1]].directions,n,"vertical");d(t[e.startIndex[0]+e.length-1][e.startIndex[1]].directions,n,"last-vertical")}if("diagonal-right"===e.direction){for(d(t[e.startIndex[0]][e.startIndex[1]].directions,n,"first-diagonal-right"),o=1;o<e.length-1;o++)d(t[e.startIndex[0]+o][e.startIndex[1]+o].directions,n,"diagonal-right");d(t[e.startIndex[0]+e.length-1][e.startIndex[1]+e.length-1].directions,n,"last-diagonal-right")}if("diagonal-left"===e.direction){for(d(t[e.startIndex[0]][e.startIndex[1]].directions,n,"first-diagonal-left"),o=1;o<e.length-1;o++)d(t[e.startIndex[0]-o][e.startIndex[1]+o].directions,n,"diagonal-left");d(t[e.startIndex[0]-(e.length-1)][e.startIndex[1]+e.length-1].directions,n,"last-diagonal-left")}},u=function(e,t){var n=l.activateWord(e,t,"selected");p(n,l.gapModel.attrs.answers.structure,!0),l.answerWords.push(n)};l.evaluate=function(){l.gapModel.evaluateStates(),l.gapModel.userAnswer=h.filter(l.answerWords,function(e){return!e.example})},l.selectLetter=function(e,t,n){!h.isEmpty(l.selectedLetter)&&g(t,n)&&(u(t,n),l.clearActive("active"),l.gapModel.attrs.answers.structure[l.selectedLetter[0]][l.selectedLetter[1]].active=!1,l.selectedLetter=[],l.evaluate())},l.selectFirstLetter=function(e,t,n){h.isEmpty(l.selectedLetter)?(e.active=!0,l.selectedLetter=[t,n]):l.selectedLetter[0]===t&&l.selectedLetter[1]===n&&l.deselectLetter()},l.deselectLetter=function(){l.selectedLetter=[],l.clearActive("active")},l.clearActive=function(t){angular.forEach(l.gapModel.attrs.answers.structure,function(e){angular.forEach(e,function(e){e[t]=!1})}),h.isEmpty(l.selectedLetter)||(l.gapModel.attrs.answers.structure[l.selectedLetter[0]][l.selectedLetter[1]][t]=!0)};var g=function(e,t){return e===l.selectedLetter[0]&&t!==l.selectedLetter[1]||t===l.selectedLetter[1]&&e!==l.selectedLetter[0]||e-l.selectedLetter[0]==t-l.selectedLetter[1]&&t!==l.selectedLetter[1]&&e!==l.selectedLetter[0]||e-l.selectedLetter[0]==-(t-l.selectedLetter[1])&&t!==l.selectedLetter[1]&&e!==l.selectedLetter[0]};l.activateWord=function(e,t,n){var o,a="",s=0,r="",i=[];if(!h.isEmpty(l.selectedLetter))if(e===l.selectedLetter[0])if(t>l.selectedLetter[1])for(o=l.selectedLetter[1];o<=t;o++)l.gapModel.attrs.answers.structure[e][o][n]=!0,a+=l.gapModel.attrs.answers.structure[e][o].letter,s=t-l.selectedLetter[1],r="horizontal",i=angular.copy(l.selectedLetter);else{for(o=t;o<=l.selectedLetter[1];o++)l.gapModel.attrs.answers.structure[e][o][n]=!0,a+=l.gapModel.attrs.answers.structure[e][o].letter,s=l.selectedLetter[1]-t,r="horizontal",i=[e,t];a=a.split("").reverse().join("")}else if(t===l.selectedLetter[1])if(e>l.selectedLetter[0])for(o=l.selectedLetter[0];o<=e;o++)l.gapModel.attrs.answers.structure[o][t][n]=!0,a+=l.gapModel.attrs.answers.structure[o][t].letter,s=e-l.selectedLetter[0],r="vertical",i=angular.copy(l.selectedLetter);else{for(o=e;o<=l.selectedLetter[0];o++)l.gapModel.attrs.answers.structure[o][t][n]=!0,a+=l.gapModel.attrs.answers.structure[o][t].letter,s=l.selectedLetter[0]-e,r="vertical",i=[e,t];a=a.split("").reverse().join("")}else if(e-l.selectedLetter[0]==t-l.selectedLetter[1])if(0<e-l.selectedLetter[0])for(o=0;o<=e-l.selectedLetter[0];o++)l.gapModel.attrs.answers.structure[l.selectedLetter[0]+o][l.selectedLetter[1]+o][n]=!0,a+=l.gapModel.attrs.answers.structure[l.selectedLetter[0]+o][l.selectedLetter[1]+o].letter,s=e-l.selectedLetter[0],r="diagonal-right",i=angular.copy(l.selectedLetter);else{for(o=0;o<=l.selectedLetter[0]-e;o++)l.gapModel.attrs.answers.structure[e+o][t+o][n]=!0,a+=l.gapModel.attrs.answers.structure[e+o][t+o].letter,s=l.selectedLetter[0]-e,r="diagonal-right",i=[e,t];a=a.split("").reverse().join("")}else if(e-l.selectedLetter[0]==-(t-l.selectedLetter[1]))if(0<e-l.selectedLetter[0]){for(o=0;o<=l.selectedLetter[1]-t;o++)l.gapModel.attrs.answers.structure[e-o][t+o][n]=!0,a+=l.gapModel.attrs.answers.structure[e-o][t+o].letter,s=l.selectedLetter[1]-t,r="diagonal-left",i=[e,t];a=a.split("").reverse().join("")}else for(o=0;o<=t-l.selectedLetter[1];o++)l.gapModel.attrs.answers.structure[l.selectedLetter[0]-o][l.selectedLetter[1]+o][n]=!0,a+=l.gapModel.attrs.answers.structure[l.selectedLetter[0]-o][l.selectedLetter[1]+o].letter,s=t-l.selectedLetter[1],r="diagonal-left",i=angular.copy(l.selectedLetter);return{answer:a,length:s+1,direction:r,startIndex:i}};var m=function(e,t,n,o){var a;if("horizontal"===e.direction)for(a=e.startIndex[1];a<e.startIndex[1]+e.length;a++)o[e.startIndex[0]][a][t]=n;if("vertical"===e.direction)for(a=e.startIndex[0];a<e.startIndex[0]+e.length;a++)o[a][e.startIndex[1]][t]=n;if("diagonal-right"===e.direction)for(a=0;a<e.length;a++)o[e.startIndex[0]+a][e.startIndex[1]+a][t]=n;if("diagonal-left"===e.direction)for(a=0;a<e.length;a++)o[e.startIndex[0]-a][e.startIndex[1]+a][t]=n};l.activateAnswerWord=function(e){m(e,"active",!0,l.gapModel.attrs.answers.structure)},l.deactivateAnswerWord=function(e){m(e,"active",!1,l.gapModel.attrs.answers.structure)},l.activateShowAnswerWord=function(e){m(e,"active",!0,l.structure)},l.deactivateShowAnswerWord=function(e){m(e,"active",!1,l.structure)},l.deleteAnswer=function(e){m(e,"selected",!1,l.gapModel.attrs.answers.structure),p(e,l.gapModel.attrs.answers.structure,!1),l.deactivateAnswerWord(e);var t=h.indexOf(l.answerWords,e);l.answerWords.splice(t,1),i(),l.evaluate()},l.getLetterClasses=function(e,t,n){var o={};return o.activeLetter=e.active,o.selectedLetter=e.selected,o.exampleLetter=e.example,o.horizontal=e.horizontal,o.vertical=e.vertical,o["diagonal-right"]=e["diagonal-right"],o["diagonal-left"]=e["diagonal-left"],o["first-horizontal"]=e["first-horizontal"],o["first-vertical"]=e["first-vertical"],o["first-diagonal-right"]=e["first-diagonal-right"],o["first-diagonal-left"]=e["first-diagonal-left"],o["last-horizontal"]=e["last-horizontal"],o["last-vertical"]=e["last-vertical"],o["last-diagonal-right"]=e["last-diagonal-right"],o["last-diagonal-left"]=e["last-diagonal-left"],o},function(){l.structure=angular.copy(l.gapModel.attrs.answers.structure),angular.forEach(l.gapModel.attrs.answers.answers,function(e){m(e,"selected",!0,l.structure),p(e,l.structure,!0),e.example&&m(e,"example",!0,l.structure)})}(),r(),l.gapModel.registerCustomSave(function(){return{options:{data:l.gapModel.attrs.answers,answers:l.answerWords}}}),l.gapModel.registerCustomRestore(function(e){e.options&&(l.gapModel.attrs.answers=e.options.data,l.answerWords=e.options.answers)})}}}]),angular.module("atoolEngine").directive("sentenceCorrect",["Gap","underscore","htmlEscaper",function(r,i,l){return{require:["^lo","^task","?^nonmarkableBlock"],scope:{options:"="},restrict:"E",replace:"true",templateUrl:"app/formats/sentenceCorrect/sentenceCorrect.tpl.html",link:function(t,n,e,o){var a=o[0],s=o[1];null!==o[2]&&(t.options.nonmarkableBlockController=o[2]),t.getElementSizing=function(e){return{offset:n.find(".cor-part:eq("+e+")").offset(),height:n.find(".cor-part:eq("+e+")").outerHeight()}},t.options.answers.correctAnswers=i.map(t.options.answers.correctAnswers,l.unescape),t.options.answers.defaultAnswer=l.unescape(t.options.answers.defaultAnswer),t.gapModel=new r(t,t.options,t.options.answers.correctAnswers,{loState:a.getLoState()}),s.getTaskModel().addGap(t.gapModel),t.isUndetermined={value:!0},t.gapInternals={},"system"===t.options.markedBy&&t.gapModel.registerState(0,function(){return t.isUndetermined.value},function(){var e=t.gapModel.userAnswer!==t.options.answers.defaultAnswer;return i.contains(t.gapModel.attrs.answers.correctAnswers,t.gapModel.userAnswer)&&("wrong"!==t.gapInternals.state||e)},function(e){return e.isCorrect()?t.gapModel.getPointsToGain():0}),t.evaluate=function(){t.gapModel.evaluateStates()},t.getReportClass=function(){return"non-marked"===t.gapModel.attrs.markedBy?{}:{"correct t_correct":t.gapModel.states[0].isCorrect(),"wrong t_wrong":t.gapModel.states[0].isWrong(),"missing t_missing":t.gapModel.states[0].isMissing()}}}}}]),angular.module("atoolEngine").directive("corEditable",function(){return{restrict:"E",translude:!0,templateUrl:"app/formats/sentenceCorrect/corEditable.tpl.html",link:function(t,e,n){t.gapInternals.state="undetermined",t.focusInput={value:!1},t.options.answers.defaultAnswer=t.options.answers.defaultAnswer.replace(/\[|\]/g,""),t.gapModel.userAnswer=t.options.answers.defaultAnswer,t.gapModel.updateCustomReset(function(){t.gapModel.userAnswer=t.options.answers.defaultAnswer,t.gapInternals.state="undetermined",t.isUndetermined.value=!0}),t.gapModel.registerCustomSave(function(){return{internalState:t.gapInternals.state,undetermined:t.isUndetermined.value}}),t.gapModel.registerCustomRestore(function(e){t.gapInternals.state=e.internalState,t.isUndetermined.value=e.undetermined}),t.enterStateWrong=function(){t.gapInternals.state="wrong",t.isUndetermined.value=!1,t.focusInput.value=!0,t.evaluate()},t.enterStateCorrect=function(){t.gapInternals.state="correct",t.isUndetermined.value=!1,t.gapModel.userAnswer=t.options.answers.defaultAnswer,t.evaluate()}}}}),angular.module("atoolEngine").directive("corClickable",["$timeout","underscore",function(e,a){return{restrict:"E",translude:!0,templateUrl:"app/formats/sentenceCorrect/corClickable.tpl.html",link:function(t,e,n){t.isUndetermined.value=!1;var o=function(e){e.userAnswer=e.value,e.state="correct",t.mergeAndEvaluate()};t.splitted=t.options.answers.defaultAnswer.match(/\[.+?\]|.+?(?=\[)|.+/g),t.splitted=a.map(t.splitted,function(e){var t=e,n="static";return t.match(/\[.+\]/)&&(n="clickable",t=t.replace(/\[(.+)\]/,"$1")),{value:t,type:n,userAnswer:t,state:"correct"}}),t.gapModel.registerCustomSave(function(){return{splitted:t.splitted}}),t.gapModel.registerCustomRestore(function(e){t.splitted=e.splitted}),t.defaultAnswer=a.reduce(t.splitted,function(e,t){return e+t.value},""),t.gapModel.updateCustomReset(function(){a.each(t.splitted,o)}),t.setStateWrong=function(e){t.splitted[e].state="wrong",t.splitted[e].focusInput=!0},t.setStateCorrect=function(e){o(t.splitted[e])},t.mergeAndEvaluate=function(){t.gapModel.userAnswer=a.reduce(t.splitted,function(e,t){return e+t.userAnswer},""),t.evaluate()},t.mergeAndEvaluate()}}}]),angular.module("atoolEngine").directive("engineRecording",["Gap","underscore","HtmlAudioPlayer","audioContextManager","$timeout","$interval","adapterProxy","EngineRecorder","rfc4122","$uibModal",function(r,i,l,c,d,e,p,t,u,g){return{require:["^lo","^task","?^nonmarkableBlock"],scope:{options:"="},restrict:"E",replace:"true",templateUrl:"app/formats/recording/recording.tpl.html",link:function(o,e,t,n){var a=n[0],s=n[1];null!==n[2]&&(o.options.nonmarkableBlockController=n[2]),o.dataCollector=a.getDataCollector(),o.loState=a.getLoState(),o.saveManager=a.getSaveManager(),o.timeLimit=o.options.timeLimit||180,o.hasModelAnswer=!!o.options.modelAnswer.links,o.busy=!1,o.gapModel=new r(o,o.options,[],{loState:a.getLoState()},function(){o.cleanRecording(),o.initRecording()}),s.getTaskModel().addGap(o.gapModel),o.loState.addObserver(function(e,t){"solving"===e&&"report"===t&&o.cleanRecording()}),o.$on("$destroy",function(){o.cleanRecording()}),"system"===o.options.markedBy&&o.gapModel.registerState(0,function(){return!o.gapModel.userAnswer.length},function(){return!0},function(e){return e.isCorrect()?o.gapModel.getPointsToGain():0}),o.gapModel.registerCustomRestore(function(e){o.gapModel.userAnswer.length&&o.createPlayerForRecording(o.gapModel.userAnswer)}),o.createPlayerForRecording=function(e){o.recordingPlayer&&o.recordingPlayer.destroy(),o.recordingPlayer=new l(i.map(e,function(e){return{url:e.url,type:e.contentType}}),o.dataCollector,{onEnded:function(){o.playingRecording=!1,o.currentPlayer=null,d(function(){})}})},o.startRecording=function(){o.uniqueRecordingID=u.v4(),o.gapModel.userAnswer=[],o.gapModel.evaluateStates(),o.engineRecorder.record(o.dataCollector.getLoParams().loId,o.uniqueRecordingID,{maxTime:o.timeLimit,vendor:p.getRecordingsVendor(o.dataCollector),onStop:function(){o.busy=!0,o.recording=!1},onUrlResponse:function(e){o.busy=!1,o.gapModel.userAnswer=e,o.gapModel.evaluateStates(),o.createPlayerForRecording(e),d(function(){})},onError:function(n){g.open({templateUrl:"app/formats/recording/recording.error.popup.tpl.html",appendTo:a.getModalPlaceholder(),controller:["$scope","$uibModalInstance",function(e,t){e.modalInstance=t,e.dataCollector=o.dataCollector,e.error=n}]})}}).then(function(){o.recording=!0}).catch(function(e){console.log(e)})},o.stopRecording=function(){o.engineRecorder.stop(o.uniqueRecordingID)},o.audioContextAvailable=function(){return!c.audioContextUsed},o.isEngineRecorderConnected=function(){return o.engineRecorder.connected},o.playRecording=function(){o.currentPlayer&&o.currentPlayer.stop(),o.playingRecording=!0,o.currentPlayer=o.recordingPlayer,o.currentPlayer.play()},o.stopPlaying=function(){o.currentPlayer&&(o.currentPlayer.stop(),o.currentPlayer=null,o.playingRecording=!1,o.playingModelAnswer=!1)},o.playModelAnswer=function(){o.currentPlayer&&o.currentPlayer.stop(),o.playingModelAnswer=!0,o.currentPlayer=o.modelAnswerPlayer,o.currentPlayer.play()},o.initRecording=function(){o.gapModel.userAnswer=[],o.engineRecorder=a.getEngineRecorder(),o.options.modelAnswer.links&&(o.modelAnswerPlayer=new l(i.map(o.options.modelAnswer.links,function(e){return{url:e.url,type:e.mime}}),o.dataCollector,{onEnded:function(){o.playingModelAnswer=!1,o.currentPlayer=null,d(function(){})}}))},o.initRecording(),o.cleanRecording=function(){o.stopPlaying(),o.modelAnswerPlayer&&o.modelAnswerPlayer.destroy(),o.recordingPlayer&&o.recordingPlayer.destroy(),o.recording&&o.stopRecording()}}}}]),angular.module("atoolEngine").directive("ordering",["Gap","underscore","draggableConfigCreator","$timeout",function(p,u,g,m){return{require:["^lo","^task","?^nonmarkableBlock","?^engineSegmented"],scope:{options:"="},restrict:"E",replace:"true",templateUrl:"app/formats/ordering/ordering.tpl.html",link:function(a,e,t,n){var o=n[0],s=n[1],r=null;null!==n[2]&&(a.options.nonmarkableBlockController=n[2]),null!==n[3]&&(r=n[3]),a.saveManager=o.getSaveManager(),a.shouldShowEyeballs=o.shouldShowEyeballs(),a.gapModel=new p(a,a.options,a.options.answers.answerSets,{loState:o.getLoState()},function(){a.resetGap()}),a.onSentenceScrambleDraggableStart=function(e,t){g.onStart(t.helper,t.helper,a.$containmentElement[0])},a.onOrderingDraggableStart=function(e,t){g.onStart(t.helper,t.helper,a.$containmentElement[0],!0)},a.evaluate=function(){a.gapModel.userAnswer=u.chain(a.gapModel.attrs.answers.options).filter(function(e){return!u.isUndefined(e.userOrder)}).map(function(e){return u.pick(e,"option","type","fixed","userOrder")}).sortBy("userOrder").value(),a.gapModel.evaluateStates()},s.getTaskModel().addGap(a.gapModel),a.randomize=function(){if(a.gapModel.attrs.randomize){var n=u.chain(a.gapModel.attrs.answers.options.length).range().filter(function(e){return!u.contains(["clickable","dnd"],a.gapModel.getDisplayType())||!a.gapModel.attrs.answers.options[e].fixed}).shuffle().tap(function(n){return u.contains(["clickable","dnd"],a.gapModel.getDisplayType())&&u.each(a.gapModel.attrs.answers.options,function(e,t){e.fixed&&n.splice(t,0,t)}),n}).value();u.each(a.gapModel.attrs.answers.options,function(e,t){e.showOrder=n[t]+1})}},a.firstInitializeGap=function(){u.each(a.gapModel.attrs.answers.options,function(e,t){e.initialOrder=t,e.correctOrders=[]})},a.firstInitializeGap(),a.getInitialReportClasses=function(){return{missing:!0,correct:!1,wrong:!1}},a.refreshContainmentElement=function(){a.$containmentElement=r?r.getActivityElement():s.getMainDOMElement(),"sequencing"===a.gapModel.getDisplayType()&&m(function(){a.$containmentElement=e.find(".js-seq-list")})},o.getLoState().addObserver(function(e,t){"showAnswer"===e&&"solving"===t&&a.refreshContainmentElement()}),a.resetGap=function(){a.refreshContainmentElement(),u.each(a.gapModel.attrs.answers.options,function(e,t){e.showOrder=t+1,e.fixed||(e.userOrder=null,e.previousUserOrder=null)}),a.randomize(),u.contains(["clickable","dnd"],a.gapModel.getDisplayType())&&u.each(a.gapModel.attrs.answers.options,function(e,t){e.userOrder=e.showOrder});var e=u.map(a.gapModel.attrs.answers.options,function(e){return u.pick(e,["option","type","initialOrder","showOrder"])}),t=u.sortBy(e,"showOrder");"sentenceScramble"===a.gapModel.getDisplayType()&&(a.draggableOptions=angular.copy(t),a.droppableOptions=u.map(e,function(e){return{reportClasses:a.getInitialReportClasses(),holder:{}}}),a.rewriteDraggableAndEvaluate(!1)),"sequencing"===a.gapModel.getDisplayType()&&(a.draggableOptions=angular.copy(e),a.droppableOptions=u.map(t,function(e){return{reportClasses:a.getInitialReportClasses(),holder:e}}),a.rewriteDraggableAndEvaluate(!1)),a.evaluate()},a.gapModel.registerCustomSave(function(){return{originalOptions:u.map(a.gapModel.attrs.answers.options,function(e){return u.pick(e,"userOrder","showOrder","initialOrder")}),droppableOptions:a.droppableOptions,draggableOptions:a.draggableOptions}}),a.keyPressed=function(e){var t=["0","1","2","3","4","5","6","7","8","9","Backspace","Delete","ArrowUp","ArrowDown","ArrowLeft","ArrowRight"];u.contains(t,e.key)||e.preventDefault()},a.inputChanged=function(e,t){isNaN(t.userOrder)||parseInt(t.userOrder,10)<=0||parseInt(t.userOrder,10)>a.gapModel.attrs.answers.options.length?t.userOrder=t.previousUserOrder:t.previousUserOrder=t.userOrder,a.evaluate()},a.gapModel.registerCustomRestore(function(o){o.originalOptions&&u.each(a.gapModel.attrs.answers.options,function(e,t){var n=u.find(o.originalOptions,{initialOrder:e.initialOrder});e.userOrder=n.userOrder,e.showOrder=n.showOrder}),o.droppableOptions&&(a.droppableOptions=o.droppableOptions),o.draggableOptions&&(a.draggableOptions=o.draggableOptions),a.evaluate()});var i=0,l=u.filter(a.gapModel.attrs.answers.options,function(e){return!e.fixed}).length;if(a.gapModel.registerEvaluateLifecycleCallbacks(function(){i=u.chain(a.gapModel.attrs.answers.answerSets.length).range().map(function(n){return{count:u.reduce(a.gapModel.attrs.answers.options,function(e,t){return e+(!t.fixed&&u.contains(t.correctOrders[n],t.userOrder)?1:0)},0),index:n}}).max(function(e){return e.count}).value().index},function(){}),"sentenceScramble"===a.gapModel.getDisplayType()?a.gapModel.eyeball.addState(0,function(){return u.every(a.gapModel.attrs.answers.options,function(e){return e.fixed||u.isUndefined(e.userOrder)||u.isNull(e.userOrder)})}):"sequencing"===a.gapModel.getDisplayType()&&u.each(a.options.answers.options,function(e){a.gapModel.eyeball.addState(e.initialOrder,function(){return!1})}),"system"===a.options.markedBy?a.gapModel.registerState(0,function(){return u.every(a.gapModel.attrs.answers.options,function(e){return e.fixed||u.isUndefined(e.userOrder)||u.isNull(e.userOrder)})},function(){return u.chain(a.gapModel.attrs.answers.answerSets.length).range().any(function(t){return u.every(a.gapModel.attrs.answers.options,function(e){return u.contains(e.correctOrders[t],e.userOrder)})}).value()},function(e){return e.isCorrect()?a.gapModel.getPointsToGain():0}):"system-option"===a.options.markedBy&&u.each(a.options.answers.options,function(e){e.fixed||a.gapModel.registerState(e.initialOrder,function(){return u.isUndefined(e.userOrder)||u.isNull(e.userOrder)},function(){return u.contains(e.correctOrders[i],e.userOrder)},function(e){return e.isCorrect()?a.gapModel.getPointsToGain()/l:0})}),a.onOrderingDrop=function(){a.rewriteDraggableAndEvaluate(!0)},a.rewriteDraggableAndEvaluate=function(e){a.draggableOptions=u.chain(a.draggableOptions).map(function(e){return u.omit(e,["jqyoui_pos"])}).filter(function(e){return 0<u.size(e)}).value(),u.each(a.gapModel.attrs.answers.options,function(t){var e=u.find(a.droppableOptions,function(e){return e.holder.initialOrder===t.initialOrder});e?t.userOrder=a.droppableOptions.indexOf(e)+1:delete t.userOrder}),a.evaluate(),u.each(a.droppableOptions,function(e){if(u.isUndefined(e.holder.initialOrder))e.reportClasses=a.getInitialReportClasses();else{var t=u.find(a.gapModel.attrs.answers.options,{initialOrder:e.holder.initialOrder});e.reportClasses={},e.reportClasses.missing=u.isUndefined(t.userOrder)||u.isNull(t.userOrder),e.reportClasses.correct=!e.reportClasses.missing&&u.contains(t.correctOrders[i],t.userOrder),e.reportClasses.wrong=!e.reportClasses.missing&&!e.reportClasses.correct}}),e&&a.saveManager.saveOnEvent()},a.classesForEyebeallReport=function(e){return a.gapModel.eyeball.shouldBeRenderedAsReport(e.holder.initialOrder)?u.extend({"seq-answer-container":!0},e.reportClasses):{}},a.moveDroppableUp=function(e){a.swapDroppables(e-1,e)},a.moveDroppableDown=function(e){a.swapDroppables(e,e+1)},a.swapDroppables=function(e,t){var n=a.droppableOptions[e];a.droppableOptions[e]=a.droppableOptions[t],a.droppableOptions[t]=n,a.rewriteDraggableAndEvaluate(!0)},u.each(a.gapModel.attrs.answers.answerSets,function(e,o){u.each(a.gapModel.attrs.answers.options,function(e){e.correctOrders.push([])}),u.each(e,function(t,n){var e=u.filter(a.gapModel.attrs.answers.options,function(e){return e.option===t.option});u.each(e,function(e,t){e.correctOrders[o].length==t?e.correctOrders[o].unshift(n+1):e.correctOrders[o].push(n+1)})})}),a.resetGap(),u.each(a.gapModel.attrs.answers.options,function(e,t){e.fixed&&(e.userOrder=e.correctOrders[0][0])}),a.prepareText=function(e,t){return"text"===e.type&&a.gapModel.attrs.capitalize&&0==t?e.option[0].toUpperCase()+e.option.slice(1):e.option},"clickable"===a.options.display){var c=u.filter(a.options.answers.options,function(e){return!e.fixed});a.firstMovableIndex=u.first(c).initialOrder,a.lastMovableIndex=u.last(c).initialOrder}a.moveBack=function(t){var e=u.chain(a.gapModel.attrs.answers.options).filter(function(e){return!e.fixed&&e.showOrder<t.showOrder}).max("showOrder").value(),n=t.showOrder;t.showOrder=e.showOrder,e.showOrder=n,t.userOrder=t.showOrder,e.userOrder=e.showOrder},a.moveForward=function(t){var e=u.chain(a.gapModel.attrs.answers.options).filter(function(e){return!e.fixed&&e.showOrder>t.showOrder}).min("showOrder").value(),n=t.showOrder;t.showOrder=e.showOrder,e.showOrder=n,t.userOrder=t.showOrder,e.userOrder=e.showOrder},a.sortableOptions={cancel:".fixed",tolerance:"pointer",placeholder:"ui-sortable-placeholder option",forcePlaceholderSize:!0,containment:"parent",orderKey:"showOrder",items:".option",orderKeyStart:1,axis:a.options.horizontal?"x":"y",sort:function(e,t){var n=angular.element(e.target).offsetParent();if(!n.is("body")&&!n.is("html")){var o=e.pageY-n.offset().top-t.helper.outerHeight(!0)/2;t.helper.css({top:o+"px"})}},stop:function(){u.each(a.gapModel.attrs.answers.options,function(e,t){e.userOrder=e.showOrder}),a.$apply(),a.evaluate()}},a.evaluate();var d=function(){m(function(){a.options.horizontal&&"dnd"===a.gapModel.getDisplayType()&&(e.find(".option:first").offset().top!==e.find(".option:last").offset().top?a.sortableOptions.axis=!1:a.sortableOptions.axis="x")})};d(),"dnd"!==a.gapModel.getDisplayType()||a.options.horizontal||m(function(){var n=e.find(".option:first").width();e.find(".option").each(function(e,t){angular.element(t).width(n)})}),a.$on("engine-window-Resize",function(){d()})}}}]),angular.module("atoolEngine").directive("missingLetters",["Gap","underscore","AnswerFilter",function(g,m,f){return{require:["^lo","^task","?^nonmarkableBlock"],scope:{options:"="},restrict:"E",replace:"true",templateUrl:"app/formats/missingLetters/missingLetters.tpl.html",link:function(a,n,e,t){var o=t[0],s=t[1];null!==t[2]&&(a.options.nonmarkableBlockController=t[2]);var r,i=[];i=m.map(a.options.answers.answers,function(e){return{option:e.option,type:"text"}});var l=function(){for(a.userAnswers=[],a.currentMoveDirection=1,r=0;r<a.options.answers.answers[0].option.length;r++)m.contains(a.options.answers.fixed,r)?a.userAnswers.push({letter:a.options.answers.answers[0].option[r],fixed:!0}):a.userAnswers.push({letter:"",fixed:!1})};l(),a.gapModel=new g(a,a.options,i,{loState:o.getLoState()},function(){l()}),s.getTaskModel().addGap(a.gapModel),a.answerFilter=new f(m.pick(a.options,"caseSensitive")),a.filteredAnswers=m.map(a.gapModel.attrs.answers.answers,function(e){var t=angular.copy(e);return t.option=a.answerFilter.filter(t.option),t}),"system"===a.options.markedBy&&a.gapModel.registerState(0,function(){return""===m.reject(a.userAnswers,function(e){return e.fixed}).map(function(e){return e.letter}).join("")},function(){var e=a.userAnswers.map(function(e){return""!==e.letter?e.letter:" "}).join("");return e=a.answerFilter.filter(e),a.gapModel.userAnswer={option:e,type:"text"},m.contains(m.map(a.filteredAnswers,function(e){return e.option}),e)},function(e){return e.isCorrect()?a.gapModel.getPointsToGain():0}),a.evaluate=function(){a.gapModel.evaluateStates()},a.gapModel.registerCustomSave(function(){return{options:{data:a.userAnswers}}}),a.gapModel.registerCustomRestore(function(e){e.options&&(a.userAnswers=e.options.data)}),a.getElementSizing=function(e){var t=n.find("input").eq(e);return{offset:t.offset(),height:t[0].offsetHeight}};var c=function(e,t){if(!m.isUndefined(a.userAnswers[e+t])){var n=a.userAnswers[e+t];n.fixed?(a.userAnswers[e].focus=!1,c(e+t,t)):(n.focus=!0,a.userAnswers[e].focus=!1)}a.currentMoveDirection=0};a.capitalizeLetter=function(e){var t=e.toUpperCase();return"ß"===e&&(t="ẞ"),t},a.onLetterChangeFromKeyboard=function(e,t){a.userAnswers[t].letter=e,a.currentMoveDirection=1,a.onLetterChange(t),this.evaluate()},a.onLetterChange=function(e){a.gapModel.attrs.capitalize&&0===e&&(a.userAnswers[e].letter=a.capitalizeLetter(a.userAnswers[e].letter)),c(e,a.currentMoveDirection)},a.onKeyPress=function(e,t){e.key!==a.userAnswers[t].letter&&32!==e.keyCode||c(t,a.currentMoveDirection)};var d=function(e){return!e&&"0"!==e},p=function(){return!0},u=function(){return!1};a.keysActions={8:{direction:-1,immediateChangeCondition:d},13:{direction:1,immediateChangeCondition:p},37:{direction:-1,immediateChangeCondition:p},39:{direction:1,immediateChangeCondition:p},46:{direction:0,immediateChangeCondition:u}},a.onKeyDown=function(e,t){var n=a.keysActions[e.keyCode];if(n){a.currentMoveDirection=n.direction;var o=a.userAnswers[t].letter;n.immediateChangeCondition(o)&&a.onLetterChange(t)}else a.currentMoveDirection=1},a.isFixed=function(e){return m.contains(a.gapModel.attrs.answers.fixed,e)}}}}]),angular.module("atoolEngine").directive("mcSingleAnswer",["Gap","underscore",function(l,c){return{require:["^lo","^task","?^nonmarkableBlock"],scope:{options:"="},restrict:"E",replace:"true",templateUrl:function(e,t){return"app/formats/mcSingleAnswer/templates/mcSingleAnswer-"+t.displayType+".tpl.html"},link:function(a,e,t,n){var o=n[0],s=n[1];null!==n[2]&&(a.options.nonmarkableBlockController=n[2]),a.saveManager=o.getSaveManager(),a.shouldShowEyeballs=o.shouldShowEyeballs();var r=c.chain(a.options.answers).filter(function(e){return e.isCorrect}).map(function(e){return c.pick(e,"option","type")}).value();a.gapModel=new l(a,a.options,r,{loState:o.getLoState()},function(){a.answer={},i(),a.randomize()}),a.randomize=function(){a.options.randomize&&(a.gapModel.attrs.answers=c.shuffle(a.gapModel.attrs.answers))},a.randomize(),s.getTaskModel().addGap(a.gapModel),a.correctAnswer=c.filter(a.gapModel.attrs.answers,function(e){return e.isCorrect}),a.gapModel.registerCustomSave(function(){return{selected:a.answer.selected?a.answer.selected.option:null,selectedDropDown:a.answer.selectedDropDown}}),a.gapModel.registerCustomRestore(function(e){e.selectedDropDown&&(a.answer.selectedDropDown=e.selectedDropDown),e.selected&&(a.answer.selected=c.findWhere(a.gapModel.attrs.answers,{option:e.selected}),a.answer.selected.selected=!0)}),"system"===a.options.markedBy&&a.gapModel.registerState(0,function(){},function(){var e=c.find(a.correctAnswer,function(e){return e.option===a.answer.selected.option});return!c.isUndefined(e)},function(e){return e.isCorrect()?a.gapModel.getPointsToGain():0}),a.gapModel.eyeball.addState(0,function(){return!a.answer.selected}),a.answer={},a.evaluate=function(){a.gapModel.evaluateStates(),a.gapModel.userAnswer=[c.pick(a.answer.selected,"option","type")],a.saveManager.saveOnEvent()},a.checkAndEvaluate=function(e){a.selectOption(e),a.evaluate()},a.getOptionFeedback=function(e){return!c.isEmpty(e)&&e.feedback&&e.feedback.option&&!c.isEmpty(e.feedback.option)?e.feedback:null};var i=function(){angular.forEach(a.gapModel.attrs.answers,function(e){e.selected=!1})};a.shouldRenderGlobalFeedback=function(){var e=a.gapModel.shouldBeRenderedAsGivenReport("system"),t=a.gapModel.shouldBeRenderedAsGivenSolving("system")&&a.gapModel.hasAutomaticMarking(),n=a.gapModel.eyeball.shouldBeRenderedAsReport(0),o=null!=a.gapModel.getFeedbackForGap();return(e||t||n)&&o},a.getAutonumberingClasses=function(){return{"sc-autonumber-decimal":"decimal"===a.options.answersNumbering,"sc-autonumber-upper-alpha":"upper-alpha"===a.options.answersNumbering,"sc-autonumber-lower-alpha":"lower-alpha"===a.options.answersNumbering}},a.getClassesForSingleChoice=function(){var e=a.gapModel.getCorrectnessClasses(0);return angular.merge({},e,a.getAutonumberingClasses())},a.getClassesForRadioButtons=function(){var e=a.getClassesForSingleChoice(),t=c.any(a.gapModel.attrs.answers,function(e){return"text"!==e.type});return e["has-answers-with-assets"]=t,e},i(),a.selectOption=function(e){i(),e.selected=!0,a.answer.selected=e}}}}]),angular.module("atoolEngine").directive("mcMultipleAnswers",["Gap","underscore",function(f,h){return{require:["^lo","^task","?^nonmarkableBlock"],scope:{options:"="},restrict:"E",replace:"true",templateUrl:function(e,t){return"app/formats/mcMultipleAnswers/templates/mcMultipleAnswers-"+t.displayType+".tpl.html"},link:function(a,e,t,n){var o=n[0],s=n[1];null!==n[2]&&(a.options.nonmarkableBlockController=n[2]),a.saveManager=o.getSaveManager(),a.shouldShowEyeballs=o.shouldShowEyeballs();var r=h.chain(a.options.answers).filter(function(e){return e.isCorrect}).map(function(e){return h.pick(e,"option","type")}).value();a.gapModel=new f(a,a.options,r,{loState:o.getLoState()},function(){a.answer={},a.answer.selected={},g(),a.randomize()}),s.getTaskModel().addGap(a.gapModel),a.gapModel.setShouldTreatMissingsAsWrongs(!1);var i=0;h.each(a.gapModel.attrs.answers,function(e){e.customId=""+i++}),a.randomize=function(){a.options.randomize&&(a.gapModel.attrs.answers=h.shuffle(a.gapModel.attrs.answers))},a.randomize(),a.correctAnswers=h.filter(a.gapModel.attrs.answers,function(e){return e.isCorrect}),a.gapModel.registerCustomSave(function(){return{selected:a.answer.selected}}),a.gapModel.registerCustomRestore(function(e){a.answer.selected=e.selected,h.each(a.gapModel.attrs.answers,function(e){e.selected=a.answer.selected[e.customId]})});var l=function(e,n){var o=[];return angular.forEach(e,function(e,t){e&&(n?o.push(h.chain(a.gapModel.attrs.answers).find(function(e){return e.customId==t}).pick("option","type").value()):o.push(t))}),o.sort()},c=function(e){var t=[];return angular.forEach(e,function(e){t.push(e.customId)}),t.sort()},d=function(e){return h.contains(l(a.answer.selected),e.customId)};if("system"===a.options.markedBy)a.gapModel.registerState(0,function(){return h.isEmpty(l(a.answer.selected))},function(){return h.isEqual(l(a.answer.selected),c(a.correctAnswers))},function(e){return e.isCorrect()?a.gapModel.getPointsToGain():0});else if("system-option"===a.options.markedBy){var p=h.reduce(a.options.answers,function(e,t){return t.isCorrect?e+1:e},0);angular.forEach(a.options.answers,function(n){a.gapModel.registerState(n.customId,function(){return h.isEmpty(l(a.answer.selected))},function(){return d(n)===n.isCorrect},function(e){var t=a.gapModel.getPointsToGain()/p;return e.isCorrect()&&d(n)?t:e.isWrong()&&d(n)&&a.options.penaltyMarking?-t:0})})}a.gapModel.eyeball.addState(0,function(){return h.isEmpty(l(a.answer.selected))}),a.answer={},a.answer.selected={},a.evaluate=function(){a.gapModel.evaluateStates(),a.gapModel.userAnswer=l(a.answer.selected,!0),a.saveManager.saveOnEvent()},a.checkAndEvaluate=function(e){m(e),a.evaluate()},a.getOptionFeedback=function(e){return!h.isEmpty(e)&&e.feedback&&e.feedback.option&&!h.isEmpty(e.feedback.option)?e.feedback:null};var u=function(){return h.reduce(a.answer.selected,function(e,t){return e+(t?1:0)},0)>=a.correctAnswers.length};a.shouldRenderGlobalFeedback=function(){var e=a.gapModel.shouldBeRenderedAsGivenReport("system"),t=a.gapModel.shouldBeRenderedAsGivenSolving("system")&&a.gapModel.hasAutomaticMarking()&&u(),n=a.gapModel.eyeball.shouldBeRenderedAsReport(0),o=null!=a.gapModel.getFeedbackForGap();return(e||t||n)&&o},a.getGlobalCorrectnessClasses=function(){return a.gapModel.shouldBeRenderedAsGivenSolving("system")&&u()||a.gapModel.shouldBeRenderedAsGivenReport("system")?a.gapModel.getCorrectnessClasses(0,"system"):""},a.getAutonumberingClasses=function(){return{"mc-autonumber-decimal":"decimal"===a.options.answersNumbering,"mc-autonumber-upper-alpha":"upper-alpha"===a.options.answersNumbering,"mc-autonumber-lower-alpha":"lower-alpha"===a.options.answersNumbering}},a.getClassesForMultipleChoice=function(){var e=a.getGlobalCorrectnessClasses();return""===e&&(e={}),angular.merge({},e,a.getAutonumberingClasses())},a.getClassesForCheckboxes=function(){var e=a.getClassesForMultipleChoice(),t=h.any(a.gapModel.attrs.answers,function(e){return"text"!==e.type});return e["has-answers-with-assets"]=t,e},a.getCorrectnessClasses=function(e){var t=e.customId,n={},o=l(a.answer.selected);return"checkboxes"!==a.gapModel.attrs.display&&(n.selected=a.answer.selected[t]),h.isEmpty(o)||(n["missing t_missing"]=!1),("system-option"===a.options.markedBy||a.gapModel.eyeball.getState(t)&&a.gapModel.eyeball.shouldBeRenderedAsReport(t))&&(h.isEmpty(l(a.answer.selected))?n["missing t_missing"]=!0:(n["correct t_correct"]=d(e)&&e.isCorrect,n["wrong t_wrong"]=d(e)!==e.isCorrect)),h.contains(o,t)&&(n.correct_option=e.isCorrect,n.wrong_option=!e.isCorrect),n},a.getOptionClasses=function(e,t){var n=a.gapModel.getCorrectnessClasses(e.customId,t);return n.selected=e.selected,n};var g=function(){angular.forEach(a.gapModel.attrs.answers,function(e){e.selected=!1})};g();var m=function(e){e.selected=!e.selected,a.answer.selected[e.customId]=!a.answer.selected[e.customId]}}}}]),angular.module("atoolEngine").directive("matching",["Gap","underscore","engineBrowserDetector","$document",function(l,c,d,p){return{require:["^lo","^task","?^nonmarkableBlock"],scope:{options:"="},restrict:"E",replace:"true",templateUrl:"app/formats/matching/matching.tpl.html",link:function(o,a,e,t){var n=t[0],s=t[1];null!==t[2]&&(o.options.nonmarkableBlockController=t[2]),o.saveManager=n.getSaveManager(),o.dataCollector=n.getDataCollector(),o.footerManager=n.getFooterManager(),o.shouldShowEyeballs=n.shouldShowEyeballs(),o.isReversed=!1;var r=c.chain(o.options.answers).map(function(e){return c.pick(e,"option","match")}).filter(function(e){return e.option&&e.match}).value();o.initMatching=function(){o.matched=[],o.selected={},o.eyeballMatched=[],o.reverseOptionAndMatches(),o.registerUserAnswerTransformers(),o.randomize(),o.generateIds(),o.filteredAnswers=c.filter(o.options.answers,function(e){return e.option&&e.match}),o.visitedCount=0,o.options.forceVisitsBeforeSubmit&&"taptap"===o.gapModel.getDisplayType()&&o.footerManager.get("submit").modifyAttr("enabled","allMatchesVisited",!1),c.each(o.options.answers,function(e){e.isOpen&&a.find(".js-collapsed-blocks:eq("+e.id+")").slideToggle(),e.isOpen=!1,e.visited=!1,delete e.selectedOptionId,delete e.selectedMatchId}),o.saveManager.subscribeForPeriodicSave()},o.gapModel=new l(o,o.options,r,{loState:n.getLoState()},function(){o.initMatching()}),s.getTaskModel().addGap(o.gapModel),o.generateIds=function(){c.each(o.options.answers,function(e,t){e.id=t})},o.randomize=function(){o.options.randomize&&c.chain(o.options.answers.length).range().shuffle().each(function(e,t){o.options.answers[t].order=e})};var i=function(e,o){return c.map(e,function(t){var n=c.omit(t,c.flatten(o));return c.each(o,function(e){n[e[0]]=t[e[1]],n[e[1]]=t[e[0]]}),n})};o.reverseOptionAndMatches=function(){"taptap"===o.gapModel.getDisplayType()&&o.options.reverseTapTap&&!o.isReversed&&(o.options.answers=i(o.options.answers,[["option","match"],["type_option","type_match"]]),o.isReversed=!0)},o.registerUserAnswerTransformers=function(){"taptap"===o.gapModel.getDisplayType()&&o.options.reverseTapTap&&(o.gapModel.setUserAnswerGetterTransformer(function(e){return i(e,[["option","match"]])}),o.gapModel.setUserAnswerSetterTransformer(function(e){return i(e,[["option","match"]])}))},n.getLoState().addObserver(function(e,t){"solving"===e&&"report"===t?c.each(o.options.answers,function(e){e.isOpen=!0}):"showAnswer"===e&&"solving"===t&&c.each(o.options.answers,function(e){e.isOpen=!1})}),o.gapModel.registerCustomRestore(function(e){c.each(o.gapModel.userAnswer,function(t){var e=c.find(o.options.answers,function(e){return e.option===t.option&&!c.find(o.matched,{option:e})}),n=c.find(o.options.answers,function(e){return e.match===t.match&&!c.find(o.matched,{match:e})});o.matched.push({option:e,match:n,correct:e==n})}),o.visitedCount=e.visitedCount,o.isReversed&&(e.answers=i(e.answers,[["selectedOptionId","selectedMatchId"]])),c.each(e.answers,function(t){var e=c.find(o.options.answers,function(e){return e.id===t.id});e.isOpen=t.isOpen,e.visited=t.visited,e.selectedOptionId=t.selectedOptionId,e.selectedMatchId=t.selectedMatchId,e.isOpen&&a.find(".js-collapsed-blocks:eq("+e.id+")").slideToggle()}),o.options.forceVisitsBeforeSubmit&&o.visitedCount===o.filteredAnswers.length&&o.footerManager.get("submit").modifyAttr("enabled","allMatchesVisited",!0)}),o.gapModel.registerCustomSave(function(){var e=o.options.answers;return o.isReversed&&(e=i(o.options.answers,[["selectedOptionId","selectedMatchId"]])),{visitedCount:o.visitedCount,answers:c.map(e,function(e){return{id:e.id,isOpen:e.isOpen,visited:e.visited,selectedOptionId:e.selectedOptionId,selectedMatchId:e.selectedMatchId}})}}),o.select=function(t,e){if(o.gapModel.eyeball.shouldBeRenderedAsSolving(t.id)||"match"!==e){if("option"===e){var n=c.find(o.eyeballMatched,function(e){return e.option===t});if(n&&!o.gapModel.eyeball.shouldBeRenderedAsSolving(n.match.id))return}o.gapModel.shouldBeRenderedAsSolving()&&(o.selected[e]=t,null!=o.selected.option&&null!=o.selected.match&&o.matchCompleted())}},o.selectOption=function(e,t){t!==o.selected.option?o.selected.option=t:delete o.selected.option,e.stopPropagation()},o.selectOptionToUnmatch=function(e){o.selectedToUnmatch?delete o.selectedToUnmatch:o.selectedToUnmatch=e},o.unmatchOption=function(){o.selectedToUnmatch&&(delete o.options.answers[o.selectedToUnmatch.selectedMatchId].selectedOptionId,delete o.selectedToUnmatch.selectedMatchId),delete o.selectedToUnmatch},o.selectMatch=function(e){o.selected.match=e,o.matchCompleted()},o.getOptionClass=function(e,t){var n={selected:o.gapModel.shouldBeRenderedAsSolving()&&o.selected[t]===e,matched:o.gapModel.shouldBeRenderedAsSolving()&&o.isMatched(e,t),example:e.example||o.gapModel.shouldBeRenderedAsExample()};return"match"===t&&(n.matched=n.matched&&o.gapModel.eyeball.shouldBeRenderedAsSolving(e.id)),e.example||(n["show-answer"]=o.gapModel.shouldBeRenderedAsShowAnswer()||o.gapModel.eyeball.shouldBeRenderedAsShowAnswer(e.id)&&"match"===t,n[o.getReportClassForOption(e,t)]=o.gapModel.shouldBeRenderedAsReport()&&o.gapModel.shouldBeRenderedAsGivenReport("system-option")&&!o.isNotUsedDistractor(e,t)||o.gapModel.eyeball.shouldBeRenderedAsReport(e.id)&&"match"===t),n["mat-option-"+e["type_"+t]]=!0,n},o.clearSelectedForEyeball=function(e,t){o.selected.option===e&&(o.selected.option=void 0),o.selected.match===t&&(o.selected.match=void 0)},o.addEyeballMatched=function(e,t){o.eyeballMatched.push({option:e,match:t,correct:e===t})},o.fireEyeball=function(t){if(o.gapModel.eyeball.shouldBeRenderedAsShowAnswer(t.id))o.clearSelectedForEyeball(t,t),o.addEyeballMatched(t,t);else if(o.gapModel.eyeball.shouldBeRenderedAsReport(t.id)){var e=c.find(o.matched,function(e){return e.match===t}).option;o.clearSelectedForEyeball(e,t),o.addEyeballMatched(e,t)}else o.gapModel.eyeball.shouldBeRenderedAsSolving(t.id)&&(o.eyeballMatched=c.filter(o.eyeballMatched,function(e){return e.match!==t}))},o.getReportOptionClass=function(e,t){var n={};return n[o.getReportClassForOption(e,t)]=o.gapModel.shouldBeRenderedAsReport()&&o.gapModel.shouldBeRenderedAsGivenReport("system-option"),n},o.getReportClassForOption=function(t,n){if("non-marked"===o.gapModel.attrs.markedBy)return"";var e=c.find(o.matched,function(e){return e[n]===t});return void 0===e?"missing":e.correct?"correct":"wrong"},o.getOptionClassInTapTap=function(e){var t={"mat-option-selected":o.selected.option===e};return t["mat-option-"+e.type_option]=!0,t},o.getContainerClassInTapTap=function(e){var t={};return c.isUndefined(e.selectedOptionId)||(t["mat-option-"+o.options.answers[e.selectedOptionId].type_option]=!0),o.selected.option&&(t["mat-container-option-selected"]=!0),t},o.getAutonumberingClasses=function(){return{"mat-autonumber-left-decimal":"decimal"===o.options.answersNumbering,"mat-autonumber-left-upper-alpha":"upper-alpha"===o.options.answersNumbering,"mat-autonumber-left-lower-alpha":"lower-alpha"===o.options.answersNumbering,"mat-autonumber-right-decimal":"decimal"===o.options.answersNumberingMatches,"mat-autonumber-right-upper-alpha":"upper-alpha"===o.options.answersNumberingMatches,"mat-autonumber-right-lower-alpha":"lower-alpha"===o.options.answersNumberingMatches}},o.isNotUsedDistractor=function(t,n){var e={option:"match",match:"option"};return void 0===c.find(o.matched,function(e){return e[n]===t})&&!t[e[n]]},o.matchCompleted=function(){o.matched=c.filter(o.matched,function(e){return!(e.option===o.selected.option||e.match===o.selected.match)}),o.matched.push({option:o.selected.option,match:o.selected.match,correct:o.selected.option===o.selected.match||o.selected.option.match===o.selected.match.match||o.selected.option.option===o.selected.match.option}),0<=o.selected.match.selectedOptionId&&delete o.options.answers[o.selected.match.selectedOptionId].selectedMatchId,o.selected.match.selectedOptionId=o.selected.option.id,o.selected.option.selectedMatchId=o.selected.match.id,o.selected.option=void 0,o.selected.match=void 0,o.evaluate()},o.isMatched=function(t,n){return c.any(o.matched,function(e){return e[n]===t})},o.removeMatched=function(e){delete e.match.selectedOptionId,delete e.option.selectedMatchId,o.matched=c.without(o.matched,e),o.evaluate()},"system"===o.options.markedBy?o.gapModel.registerState(0,function(){return 0===o.matched.length},function(){return o.expectedLenght===o.matched.length&&c.every(o.matched,function(e){return e.correct})},function(e){return e.isCorrect()?o.gapModel.getPointsToGain():0}):"system-option"===o.options.markedBy&&o.gapModel.registerState(0,function(){return 0===o.matched.length},function(){return o.expectedLenght===o.matched.length&&c.every(o.matched,function(e){return e.correct})},function(e){var t=c.filter(o.filteredAnswers,function(e){return!e.example}).length,n=o.gapModel.getPointsToGain()/t;return c.reduce(o.matched,function(e,t){return e+=t.correct?n:0},0)-(o.matched.length>t?o.matched.length-t:0)*n}),o.evaluate=function(){o.gapModel.evaluateStates();var t=[];angular.forEach(o.matched,function(e){t.push({option:e.option.option,match:e.match.match})}),o.gapModel.userAnswer=t},o.expectedLenght=0,angular.forEach(o.gapModel.attrs.answers,function(e){e.example||null===e.option||null===e.match||o.expectedLenght++}),o.toggleCollapse=function(t,e){delete o.selectedToUnmatch,delete o.selected.option,t.isOpen=!t.isOpen,t.visited||(t.visited=!0,o.visitedCount++,o.options.forceVisitsBeforeSubmit&&o.visitedCount===o.filteredAnswers.length&&o.footerManager.get("submit").modifyAttr("enabled","allMatchesVisited",!0)),a.find(".js-collapsed-blocks:eq("+t.id+")").slideToggle(400,function(){o.scrollScreenToOption(t)}),e&&c.each(o.options.answers,function(e){e.isOpen&&t!==e&&(e.isOpen=!1,a.find(".js-collapsed-blocks:eq("+e.id+")").slideToggle(400,function(){o.scrollScreenToOption(t)}))})},o.scrollScreenToOption=function(e){var t=a.scrollParent(),n=0;t.is(p)?t=d.isEdge()?angular.element(t[0].body):d.isIOSSafari()?angular.element(t[0].scrollingElement):angular.element(t[0].documentElement):n=t[0].scrollTop,t.animate({scrollTop:n+a.find(".mat-option-id-"+e.id).offset().top-t.offset().top-10})},o.initMatching(),c.each(o.options.answers,function(t){o.gapModel.eyeball.addState(t.id,function(){return!c.find(o.matched,function(e){return e.match.id===t.id})})})}}}]),angular.module("atoolEngine").directive("matRegister",function(){return{restrict:"A",scope:{type:"=matRegisterType",option:"=matRegisterOption"},require:"^matModel",link:function(e,t,n,o){o.registerElement(e.type,e.option,t)}}}),angular.module("atoolEngine").directive("matModel",function(){return{restrict:"A",link:function(e,t){},controller:["$scope",function(o){o.elements={option:{},match:{}},angular.extend(this,{registerElement:function(e,t,n){o.elements[e][t.$$hashKey]=n},getElement:function(e,t){if(t)return o.elements[e][t.$$hashKey]}})}]}}),angular.module("atoolEngine").directive("matLine",["$window","UAParser","ResizeObserver",function(a,s,r){return{restrict:"E",scope:{matUsemodel:"=matUsemodel"},require:"^matModel",templateUrl:"app/formats/matching/matLine.tpl.html",templateNamespace:"svg",replace:!0,link:function(n,m,e,o){var t=s.getBrowser().name,f="IE"===t||"Edge"===t;n.$watch(function(){return null!=o.getElement("option",n.matUsemodel.option)&&null!=o.getElement("match",n.matUsemodel.match)},function(e){if(e){var p=!1,u=o.getElement("option",n.matUsemodel.option),g=o.getElement("match",n.matUsemodel.match);n.drawLine=function(){m.parent().width();var e,t,n=u.position().top,o=u.position().left,a=g.position().top,s=g.position().left,r={X:o+u.outerWidth(!0),Y:n+u.outerHeight(!0)/2},i={X:s,Y:a+g.outerHeight(!0)/2},l={X:r.X+((i.X-r.X)/4<=10?10:(i.X-r.X)/4),Y:r.Y},c={X:r.X+(i.X-r.X)/2,Y:r.Y+(i.Y-r.Y)/2},d="M "+r.X+" "+r.Y+" Q "+l.X+" "+l.Y+", "+c.X+" "+c.Y+" T "+i.X+" "+i.Y;0===n&&0===o&&0===a&&0===s||((e=m.find("path")).attr("d",d),p||f?e.css({"stroke-dasharray":"","stroke-dashoffset":"",animation:""}):(t=e[0].getTotalLength(),e.css({"stroke-dasharray":t,"stroke-dashoffset":t,animation:"dash 0.2s linear forwards"}),p=!0))};var t=new r(function(e){n.drawLine()});t.observe(u[0]),t.observe(g[0]),n.drawLine(),angular.element(a).bind("resize",function(){n.drawLine()})}})}}}]),angular.module("atoolEngine").directive("gapfill",["$rootScope","afterViews","Gap","underscore","AnswerFilter","localStorageService","keyboardHelper",function(l,c,d,p,u,e,t){return{require:["^lo","^task","?^nonmarkableBlock"],scope:{options:"="},restrict:"E",replace:"true",templateUrl:"app/formats/gapfill/gapfill.tpl.html",link:function(n,e,t,o){var a=o[0],s=o[1];null!==o[2]&&(n.options.nonmarkableBlockController=o[2]);var r=s.getWordpoolController(n.options.wordpoolId);n.saveManager=a.getSaveManager(),n.gapsGroupManager=a.getGapsGroupManager(),n.shouldShowEyeballs=a.shouldShowEyeballs(),n.getElementSizing=function(){return{offset:e.offset(),height:e[0].offsetHeight}},n.gapModel=new d(n,n.options,n.options.answers,{loState:a.getLoState()},function(){n.gapModel.userAnswer={option:"",type:"text"},n.selected=!1,n.evaluate()}),n.onEyeballFire=p.noop,"dnd"===n.gapModel.getDisplayType()&&(n.wordpoolType=r.isTapTap()?"taptap":"dnd",n.handleTapTapClick=function(){if(n.gapModel.userAnswer.option&&!r.taptap.isSelected())n.selected=!0,r.taptap.selectFromGap(n.gapModel.userAnswer,function(){n.selected=!1},function(){n.gapModel.reset()});else if(r.taptap.isSelected()&&n.selected)n.selected=!1,r.taptap.removeSelection();else if(r.taptap.isSelected()){n.gapModel.userAnswer.option&&r.taptap.release(n.gapModel.userAnswer);var e=r.taptap.claimSelected();n.gapModel.userAnswer.option=e.content,n.gapModel.userAnswer.type=e.type,n.gapModel.userAnswer.originalOption=e.content,n.gapModel.attrs.capitalize&&"text"===n.gapModel.userAnswer.type&&""!==n.gapModel.userAnswer.option&&(n.gapModel.userAnswer.option=n.capitalizeAnswer(n.gapModel.userAnswer.option)),c.chain(function(){l.$broadcast("engine-draggable-element-dropped")}),n.evaluate()}},n.getClassesForTapTap=function(){var e=n.gapModel.getCorrectnessClasses(0);return e.selected=n.selected,e["can-accept-element"]=r.taptap.isSelected(),e},n.onEyeballFire=function(){"taptap"===n.wordpoolType&&n.selected&&(n.selected=!1,r.taptap.removeSelection())}),n.gapModel.registerCustomSave(function(){return{originalAnswer:n.gapModel.userAnswer.originalOption}}),n.gapModel.registerCustomRestore(function(e){e.originalAnswer&&(n.gapModel.userAnswer.originalOption=e.originalAnswer,"dnd"===n.gapModel.getDisplayType()&&"taptap"===n.wordpoolType&&r.taptap.directClaim(n.gapModel.userAnswer)),n.$broadcast("autosize-invalidate")}),a.getLoState().addObserver(function(e,t){"solving"===t&&n.$broadcast("autosize-invalidate")}),n.gapModel.userAnswer={option:"",type:"text"},s.getTaskModel().addGap(n.gapModel);var i=p.pick(n.options,"caseSensitive","punctuationSensitive");n.answerFilter=new u(i),n.answersWithConfig=p.map(n.gapModel.attrs.answers,function(e){var t=angular.copy(e);return t.config=i,t}),n.gapsGroup=n.gapsGroupManager.registerGap(n.gapModel,n.answersWithConfig),n.getGFDisplayType=function(){return"fillin-keyboard"===n.gapModel.getDisplayType()?"fillin":n.gapModel.getDisplayType()},n.capitalizeAnswer=function(e){var t=e[0],n=t.toUpperCase();return"ß"===t&&(n="ẞ"),n+e.slice(1)},n.onKeyUp=function(){n.gapModel.attrs.capitalize&&"text"===n.gapModel.userAnswer.type&&""!==n.gapModel.userAnswer.option&&(n.gapModel.userAnswer.option=n.capitalizeAnswer(n.gapModel.userAnswer.option))},"system"===n.options.markedBy&&(n.gapModel.registerEvaluateLifecycleCallbacks(function(){n.gapsGroup.clearForGap(n.gapModel)}),n.gapModel.registerState(0,function(){return!n.gapModel.userAnswer.option&&!p.contains(p.map(n.gapsGroup.getUnusedAnswers(),function(e){return e.option}),"")},function(){var e=p.find(n.gapsGroup.getUnusedAnswers(),function(e){var t=new u(e.config);return("text"===e.type?t.filter(e.option):t.filterUrlParams(e.option))===("text"===n.gapModel.userAnswer.type?t.filter(n.gapModel.userAnswer.option):t.filterUrlParams(n.gapModel.userAnswer.option))});return e&&n.gapsGroup.markAnswerAsUsed(n.gapModel,e),!!e},function(e){return e.isCorrect()?n.gapModel.getPointsToGain():0})),n.gapModel.eyeball.addState(0,function(){return!n.gapModel.userAnswer.option}),n.evaluate=function(){n.gapsGroup.evaluateAll(),"dnd"===n.gapModel.getDisplayType()&&n.saveManager.saveOnEvent()},"dnd"!==n.gapModel.getDisplayType()&&n.saveManager.subscribeForPeriodicSave(),n.evaluate()}}}]),angular.module("atoolEngine").directive("gapfillDnd",["underscore","rfc4122",function(c,d){return{require:["^task","gapfillDnd","?^engineSegmented"],restrict:"E",transclude:!0,controller:"gapFillDndController",templateUrl:"app/formats/gapfill/gapfill-dnd.tpl.html",link:function(o,e,t,n){var a=n[0],s=n[1],r=n[2],i=e.find(".dnd-droppable");a.registerDnd(o.options.wordpoolId,s),o.originUuid=d.v4(),i.droppable({tolerance:"pointer",classes:{"ui-droppable-hover":"dnd-hover","ui-droppable-active":"dnd-highlight"},accept:".wordpool-item-"+o.options.wordpoolId+':not(.js-wordpool-item-over-wordpool):not([origin-uuid="'+o.originUuid+'"])',drop:function(e,t){if(!angular.element(t.helper).data("alreadyDropped")){var n=r?r.getActivityElement():a.getMainDOMElement();s.drop(i,t.draggable,a,n)}}});var l=o.$on("engine-draggable-element-dropped",function(){s.resetIfEmpty()});o.$on("$destroy",function(){a.unregisterDnd(o.options.wordpoolId,s),l()}),o.gapModel.updateCustomReset(function(){var e=r?r.getActivityElement():a.getMainDOMElement();s.customReset(a,e)}),o.gapModel.registerCustomSave(function(){return{originalAnswer:o.originalAnswer}}),o.gapModel.registerCustomRestore(function(e){if(!c.isEmpty(e.originalAnswer)){var t=r?r.getActivityElement():a.getMainDOMElement(),n=a.getWordpoolElement(o.options.wordpoolId,e.originalAnswer);s.drop(i,n,a,t),a.getRegisteredWordpoolElement(o.options.wordpoolId,e.originalAnswer).manualHandlers.afterMoveElement()}})}}}]),angular.module("atoolEngine").controller("gapFillDndController",["$scope","$element","$compile","$timeout","draggableConfigCreator",function(c,o,d,p,u){angular.extend(this,{resetIfEmpty:function(){0===o.find(".wordpool-item").length&&c.gapModel.reset()},drop:function(e,t,n,o){var a=angular.element(t),s=a.data("wordpool-item-data");a=a.clone();var r=u.createConfig({helper:"clone",cloneable:!1,element:a,appendTo:o,appendToStructureSelector:"span.gapfill span.dnd span span.dnd-droppable.dnd-gap",containmentElement:o,scroll:!0});if(a.draggable(r.config).data("wordpool-item-data",s).data("should-be-clonned",!1).removeClass("dnd-item-hidden"),c.gapModel.reset(),c.originalAnswer=s.content,c.currentData=s,c.gapModel.userAnswer.option=s.content,c.gapModel.userAnswer.type=s.type,c.options.capitalize){var i=c.gapModel.userAnswer.option.charAt(0).toUpperCase()+c.gapModel.userAnswer.option.slice(1);c.gapModel.userAnswer.option=i}var l='<answer-option type="elementToCompile.type" option="elementToCompile.content" config="{playerType: elementToCompile.playerType}"></answer-option>';c.elementToCompile={type:s.type,content:c.gapModel.userAnswer.option,playerType:s.playerType},a.html(d(l)(c)),a.attr("origin-uuid",c.originUuid),a.detach().removeAttr("style").css({width:"auto",position:"relative"}).appendTo(e),c.evaluate(),p(function(){})},customReset:function(e,t){var n=o.find(".wordpool-item");0<n.length&&(e.restoreWordpoolElement(c.options.wordpoolId,n,c.currentData,t),n.remove()),c.currentData=null,c.originalAnswer=null,c.gapModel.userAnswer={option:null,type:"text"}}})}]),angular.module("atoolEngine").directive("freeWriting",["Gap","underscore","htmlEscaper",function(r,e,i){return{require:["^lo","^task","?^nonmarkableBlock"],scope:{options:"="},restrict:"E",replace:"true",templateUrl:"app/formats/freeWriting/freeWriting.tpl.html",link:function(t,e,n,o){var a=o[0],s=o[1];null!==o[2]&&(t.options.nonmarkableBlockController=o[2]),t.options.answers.modelAnswer=i.unescape(t.options.answers.modelAnswer),t.options.answers.defaultAnswer=i.unescape(t.options.answers.defaultAnswer),t.gapModel=new r(t,t.options,t.options.answers.modelAnswer,{loState:a.getLoState()},function(){t.initFreeWriting()}),s.getTaskModel().addGap(t.gapModel),"system"===t.options.markedBy&&t.gapModel.registerState(0,function(){var e=t.gapModel.userAnswer.trim();return""===e||e===t.options.answers.defaultAnswer},function(){return!0},function(e){return e.isCorrect()?t.gapModel.getPointsToGain():0}),t.modelAnswer=t.options.answers.modelAnswer,t.wordsLimit=parseInt(t.gapModel.attrs.wordsLimit,10),t.charaktersLimit=1e10,t.onChangeUserAnswer=function(){t.countWords(),t.gapModel.evaluateStates()},t.countWords=function(){t.gapModel.userAnswer.replace(/\s+/g," ").split(" ").length>t.wordsLimit?t.charaktersLimit=t.gapModel.userAnswer.length:t.charaktersLimit+=200},t.initFreeWriting=function(){t.gapModel.userAnswer=t.options.answers.defaultAnswer,t.gapModel.evaluateStates()},t.initFreeWriting()}}}]),angular.module("atoolEngine").directive("engineFlashcardsWordlist",["Gap","underscore","$uibModal","afterViews",function(l,c,d,p){return{require:["^lo","^task","?^nonmarkableBlock","?^engineSegmented"],scope:{options:"="},restrict:"E",replace:"true",templateUrl:"app/formats/flashcardsWordlist/flashcards.tpl.html",link:function(t,e,n,o){var a,s=o[0],r=o[1];null!==o[2]&&(t.options.nonmarkableBlockController=o[2]),null!==o[3]&&(a=o[3]),t.dataCollector=s.getDataCollector(),t.footerManager=s.getFooterManager(),t.gapModel=new l(t,t.options,t.options.cards,{loState:s.getLoState()},function(){t.initFlashcards()}),r.getTaskModel().addGap(t.gapModel),"system"===t.options.markedBy&&t.gapModel.registerState(0,function(){return!1},function(){return!0},function(){return t.gapModel.getPointsToGain()}),t.gapModel.evaluateStates();var i=function(e){c.each(t.options.cards,function(n){c.each(e,function(e,t){n[t]=e})})};t.filterSelectedCards=function(){t.selectedCards=c.filter(t.options.cards,function(e){return e.selected})},t.changeCard=function(e){t.config.currentCardIndex=e,t.config.currentCardIndex<0&&(t.config.currentCardIndex=t.selectedCards.length+t.config.currentCardIndex),t.config.currentCardIndex>t.selectedCards.length-1&&(t.config.currentCardIndex=t.selectedCards.length-t.config.currentCardIndex),t.config.currentAudio=null,t.selectedCards[t.config.currentCardIndex].audio&&(t.config.currentAudio=t.selectedCards[t.config.currentCardIndex].audio.links),t.config.currentImage=null,t.selectedCards[t.config.currentCardIndex].image&&(t.config.currentImage=t.selectedCards[t.config.currentCardIndex].image.links[0].url)},t.initFlashcards=function(){t.mode=t.options.wordlist?"wordlist":"deck",i({selected:!0,side:t.options.displayMode}),t.filterSelectedCards(),t.config={selectAllChecked:!0,currentCardIndex:0,dontShowConfirmationModal:!1,currentAudio:null,currentImage:null},"deck"===t.mode&&t.changeCard(0),a&&(t.activityElement=a.compileElement("app/formats/flashcardsWordlist/flashcards.activity.tpl.html",t,s,r),a.replaceCustomActivity(t.activityElement)),t.footerManager.get("submit").modifyAttr("visible","flashcardsActivity",!1),t.footerManager.get("tryAgain").modifyAttr("visible","flashcardsActivity",!1),t.footerManager.get("showAnswers").modifyAttr("visible","flashcardsActivity",!1),t.footerManager.get("footer").modifyAttr("visible","flashcardsActivity",!1)},t.initFlashcards(),t.autoSubmit=function(){p.chain(function(){s.tryToSubmitLO()})},t.autoSubmit(),t.selectAll=function(){t.config.selectAllChecked?i({selected:!0}):i({selected:!1}),t.filterSelectedCards()},t.selectCard=function(){t.filterSelectedCards(),t.config.selectAllChecked=t.options.cards.length===t.selectedCards.length},t.createFlashcards=function(){t.mode="deck",t.changeCard(0),a&&a.recalcColumnSizes()},t.flipCard=function(){var e=t.selectedCards[t.config.currentCardIndex].side;t.selectedCards[t.config.currentCardIndex].side="term"===e?"definition":"term"},t.goToWordlist=function(){t.mode="wordlist",a&&a.recalcColumnSizes()},t.tryToRemoveCurrentCardFromDeck=function(){t.config.dontShowConfirmationModal?(t.removeCurrentCardFromDeck(),t.config.selectAllChecked=!1):d.open({templateUrl:"app/formats/flashcardsWordlist/confirmRemoveFlashcard.popup.tpl.html",scope:t,appendTo:s.getModalPlaceholder(),controller:["$scope","$uibModalInstance",function(e,t){e.modalInstance=t,e.popupConfig={dontShowConfirmationModal:!1},e.confirm=function(){e.modalInstance.close(e.popupConfig.dontShowConfirmationModal)}}]}).result.then(function(e){t.removeCurrentCardFromDeck(),t.config.dontShowConfirmationModal=e,t.config.selectAllChecked=!1})},t.removeCurrentCardFromDeck=function(){t.selectedCards[t.config.currentCardIndex].selected=!1,t.selectedCards.splice(t.config.currentCardIndex,1),t.changeCard(t.config.currentCardIndex)},t.flipDeck=function(){var e=t.selectedCards[t.config.currentCardIndex].side;i({side:"term"===e?"definition":"term"})},t.shuffle=function(){t.selectedCards=c.shuffle(t.selectedCards),t.changeCard(0),i({side:t.options.displayMode})}}}}]),angular.module("atoolEngine").directive("flashcards",["Gap","underscore",function(r,i){return{require:["^lo","^task","?^nonmarkableBlock"],scope:{options:"="},restrict:"E",replace:"true",templateUrl:"app/formats/flashcards/flashcards.tpl.html",link:function(t,e,n,o){var a=o[0],s=o[1];null!==o[2]&&(t.options.nonmarkableBlockController=o[2]),t.gapModel=new r(t,t.options,angular.copy(t.options.answers),{loState:a.getLoState()},function(){t.gapModel.userAnswer={},t.currentSide="front"}),t.currentSide="front",t.gapModel.userAnswer={},s.getTaskModel().addGap(t.gapModel),"system"===t.options.markedBy&&t.gapModel.registerState(0,function(){return i.isUndefined(t.gapModel.userAnswer.isKnown)},function(){return t.gapModel.userAnswer.isKnown},function(e){return e.isCorrect()?t.gapModel.getPointsToGain():0}),t.evaluate=function(){t.gapModel.evaluateStates()},t.setKnown=function(e){e.stopPropagation(),t.gapModel.userAnswer.isKnown=!0,t.evaluate()},t.setUnknown=function(e){e.stopPropagation(),t.gapModel.userAnswer.isKnown=!1,t.evaluate()},t.flipSide=function(){"front"===t.currentSide?t.currentSide="back":t.currentSide="front"},t.gapModel.registerCustomSave(function(){return{currentSide:t.currentSide}}),t.gapModel.registerCustomRestore(function(e){t.currentSide=e.currentSide})}}}]),angular.module("atoolEngine").directive("crosswordHorizontal",["Gap","underscore",function(e,t){return{require:["^task"],restrict:"E",translude:!0,templateUrl:"app/formats/crossword/crosswordHorizontal.tpl.html",link:function(n,e,t,o){n.goDown=function(e){n.focusNextLetter(e,"down",1,0)},n.goUp=function(e){n.focusNextLetter(e,"up",-1,0)},n.goLeft=function(e){n.focusNextLetter(e,"left",0,-1)},n.goRight=function(e){n.focusNextLetter(e,"right",0,1)},n.typeLetter=function(e){n.goRight(e)},n.backspaced=function(e,t){e.preventDefault(),t.userLetter="",n.goLeft(t)},n.keyDown=function(e,t){switch(e.keyCode){case 8:n.backspaced(e,t);break;case 40:n.goDown(t);break;case 38:n.goUp(t);break;case 37:n.goLeft(t);break;case 39:n.goRight(t)}},n.onLetterChangeFromKeyboard=function(e,t){t.userLetter=e,n.typeLetter(t),n.setLetter(t)},n.onLetterChange=function(e,t){1===e.key.length&&(t.userLetter=e.key,n.typeLetter(t))}}}}]),angular.module("atoolEngine").directive("crosswordGeneral",["Gap","underscore",function(e,t){return{require:["^task"],restrict:"E",translude:!0,templateUrl:"app/formats/crossword/crosswordGeneral.tpl.html",link:function(n,e,t,o){n.direction={horizontal:!0},n.goDown=function(e){n.direction.horizontal=!1,n.focusNextLetter(e,"down",1,0)},n.goUp=function(e){n.direction.horizontal=!1,n.focusNextLetter(e,"up",-1,0)},n.goLeft=function(e){n.direction.horizontal=!0,n.focusNextLetter(e,"left",0,-1)},n.goRight=function(e){n.direction.horizontal=!0,n.focusNextLetter(e,"right",0,1)},n.backspaced=function(e,t){e.preventDefault(),t.userLetter="",1<t.horizontal.length?n.direction.horizontal?n.goLeft(t):n.goUp(t):(t.horizontal[0]?n.goLeft(t):n.goUp(t),n.direction.horizontal=t.horizontal[0])},n.keyDown=function(e,t){switch(e.keyCode){case 8:n.backspaced(e,t);break;case 40:n.goDown(t);break;case 38:n.goUp(t);break;case 37:n.goLeft(t);break;case 39:n.goRight(t)}},n.onLetterChangeFromKeyboard=function(e,t){t.userLetter=e,n.typeLetter(t),n.setLetter(t)},n.onLetterChange=function(e,t){1===e.key.length&&(t.userLetter=e.key,n.typeLetter(t))},n.typeLetter=function(e){1<e.horizontal.length?n.direction.horizontal?(n.goRight(e),n.direction.horizontal=!0):(n.goDown(e),n.direction.horizontal=!1):(e.horizontal[0]?n.goRight(e):n.goDown(e),n.direction.horizontal=e.horizontal[0])}}}}]),angular.module("atoolEngine").filter("horizontal",function(){return function(e){return _.filter(e,function(e){return e.horizontal})}}),angular.module("atoolEngine").filter("vertical",function(){return function(e){return _.filter(e,function(e){return!e.horizontal})}}),angular.module("atoolEngine").directive("crossword",["Gap","underscore","AnswerFilter","CrosswordFactory",function(u,g,m,f){return{require:["^lo","^task","?^nonmarkableBlock"],scope:{options:"="},restrict:"E",replace:"true",templateUrl:"app/formats/crossword/crossword.tpl.html",link:function(s,n,e,t){var o=t[0],a=t[1];null!==t[2]&&(s.options.nonmarkableBlockController=t[2]);var r=o.getLoState();s.answersWithoutExamples=g.filter(s.options.answers.words,function(e){return!e.example});var i=[];s.generateStructure=function(){var e;s.structureGenerated=!0;try{e=f(s.options,s.options.randomize)}catch(e){s.structureGenerated=!1}if(s.structureGenerated){if(s.options.randomize){var t=e.getRankedStructures(),n=g.random(0,t.length-1);s.crosswordStructure=t[n].crossword.getStructure(),s.cluesStructure=t[n].crossword.getClues()}else s.crosswordStructure=e.getStructure(),s.cluesStructure=e.getClues();i=g.chain(s.options.answers.words).filter(function(e){return!e.example}).map(function(t){var e=g.find(s.cluesStructure,function(e){return e.id===t.id});return{direction:e.horizontal?"horizontal":"vertical",number:e.number,answer:t.word,clue:e.clue}}).value()}},s.generateStructure(),s.gapModel=new u(s,s.options,i,{loState:o.getLoState()},function(){s.setEmptyUserWords(),s.options.randomize?(s.generateStructure(),s.setUserLetterWhenExampleOnIntersection()):(s.setUserLetterWhenExampleOnIntersection(),angular.forEach(s.crosswordStructure,function(e){angular.forEach(e,function(e){s.isEmpty(e)||(e.userLetter="")})}))}),a.getTaskModel().addGap(s.gapModel),s.answerFilter=new m({caseSensitive:s.options.caseSensitive}),s.getMainDisplayType=function(){return s.gapModel.getDisplayType().replace("-keyboard","")},s.getElementSizing=function(e){var t=n.find("tr").eq(e.coordinates[0]).find("td").eq(e.coordinates[1]);return{offset:t.offset(),height:t[0].offsetHeight}},"system"===s.options.markedBy?s.gapModel.registerState(0,function(){return g.every(s.answersWithoutExamples,function(e){return""===e.userWord.join("")})},function(){return g.every(s.answersWithoutExamples,function(e){return g.isEqual(s.answerFilter.filter(e.userWord.join("")),s.answerFilter.filter(e.word.split(" ").join("")))})},function(e){return e.isCorrect()?s.gapModel.getPointsToGain():0}):"system-option"===s.options.markedBy&&angular.forEach(s.answersWithoutExamples,function(e){s.gapModel.registerState(e.id,function(){return""===e.userWord.join("")},function(){return g.isEqual(s.answerFilter.filter(e.userWord.join("")),s.answerFilter.filter(e.word.split(" ").join("")))},function(e){var t=s.gapModel.getPointsToGain()/s.answersWithoutExamples.length;return e.isCorrect()?t:0})}),s.evaluate=function(){s.gapModel.evaluateStates(),s.gapModel.userAnswer=g.chain(s.options.answers.words).filter(function(e){return!e.example}).map(function(t){var e=g.find(s.cluesStructure,function(e){return e.id===t.id});return{direction:e.horizontal?"horizontal":"vertical",number:e.number,answer:t.userWord.join(""),clue:e.clue}}).value()},s.setLetter=function(n){var e=g.filter(s.options.answers.words,function(e){return g.contains(n.word,e.id)});angular.forEach(e,function(e){var t=g.indexOf(n.word,e.id);e.userWord[n.index[t]]=n.userLetter}),s.evaluate()},s.setUserLetterWhenExampleOnIntersection=function(){angular.forEach(s.crosswordStructure,function(e){var t=g.filter(e,function(e){return e.example&&1<e.word.length||e.fixed});angular.forEach(t,function(e){e.userLetter=e.letter,s.setLetter(e)})})},s.setEmptyUserWords=function(){angular.forEach(s.options.answers.words,function(n){n.userWord=[],angular.forEach(n.word,function(e,t){n.userWord[t]=""})})},s.setEmptyUserWords(),s.setUserLetterWhenExampleOnIntersection(),s.gapModel.registerCustomSave(function(){return{options:{structure:s.crosswordStructure,answers:s.options.answers.words}}}),s.gapModel.registerCustomRestore(function(e){e.options&&(s.crosswordStructure=e.options.structure,s.options.answers.words=e.options.answers,c())});var l=function(t){angular.forEach(s.crosswordStructure,function(e){angular.forEach(e,function(e){g.contains(e.word,t)&&(e.focus=!0)})}),angular.forEach(s.cluesStructure,function(e){e.id===t&&(e.focus=!0)})},c=function(){angular.forEach(s.crosswordStructure,function(e){angular.forEach(e,function(e){s.isEmpty(e)||(e.focus=!1)})}),angular.forEach(s.cluesStructure,function(e){e.focus=!1})};s.highlightWords=function(e){c(),angular.forEach(e,function(e){l(e)})},s.highlightWord=function(e){c(),l(e)},r.addObserver(function(e,t){c()}),s.isEmpty=function(e){return e=g.omit(e,"$$hashKey"),g.isEmpty(e)},s.hasFirst=function(e){return g.contains(e.index,0)},s.getNumber=function(e){return 0===e.index[0]?e.number[0]:e.number[1]},s.spaceAfter=function(e,t){if(e.spaceAfter){var n=-1;return n="horizontal"===t?g.indexOf(e.horizontal,!0):g.indexOf(e.horizontal,!1),e.spaceAfter[n]}};var d=function(e,t,n,o,a){0===e.index[o]&&(t[a+"-"+n+"-first"]=!0),e.isLastIndex[o]&&(t[a+"-"+n+"-last"]=!0)},p=function(e,t,n){var o="";o=e.horizontal[n]?"horizontal":"vertical",s.gapModel.states[e.word[n]].isCorrect()&&(t["correct-"+o]=!0,d(e,t,o,n,"correct")),s.gapModel.states[e.word[n]].isWrong()&&(t["wrong-"+o]=!0,d(e,t,o,n,"wrong")),s.gapModel.states[e.word[n]].isMissing()&&(t["missing-"+o]=!0,d(e,t,o,n,"missing"))};s.getReportClasses=function(e){var t={};return s.isEmpty(e)?t["no-border"]=!0:(t.border=!0,t.active=e.focus,t.hiddenLetter=e.hidden,t["space-horizontal"]=s.spaceAfter(e,"horizontal"),t["space-vertical"]=s.spaceAfter(e,"vertical"),s.gapModel.shouldBeRenderedAsGivenReport("system-option")&&(1<e.word.length?e.example?g.isUndefined(s.gapModel.states[e.word[0]])?p(e,t,1):p(e,t,0):(p(e,t,0),p(e,t,1)):e.example||p(e,t,0))),t},s.focusNextLetter=function(e,t,n,o){if(!g.isUndefined(s.crosswordStructure[e.coordinates[0]+n])){var a=s.crosswordStructure[e.coordinates[0]+n][e.coordinates[1]+o];g.isUndefined(a)||s.isEmpty(a)||(a.fixed||a.example?"right"===t?s.focusNextLetter(e,t,n,o+1):"left"===t?s.focusNextLetter(e,t,n,o-1):"down"===t?s.focusNextLetter(e,t,n+1,o):"up"===t&&s.focusNextLetter(e,t,n-1,o):(a.focusIn=!0,e.focusOn=!1))}}}}}]),angular.module("atoolEngine").directive("engineConcentration",["Gap","underscore","$timeout","afterViews","$uibModal","$window","HtmlAudioPlayer","adapterProxy",function(i,l,c,d,p,u,e,t){return{require:["^lo","^task","?^nonmarkableBlock"],scope:{options:"="},restrict:"E",replace:"true",templateUrl:"app/formats/concentration/concentration.tpl.html",link:function(o,a,e,t){var s=t[0],n=t[1];null!==t[2]&&(o.options.nonmarkableBlockController=t[2]),o.dataCollector=s.getDataCollector(),o.footerManager=s.getFooterManager();var r="webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend";o.gapModel=new i(o,o.options,[],{loState:s.getLoState()},function(){o.initConcentration()}),n.getTaskModel().addGap(o.gapModel),o.backflipTimeout=1500,o.initConcentration=function(){var n=0;o.cards=l.chain(o.options.pairs).map(function(t){return l.map(o.options.mode,function(e){return{type:e,option:t[e],pair:t,state:"initial",id:n++}})}).flatten().shuffle().value(),o.selectedPair=[],o.matchedPairs=[],o.useAnimations=!0,o.footerManager.get("submit").modifyAttr("visible","concentrationActivity",!1),o.footerManager.get("showAnswers").modifyAttr("visible","concentrationActivity",!1),o.footerManager.get("tryAgain").modifyAttr("visible","concentrationActivity",!1),o.footerManager.registerButton("resetGame",250).addText("memory_restart_game").addAttr("visible").addAttr("enabled").addClass("reset-game-button").addCallback("click",function(){o.restartGame(!1)}),o.footerManager.registerButton("newGame",260).addText("memory_new_game").addAttr("visible").addAttr("enabled").addClass("new-game-button").addCallback("click",function(){o.restartGame(!0)}),o.footerManager.get("newGame").modifyAttr("enabled","gameStarted",!1),o.footerManager.get("resetGame").modifyAttr("enabled","gameStarted",!1),o.recalculateCardsHeight()},o.flipCard=function(e){2!==o.selectedPair.length&&("initial"===e.state&&(e.state="flipped",o.selectedPair.push(e)),o.checkSelectedPair(),o.checkGameFinished(e.id))},o.checkSelectedPair=function(){2===o.selectedPair.length&&(o.selectedPair[0].pair!==o.selectedPair[1].pair?o.backflipTimeoutPromise=c(function(){o.selectedPair[0].state=o.selectedPair[1].state="initial",o.selectedPair=[],o.backflipTimeoutPromise=null},o.backflipTimeout):(o.matchedPairs.push(o.selectedPair[0].pair),o.selectedPair=[])),o.footerManager.get("newGame").modifyAttr("enabled","gameStarted",!0),o.footerManager.get("resetGame").modifyAttr("enabled","gameStarted",!0)},o.checkGameFinished=function(e){if(o.matchedPairs.length===o.options.pairs.length){var t=a.find("[card-id="+e+"]"),n=function(){t.off(r,n),p.open({templateUrl:"app/formats/concentration/finish.popup.tpl.html",scope:o,appendTo:s.getModalPlaceholder(),controller:["$scope","$uibModalInstance","cptPopupTimeout",function(e,t,n){e.modalInstance=t,s.isCptMode()&&c(function(){e.modalInstance.dismiss()},n)}]})};t.on(r,n)}},o.restartGame=function(e){o.backflipTimeoutPromise&&(c.cancel(o.backflipTimeoutPromise),o.backflipTimeoutPromise=null),o.selectedPair=[],o.matchedPairs=[],l.each(o.cards,function(e){e.state="initial"}),e&&(o.cards=l.shuffle(o.cards)),o.useAnimations=!1,d.chain(function(){angular.forEach(a.find(".js-con-card .flipper"),function(e){e.offsetHeight})}),d.chain(function(){o.useAnimations=!0}),o.footerManager.get("newGame").modifyAttr("enabled","gameStarted",!1),o.footerManager.get("resetGame").modifyAttr("enabled","gameStarted",!1)},o.recalculateCardsHeight=function(){d.chain(function(){angular.forEach(a.find(".js-con-card"),function(e){angular.element(e).height("")})},function(){var t=a.find(".js-con-card:eq(0)").height();angular.forEach(a.find(".js-con-card"),function(e){angular.element(e).height(t+"px")})})},angular.element(u).on("resize",function(){o.recalculateCardsHeight()}),o.$on("engine-Segmented-InstructionSwitch",o.recalculateCardsHeight),o.initConcentration()}}}]),angular.module("atoolEngine").directive("categoryDnd",["rfc4122",function(n){return{require:["^task","^categorisationAssign","?^engineSegmented"],restrict:"E",transclude:!0,scope:{category:"="},templateUrl:"app/formats/categorisation/category-dnd.tpl.html",link:function(o,a,e,t){o.categorisationScope=o.$parent;var s=t[0],r=t[1],i=t[2],l=a.find(".category_drop");o.originUuid=n.v4(),a.find(".category_drop").droppable({tolerance:"pointer",activeClass:"dnd-highlight",hoverClass:"dnd-hover",accept:".wordpool-item-"+o.$parent.options.wordpoolId+':not(.js-wordpool-item-over-wordpool):not([origin-uuid="'+o.originUuid+'"])',drop:function(e,t){if(!angular.element(t.helper).data("alreadyDropped")){var n=i?i.getActivityElement():s.getMainDOMElement();r.drop(angular.element(l),t.draggable,o.category.id,s,n,o.originUuid),a.parents(".category_dnd").removeClass("category-hover")}},over:function(e,t){a.parents(".category_dnd").addClass("category-hover")},out:function(e,t){a.parents(".category_dnd").removeClass("category-hover")}}),o.examples=o.$parent.examples}}}]),angular.module("atoolEngine").directive("categorisationTaptap",["$timeout","underscore","$document","engineBrowserDetector",function(e,r,i,l){return{restrict:"E",translude:!0,require:["^lo","^task"],templateUrl:"app/formats/categorisation/categorisationTaptap.tpl.html",link:function(a,n,e,t){var o=t[0],s=t[1];a.footerManager=o.getFooterManager(),o.getLoState().addObserver(function(e,t){"solving"===e&&"report"===t?r.each(a.options.answers.categories,function(e){e.isOpen=!0}):"showAnswer"===e&&"solving"===t&&r.each(a.options.answers.categories,function(e){e.isOpen=!1})}),a.gapModel.updateCustomReset(function(){a.initTaptap(),r.each(a.wordpoolElements,function(e){delete e.category_selected}),r.each(a.options.answers.options,function(e){delete e.category_selected}),r.each(a.options.answers.categories,function(e){e.isOpen&&n.find('.js-collapsed-blocks[data-id="'+e.id+'"]').slideToggle(),e.isOpen=!1,e.visited=!1})}),a.gapModel.registerCustomSave(function(){var t={};return r.each(a.options.answers.categories,function(e){t[e.id]=e.visited}),{visitedCount:a.visitedCount,visitedCategories:t,wordpoolElements:r.map(a.wordpoolElements,function(e){return{category_selected:e.category_selected,content:e.content,type:e.type}})}}),a.gapModel.registerCustomRestore(function(o){o.options&&(o.wordpoolElements=r.map(a.wordpoolElements,function(e){return{content:e.content,type:e.type}}),angular.forEach(o.options,function(e,n){angular.forEach(e,function(e){var t=r.find(o.wordpoolElements,{content:e.answer});t.category_selected=t.category_selected||[],t.category_selected.push(parseInt(n,10))})})),o.wordpoolElements&&r.each(o.wordpoolElements,function(t){var e=r.find(a.options.answers.options,function(e){return e.option===t.content&&r.isUndefined(e.category_selected)});e&&(e.category_selected=t.category_selected);var n=r.find(a.wordpoolElements,function(e){return e.content===t.content&&r.isUndefined(e.category_selected)});n.category_selected=t.category_selected,0<r.size(n.category_selected)&&a.handleSubmitButtonEnabling(!0)}),o.visitedCategories&&r.each(a.options.answers.categories,function(e){e.visited=o.visitedCategories[e.id]}),o.visitedCount&&(a.visitedCount=o.visitedCount,a.options.forceVisitsBeforeSubmit&&a.visitedCount===a.options.answers.categories.length&&a.footerManager.get("submit").modifyAttr("enabled","allCategoriesVisited",!0))}),a.initTaptap=function(){a.selected={},s.hideWordpool(a.options.wordpoolId),a.wordpool=s.getWordpoolData(a.options.wordpoolId),a.wordpoolElements=a.wordpool.elements.filter(function(e){return!e.isExample}),a.wordpool.randomize&&(a.wordpoolElements=r.shuffle(a.wordpoolElements)),a.options.forceVisitsBeforeSubmit&&a.footerManager.get("submit").modifyAttr("enabled","allCategoriesVisited",!1),a.visitedCount=0,a.handleSubmitButtonEnabling(!1)},a.initTaptap(),a.toggleCollapse=function(t,e){delete a.selectedToUnmatch,delete a.selected.option,t.isOpen=!t.isOpen,t.visited||(t.visited=!0,a.visitedCount++,a.options.forceVisitsBeforeSubmit&&a.visitedCount===a.options.answers.categories.length&&a.footerManager.get("submit").modifyAttr("enabled","allCategoriesVisited",!0)),n.find('.js-collapsed-blocks[data-id="'+t.id+'"]').slideToggle(400,function(){a.scrollScreenToCategory(t)}),e&&r.each(a.options.answers.categories,function(e){e.isOpen&&t!==e&&(e.isOpen=!1,n.find('.js-collapsed-blocks[data-id="'+e.id+'"]').slideToggle(400,function(){a.scrollScreenToCategory(t)}))})},a.scrollScreenToCategory=function(e){var t=n.scrollParent();t.is(i)&&(t=l.isEdge()?angular.element(t[0].body):angular.element(t[0].documentElement)),t.animate({scrollTop:t[0].scrollTop+n.find(".sort-category-id-"+e.id).offset().top-t.offset().top-10})},a.wordpoolElementsForCategory=function(t){return r.filter(a.wordpoolElements,function(e){return e.category_selected&&e.category_selected.some(function(e){return e===t.id})})},a.optionsForCategory=function(t){return r.filter(a.options.answers.options,function(e){return e.category.some(function(e){return e===t.id})&&!e.example})},a.examplesForCategory=function(t){return r.filter(a.options.answers.options,function(e){return e.category.some(function(e){return e===t.id})&&e.example})},a.isCategoryEmpty=function(t){var e=r.any(a.wordpoolElements,function(e){return e.category_selected&&e.category_selected.some(function(e){return e===t.id})}),n=r.any(a.options.answers.options,function(e){return e.category.some(function(e){return e===t.id})&&e.example});return!e&&!n},a.areCategorySelectedSame=function(e,n){return e===n||!(!e||!n||e.length!==n.length)&&e.every(function(e,t){return e===n[t]})},a.findCorrespondingOption=function(t){return r.find(a.options.answers.options,function(e){return e.option===t.content&&a.areCategorySelectedSame(e.category_selected,t.category_selected)})},a.getReportClassForOption=function(e,t){var n=a.findCorrespondingOption(e),o="";return n&&a.gapModel.shouldBeRenderedAsGivenReport("system-option")&&(o+=n.index),(n&&a.gapModel.shouldBeRenderedAsGivenReport("system-option-part")||a.gapModel.shouldBeRenderedAsGivenReport("system-option-alternative"))&&(o=o+n.index+"-"+t.id),o?{correct:a.gapModel.states[o].isCorrect(),wrong:a.gapModel.states[o].isWrong()}:{}},a.selectOption=function(e,t){t!==a.selected.option?(a.selected.option=t,delete a.selectedToUnmatch):delete a.selected.option,e.stopPropagation()},a.selectOptionToUnmatch=function(e){a.selectedToUnmatch===e?delete a.selectedToUnmatch:(a.selectedToUnmatch=e,delete a.selected.option)},a.unmatchOption=function(t){if(a.selectedToUnmatch){var e=r.find(a.options.answers.options,function(e){return e.option===a.selectedToUnmatch.content&&(e.category_selected||[]).some(function(e){return e===t.id})&&(a.selectedToUnmatch.category_selected||[]).some(function(e){return e===t.id})});e&&(e.category_selected=e.category_selected.filter(function(e){return e!==t.id}),0===e.category_selected.length&&delete e.category_selected),a.selectedToUnmatch.category_selected=a.selectedToUnmatch.category_selected.filter(function(e){return e!==t.id}),0===a.selectedToUnmatch.category_selected.length&&delete a.selectedToUnmatch.category_selected}delete a.selectedToUnmatch,a.evaluate()},a.selectCategory=function(e){a.selected.category=e,a.matchCompleted()},a.matchCompleted=function(){var e=r.find(a.options.answers.options,function(e){return e.option===a.selected.option.content});e&&(e.category_selected||(e.category_selected=[]),e.category_selected.push(parseInt(a.selected.category.id,10))),a.selected.option.category_selected||(a.selected.option.category_selected=[]),a.selected.option.category_selected.push(parseInt(a.selected.category.id,10)),delete a.selected.option,delete a.selected.category,a.handleSubmitButtonEnabling(!0),a.evaluate()}}}}]),angular.module("atoolEngine").directive("categorisationChoosable",["$timeout","underscore",function(e,r){return{restrict:"E",translude:!0,templateUrl:"app/formats/categorisation/categorisationChoosable.tpl.html",link:function(o,e,t){o.gapModel.updateCustomReset(function(){o.answer={},o.answer.selected={},o.clearSelectedCategories(),a()}),o.answer={},o.answer.selected={},o.mapAndEvaluate=function(e){var n=[];angular.forEach(o.answer.selected[e.option],function(e,t){e&&n.push(parseInt(t,10))}),e.category_selected=n,o.evaluate()},o.gapModel.registerCustomSave(function(){return{options:o.answer}}),o.gapModel.registerCustomRestore(function(e){e.options&&(o.answer=e.options,"dropdown"===o.gapModel.getDisplayType()&&angular.forEach(o.answer.selected,function(e,t){var n=r.where(o.gapModel.attrs.answers.categories,{id:e.id});o.answer.selected[t]=n[0]}))}),o.mapRadioAndEvaluate=function(e){e.category_selected=[o.answer.selected[e.option]],o.evaluate()},o.mapDropdownAndEvaluate=function(e){o.answer.selected[e.option]=o.gapModel.attrs.answers.categories[o.answer.selectedDropDown[e.option]],e.category_selected=[o.answer.selected[e.option].id],o.evaluate()},o.checkAndEvaluate=function(e,t){n(e,t),o.mapAndEvaluate(e)},o.checkRadioAndEvaluate=function(e,t){o.answer.selected[e.option]=t,o.mapRadioAndEvaluate(e)},o.generateStateIdForDropdownAlternatives=function(e,t){var n=o.answer.selected[t.option].id;return r.isUndefined(n)&&(n=t.category[0]),e+"-"+n};var n=function(e,t){e.selected[t]=!e.selected[t],o.answer.selected[e.option][t]=!o.answer.selected[e.option][t]},a=function(){angular.forEach(o.gapModel.attrs.answers.options,function(e){e.selected={},o.answer.selected[e.option]={}})};a();var s=function(){angular.forEach(o.gapModel.attrs.answers.options,function(e){var t=r.where(o.gapModel.attrs.answers.categories,{id:e.category[0]});e.full_category=t[0]})};"dropdown"===o.gapModel.getDisplayType()&&s(),o.isInAnswers=function(e,t){return r.contains(e.category,t)}}}}]),angular.module("atoolEngine").directive("categorisationAssign",["$timeout","underscore","afterViews",function(r,u,g){return{require:["^lo","^task","categorisationAssign","?^engineSegmented"],restrict:"E",translude:!0,controller:"categorisationAssignCtrl",templateUrl:"app/formats/categorisation/categorisationAssign.tpl.html",link:function(i,l,e,t){var n=t[0],c=t[1],d=t[2],p=t[3];i.wordpoolCtrl=c.getWordpoolController(i.options.wordpoolId),i.handleTapTapClick=function(e,t){if("taptap"===i.wordpoolType){if(i.wordpoolCtrl.taptap.isSelected()||u.isUndefined(t)){if(i.wordpoolCtrl.taptap.isSelected()){var n=i.wordpoolCtrl.taptap.getSelected();if(n.currentCategory===e)i.wordpoolCtrl.taptap.clearGapSelection();else{n=i.wordpoolCtrl.taptap.claimSelected();var o=c.getWordpoolElement(i.options.wordpoolId,n.content);i.answerInputs[e].push({answer:n.content,type:n.type,data:n,element:o})}}}else i.answerInputs[e][t].selected=!0,i.answerInputs[e][t].data.currentCategory=e,i.wordpoolCtrl.taptap.selectFromGap(i.answerInputs[e][t].data,function(){i.answerInputs[e][t].selected=!1,delete i.answerInputs[e][t].data.currentCategory},function(){delete i.answerInputs[e][t].data.currentCategory,i.answerInputs[e].splice(t,1)});c.evaluateCatGaps(i.options.wordpoolId),i.gapModel.eyeball.resetAnswersToShowCounter(e),i.handleSubmitButtonEnabling(!0),r(function(){})}};var o=null;c.registerCat(i.options.wordpoolId,d),"dnd"===i.options.display?(i.wordpoolType=i.wordpoolCtrl.isTapTap()?"taptap":"dnd",i.handleSubmitButtonEnabling(!1),i.gapModel.updateCustomReset(function(){var e=p?p.getActivityElement():c.getMainDOMElement();for(var t in d.customReset(c,e),i.answerInputs)delete i.answerInputs[t];s(),i.clearSelectedCategories(),i.handleSubmitButtonEnabling(!1)}),o=i.$on("engine-draggable-element-dropped",function(){c.evaluateCatGaps(i.options.wordpoolId)})):i.gapModel.updateCustomReset(function(){for(var e in i.answerInputs)delete i.answerInputs[e];s(),i.clearSelectedCategories()}),i.gapModel.registerCustomSave(function(){return{options:u.mapObject(i.answerInputs,function(e){var t=u.filter(e,function(e){return 0<e.answer.length});return u.map(t,function(e){return u.pick(e,["answer","type"])})})}}),i.gapModel.registerCustomRestore(function(n){if(n.wordpoolElements&&(n.options={},angular.forEach(n.wordpoolElements,function(t){angular.forEach(t.category_selected,function(e){n.options[e]=n.options[e]||[],n.options[e].push({answer:t.content,type:t.type})})})),n.options)if("fillin"===i.gapModel.getDisplayType()){for(var e in n.options)i.answerInputs[e]=n.options[e];a(),i.fillinEvaluate()}else g.chain(function(){angular.forEach(n.options,function(e,r){angular.forEach(e,function(e){if("taptap"===i.wordpoolType){var t=i.wordpoolCtrl.taptap.directClaim({content:e.answer,type:e.type}),n=c.getWordpoolElement(i.options.wordpoolId,e.answer);i.answerInputs[r].push({answer:e.answer,type:e.type,data:t,element:n})}else{var o=l.find('.category_drop[data-cat="'+r+'"]'),a=c.getWordpoolElement(i.options.wordpoolId,e.answer),s=p?p.getActivityElement():c.getMainDOMElement();d.drop(o,a,r,c,s,o.attr("data-origin-uuid")),c.getRegisteredWordpoolElement(i.options.wordpoolId,e.answer).manualHandlers.afterMoveElement()}})}),i.fillinEvaluate()});i.$broadcast("autosize-invalidate")}),n.getLoState().addObserver(function(e,t){"solving"===t&&i.$broadcast("autosize-invalidate")}),i.$on("$destroy",function(){c.unregisterCat(i.options.wordpoolId,d),o&&o()}),i.isCorrect=function(t){var e=u.find(i.gapModel.attrs.answers.options,function(e){return e.option===t.answer});return!!e&&u.isEqual(e.category,e.category_selected)},i.getStateForOptionAndCategory=function(t,e){var n=u.find(i.gapModel.attrs.answers.options,function(e){return e.option===t.answer});return n?i.gapModel.states[n.index+"-"+e.id]:null},i.reportClasses=function(e,t){if(i.gapModel.shouldBeRenderedAsGivenReport("system-option")||"system-option"===i.options.markedBy&&i.gapModel.eyeball.shouldBeRenderedAsReport(t.id))return{correct:!e.duplicated&&i.isCorrect(e),wrong:e.duplicated||!i.isCorrect(e)};if(i.gapModel.shouldBeRenderedAsGivenReport(["system-option-part","system-option-alternative"])||("system-option-part"===i.options.markedBy||"system-option-alternative"===i.options.markedBy)&&i.gapModel.eyeball.shouldBeRenderedAsReport(t.id)){var n=i.getStateForOptionAndCategory(e,t);return{correct:!e.duplicated&&!!n&&n.isCorrect(),wrong:e.duplicated||!n||n.isWrong(),missing:!!n&&n.isMissing()}}return"taptap"===i.wordpoolType?{selected:e.selected}:void 0},i.examples={},function(){angular.forEach(i.gapModel.attrs.answers.options,function(t){t.example&&angular.forEach(t.category,function(e){i.examples.hasOwnProperty(e)||(i.examples[e]=[]),i.examples[e].push(t)})})}(),i.fillinEvaluate=function(){angular.forEach(i.gapModel.attrs.answers.options,function(e){delete e.category_selected}),angular.forEach(i.answerInputs,function(e,n){angular.forEach(e,function(e){var t=u.where(i.gapModel.attrs.answers.options,{option:e.answer,type:e.type});u.isEmpty(t)||(t[0].hasOwnProperty("category_selected")?u.contains(t[0].category_selected,parseInt(n,10))?e.duplicated=!0:t[0].category_selected.push(parseInt(n,10)):t[0].category_selected=[parseInt(n,10)])})}),i.evaluate()};var a=function(){angular.forEach(i.gapModel.attrs.answers.categories,function(e){"fillin"===i.gapModel.getDisplayType()&&i.answerInputs[e.id].push({answer:"",type:"text",solvable:!0,focus:!1,focusNext:!1})})},s=function(){angular.forEach(i.gapModel.attrs.answers.categories,function(e){i.answerInputs[e.id]=[]}),a()};s(),i.removeInput=function(e,t){var n=u.where(i.gapModel.attrs.answers.options,{option:i.answerInputs[e][t].answer});u.isEmpty(n)||delete n[0].category_selected,i.answerInputs[e].splice(t,1),i.evaluate()},i.evaluateAndAddNew=function(e,t,n){""!==i.answerInputs[e][t].answer?(i.answerInputs[e][t].solvable=!1,i.isInEditable||i.answerInputs[e].push({answer:"",type:"text",solvable:!0,focus:n})):i.isInEditable&&i.removeInput(e,t),i.isInEditable=!1,i.fillinEvaluate()},i.evaluateAndAddNewAndFocus=function(e,t,n){i.answerInputs[e].length-1>t?i.answerInputs[e][i.answerInputs[e].length-1].focus=!0:(i.answerInputs[e][t].focusNext=!0,angular.element(n.target).blur())},i.changeToSolvable=function(e){e.solvable=!0,e.focus=!0,e.focusNext=!1,i.isInEditable=!0},i.emptyOrNull=function(e){return!(null===e.answer||0===e.answer.trim().length)}}}}]),angular.module("atoolEngine").controller("categorisationAssignCtrl",["$scope","$element","underscore","$timeout","draggableConfigCreator","$compile",function(c,e,a,d,p,t){angular.extend(this,{afterElementMove:function(){e.find(".category_drop").each(function(e,t){var n=angular.element(t),o=n.attr("data-cat");"taptap"!==c.wordpoolType&&(c.answerInputs[o]=a.map(n.find(".wordpool-item"),function(e){var t=angular.element(e),n=t.data("wordpool-item-data");return{answer:n.content,type:n.type,data:n,element:t}})),c.gapModel.eyeball.setAnswersToCheckCount(o,c.answerInputs[o].length)}),c.fillinEvaluate()},customReset:function(t,n){for(var e in angular.forEach(c.answerInputs,function(e){angular.forEach(e,function(e){e.element.show(),"taptap"!==c.wordpoolType&&(t.restoreWordpoolElement(c.options.wordpoolId,e.element,e.data,n),e.element.remove())})}),c.answerInputs)delete c.answerInputs[e]},drop:function(e,t,n,o,a,s){var r=angular.element(t),i=r.data("wordpool-item-data");r=r.clone();var l=p.createConfig({helper:"clone",cloneable:!1,element:r,appendTo:a,appendToStructureSelector:"span.categorisation span.dnd span.categories-container div.category div.category-content div.category_drop.dnd-gap",containmentElement:a,scroll:!0});r.draggable(l.config).data("wordpool-item-data",i).data("should-be-clonned",!1).removeClass("dnd-item-hidden"),c.currentData=i,"taptap"!==c.wordpoolType&&r.detach().attr("origin-uuid",s).removeAttr("style").css({width:"auto",position:"relative"}).appendTo(e),c.answerInputs[n].push({answer:i.content,type:i.type,data:i,element:r}),c.gapModel.eyeball.resetAnswersToShowCounter(n),c.handleSubmitButtonEnabling(!0),d(function(){})}})}]),angular.module("atoolEngine").directive("categorisation",["Gap","underscore",function(l,c){return{require:["^lo","^task","?^nonmarkableBlock"],scope:{options:"="},restrict:"E",replace:"true",templateUrl:"app/formats/categorisation/categorisation.tpl.html",link:function(r,n,e,t){var o=t[0],a=t[1];null!==t[2]&&(r.options.nonmarkableBlockController=t[2]),r.dataCollector=o.getDataCollector(),r.saveManager=o.getSaveManager(),r.shouldShowEyeballs=o.shouldShowEyeballs(),r.footerManager=o.getFooterManager(),r.answersWithoutExamples=c.filter(r.options.answers.options,function(e){return!e.example});var s=r.answersWithoutExamples.map(function(e){return{option:e.option,category:e.category}});if(r.answerInputs={},r.gapModel=new l(r,r.options,s,{loState:o.getLoState()}),a.getTaskModel().addGap(r.gapModel),angular.forEach(r.options.answers.options,function(e,t){e.index=t}),r.saveManager.subscribeForPeriodicSave(),r.gapModel.registerCustomDataToSend(function(){return{categories:r.options.answers.categories}}),r.handleSubmitButtonEnabling=function(e){r.dataCollector.getInternals().hasSegmented&&r.footerManager.get("submit").modifyAttr("enabled",r.options.id+"-answerModified",e)},"system"===r.options.markedBy)r.gapModel.registerState(0,function(){return"dnd"===r.options.display?c.every(r.options.answers.categories,function(e){return 0===r.answerInputs[e.id].length}):"fillin"===r.options.display?c.every(r.options.answers.categories,function(e){return 1===r.answerInputs[e.id].length}):c.every(r.answersWithoutExamples,function(e){return c.isUndefined(e.category_selected)})},function(){return c.every(r.answersWithoutExamples,function(e){return c.isEqual(e.category,e.category_selected)})},function(e){return e.isCorrect()?r.gapModel.getPointsToGain():0});else if("system-category"===r.options.markedBy)angular.forEach(r.options.answers.categories,function(n,e){var o=c.filter(r.answersWithoutExamples,function(e){return c.contains(e.category,n.id)}),a=c.difference(r.answersWithoutExamples,o);r.gapModel.registerState(n.id,function(){return"dnd"===r.options.display?0===r.answerInputs[n.id].length:"fillin"===r.options.display?1===r.answerInputs[n.id].length:!c.any(r.answersWithoutExamples,function(e){return c.contains(e.category_selected,n.id)})},function(){var e=c.every(o,function(e){return c.contains(e.category_selected,n.id)}),t=c.filter(a,function(e){return c.contains(e.category_selected,n.id)});return t=1<=t.length,e&&!t},function(e){var t=r.gapModel.getPointsToGain()/r.options.answers.categories.length;return e.isCorrect()?t:0})});else if("system-option"===r.options.markedBy)angular.forEach(r.options.answers.options,function(n,e){n.example||r.gapModel.registerState(e,function(){return c.isUndefined(n.category_selected)},function(){var e=c.sortBy(n.category,function(e){return e}),t=c.sortBy(n.category_selected,function(e){return e});return c.isEqual(e,t)},function(e){var t=r.gapModel.getPointsToGain()/r.answersWithoutExamples.length;return e.isCorrect()?t:0})});else if("system-option-part"===r.options.markedBy){var i={};r.gapModel.registerEvaluateLifecycleCallbacks(function(){i={},angular.forEach(r.options.answers.options,function(e,t){var n=0;e.category.length<(e.category_selected||[]).length&&(n=Math.min(e.category.length,e.category_selected.length-e.category.length)),i[t]=n})},function(){}),angular.forEach(r.options.answers.options,function(a,s){a.example||angular.forEach(r.options.answers.categories,function(o){r.gapModel.registerState(s+"-"+o.id,function(){var e=c.contains(a.category,o.id),t=c.contains(a.category_selected||[],o.id);return e&&!t},function(){var e=c.contains(a.category,o.id),t=c.contains(a.category_selected||[],o.id);return e&&t||!e&&!t},function(e){var t=r.gapModel.getPointsToGain()/r.answersWithoutExamples.length,n=c.contains(a.category_selected||[],o.id);return e.isCorrect()&&n?t/a.category.length:e.isWrong()&&0<i[s]?(i[s]--,-t/a.category.length):0})})})}else"system-option-alternative"===r.options.markedBy&&angular.forEach(r.options.answers.options,function(s,e){s.example||angular.forEach(r.options.answers.categories,function(a){r.gapModel.registerState(e+"-"+a.id,function(){var e=c.contains(s.category,a.id),t=c.some(r.options.answers.categories,function(e){return c.contains(s.category_selected||[],e.id)});return e&&!t},function(){var e=c.contains(s.category,a.id),t=c.contains(s.category_selected||[],a.id),n=c.some(r.options.answers.categories,function(e){return c.contains(s.category_selected||[],e.id)});return e&&n||!e&&!t},function(e){var t=r.gapModel.getPointsToGain()/r.answersWithoutExamples.length,n=c.contains(s.category_selected||[],a.id),o=c.filter(r.options.answers.categories,function(e){return c.contains(s.category_selected||[],e.id)&&c.contains(s.category,e.id)}).length;return!c.some(r.options.answers.categories,function(e){return!c.contains(s.category,e.id)&&c.contains(s.category_selected||[],e.id)})&&e.isCorrect()&&n?t/o:0})})});c.each(r.options.answers.categories,function(t){r.gapModel.eyeball.addState(t.id,function(){return 0===r.answerInputs[t.id].length});var e=c.filter(r.answersWithoutExamples,function(e){return c.contains(e.category,t.id)}).length;r.gapModel.eyeball.setAnswersToShowCount(t.id,e),r.gapModel.eyeball.setAnswersToCheckCount(t.id,0)}),r.evaluate=function(){r.gapModel.evaluateStates(),r.gapModel.userAnswer=r.answersWithoutExamples.map(function(e){return{option:e.option,type:e.type,category:e.category_selected}}).filter(function(e){return void 0!==e.category}),"dnd"!==r.options.display&&"fillin"!==r.options.display||angular.forEach(r.options.answers.categories,function(t){angular.forEach(r.answerInputs[t.id],function(e){""!==e.answer&&0===c.where(r.answersWithoutExamples,{option:e.answer,type:e.type}).length&&r.gapModel.userAnswer.push({option:e.answer,type:e.type,category:[t.id]})})})},r.isImageOnly=a.isWordpoolRegistered(r.options.wordpoolId)&&c.every(a.getWordpoolData(r.options.wordpoolId).elements,function(e){return"image"===e.type}),r.fireEyeball=function(e){r.gapModel.eyeball.shouldBeRenderedAsReport(e)?n.find(".category-"+e+" .wordpool-item").eq(r.gapModel.eyeball.getAnswersToCheckCounter(e)-1).hide():r.gapModel.eyeball.shouldBeRenderedAsSolving(e)&&n.find(".category-"+e+" .wordpool-item").show()},o.getLoState().addObserver(function(e,t){"solving"===t&&n.find(".wordpool-item").show()}),r.clearSelectedCategories=function(){angular.forEach(r.answersWithoutExamples,function(e){delete e.category_selected})}}}}]),angular.module("atoolEngine").service("SoundProvider",["underscore","$rootScope","$document",function(t,e,n){var o=this;return o.audio=angular.element("<audio style=\"display: none;\" class='shared-custom-player-audio' />"),o.audio.appendTo(n[0].body),o.getAudio=function(){return o.audio[0]},o.setSrc=function(e){for(;o.audio[0].firstChild;)o.audio[0].removeChild(o.audio[0].firstChild);t.each(e,function(e){var t=document.createElement("source");t.type=e.type,t.src=e.url,o.audio[0].appendChild(t)})},o}]),angular.module("atoolEngine").service("shareManager",["adapterProxy","$window","$http",function(o,a,s){var r=null,i=null,l=!1;return{shareExercise:function(e){var t={projectId:o.getProjectId(e),exerciseId:o.getExerciseId(e),exerciseVersion:o.getExerciseVersion(e),exerciseName:o.getExerciseName(e),skinId:o.getSkinId(e)},n=o.getSharemoteUrls(e);null!==r&&(t.sessionAdminUuid=r),i&&!i.closed||(i=a.open(n.loader,"_blank"),l=!1),s.post(n.share,t).then(function(e){if(r=e.data.sessionAdminUuid,l)i.postMessage&&i.postMessage({adminUuid:e.data.sessionAdminUuid,message:"exercise.add",version:1},"*");else{var t=n.dashboard.replace(":uuid",e.data.sessionAdminUuid);i.location=t,l=!0}},function(e){l||i.close()})}}}]),angular.module("atoolEngine").service("objectHelper",["underscore",function(i){var l=this,e=function(e,t){for(var n={},o=0;o<e.length;o++)n[e[o]]=t[o];return function(e){return i.isMatch(e,n)}};l.hasPair=function(e,t,n,o){return 0<l.getPairs(e,t,n,o).length},l.getPairs=function(t,n,o,a){var s={};i.each(n,function(e){s[e]=t[e]}),i.isFunction(o)||(o=e(n,o));var r=[];return!i.any(s,i.isUndefined)&&o(s)&&r.push(s),i.each(t,function(e){a&&i.isObject(e)&&(r=r.concat(l.getPairs(e,n,o,a)))}),r}}]),angular.module("atoolEngine").service("mobileDetector",["$window",function(e){var t=new MobileDetect(e.navigator.userAgent);return{isMobile:function(){return null!=t.mobile()},isDesktop:function(){return null==t.mobile()},isPhone:function(){return null!=t.phone()},isTablet:function(){return null!=t.tablet()},getType:function(){return this.isDesktop()?"desktop":this.isPhone()?"phone":this.isTablet()?"tablet":"default"}}}]),angular.module("atoolEngine").service("LoCtrlProvider",function(){var e=this;return e.loCtrl=null,e.setLoCtrl=function(e){this.loCtrl=e},e.getLoCtrl=function(){return this.loCtrl},e}),angular.module("atoolEngine").service("kalturaScriptLoader",["$q","$timeout",function(n,o){var a=this;a.cache={},a.loadingInProgress=!1,a.loaderQueue=[],a.createScriptUrl=function(e){return"https://"+e.domain+"/p/"+e.partnerId+"/sp/"+e.partnerId+"00/embedIframeJs/uiconf_id/"+e.uiconfId+"/partner_id/"+e.partnerId},a.resolveFromCacheAndScheduleProcessing=function(e,t){t.resolve(a.cache[e]),o(function(){a.processQueue()})},a.processQueue=function(){if(0<a.loaderQueue.length){a.loadingInProgress=!0;var e=a.loaderQueue.shift(),t=a.createScriptUrl(e.data);a.cache[t]?a.resolveFromCacheAndScheduleProcessing(t,e.deferred):angular.element.getScript(t,function(){a.cache[t]=kWidget,a.resolveFromCacheAndScheduleProcessing(t,e.deferred)})}else a.loadingInProgress=!1},a.loadKWidget=function(e){var t=n.defer();return a.loaderQueue.push({data:e,deferred:t}),o(function(){a.loadingInProgress||a.processQueue()}),t.promise}}]),angular.module("atoolEngine").service("htmlEscaper",function(){return{unescape:function(e){if(null==e)return null;var t=angular.element("<div/>").html(e),n=t.text();return t.remove(),n}}}),angular.module("atoolEngine").service("engineEventTrigger",["underscore",function(t){var n={};return{addLoController:function(e,t){n[t]=e},triggerSubmit:function(e){t.isUndefined(n[e])||n[e].getLoState().isReport()||n[e].submitLO()},triggerSave:function(e){t.isUndefined(n[e])||n[e].getLoState().isReport()||n[e].saveData()},triggerRestore:function(e){t.isUndefined(n[e])||n[e].getLoState().isReport()||n[e].restoreData()}}}]),angular.module("atoolEngine").service("draggableConfigCreator",["$rootScope","$document","engineBrowserDetector","$window",function(o,n,a,b){var s=this,k=function(e,t){return parseFloat(e.css("margin-"+t))},S=function(e,t){return parseFloat(angular.element(e).css("padding-"+t))},M=function(e){return angular.element(e).scrollParent().is(n)},A=function(e){return angular.element(e).scrollParent()},C=function(e){var t=A(e);return t.is(n)?a.isEdge()?t[0].body:t[0].documentElement:t[0]},x=0,i=function(e,t,n){var o=n.getBoundingClientRect(),a=t[0].getBoundingClientRect(),s=A(t),r=C(t),i=r.getBoundingClientRect(),l=r.scrollTop,c=a.right-a.left,d=a.bottom-a.top,p=Math.max(0,o.left+S(n,"left"),i.left+S(r,"left")),u=Math.max(0,o.top+S(n,"top"),i.top+S(r,"top")),g=Math.min(b.innerWidth,o.right-S(n,"right"),i.right-S(r,"right")),m=Math.min(b.innerHeight,o.bottom-S(n,"bottom"),i.bottom-S(r,"bottom")),f=o.right-S(n,"right")<i.right-S(r,"right"),h=o.bottom-S(n,"bottom")<i.bottom-S(r,"bottom"),v=f?0:r.offsetWidth-r.clientWidth,w=h?0:r.offsetHeight-r.clientHeight,y=[0,0,0,0];return y[0]=p-k(t,"left")+x,y[1]=u-k(t,"top")+x,y[2]=g-c-v-k(t,"left")-k(t,"right")-x,y[3]=m-d-w-k(t,"top")-k(t,"bottom")-x,M(t)&&(y[1]+=l,y[3]+=l),e.draggable("option","containment",y),e.data("ui-draggable")._setContainment(),s};s.onStart=function(e,t,n,o){var a=i(e,t,n);if(o){var s=e.draggable("option","stop"),r=function(){i(e,t,n)};angular.element(a).on("scroll",r),e.draggable("option","stop",function(e,t){angular.element(a).off("scroll",r),s&&s.call(this,e,t)})}},s.registeredWrapperElements={},s.createWrapperElement=function(e,t){var n=null,a=n=1===e.find(".draggable-wrapper").size()?e.find(".draggable-wrapper"):angular.element("<span></span>").addClass("draggable-wrapper");return t.split(/\s+/).forEach(function(e){var t=e.split("."),n=t.shift(),o=t.join(" ");a=angular.element("<"+n+"></"+n+">").addClass(o).addClass("draggable-wrapper-element").appendTo(a)}),n.appendTo(e),a},s.getWrapperElement=function(e,t){return this.registeredWrapperElements[t]||(this.registeredWrapperElements[t]=this.createWrapperElement(e,t)),this.registeredWrapperElements[t]},s.createConfig=function(n){var t={isReverting:!1},e=n.appendTo;return n.appendToStructureSelector&&(e=this.getWrapperElement(n.appendTo,n.appendToStructureSelector)),{manualHandlers:{afterMoveElement:function(){n.cloneable||n.element.remove()}},config:{helper:n.helper,zIndex:1e3,scroll:n.scroll,appendTo:e,refreshPositions:!0,revert:function(e){return!e&&(t.isReverting=!0)},start:function(e,t){n.cloneable||n.element.addClass("dnd-item-hidden"),angular.element(t.helper).data("alreadyDropped",!1),s.onStart(angular.element(this),angular.element(t.helper),n.containmentElement[0],n.scroll)},stop:function(){n.cloneable||(t.isReverting?n.element.removeClass("dnd-item-hidden"):n.element.remove()),t.isReverting=!1,o.$broadcast("engine-draggable-element-dropped")}}}}}]),angular.module("atoolEngine").service("contentAnaliticsManager",["underscore","analiticsUrl","$http","$location",function(n,a,s,e){var r=function(e){return n.map(e,function(e){var t=n.omit(e,"correctAnswers","userAnswer","extra");return t["correctAnswers"+t.type]=e.correctAnswers,t["userAnswer"+t.type]=e.userAnswer,t["extra"+t.type]=e.extra,t})};return{sendAnalitics:function(e,t){var n=angular.copy(e.getLoParams()),o=r(e.getSolvingData());n.type=t,s.post(a,{params:n,answers:o})}}}]),angular.module("atoolEngine").service("engineBrowserDetector",["UAParser",function(e){var t=e.getBrowser().name.toLowerCase().replace(/\s/g,""),n=e.getBrowser().version.toLowerCase().replace(/\./g,"_").replace(/[^_a-zA-Z0-9-]/g,"");return{getBrowserName:function(){return t},getBrowserVersion:function(){return n},isIE:function(){return/IE/i.test(this.getBrowserName())},isEdge:function(){return/Edge/i.test(this.getBrowserName())},isIOSSafari:function(){return/mobilesafari/i.test(this.getBrowserName())}}}]),angular.module("atoolEngine").service("blockTypesHelper",["underscore","rfc4122",function(t,s){var e=this;e.isBlock=function(e){return t.contains(["wordpool","rubric","tabs","collapsed","list","list-item","presentation","text","asset","external-asset","container","columns","table","table-td","dialog","dialog-row","columns-col","segmented","instruction","instruction-mobile","stimulus","activity","model","cptQS"],e)},e.isContainer=function(e){return t.contains(["container","table-td","dialog-row","list-item","columns-col","instruction","instruction-mobile","stimulus","activity","model","cptQS"],e)},e.isSegmentedChild=function(e){return t.contains(["stimulus","activity"],e)},e.isAbsolutePositioned=function(e){return t.contains(["model"],e)},e.isList=function(e){return t.contains(["list"],e)},e.isGap=function(e){return t.contains(["GF","SC","MC","MAT","COR","CAT","ORD","WR","CW","ML","FC","WS","FCWL","REC","nglFCWL","nglWE","nglOD","nglSP","nglDIA","nglCOR","nglHL","nglESS","nglSI","cptQSH","MEM","cptCON","cptTTT","sriMC"],e)},e.createList=function(e,t){var n=s.v4().substr(0,8),o=s.v4(),a=s.v4().substr(0,8);return{randomize:!1,limit:"",numbered:"numbered",layoutType:"list-1col",listStyle:"list-style-decimal",animations:[],id:"list-"+n,title:"list-"+n,uuid:o,type:"list",start:t||1,blocks:[{css:{top:"",right:"",bottom:"",left:"",width:"",height:"",position:"relative"},orientation:"horizontal",animations:[],id:"list-item-"+a,title:"list-item-"+a,uuid:s.v4(),type:"list-item",blocks:e}]}}}]),angular.module("atoolEngine").service("autosizeInputManager",["$document","$window","$rootScope",function(e,n,a){var t=this,s=angular.element('<div class="autosize-input-engine" />');s.css({display:"inline-block",height:0,overflow:"hidden",position:"absolute",top:0,visibility:"hidden",whiteSpace:"nowrap"}),s.appendTo(e[0].body);var r=function(e){var t=n.getComputedStyle(e);return{boxSizing:t.boxSizing,borderLeft:t.borderLeftWidth+" solid black",borderRight:t.borderRightWidth+" solid black",fontFamily:t.fontFamily,fontFeatureSettings:t.fontFeatureSettings,fontKerning:t.fontKerning,fontSize:t.fontSize,fontStretch:t.fontStretch,fontStyle:t.fontStyle,fontVariant:t.fontVariant,fontVariantCaps:t.fontVariantCaps,fontVariantLigatures:t.fontVariantLigatures,fontVariantNumeric:t.fontVariantNumeric,fontWeight:t.fontWeight,letterSpacing:t.letterSpacing,marginLeft:t.marginLeft,marginRight:t.marginRight,paddingLeft:t.paddingLeft,paddingRight:t.paddingRight,textIndent:t.textIndent,textTransform:t.textTransform}},o=/\s/g,i=/>/g,l=/</g,c=function(e){return e.replace(o,"&nbsp;").replace(i,"&lt;").replace(l,"&gt;")};t.registerInput=function(e){e.on("input",this.recalc.bind(this,e,!0)),this.recalc(e,!1)},t.recalc=function(e,t){s.css(r(e[0]));var n=c(e.val()||e.attr("placeholder")||"");s.html(n);var o=s[0].getBoundingClientRect();e.css({width:Math.ceil(o.right-o.left)+1}),t&&a.$broadcast("engine-input-autosized")}}]),angular.module("atoolEngine").service("audioService",["underscore",function(n){var o=this;o.storedAudios={},o.currentAudio=null,o.registerAudio=function(e,t){n.isUndefined(o.storedAudios[e])&&(o.storedAudios[e]={}),o.storedAudios[e][t]=new Audio(t)},o.loadAudioFromLo=function(e){o.storedAudios[e]&&n.each(o.storedAudios[e],function(e){e.load()})},o.playAudio=function(e,t){o.pauseAudio(),o.storedAudios[e]&&o.storedAudios[e][t]&&(o.currentAudio=o.storedAudios[e][t],o.currentAudio.play())},o.pauseAudio=function(){o.currentAudio&&o.currentAudio.pause()}}]),angular.module("atoolEngine").service("audioContextManager",["$window","adapterProxy","Modernizr",function(t,n,e){var o=this;o.Html5AudioContext=t.AudioContext||t.webkitAudioContext,o.newGetUserMediaAPISupported=t.navigator.mediaDevices&&t.navigator.mediaDevices.getUserMedia,o.oldGetUserMediaAPISupported=e.getusermedia,o.anyGetUserMediaSupported=this.newGetUserMediaAPISupported||this.oldGetUserMediaAPISupported,e.on("flash",function(e){!o.anyGetUserMediaSupported&&e&&(t.fgum.initFlashGetUserMedia(n.getUserMediaFlashUri()),o.FlashAudioContext=t.fgum.flashAudioContext,o.recordingAudioContext=new o.FlashAudioContext)}),o.playingAudioContext=null,o.Html5AudioContext&&(o.playingAudioContext=new o.Html5AudioContext),o.anyGetUserMediaSupported?o.recordingAudioContext=o.playingAudioContext:o.recordingAudioContext=null,o.audioContextUsed=!1,o.acquireAudioContext=function(e){return o.audioContextUsed?null:(o.audioContextUsed=!0,"recording"===e?o.recordingAudioContext:o.playingAudioContext)},o.releaseAudioContext=function(){o.audioContextUsed=!1},o.audioContextSupported=function(e){return!("recording"!==e||!o.recordingAudioContext)||!("playing"!==e||!o.playingAudioContext)}}]),angular.module("atoolEngine").service("audioCheckingService",["$uibModal","$rootScope",function(t,e){var n=this,o=e.$new(),a=!1;n.showPopup=function(e){a||(a=!0,o.dataCollector=e.getDataCollector(),o.loCtrl=e,t.open({templateUrl:"app/common/audioCheck.popup.tpl.html",appendTo:e.getModalPlaceholder(),scope:o,backdrop:"static",keyboard:!1,controller:"audioCheckingController"}))}}]),angular.module("atoolEngine").controller("audioCheckingController",["$scope","underscore","rfc4122","$uibModalInstance","adapterProxy","$timeout",function(t,e,n,o,a,s){t.recording=!1,t.busy=!1,t.recordingUrl=null,t.modalInstance=o;var r=a.getSRIUrls(t.dataCollector);t.recorder=t.loCtrl.getRecorder(),t.activityID=n.v4(),t.startRecording=function(){t.recordingUrl=null,t.uniqueRecordingID=n.v4(),t.recorder.newSession(t.activityID,t.uniqueRecordingID).then(function(){t.recording=!0,t.recorder.start(),s(function(){})}).catch(function(e){console.log(e)})},t.closeModal=function(){t.recording&&t.stopRecording(),t.playing&&t.stopPlayback(),t.modalInstance.dismiss()},t.stopRecording=function(){t.recording=!1,t.busy=!0,t.recorder.stop().then(function(e){t.recorder.close(),t.recordingUrl=r.dynaBucket+e.audioUri,t.busy=!1,s(function(){})})},t.startPlayback=function(){t.playing=!0,t.currentAudio=new Audio(t.recordingUrl),t.currentAudio.play(),t.currentAudio.addEventListener("ended",function(){t.$apply(function(){t.playing=!1})})},t.stopPlayback=function(){t.currentAudio&&t.currentAudio.pause(),t.playing=!1}}]),angular.module("atoolEngine").service("asyncDigest",["$timeout",function(e){this.trigger=function(){e(function(){})}}]),angular.module("atoolEngine").service("animateHelper",["underscore","rfc4122","$timeout","audioService",function(s,r,i,a){var l=this,c="webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend";l.animateOnClick=function(n,e,t){var o=function(){},a=r.v4();t.repeat||(o=function(){n.unbind("click.animations"+a);var e=angular.element._data(n[0],"events"),t=e?e.click:void 0;t&&(t=s.filter(t,function(e){return null!=e.namespace.match(/animations/)})),s.isEmpty(t)&&n.removeClass("atool-animation-trigger")}),n.addClass("atool-animation-trigger"),n.bind("click.animations"+a,function(){i(function(){l.animateThis(t,e,o)},parseInt(t.timeout,10))})},l.animateThis=function(e,t,n){var o="animated "+e.animation;e.audio&&a.playAudio(e.loId,e.audio),t.hasClass("atool-hidden")&&t.removeClass("atool-hidden"),t.addClass("atool-animation "+o).one(c,function(){t.removeClass(o),e.hiddenAfter?t.addClass("atool-hidden"):t.removeClass("atool-hidden"),s.isFunction(n)&&n()})}}]),angular.module("atoolEngine").service("afterViews",["$timeout","underscore",function(n,o){var a=this;a.chain=function(){var e=!1,t=Array.prototype.slice.call(arguments);return t.length&&n(function(){e||(o.isFunction(t[0])&&t[0](),t.shift(),a.chain.apply(a,t))}),{cancel:function(){e=!0}}}}]),angular.module("atoolEngine").service("adapterProxy",["$window","underscore","engineEventTrigger","$q","sharemoteUrls","SRIUrls",function(r,s,e,t,n,o){var i=function(e,t){return e&&s.isObject(e.atoolAdapter)&&s.isFunction(e.atoolAdapter[t])?e.atoolAdapter:null},l=function(e,t,n,o){if(!e)return{success:!1,value:o};var a=e[t].apply(e,n);return{success:!s.isUndefined(a)||s.isUndefined(o),value:s.isUndefined(a)?o:a}},a=function(e,t,n){var o=i(r.parent,e),a=l(o,e,t,n);if(!a.success&&r!==r.parent){var s=i(r,e);a=l(s,e,t,n)}return a.value};return a("setEngineEventTrigger",[e]),{getName:function(e){return a("getName",[e.getLoParams()],null)},getVersion:function(e){return a("getVersion",[e.getLoParams()],null)},submitLo:function(e){a("submit",[e.getSolvingData(!0),e.getLoParams()])},initializeLo:function(e,t){a("init",[e.getLoParams(),t])},saveLo:function(e,t){a("save",[e,t.getLoParams()])},restoreLo:function(e){return a("restore",[e.getLoParams()],t.when())},tryAgainLo:function(e){return a("tryAgain",[e.getLoParams()])},shareLo:function(e){a("share",[e.getLoParams()])},error:function(e,t){a("error",[t,e.getLoParams()])},canTryAgainLo:function(e){return a("getParam",["canTryAgain",e.getLoParams()],!0)},canShowAnswers:function(e){return a("getParam",["canShowAnswers",e.getLoParams()],!0)},showAnswersVisibleOnlyAfterValidation:function(e){return a("getParam",["showAnswersVisibleOnlyAfterValidation",e.getLoParams()],!1)},isShareable:function(e){return a("getParam",["shareable",e.getLoParams()],!1)},getProjectId:function(e){return a("getParam",["projectId",e.getLoParams()],"")},getExerciseName:function(e){return a("getParam",["exerciseName",e.getLoParams()],"")},getExerciseId:function(e){return a("getParam",["exerciseId",e.getLoParams()],"")},getExerciseVersion:function(e){return a("getParam",["exerciseVersion",e.getLoParams()],"")},getMode:function(e){return a("getParam",["mode",e.getLoParams()],"default")},getSkinId:function(e){return a("getParam",["skinId",e.getLoParams()],"")},getTranslation:function(e,t){return a("getParam",["translations_"+t,e.getLoParams()],null)},shouldShowAnimations:function(e){return a("getParam",["shouldShowAnimations",e.getLoParams()],!0)},shouldInitiallyExpandCollapse:function(e){return a("getParam",["shouldInitiallyExpandCollapse",e.getLoParams()],!1)},hasExternalAssets:function(e){return a("getParam",["hasExternalAssets",e.getLoParams()],!0)},canHandleSave:function(e){return a("getParam",["canHandleSave",e.getLoParams()],!1)},hasSavedData:function(e){return a("getParam",["hasSavedData",e.getLoParams()],!1)},shouldShowAsReport:function(e){return a("getParam",["shouldShowAsReport",e.getLoParams()],!1)},getReportType:function(e){return a("getParam",["reportType",e.getLoParams()],"teacher")},getKeyboardLanguagesList:function(e){return a("getParam",["keyboardLanguagesList",e.getLoParams()],[])},getClient:function(e){return a("getParam",["client",e.getLoParams()],"")},getRecordingsVendor:function(e){return a("getParam",["recordingsVendor",e.getLoParams()],"")},restoreReport:function(e){return a("restoreReport",[e.getLoParams()],t.when())},getTinymceDefaultConfig:function(e){return a("getParam",["tinymceDefaultConfig",e.getLoParams()],{})},getSriFlashUri:function(e){return a("getParam",["sriFlashUri",e.getLoParams()],"assets/flash/sriFlashRecorder.swf")},getUserMediaFlashUri:function(e){return a("getParam",["userMediaFlashUri",e?e.getLoParams():{}],"assets/flash/flashGetUserMedia.swf")},getAudioUriPrefix:function(e){return a("getParam",["audioUriPrefix",e.getLoParams()],"/assets/audio/")},getSharemoteUrls:function(e){return a("getParam",["sharemoteUrls",e.getLoParams()],n)},getSRIUrls:function(e){return a("getParam",["SRIUrls",e.getLoParams()],o)},disableManualSaveButtons:function(e){return a("getParam",["disableManualSaveButtons",e.getLoParams()],!1)}}}]),angular.module("atoolEngine").filter("trustUrl",["$sce",function(t){return function(e){return t.trustAsResourceUrl(e)}}]),angular.module("atoolEngine").filter("milisecondsToMinutes",[function(){var o=function(e){return("0"+e).slice(-2)};return function(e){var t="",n=Math.ceil(e/1e3);return n<0&&(n=-n,t="-"),t+Math.floor(n/60)+":"+o(n%60)}}]),angular.module("atoolEngine").filter("engineTranslate",["adapterProxy","underscore",function(r,t){var i={checkAnswers:"Check answers",showAnswers:"Show answers",hideAnswers:"Hide answers",tryAgain:"Try again",save:"Save",restore:"Restore",share:"Share",overallPoints:"Overall points:",notMarked:"This exercise is not marked",preventSubmit_notAnswered:"You have not answered all questions.",preventSubmit_sure:"Are you sure you want to submit your answers?",preventSubmit_submit:"Submit",preventSubmit_cancel:"Cancel",shouldLoadSavedData:"You started this activity, but you did not finish. Do you want to <strong>Continue</strong> this activity or <strong>Start Again</strong>?",shouldLoadSavedData_load:"Continue",shouldLoadSavedData_dismiss:"Start Again",lang_en:"English",lang_de:"German",lang_es:"Spanish",lang_fr:"French",lang_it:"Italian",lang_pl:"Polish",lang_ru:"Russian",invalid_json_version:"Invalid exercise version",instructions:"Instructions",memory_restart_game:"Zrestartuj grę",memory_new_game:"Rozpocznij nową grę",memory_win_title:"Gratulacje!",memory_win_subtitle:"Znalazłeś wszystkie kombinacje.",cengage_audio_check_message:"You need a microphone to complete this activity. To check your microphone, click Record, record your voice, and then click Stop. If you can hear your voice when you click Playback, your microphone is working.",cengage_audio_check_record:"Record",cengage_audio_check_recording_stop:"Stop",cengage_audio_check_playback:"Playback",cengage_audio_check_playbacking_stop:"Stop",cengage_segmented_wrapper_needed:"This activity should be wrapped in segmented block",cengage_segmented_feedback:"Feedback",cengage_fcwl_wordlist:"Word List",cengage_fcwl_wordlist_instruction:"Select the words to use in your flashcards.",cengage_fcwl_wordlist_selectall:"Select all",cengage_fcwl_wordlist_createflashcards:"Create Flashcards",cengage_fcwl_deck_flip:"FLIP",cengage_fcwl_deck_of:"of",cengage_fcwl_deck_flipdeck:"Flip Deck",cengage_fcwl_deck_shuffle:"Shuffle Deck",cengage_fcwl_deck_remove_warning:"Warning",cengage_fcwl_deck_remove_text:"Are you sure youʼd like to throw this card into the trash?",cengage_fcwl_deck_remove_confirm:"OK",cengage_fcwl_deck_remove_cancel:"Cancel",cengage_fcwl_deck_remove_dontshowagain:"Don't show this message again",cengage_fcwl_reset:"Reset",cengage_we_min:"min",cengage_we_minutesleft:"time left",cengage_we_welcome_start:"Start",cengage_we_model:"Model",cengage_we_write_wordcount:"Word count:",cengage_we_finish_finalwriting:"Final writing",cengage_we_finish_viewtimespent:"View Time Spent",cengage_we_finish_print:"Print",cengage_we_timespent_section:"SECTION",cengage_we_timespent_recommended:"RECOMMENDATION",cengage_we_timespent_timespent:"TIME SPENT",cengage_we_timespent_total:"Total",cengage_we_not_supported:"This activity is currently not available on tablets and phones. Please use a desktop computer to complete this activity.",cengage_od_welcome_start:"Start",cengage_od_welcome_select_avatar:"Select Image",cengage_od_welcome_name_placeholder:"Type name",cengage_od_user_record:"Record",cengage_od_user_record_stop:"Stop",cengage_od_user_playback:"Playback",cengage_od_user_playback_stop:"Stop",cengage_od_final_playback:"Playback",cengage_od_final_playback_stop:"Stop",cengage_od_submitted:"Submitted!",cengage_od_model_audionotavailable:"Audio is not available, please record answer first",cengage_sp_record:"Record",cengage_sp_recording_stop:"Stop",cengage_sp_playback:"Playback",cengage_sp_playbacking_stop:"Stop",cengage_sp_listen:"Listen",cengage_sp_listening_stop:"Stop",cengage_dia_select_part:"Select the part you want to record.",cengage_dia_redo:"Redo",cengage_dia_listening_play:"Play",cengage_dia_listening_stop:"Stop",cengage_dia_next:"Next",cengage_dia_start:"Start",cengage_dia_record:"Record",cengage_dia_recording_stop:"Stop",cengage_dia_playback:"Playback",cengage_dia_playbacking_stop:"Stop",cengage_dia_submitted:"Submitted!",cengage_dia_redo_popup_text:"Are you sure you want to start again? Your recording will be deleted.",cengage_dia_redo_popup_cancel:"Cancel",cengage_dia_redo_popup_ok:"OK",cengage_mat_drag_here:"Place items here",cengage_sort_drag_here:"Place items here",cengage_cor_original_text:"Show original text",cengage_cor_reset_title:"Warning",cengage_cor_reset_text:"Are you sure you want to reset?",cengage_cor_reset_ok:"OK",cengage_cor_edit_ok:"OK",cengage_cor_reset_cancel:"Cancel",cengage_ess_wordcount:"Word count:",cengage_view_feedback_button:"View Feedback",cengage_check_button_with_badge:'Check <span class="badge">{{maxChecks}}</span>',cengage_check_button:"Check",cengage_skip_button:"Skip",cengage_qs_team:"Team",cengage_qs_pts:"pts",cengage_qs_points:"points",cengage_qs_team_wins:"Team {{name}} wins!",cengage_qs_draw:"It is a draw!",cengage_qs_congratulations:"CONGRATULATIONS!",cengage_cpt_check_answers:"Check All",cengage_cpt_show_answers:"Show All",cengage_cpt_hide_answers:"Hide All",cengage_cpt_reset:"Reset",cengage_cpt_reset_game:"Restart game",cengage_cpt_new_game:"New game",cengage_con_finish_text:"Well done!",cengage_ttt_attempt_remaining:"1 Attempt Remaining",cengage_ttt_team:"Team",cengage_ttt_the_end:"End of the game",cengage_ttt_draw:"It is a draw!",cengage_ttt_team_wins:"Team {{name}} wins!",cengage_sri_mc_record:"Record",cengage_sri_mc_recording_stop:"Stop",cengage_sri_mc_playback:"Playback",cengage_sri_mc_playbacking_stop:"Stop",cengage_sri_mc_warning_speechTooLoudMessage:"You are speaking too loudly. Please record again.",cengage_sri_mc_warning_speechTooSoftMessage:"You are speaking too softly. Please record again.",cengage_sri_mc_warning_tooMuchNoiseInBackground:"You are too far from the microphone or there is too much noise in the background. Please record again.",cengage_sri_mc_warning_speechTruncatedAtStartMessage:"Recorded audio is not usable. Please record again.",cengage_sri_mc_warning_speechTruncatedAtEndMessage:"Recorded audio is not usable. Click STOP when you are finished recording. Please record again.",cengage_sri_mc_warning_speechTruncatedAtBothEndsMessage:"Recorded audio is not usable. Click STOP when you are finished recording. Please record again.",cengage_sri_mc_warning_lowConfidenceMessage:"Recorded audio is not usable and does not match what you are supposed to record. Please record again.",cengage_sri_mc_warning_answerDoesNotMatchMessage:"Recorded audio is not usable. Please record again.",cengage_ttt_label_sc_dropodown:"Fill-in-the-blank Drop Down",cengage_ttt_label_gf_dnd:"Fill-in-the-blank Drag and Drop",cengage_ttt_label_gf_fillin:"Fill-in-the-blank Type In",cengage_ttt_label_sc:"Multiple Choice Single Answer",cengage_ttt_label_mc:"Multiple Choice Multiple Answer",cengage_ttt_label_mat:"Matching",cengage_ttt_label_cor:"Sentence Correction",cengage_ttt_label_cat:"Sorting",cengage_ttt_label_ord_sentenceScramble:"Sentence Scramble",cengage_ttt_label_ord_sequencing:"Sequencing",cengage_ttt_label_ord:"Ordering",cengage_ttt_label_wr:"Free Writing",cengage_ttt_label_cw:"Crossword",cengage_ttt_label_ml:"Missing Letters",cengage_ttt_label_fc:"Flashcards",cengage_ttt_label_ws:"Word Search",cengage_ttt_label_nglSP:"Speaking",cengage_ttt_label_nglDIA:"Dialogue",cengage_ttt_label_nglCOR:"Sentence Correction",cengage_ttt_label_nglHL:"Hilighting",cengage_ttt_label_nglESS:"Essay",cengage_ttt_label_nglSI:"Sentence Insertion",cengage_ttt_label_sriMC:"SRI Multiple Choice",recording_record:"Record",recording_recording_stop:"Stop",recording_playback:"Playback",recording_playbacking_stop:"Stop",recording_listen:"Listen",recording_listening_stop:"Stop",recorder_unable_to_connect:"Unable to connect to recording server",recorder_mic_not_allowed:"Access to microphone denied",recorder_mic_not_found:"Microphone is not connected",recorder_not_supported:"Your browser does not support audio recording. Upgrade your browser or install flash player.",recorder_default_error:"An error occurred while accessing microphone",recorder_error_close:"Close"},l={checkAnswers:"Submit"},c=function(e){return t.isNull(e)||t.isUndefined(e)},d=function(e,n){var t=/{{(.+?)}}/g;return e.replace(t,function(e,t){return n[t]})};return function(e,t,n){var o=r.getTranslation(t,e),a=[];t.getInternals().hasSegmented&&(a=l);var s="";return s=c(o)?c(a)||c(a[e])?c(i[e])?e:i[e]:a[e]:o,d(s,n||{})}}]),angular.module("atoolEngine").factory("StickTopManager",["underscore","rfc4122","$window","engineBrowserDetector","$rootScope","$timeout",function(d,n,p,e,t,o){var a=function(e){this.stickerGroups={},this.loCtrl=e,this.initializeCallbacks()},s=function(e){var t="sticktotop-container-id";return e.attr(t)||e.attr(t,n.v4()),e.attr(t)};return angular.extend(a.prototype,{initializeCallbacks:function(){angular.element(p).on("resize",this.recalculateAll.bind(this)),t.$on("engine-draggable-element-dropped",this.recalculateAll.bind(this));var n=this;this.loCtrl.getLoState().addObserver(function(e,t){o(function(){n.recalculateAll()})})},isSupported:function(){return!e.isIE()&&!this.loCtrl.hasMultipleContentSlides()},sortAndGroupStickers:function(e){return e.sort(function(e,t){var n=e.getOffset().top,o=t.getOffset().top;return n<o?-1:o<n?1:0}),d.chain(e).groupBy(function(e){return e.getPriority()}).map(function(e,t){return{priority:+t,stickers:e}}).sortBy("priority").value()},hasSticker:function(t){return d.any(this.stickerGroups,function(e){return d.contains(e.stickers,t)})},registerSticker:function(e){if(this.isSupported()){this.hasSticker(e)&&this.deregisterSticker(e);var t=e.getScrollableContainer(),n=e.getScrollableContainerElement(),o=e.getPositioningContainerElement(),a=s(n);d.has(this.stickerGroups,a)||(this.stickerGroups[a]={scrollableContainer:t,containerElement:n,positioningContainerElement:o,callback:this.recalculate.bind(this,a),stickers:[]},t.on("scroll",this.stickerGroups[a].callback)),this.stickerGroups[a].stickers.push(e),this.stickerGroups[a].groupedStickers=this.sortAndGroupStickers(this.stickerGroups[a].stickers)}},deregisterSticker:function(t){this.isSupported()&&(d.each(this.stickerGroups,function(e){e.stickers=d.without(e.stickers,t),e.groupedStickers=this.sortAndGroupStickers(e.stickers),0==e.stickers.length&&e.scrollableContainer.off("scroll",e.callback)}.bind(this)),this.stickerGroups=d.pick(this.stickerGroups,function(e){return 0<e.stickers.length}))},convertPriorityToZIndex:function(e){var n=e;return d.each(this.stickerGroups,function(e){d.each(e.stickers,function(e,t){e.getPriority()>n&&(n=e.getPriority())})}),n-e+2e3},recalculateAll:function(){d.each(this.stickerGroups,function(e,t){d.each(e.stickers,function(e){e.enterStateDefault()}),this.recalculate(t)}.bind(this))},recalculate:function(e){var t=this.stickerGroups[e],a=[],n=[],o=[],s=p.getComputedStyle(t.containerElement[0]),r=(parseFloat(s.getPropertyValue("padding-top")),0);d.each(t.groupedStickers,function(e){var n=null,o=-Number.MAX_VALUE;(d.each(e.stickers,function(e){var t=e.getTopOffsetToScrollable();t<r&&o<t&&(n=e,o=t)}),n)&&(d.every(a,function(e){return e.getTopOffsetToScrollable()<n.getTopOffsetToScrollable()})&&(r+=n.getOriginalHeight(),a.push(n)))});var i=null;if(d.each(t.stickers,function(e){var t=e.getTopOffsetToScrollable();!i&&!d.contains(a,e)&&0<t&&t<=r&&(i=e)}),i){var l=i.getPosition().top;d.each(a.slice().reverse(),function(e){e.getPriority()>=i.getPriority()&&(n.push(e),e.enterStateScrollingOut(l,this.convertPriorityToZIndex(e.getPriority())),l-=e.getOriginalHeight())}.bind(this))}a=d.difference(a,n),o=d.difference(t.stickers,a,n);var c=0;d.each(a,function(e){e.enterStateSticked(c,this.convertPriorityToZIndex(e.getPriority())),c+=e.getOriginalHeight()}.bind(this)),d.each(o,function(e){e.enterStateDefault()}.bind(this))}}),a}]),angular.module("atoolEngine").factory("SaveManager",["localStorageService","underscore","$interval","adapterProxy",function(o,a,e,s){var t=function(e,t,n){var o=this;this.config=e,this.tasks=t,this.periodicSavePromise=null,this.loCtrl=n,this.dataCollector=n.getDataCollector(),this.enableLocalStorageFallback=!s.canHandleSave(this.dataCollector),this.savingEnabled=!0,n.getLoState().addObserver(function(e,t){"report"===t?o.disableSaving():"solving"===t&&o.enableSaving()})},n=3e4,r=function(e){return"atool-engine."+e.loId+"-"+e.loVersion},i=function(e){return!(a.isUndefined(e.loId)||a.isUndefined(e.loVersion))},l=function(e){return a.contains(o.keys(),r(e))},c=function(e){return a.object(a.map(e,function(e){return[e.attrs.id,e.saveData()]}))},d=function(t,e,n){a.each(e,function(e){a.isUndefined(t[e.attrs.id])||e.restoreData(t[e.attrs.id],n)})},p=function(e,t){if(i(t)){var n=JSON.parse(JSON.stringify(e));o.set(r(t),n)}},u=function(e){if(i(e)&&l(e))return o.get(r(e))};return angular.extend(t.prototype,{canHandleManualSave:function(){return"auto"!==this.config.saveType&&i(this.config)},canHandleManualRestore:function(){return this.canHandleManualSave()&&l(this.config)||s.hasSavedData(this.dataCollector)},canHandleAutoSave:function(){return"auto"===this.config.saveType},canHandleAutoRestore:function(){return this.canHandleAutoSave()&&s.hasSavedData(this.dataCollector)},save:function(){if(this.loCtrl.getCpt().isEnabled())return!1;if(!this.savingEnabled)return!1;var e=c(this.tasks);return this.enableLocalStorageFallback&&p(e,this.config),s.saveLo(e,this.dataCollector),!0},restore:function(t){var n=this;return s.restoreLo(this.dataCollector).then(function(e){n.enableLocalStorageFallback&&(e=u(n.config)),n.customRestore(e,t)})},customRestore:function(e,t){e&&d(e,this.tasks,t)},saveOnEvent:function(){"auto"===this.config.saveType&&(null!==this.periodicSavePromise&&(this.clearPeriodicSave(),this.periodicSavePromise=e(this.save.bind(this),n)),this.save())},subscribeForPeriodicSave:function(){null===this.periodicSavePromise&&"auto"===this.config.saveType&&(this.periodicSavePromise=e(this.save.bind(this),n))},enableSaving:function(){this.savingEnabled=!0},disableSaving:function(){this.savingEnabled=!1},clearPeriodicSave:function(){null!==this.periodicSavePromise&&(e.cancel(this.periodicSavePromise),this.periodicSavePromise=null)}}),t}]),angular.module("atoolEngine").factory("LOState",["underscore",function(e){var t=function(){this.currentState="solving",this.previousState="",this.observer=[]};return angular.extend(t.prototype,{isSolving:function(){return"solving"===this.currentState},isReport:function(){return"report"===this.currentState},isShowAnswer:function(){return"showAnswer"===this.currentState},setStateSolving:function(){this.previousState=this.currentState,this.currentState="solving",this.notifyObservers(this.previousState,this.currentState)},setStateReport:function(){this.previousState=this.currentState,this.currentState="report",this.notifyObservers(this.previousState,this.currentState)},setStateShowAnswer:function(){this.previousState=this.currentState,this.currentState="showAnswer",this.notifyObservers(this.previousState,this.currentState)},setPreviousState:function(){var e=this.previousState;this.previousState=this.currentState,this.currentState=e,this.notifyObservers(this.previousState,this.currentState)},previous:function(){return this.previousState},addObserver:function(e,t){this.observer.push(e),t&&e(this.previousState,this.currentState)},notifyObservers:function(t,n){e.each(this.observer,function(e){e(t,n)})}}),t}]),angular.module("atoolEngine").factory("HtmlAudioPlayer",["$document","adapterProxy","underscore",function(a,s,r){var e=function(e,t,n){var o=this;this.sources=e,this.dataCollector=t,n&&r.has(n,"setCrossOrigin")?this.setCrossOrigin=n.setCrossOrigin:this.setCrossOrigin=s.hasExternalAssets(this.dataCollector),this.audio=angular.element("<audio style=\"display: none;\" class='html-audio-player' />"),this.audio.appendTo(a[0].body),n&&r.has(n,"onEnded")&&this.audio.on("ended",function(){n.onEnded()}),this.setCrossOrigin&&(this.audio[0].crossOrigin="anonymous"),r.each(this.sources,function(e){var t=document.createElement("source");t.type=e.type,t.src=e.url,o.audio[0].appendChild(t)}),this.audio[0].load()};return angular.extend(e.prototype,{play:function(){this.audio[0].play()},stop:function(){this.audio[0].pause(),this.audio[0].currentTime=0},destroy:function(){this.stop(),this.audio.remove()}}),e}]),angular.module("atoolEngine").factory("GapState",["underscore",function(e){var t=function(e,t){this.isExample=e,this.loState=t,this.overriddenState=null};return angular.extend(t.prototype,{overrideStateSetSolving:function(){this.overriddenState="solving"},overrideStateSetReport:function(){this.overriddenState="report"},overrideStateSetShowAnswer:function(){this.overriddenState="showAnswer"},clearOverriddenState:function(){this.overriddenState=null},shouldBeRenderedAsSolving:function(){return!this.isExample&&(null!==this.overriddenState?"solving"===this.overriddenState:this.loState.isSolving())},shouldBeRenderedAsShowAnswer:function(){return!this.isExample&&(null!==this.overriddenState?"showAnswer"===this.overriddenState:this.loState.isShowAnswer())},shouldBeRenderedAsReport:function(){return!this.isExample&&(null!==this.overriddenState?"report"===this.overriddenState:this.loState.isReport())}}),t}]),angular.module("atoolEngine").factory("Eyeball",["underscore",function(n){var e=function(e,t){this.states={},this.gapState=e,this.loState=t,this.loState.addObserver(function(e,t){n.each(this.states,function(e){e.mode="solving",e.answersToCheckCounter=0,e.answersToShowCounter=0})}.bind(this))};return angular.extend(e.prototype,{addState:function(e,t){this.states[e]={mode:"solving",isMissing:t,answersToShowCount:1,answersToShowCounter:0,answersToCheckCount:1,answersToCheckCounter:0}},fire:function(e){"showAnswer"===this.states[e].mode||"report"===this.states[e].mode?(this.resetAnswersToShowCounter(e),this.resetAnswersToCheckCounter(e),this.states[e].mode="solving"):"solving"!==this.states[e].mode&&"partialShowAnswer"!==this.states[e].mode||!this.states[e].isMissing()?"solving"!==this.states[e].mode&&"partialReport"!==this.states[e].mode||this.states[e].isMissing()||(this.increaseAnswersToCheckCounter(e),this.states[e].answersToCheckCounter<this.states[e].answersToCheckCount?this.states[e].mode="partialReport":this.states[e].mode="report"):(this.increaseAnswersToShowCounter(e),this.states[e].answersToShowCounter<this.states[e].answersToShowCount?this.states[e].mode="partialShowAnswer":this.states[e].mode="showAnswer")},getState:function(e){return this.states[e]},getClasses:function(e){return{"eyeball-before-showAnswer":"solving"===this.states[e].mode&&this.states[e].isMissing(),"eyeball-showAnswer":"showAnswer"===this.states[e].mode||"partialShowAnswer"===this.states[e].mode,"eyeball-before-report":"solving"===this.states[e].mode&&!this.states[e].isMissing(),"eyeball-report":"report"===this.states[e].mode||"partialReport"===this.states[e].mode}},setMode:function(e,t){this.states[e].mode=t},getMode:function(e){return this.states[e].mode},setAnswersToShowCount:function(e,t){this.states[e].answersToShowCount=t},getAnswersToCheckCount:function(e){return this.states[e].answersToCheckCount},setAnswersToCheckCount:function(e,t){this.states[e].answersToCheckCount=t,"showAnswer"===this.states[e].mode||"partialShowAnswer"===this.states[e].mode?0<this.states[e].answersToCheckCount&&(this.states[e].mode="solving"):"report"!==this.states[e].mode&&"partialReport"!==this.states[e].mode||(this.states[e].answersToCheckCounter===this.states[e].answersToCheckCount?this.states[e].mode="report":this.states[e].mode="partialReport")},resetAnswersToShowCounter:function(e){this.states[e].answersToShowCounter=0},resetAnswersToCheckCounter:function(e){this.states[e].answersToCheckCounter=0},getAnswersToShowCounter:function(e){return this.states[e].answersToShowCounter},getAnswersToCheckCounter:function(e){return this.states[e].answersToCheckCounter},increaseAnswersToShowCounter:function(e){this.states[e].answersToShowCounter++},increaseAnswersToCheckCounter:function(e){this.states[e].answersToCheckCounter++},shouldBeRenderedAsSolving:function(e){return"solving"===this.states[e].mode},shouldBeRenderedAsShowAnswer:function(e){return"showAnswer"===this.states[e].mode||"partialShowAnswer"===this.states[e].mode},shouldBeRenderedAsReport:function(e){return"report"===this.states[e].mode||"partialReport"===this.states[e].mode}}),e}]),angular.module("atoolEngine").factory("EngineRecorder",["rfc4122","$window","$q","$timeout","Modernizr","$interval","audioContextManager","$rootScope","underscore","socketIO","recordingBackendWebsocket",function(e,l,c,d,p,u,g,n,t,o,a){var s=function(){var t=this;this.newGetUserMediaAPISupported=l.navigator.mediaDevices&&l.navigator.mediaDevices.getUserMedia,this.oldGetUserMediaAPISupported=p.getusermedia,this.anyGetUserMediaSupported=this.newGetUserMediaAPISupported||this.oldGetUserMediaAPISupported,this.supported=this.anyGetUserMediaSupported&&g.audioContextSupported("recording"),p.on("flash",function(e){!t.anyGetUserMediaSupported&&e&&(t.flashGetUserMediaAPISupported=!0,n.$evalAsync(function(){t.supported=g.audioContextSupported("recording")}))}),this.connected=!1,this.recording=!1,this.recordingMaxTimePromise=null,this.recordingTimerPromise=null,this.chunkIndex=0,this.currentTime=0,this.currentTimePercent=0,this.recordingsMap={},this.connect()};return angular.extend(s.prototype,{send:function(e,t){this.socket&&this.connected&&this.socket.emit(e,t)},connect:function(){var e=this;this.socket=o(a),this.socket.on("connect",function(){e.connected=!0,d(function(){}),console.log("Audio websocket connected!")}),this.socket.on("disconnect",function(){e.connected=!1,d(function(){}),console.log("Audio websocket disconnected!")})},sendAudioData:function(e,t,n){this.send("addRecordingData",{recordingUuid:e,chunkIndex:t,data:n.buffer.slice(0)})},record:function(n,o,a){(this.recordingsMap[o]=a).maxTime||(a.maxTime=999);var s=c.defer(),r=this;if(r.currentTime=0,r.currentTimePercent=0,!r.supported&&a.onError&&a.onError("recorder_not_supported"),r.supported&&r.connected){r.audioContext=g.acquireAudioContext("recording"),r.audioContext.resume&&r.audioContext.resume();var e=function(e){r.recording=!0;var t=new Date;if(r.chunkIndex=0,!r.audioContext)return!1;r.socket.on("urlsResponse",function(e){r.recordingsMap[o]&&r.recordingsMap[o].onUrlResponse&&(r.recordingsMap[o].onUrlResponse(e.urls),delete r.recordingsMap[o])}),r.send("startRecording",{loId:n,recordingUuid:o,vendor:a.vendor,sampleRate:r.audioContext.sampleRate}),r.recordingMaxTimePromise=d(function(){r.stop(o)},1e3*a.maxTime),r.recordingTimerPromise=u(function(){var e=new Date;r.currentTime=Math.min(a.maxTime,Math.floor((e-t)/1e3)),r.currentTimePercent=Math.floor(r.currentTime/a.maxTime*100)},200),r.track=e.getTracks()[0],r.source=r.audioContext.createMediaStreamSource(e),r.scriptNode=r.audioContext.createScriptProcessor(4096,1,1),r.scriptNode.onaudioprocess=function(e){var t=e.inputBuffer.getChannelData(0);r.recording&&r.sendAudioData(o,r.chunkIndex++,t)},r.source.connect(r.scriptNode),r.scriptNode.connect(r.audioContext.destination),s.resolve()},t=function(e){console.log(e);var t="recorder_default_error";switch(e.name){case"PermissionDeniedError":case"NotAllowedError":t="recorder_mic_not_allowed";break;case"NotFoundError":t="recorder_mic_not_found"}a.onError&&a.onError(t),g.releaseAudioContext(),s.reject({message:"engine_recorder_cannot_access"})},i={audio:!0};this.newGetUserMediaAPISupported?l.navigator.mediaDevices.getUserMedia(i).then(e).catch(t):this.oldGetUserMediaAPISupported?p.prefixed("getUserMedia",l.navigator)(i,e,t):this.flashGetUserMediaAPISupported&&l.navigator.flashGetUserMedia(i,e,t)}else s.reject({message:"engine_recorder_record_not_supported"});return s.promise},stop:function(e){this.recording=!1,this.source.disconnect(),this.scriptNode.disconnect(),this.track.stop(),this.source=null,this.scriptNode=null,this.track=null,this.send("endRecording",{recordingUuid:e}),this.recordingMaxTimePromise&&d.cancel(this.recordingMaxTimePromise),this.recordingTimerPromise&&u.cancel(this.recordingTimerPromise),this.currentTime=0,this.currentTimePercent=0,g.releaseAudioContext(),this.recordingsMap[e]&&this.recordingsMap[e].onStop&&this.recordingsMap[e].onStop()}}),s}]),angular.module("atoolEngine").factory("DataCollector",["underscore","$window","rfc4122","$cookies","$location","dataVersion","engineVersion","compatibleSchemaVersions","adapterProxy","objectHelper",function(t,e,n,o,a,s,r,i,l,c){var d=function(e){this.loParams={},this.solvingData=[],this.internals={},this.getSessionId=function(){var e=o.atoolEngineSessionId;return e||(o.atoolEngineSessionId=e=n.v4()),e},this.JsonLOdescription=e,this.initializeDataCollector()};return angular.extend(d.prototype,{initializeDataCollector:function(){t.isUndefined(this.JsonLOdescription)||t.isUndefined(this.JsonLOdescription.meta)||(this.loParams.loId=this.JsonLOdescription.meta.id,this.loParams.loVersion=this.JsonLOdescription.meta.version,this.loParams.loTags=this.JsonLOdescription.meta.tags,this.loParams.loCourse=this.JsonLOdescription.meta.course,this.loParams.loName=this.JsonLOdescription.meta.name,this.loParams.threshold=this.JsonLOdescription.meta.threshold,this.loParams.markable=this.JsonLOdescription.meta.markable,this.loParams.organisation=this.JsonLOdescription.meta.organisation,this.loParams.schemaVersion=this.JsonLOdescription.meta.schemaVersion||1,this.loParams.objectives=this.JsonLOdescription.meta.objectives||null),this.internals.hasSegmented=!t.isUndefined(this.JsonLOdescription)&&c.hasPair(this.JsonLOdescription,["type"],["segmented"],!0)},startDataCollecting:function(){this.loParams.startTime=t.now(),this.loParams.userAgent=e.navigator.userAgent,this.loParams.host=a.host(),this.loParams.session=this.getSessionId(),this.loParams.adapterName=l.getName(this),this.loParams.adapterVersion=l.getVersion(this),this.loParams.timestamp=new Date,this.loParams.dataVersion=s,this.loParams.engineVersion=r,this.loParams.compatibleSchemaVersions=i,this.loParams.client=l.getClient(this)},finishDataCollecting:function(){this.loParams.endTime=t.now(),this.loParams.elapsedTime=this.loParams.endTime-this.loParams.startTime,this.loParams.timestamp=new Date},addSolvingData:function(e){this.solvingData=this.solvingData.concat(e)},clear:function(){this.loParams={},this.solvingData=[],this.internals={},this.initializeDataCollector()},getLoParams:function(){return this.loParams},getSolvingData:function(e){return e?this.solvingData:t.map(this.solvingData,function(e){return t.omit(e,["saveData"])})},getInternals:function(){return this.internals}}),d}]),angular.module("atoolEngine").factory("Cpt",["underscore",function(e){var t=function(){this.gap=null,this.enabled=!1};return angular.extend(t.prototype,{enable:function(){this.enabled=!0},registerGap:function(e){this.gap=e},clearGap:function(){this.gap=null},renderGapAsReport:function(){this.gap&&this.gap.gapState.overrideStateSetReport()},renderGapAsShowAnswer:function(){this.gap&&this.gap.gapState.overrideStateSetShowAnswer()},isEnabled:function(){return this.enabled},getGapState:function(){return this.gap?this.gap.globalState:null},shouldBeRenderedAsSolving:function(){return!!this.gap&&this.gap.gapState.shouldBeRenderedAsSolving()}}),t}]),angular.module("atoolEngine").factory("BreadcrumbsVisibility",["underscore","$timeout",function(u,f){var e=function(e,t){this.scope=e,this.isPhone=t};return angular.extend(e.prototype,{calculateInitialWidth:function(){return this.scope.menuElement.find(".breadcrumbs").innerWidth()},makeAllBreadcrumbsVisible:function(){u.each(this.scope.options.blocks,function(e){e.visible=!0})},getScreenWidth:function(e){var t=this.scope.menuElement.find(".breadcrumbs-ghost");return e===this.scope.currentScreenIndex&&(t=this.scope.menuElement.find(".breadcrumbs-ghost-active")),t.find(".breadcrumbs-list-item").eq(e).outerWidth(!0)},cleanScreensForBreadcrumbs:function(){u.each(this.scope.options.blocks,function(e){e.visible=!1}),u.each(this.scope.menuElement.find(".breadcrumbs-list-item-screen"),function(e){angular.element(e).css("width",""),angular.element(e).css("padding-right","")})},cleanArrowAndEllipsis:function(e){var t=this;t.scope.shouldShowRightEllipsis=!1,t.scope.shouldShowLeftEllipsis=!1,f(function(){t.scope.menuElement.find(".breadcrumbs-list-item-arrow").css("position",e)})},shouldRecalculateBreadcrumbs:function(){if(!this.isPhone)return!1;var e=this.calculateInitialWidth();if(0===e)return!1;var t=0;t+=this.scope.menuElement.find(".breadcrumbs-ghost").find(".breadcrumbs-list-item-arrow").outerWidth(!0);for(var n=0;n<this.scope.options.blocks.length;n++)t+=this.getScreenWidth(n);return!(t<=e)},applyViewChanges:function(e,t,n,o,r,a,s){var i=this;e&&i.scope.menuElement.find(".breadcrumbs-list-item-screen:visible").last().css("width",e+"px");var l=i.scope.menuElement.find(".breadcrumbs-list-item-ellipsis-right"),c=t-n;i.scope.shouldShowNextButton()&&(c-=s),i.scope.shouldShowLeftEllipsis&&(c-=a),0<o&&!i.scope.shouldShowRightEllipsis&&(c-=o),l.css("left",c+"px");var d=c+n;if(i.scope.menuElement.find(".breadcrumbs-list-item-arrow").css("left",d+"px"),r){var p=i.scope.menuElement.find(".breadcrumbs-list-item-screen:visible");u.each(p,function(e,t){var n=angular.element(e),o=Math.floor(r/(p.length-t));r-=o,n.css("padding-right","");var a=n.css("padding-right"),s=parseInt(a.substring(0,a.length-2));n.css("padding-right",s+o+"px")})}i.scope.menuElement.find(".breadcrumbs-list-item-ellipsis-left").css("left",-a+"px"),i.scope.menuElement.find(".breadcrumbs").css("left",a+"px")},recalculate:function(){var e=this;if(!this.shouldRecalculateBreadcrumbs())return e.makeAllBreadcrumbsVisible(),e.cleanArrowAndEllipsis("relative"),!1;var t=e.scope.menuElement.find(".breadcrumbs-ghost"),n=t.find(".breadcrumbs-list-item-ellipsis").outerWidth(!0),o=t.find(".breadcrumbs-list-item-arrow").outerWidth(!0),a=0,s=0,r=!0,i=!1,l=30;e.cleanArrowAndEllipsis("absolute"),e.cleanScreensForBreadcrumbs();var c=e.calculateInitialWidth(),d=c;0<e.scope.currentScreenIndex&&(d-=n,e.scope.shouldShowLeftEllipsis=!0),e.scope.shouldShowNextButton()&&(d-=o),e.scope.currentScreen.visible=!0,d-=e.getScreenWidth(e.scope.currentScreenIndex);var p=e.scope.currentScreenIndex===e.scope.options.blocks.length-1;if((!p&&d<n||d<0)&&(a=e.getScreenWidth(e.scope.currentScreenIndex)+d,p||(a-=n)),a)r=!1;else for(var u=e.scope.currentScreenIndex+1;u<e.scope.options.blocks.length;u++){var g=e.getScreenWidth(u);if(d-=g,e.scope.options.blocks[u].visible=!0,u===e.scope.options.blocks.length-1&&0<=d)r=!0;else if(d<=n&&u<e.scope.options.blocks.length-1||d<0&&u===e.scope.options.blocks.length-1){g-(a=Math.min(g+d,g,g+d-n)),r=!1,a<l&&(e.scope.options.blocks[u].visible=!1,s=a,a=0);break}}r||(e.scope.shouldShowRightEllipsis=!0);for(u=e.scope.currentScreenIndex-1;0<=u;u--){g=e.getScreenWidth(u);if(!(r&&0<d))break;d-=g,i=e.scope.options.blocks[u].visible=!0}var m=(e.scope.shouldShowLeftEllipsis?n:0)+(i&&d<0?d:0);f(function(){e.applyViewChanges(a,c,n,d,s,m,o)})}}),e}]),angular.module("atoolEngine").factory("AudioSpectrumDrawer",["$window","Modernizr",function(r,i){var e=function(e,t){this.analyser=e,this.canvas=t[0],this.freqs=new Uint8Array(this.analyser.frequencyBinCount),this.times=new Uint8Array(this.analyser.frequencyBinCount),this.drawing=!1,this.supported=i.requestanimationframe},l=function(){if(this.drawing){this.analyser.getByteFrequencyData(this.freqs),this.analyser.getByteTimeDomainData(this.times);Math.floor(1/this.freqs.length);var e=this.canvas.getContext("2d"),t=this.canvas.width,n=this.canvas.height;e.fillStyle="white",e.fillRect(0,0,t,n);for(var o=0;o<this.analyser.frequencyBinCount;o++){var a=n-n*(this.times[o]/256)-1,s=t/this.analyser.frequencyBinCount;e.fillStyle="black",e.fillRect(o*s,a,1,2)}i.prefixed("requestAnimationFrame",r)(l.bind(this))}};return angular.extend(e.prototype,{start:function(){this.drawing=!0,this.supported&&i.prefixed("requestAnimationFrame",r)(l.bind(this))},stop:function(){this.drawing=!1;var e=this.canvas.getContext("2d");e.fillStyle="white",e.fillRect(0,0,this.canvas.width,this.canvas.height)}}),e}]),angular.module("atoolEngine").factory("AudioPlayer",["AudioSpectrumDrawer","$window","adapterProxy","$rootScope","underscore","audioContextManager",function(t,e,a,n,s,r){var o=function(e,t,n,o){this.url=e,this.canvas=t,this.dataCollector=n,this.playing=!1,this.shouldDrawSpectrum=!!this.canvas&&o&&o.shouldDrawSpectrum,o&&s.has(o,"setCrossOrigin")?this.setCrossOrigin=o.setCrossOrigin:this.setCrossOrigin=a.hasExternalAssets(this.dataCollector),this.audio=new Audio(this.url),this.setCrossOrigin&&(this.audio.crossOrigin="anonymous"),this.audio.load(),this.audioContext=r.acquireAudioContext("playing"),this.audioContext&&(this.source=this.audioContext.createMediaElementSource(this.audio)),r.releaseAudioContext()};return angular.extend(o.prototype,{play:function(e){this.audioContext=r.acquireAudioContext("playing"),this.audioContext&&(this.source.connect(this.audioContext.destination),this.shouldDrawSpectrum&&(this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=2048,this.spectrumAnalyser=new t(this.analyser,this.canvas),this.source.connect(this.analyser),this.spectrumAnalyser.start())),this.finishCallback=e,this.audio.addEventListener("ended",function(){this.clean(!0)}.bind(this)),this.audio.play()},stop:function(){this.audio.pause(),this.clean(!1)},clean:function(e){r.releaseAudioContext(),this.source&&this.source.disconnect(),this.shouldDrawSpectrum&&this.spectrumAnalyser.stop(),this.finishCallback&&(e?n.$apply(this.finishCallback):this.finishCallback())},destroy:function(e){this.clean(e)}}),o}]),angular.module("atoolEngine").factory("AnswerFilter",["underscore",function(t){var e=function(e){this.config=e,this.filters=[this.filterSpaces,this.filterApostrophe,this.filterHyphen,this.filterSpaceAfterApostrophe,this.filterSpaceBeforePunctuationSigns,this.filterSpaceAfterComma,this.filterTimeSuffix,this.filterSpaceBeforeAndAfterHyphen],1!=e.caseSensitive&&this.filters.push(this.filterCase),1!=e.punctuationSensitive&&this.filters.push(this.filterPunctuation)};return angular.extend(e.prototype,{filter:function(e){return t.reduce(this.filters,function(e,t){return t(e)},e)},filterCase:function(e){return e.toLowerCase()},filterPunctuation:function(e){return e.replace(/\,|\.|\?|\!/g,"")},filterSpaces:function(e){return e.replace(/\s+/g," ").trim()},filterApostrophe:function(e){return e.replace(/ʻ|ʾ|ʿ|ʽ|ʼ|ˋ|`|'|‘|’/g,"'")},filterHyphen:function(e){return e.replace(/–|-/g,"-")},filterSpaceAfterApostrophe:function(e){return e.replace(/'\s(ve|s|d|m|re|ll|t)([^a-zA-Z0-9]*)/g,"'$1$2")},filterSpaceBeforePunctuationSigns:function(e){return e.replace(/\s([.,!?'])/g,"$1")},filterSpaceAfterComma:function(e){return e.replace(/([^\s]{1}),([^\s]{1})/g,"$1, $2")},filterTimeSuffix:function(e){return e.replace(/(\d|^)(am|a\.m\.|pm|p\.m\.)(?=\s|$)/gi,"$1 $2").replace(/(\s)((am)|(a)\.(m)\.)(?=\s|$)/gi," $3$4$5").replace(/(\s)((pm)|(p)\.(m)\.)(?=\s|$)/gi," $3$4$5")},filterSpaceBeforeAndAfterHyphen:function(e){return e.replace(/([^\s\-]+?)\s?-\s?([^\s\-]+?)/g,"$1 - $2")},filterUrlParams:function(e){return e.replace(/(.*)(\?.*)/gi,"$1")}}),e}]),angular.module("atoolEngine").factory("AnimateSupervisor",["animateHelper","underscore",function(o,a){var e=function(e){this.animationsDeferred=e&&e.animationsDeferred,this.blocks={},this.animations=[]};return angular.extend(e.prototype,{registerBlock:function(t,e){this.blocks[t]=e;var n=this;angular.forEach(this.animations,function(e){e.id==t&&o.animateOnClick(n.blocks[e.id],e.block,e.params)})},registerAnimation:function(e,t,n){a.isUndefined(this.blocks[e])?this.animations.push({id:e,block:t,params:n}):o.animateOnClick(this.blocks[e],t,n)}}),e}]),angular.module("atoolEngine").factory("SRIRecorder",["SRISpeechClient",function(t){var e=function(){};return angular.extend(e.prototype,{getSRISpeechClient:function(e){return this.SRISpeechClient||(this.SRISpeechClient=new t({host:e.host,wsEndpoint:e.wsEndpoint})),this.SRISpeechClient}}),e}]),angular.module("atoolEngine").factory("GapsGroupManager",["rfc4122","GapsGroup","underscore",function(o,a,e){var t=function(){this.groups={}};return angular.extend(t.prototype,{registerGap:function(e,t){var n=e.getGroupName();return n||(n=o.v4()),this.groups[n]||(this.groups[n]=new a(n)),this.groups[n].registerGap(e,t),this.groups[n]},reset:function(){e.each(this.groups,function(e){e.clearAll()})}}),t}]),angular.module("atoolEngine").factory("FooterManager",["underscore","$rootScope","FooterElement",function(n,e,o){var t=function(){this.elements={},this.buttons={},this.orderedButtons=[]};return angular.extend(t.prototype,{registerElement:function(e,t){return n.isUndefined(t)&&(t=0),n.has(this.elements,e)||(this.elements[e]=new o(e,t)),this.elements[e]},registerButton:function(e,t){return n.has(this.buttons,e)||(this.buttons[e]=this.registerElement(e,t)),this.reorderButtons(),this.buttons[e]},get:function(e){return this.elements[e]||null},reorderButtons:function(){this.orderedButtons=n.sortBy(this.buttons,"order")}}),t}]),angular.module("atoolEngine").factory("FooterElement",["underscore","$rootScope",function(o,a){var e=function(e,t){this.name=e,this.order=t,this.callbacks={},this.attrs={},this.data={raw:{},simplified:{}},this.classes={original:{},calculated:{},registeredWatchers:{}},this.text=""};return angular.extend(e.prototype,{addClass:function(t,e){return o.isUndefined(e)&&(e=!0),o.has(this.classes.original,t)||(this.classes.original[t]=e,o.isFunction(e)?this.classes.registeredWatchers[t]=a.$watch(e,function(e){this.classes.calculated[t]=e}.bind(this)):this.classes.calculated[t]=e),this},addAttr:function(e){return o.has(this.attrs,e)||(this.attrs[e]={value:!0,modifiers:{},observers:[]}),this},addAttrObserver:function(e,t,n){return this.attrs[e].observers.push(t),n&&t(this.attrs[e].value),this},addCallback:function(e,t){return o.has(this.callbacks,e)||(this.callbacks[e]=[]),this.callbacks[e].push(t),this},addText:function(e){return this.text=e,this},writeSimplifiedData:function(){return this.data.simplified={},o.each(this.data.raw,function(e,t){this.data.simplified[t]=e.value}.bind(this)),this},addData:function(e,t,n){return o.isUndefined(this.data.raw[e])?this.data.raw[e]={value:t,callbacks:{}}:o.isFunction(n)?this.data.raw[e].value=n(e,this.data.raw[e].value,t):this.data.raw[e].value=t,this.data.raw[e].initialValue=this.data.raw[e].value,this.writeSimplifiedData(),this},resetDataToInitialValue:function(e){return this.data.raw[e]&&(this.data.raw[e].value=this.data.raw[e].initialValue,this.writeSimplifiedData()),this},getData:function(e){if(this.data.raw[e])return this.data.raw[e].value},setData:function(e,t){return this.data.raw[e]&&(o.isFunction(t)?this.data.raw[e].value=t(this.data.raw[e].value):this.data.raw[e].value=t,this.writeSimplifiedData()),this},setDataCallback:function(e,t,n){return o.isUndefined(this.data.raw[e])||(this.data.raw[e].callbacks[t]=n),this},getSimplifiedData:function(){return this.data.simplified},modifyAttr:function(e,t,n){return this.attrs[e].modifiers[t]=n,this.recalculateAttr(e),this},getAttrModifier:function(e,t){return this.attrs[e].modifiers[t]},attrWatchModify:function(t,n,e){return a.$watch(e,function(e){this.attrs[t].modifiers[n]=e,this.recalculateAttr(t)}.bind(this)),this},recalculateAttr:function(t){this.attrs[t].value=o.every(this.attrs[t].modifiers),o.each(this.attrs[t].observers,function(e){e(this.attrs[t].value)}.bind(this))},on:function(t){return o.has(this.callbacks,t)&&o.each(this.callbacks[t],function(e){e(this)}.bind(this)),o.each(this.data.raw,function(e){e.callbacks[t]&&e.callbacks[t](this)}.bind(this)),this},is:function(e){return!this.attrs[e]||this.attrs[e].value},getClasses:function(){return this.classes.calculated}}),e}]),angular.module("atoolEngine").directive("undraggable",function(){return{restrict:"A",link:function(e,t){t.addClass("unselectable").attr("unselectable","on").attr("draggable","false").on("dragstart",function(){return!1}),t.find("*").attr("draggable","false").attr("unselectable","on")}}}),angular.module("atoolEngine").directive("stickToTop",function(){return{restrict:"E",scope:{priority:"=",enabled:"="},templateUrl:"app/common/directives/stickToTop.directive.tpl.html",transclude:!0,controller:"StickToTopController",require:["^lo","stickToTop"],link:function(e,t,n,o){var a=o[0],s=o[1],r=a.getStickTopManager();e.config={state:"default"},e.enabled&&(r.registerSticker(s),e.$on("engine-SegmentedScreen-OnEnter",function(){r.registerSticker(s)}),e.$on("engine-SegmentedScreen-Hidden",function(){s.enterStateDefault(),r.deregisterSticker(s)}),e.$on("$destroy",function(){r.deregisterSticker(s)}))}}}),angular.module("atoolEngine").controller("StickToTopController",["$scope","$element","$window","$document","engineBrowserDetector",function(a,s,e,t,n){angular.extend(this,{getPriority:function(){return+a.priority},getScrollableContainer:function(){return s.scrollParent()},getScrollableContainerElement:function(){var e=this.getScrollableContainer();return e.is(t)&&(e=n.isEdge()?angular.element(e[0].body):angular.element(e[0].documentElement)),e},isDocumentScrollable:function(){return this.getScrollableContainer().is(t)},getPositioningContainerElement:function(){return s.closest("[sticktotop-positioning-container]")},getOffset:function(){return s.offset()},getPosition:function(){return s.position()},getTopOffsetToScrollable:function(){var e=s[0].getBoundingClientRect(),t=0;return this.isDocumentScrollable()||(t=this.getScrollableContainerElement()[0].getBoundingClientRect().top),e.top-t},getState:function(){return a.config.state},isState:function(e){return a.config.state===e},isStateDefault:function(){return this.isState("default")},isStateScrollingOut:function(){return this.isState("scrollingOut")},isStateSticked:function(){return this.isState("sticked")},getOriginalHeight:function(){return s.find(".js-sticker-original").outerHeight(!0)},handlePositioningForNonDefaultState:function(e){this.getPositioningContainerElement(),this.getScrollableContainerElement();var t=s.find(".js-sticker-fixed-container"),n=s.find(".js-sticker-original");s.find(".js-sticker-placeholder").css({display:"block",width:n.outerWidth(!0),height:n.outerHeight(!0)}),n.css({position:"absolute",top:0,left:e.originalSticker.left,width:n.outerWidth(!0)}),t.css({position:e.fixedContainer.position,top:e.fixedContainer.top,left:e.fixedContainer.left,width:e.fixedContainer.width,height:this.getOriginalHeight(),backgroundColor:"white",zIndex:e.fixedContainer.zIndex})},enterStateDefault:function(){if(!this.isStateDefault()){var e=s.find(".js-sticker-fixed-container"),t=s.find(".js-sticker-original"),n=s.find(".js-sticker-placeholder");a.config.state="default",e.removeAttr("style"),t.removeAttr("style"),n.removeAttr("style")}},enterStateSticked:function(e,t){if(!this.isStateSticked()){a.config.state="sticked";var n=this.getScrollableContainerElement().offset(),o=this.getScrollableContainerElement();this.handlePositioningForNonDefaultState({originalSticker:{left:this.getOffset().left-n.left},fixedContainer:{position:"fixed",top:n.top+e,left:n.left,width:o[0].clientWidth,zIndex:t}})}},enterStateScrollingOut:function(e,t){if(!this.isStateScrollingOut()){a.config.state="scrollingOut";var n=this.getScrollableContainerElement(),o=s.offsetParent().offset().left-n.offset().left;this.handlePositioningForNonDefaultState({originalSticker:{left:this.getPosition().left},fixedContainer:{position:"absolute",top:e-this.getOriginalHeight(),left:0,width:n[0].clientWidth-o,zIndex:t}})}}})}]),angular.module("atoolEngine").directive("selectOnEvents",function(){return{link:function(e,t,n){var o=e.$eval(n.selectOnEvents)||[],a=function(){t.select()};o.forEach(function(e){t.on(e,a)}),e.$on("$destroy",function(){o.forEach(function(e){t.off(e,a)})})}}}),angular.module("atoolEngine").directive("percentColor",function(){var o=.97,a=.75,s=function(e,t,n){var o,a,s;if(e%=360,0==n)o=a=s=0;else{e/=60;var r=Math.floor(e),i=e-r,l=n*(1-t),c=n*(1-t*i),d=n*(1-t*(1-i));switch(r){case 0:o=n,a=d,s=l;break;case 1:o=c,a=n,s=l;break;case 2:o=l,a=n,s=d;break;case 3:o=l,a=c,s=n;break;case 4:o=d,a=l,s=n;break;case 5:o=n,a=l,s=c}}return[Math.round(255*o),Math.round(255*a),Math.round(255*s)]},r=function(e){function t(e){return e<16?"0"+e.toString(16):e.toString(16)}var n=s(1.2*e,o,a);return"#"+t(n[0])+t(n[1])+t(n[2])};return{restrict:"A",link:function(e,t,n){t.css("color",r(n.percentColor))}}}),angular.module("atoolEngine").directive("nonmarkableBlock",function(){return{link:function(e,t){},controller:["$scope","$element","$attrs",function(e,t,n){angular.extend(this,{shouldNotBeMarked:function(){return"true"===n.nonmarkableBlock}})}]}}),angular.module("atoolEngine").directive("video",["adapterProxy",function(e){return createDirective(e)}]).directive("audio",["adapterProxy",function(e){return createDirective(e)}]).directive("source",["adapterProxy",function(e){return createDirective(e)}]),angular.module("atoolEngine").directive("loSummary",["underscore","$interval","Mousetrap","$timeout",function(e,l,c,d){return{restrict:"E",replace:"true",require:"^lo",templateUrl:"app/common/directives/loSummary.tpl.html",link:function(n,e,t,o){var a=function(e){switch(e){case"none":return"Full";case"check answers":return"Only check answers";case"show answers":return"Only show answers";case"full":return"Full"}};n.loSummaryVisible=!1,c.bind(["ctrl+, ctrl+]","command+, command+]"],function(){n.toggleVisibility()}),n.toggleVisibility=function(){n.loSummaryVisible?r():o.getLoState().isSolving()&&s(!0),n.loSummaryVisible=!n.loSummaryVisible,n.loSummaryVisible?e.removeClass("lo-summary-hidden"):e.addClass("lo-summary-hidden"),d(function(){})};var s=function(e){e||(n.startTime=Date.now()),n.clockInterval=l(function(){var e=Date.now()-n.startTime,t=new Date(e);n.elapsedMinutes=t.getMinutes(),n.elapsedSeconds=t.getSeconds()},250)},r=function(){l.cancel(n.clockInterval)},i=o.getDataCollector().getLoParams();n.startTime=i.startTime,n.loId=o.getLoId(),n.loSummaryVisible=!1,n.organization=i.organisation,n.markingOptions=a(i.markable),n.hasSegmented=!1,d(function(){n.segmentedController=o.getSegmentedController(),null!==n.segmentedController&&(n.hasSegmented=!0,n.screens=n.segmentedController.getScreens())}),o.getLoState().addObserver(function(e,t){n.loSummaryVisible&&("solving"===e&&"report"===t?r():"solving"===t&&o.addOnExerciseStartCallback(s))})}}}]),angular.module("atoolEngine").service("keyboardHelper",function(){var e=[{sign:"ä",lang:"de"},{sign:"ö",lang:"de"},{sign:"ü",lang:"de"},{sign:"ß",lang:"de"},{sign:"ą",lang:"pl"},{sign:"ć",lang:"pl"},{sign:"ę",lang:"pl"},{sign:"ł",lang:"pl"},{sign:"ń",lang:"pl"},{sign:"ó",lang:"pl"},{sign:"ś",lang:"pl"},{sign:"ź",lang:"pl"},{sign:"ż",lang:"pl"}],t=["pl","de"];return{getLanguages:function(){return t},getSpecialSigns:function(){return e},uppercaseSigns:function(){return angular.forEach(e,function(e){"ß"===e.sign?e.sign="ẞ":e.sign=e.sign.toUpperCase()}),e},lowercaseSigns:function(){return angular.forEach(e,function(e){"ẞ"===e.sign?e.sign="ß":e.sign=e.sign.toLowerCase()}),e}}}),angular.module("atoolEngine").directive("keyboard",["localStorageService","keyboardHelper","$document","rfc4122","$compile","$window","$templateCache","underscore","adapterProxy","$rootScope",function(s,r,p,u,g,m,f,h,v,w){return{restrict:"E",transclude:!0,templateUrl:"app/common/directives/keyboard.tpl.html",scope:{onKeyPress:"&keyboardKeyPress",getParentSizing:"&parentSizing",customClasses:"=?"},require:["^lo","^task","?^engineSegmented"],link:function(i,e,t,n){var o=n[0],l=n[1],c=n[2];i.isKeyboardShown=!1,i.dataCollector=o.getDataCollector(),i.languagesList=v.getKeyboardLanguagesList(i.dataCollector),0===i.languagesList.length&&(i.languagesList=r.getLanguages()),i.specialSigns=r.getSpecialSigns(),i.config={langs:i.languagesList},angular.element(m).on("resize",function(){i.isKeyboardShown&&(p.find("#keyboard_"+i.uniqueId).remove(),a())}),i.uniqueId=u.v4();var d=f.get("app/common/directives/keyboard.items.tpl.html");i.$on("engine-keyboardShown",function(e,t){t.id!==i.uniqueId&&i.hideKeyboard(!0)}),i.addSpecialSign=function(e){i.$broadcast("add",e.sign),i.onKeyPress({$event:e.sign}),i.$broadcast("autosize-invalidate")};var a=function(){var e=c?c.getActivityElement():l.getMainDOMElement(),t=i.getParentSizing(),n=e.offset(),o=e.scrollTop();if(0===e.find("#keyboard_"+i.uniqueId).length){var a=g(d)(i),s=t.offset.top-n.top+t.height+o,r=t.offset.left-n.left;a.css("top",s+"px"),a.css("left",r+"px"),e.append(a)}};i.showKeyboard=function(){if(!i.isKeyboardShown){var e=s.get("fillin-language",null);h.contains(i.languagesList,e)?i.config.langs=[e]:i.config.langs=[i.languagesList[0]]}i.isKeyboardShown=!0,a(),w.$broadcast("engine-keyboardShown",{id:i.uniqueId})},e.find("input").on("focus",function(){i.showKeyboard()}),i.hideKeyboard=function(e,t){(e||t&&t.target.className.indexOf("kitem")<0)&&p.find("#keyboard_"+i.uniqueId).remove(),i.isKeyboardShown=!1},i.languageChange=function(e){i.config.langs=[e],s.set("fillin-language",e)},i.areSignsUp=!1,i.shiftSpecialSigns=function(){i.areSignsUp=!i.areSignsUp,i.areSignsUp?i.specialSigns=r.uppercaseSigns():i.specialSigns=r.lowercaseSigns()},i.filterSigns=function(e){return h.contains(i.config.langs,e.lang)},i.isLangChosen=function(e){return h.contains(i.config.langs,e)}}}}]),angular.module("atoolEngine").directive("insertCaret",["$timeout","$parse",function(d,p){return{require:"ngModel",link:function(i,l,c){i.$on("add",function(e,t){var n=l[0];if(document.selection)n.focus(),document.selection.createRange().text=t,n.focus();else if(n.selectionStart||0===n.selectionStart){var o=n.selectionStart,a=n.selectionEnd,s=n.scrollTop,r=n.value.substring(0,o)+t+n.value.substring(a,n.value.length);p(c.ngModel).assign(i,r),d(function(){n.focus(),n.selectionStart=o+t.length,n.selectionEnd=o+t.length,n.scrollTop=s})}else n.value+=t,n.focus()})}}}]),angular.module("atoolEngine").directive("input",function(){return{restrict:"E",require:["?^lo"],link:function(e,t,n,o){o[0]&&"text"===t.attr("type")&&t.attr("autocomplete","off")}}}),angular.module("atoolEngine").directive("injectElement",function(){return{scope:{target:"=injectElement"},link:function(e,t){e.target={$element:t}}}}),angular.module("atoolEngine").directive("focusOnCor",["$timeout",function(o){return{scope:{trigger:"=focusOnCor"},link:function(t,n){t.$watch("trigger.value",function(e){!0===e&&(t.trigger.value=!1,o(function(){n[0].focus()}))})}}}]),angular.module("atoolEngine").directive("focusOn",["$timeout",function(o){return{scope:{trigger:"=focusOn"},link:function(t,n){t.$watch("trigger",function(e){!0===e&&(t.trigger=!1,o(function(){n[0].focus()}))})}}}]),angular.module("atoolEngine").directive("engineNewScope",function(){return{restrict:"A",scope:!0,link:function(e,t){}}}),angular.module("atoolEngine").directive("engineVideo",["underscore","MediaElementPlayer","adapterProxy","afterViews","$q","asyncDigest","mobileDetector","$window",function(a,s,e,r,i,l,t,n){return{scope:{videoPoster:"=?",css:"=?",urls:"=",subtitles:"=?",onStart:"&?",onEnd:"&?",engineAutoplay:"=?",features:"=?",customWidth:"=?",customHeight:"=?"},require:"^lo",templateUrl:"app/common/directives/engine.video.tpl.html",link:function(t,n,e,o){t.defaultFeatures=["playpause","rewind","current","progress","duration","tracks","volume","fullscreen","hacks"],o.isCptMode()&&(t.defaultFeatures=["playpause","rewind","speed","current","progress","duration","tracks","karaoke","script","volume","fullscreen","hacks"]),t.css=t.css||{},t.videoPoster=t.videoPoster||"",t.subtitles=t.subtitles||{},t.features=t.features||t.defaultFeatures,t.dataCollector=o.getDataCollector(),t.pendingGetPlayerRequests=[],t.flushGetPlayerRequests=function(){a.each(t.pendingGetPlayerRequests,function(e){e.resolve(t.player)}),t.pendingGetPlayerRequests=[]},t.getPlayer=function(){var e=i.defer();return t.player?e.resolve(t.player):t.pendingGetPlayerRequests.push(e),e.promise},r.chain(function(){var e={features:t.features,poster:t.videoPoster,alwaysShowControls:!0,autosizeProgress:!1,karaokeButton:!o.isCptMode(),karaokeAlwaysOn:o.isCptMode(),defaultVideoWidth:480,defaultVideoHeight:270,toggleCaptionsButtonWhenOnlyOne:!0,speeds:["1.00","0.75","0.50"],speedText:"Speed",rewindText:"Rewind",scriptSizeButton:!1,stretching:"none",setDimensions:!1,success:function(e){e.addEventListener("play",t.startedCallback),e.addEventListener("ended",t.endedCallback)}};t.player=new s(n.find("video")[0],e),t.flushGetPlayerRequests()}),t.$watch("urls",function(){t.getPlayer().then(function(e){e.pause(),t.urls&&t.urls.length?(a.isArray(t.urls)?e.setSrc(a.map(t.urls,function(e){return{src:e.url,type:e.mime}})):e.setSrc(t.urls),t.engineAutoplay&&e.play()):e.setSrc("")})}),t.$watch("engineAutoplay",function(e){e&&t.getPlayer().then(function(e){e.play()})}),t.$on("engine-mediaPause",function(){t.getPlayer().then(function(e){e.pause()})}),t.$on("$destroy",function(){t.getPlayer().then(function(e){e.remove()})}),t.endedCallback=function(){t.onEnd&&(t.onEnd(),l.trigger())},t.startedCallback=function(){t.onStart&&(t.onStart(),l.trigger())}}}}]),angular.module("atoolEngine").directive("engineImage",["$timeout","$compile","$templateCache","$window","underscore","afterViews","adapterProxy","LoCtrlProvider",function(e,s,r,n,i,l,t,c){return{scope:{css:"=?",url:"=",zoomEnabled:"=?",alt:"=?",externalZoomEnabled:"=?",handleLoad:"=?"},replace:!0,templateUrl:"app/common/directives/engine.image.tpl.html",link:function(o,e,t){var a=c.getLoCtrl();o.css=o.css||{},o.alt=o.alt||"",o.zoomEnabled=!i.isUndefined(o.zoomEnabled)&&o.zoomEnabled,o.handleLoad=!!i.isUndefined(o.handleLoad)||o.handleLoad,e.find("img").on("load",function(){o.handleLoad&&l.chain(function(){o.$emit("engine-image-Loaded")})}),o.writeDefaultZoomedImageStyles=function(){o.zoomedImageStyles.top=o.originalPosition.top-30,o.zoomedImageStyles.left=o.originalPosition.left-30,o.zoomedImageStyles.width=o.originalPosition.width+60,o.zoomedImageStyles.height=o.originalPosition.height+60,o.zoomedImageStyles.border="30px solid transparent"},o.zoomExternal=function(){o.externalZoomEnabled&&n.open(o.url,"_blank")},o.zoomImage=function(){var t=e.find("img")[0];o.originalPosition=i.pick(t.getBoundingClientRect(),"left","top","width","height"),o.zoomedImageStyles={},o.zoomedImageStyles["background-image"]="url("+o.getBase64FromImage(t)+")",o.writeDefaultZoomedImageStyles(),o.zoomed=s(r.get("app/common/directives/engine.image.fullscreen.tpl.html"))(o),a.getModalPlaceholder().append(o.zoomed);var n=Math.min((o.zoomed[0].clientWidth-60)/t.width,(o.zoomed[0].clientHeight-60)/t.height);l.chain(function(){o.enableFullscreen=!0,o.zoomedImageStyles.top="0px",o.zoomedImageStyles.left="0px",o.zoomedImageStyles.width="100%",o.zoomedImageStyles.height="100%",o.zoomedImageStyles.transition="all 0.5s ease-in-out",o.zoomed.one("transitionend",function(e){l.chain(function(){o.exitButtonPosition={},o.exitButtonPosition.top=Math.round((o.zoomed[0].clientHeight-t.height*n)/2)+10,o.exitButtonPosition.right=Math.round((o.zoomed[0].clientWidth-t.width*n)/2)+10,o.showExitButton=!0})})})},o.getBase64FromImage=function(e){var t=document.createElement("canvas"),n=t.getContext("2d");return t.width=e.naturalWidth,t.height=e.naturalHeight,n.drawImage(e,0,0),t.toDataURL()},o.destroyZoomed=function(e){o.zoomed&&(e?(o.showExitButton=!1,o.enableFullscreen=!1,o.writeDefaultZoomedImageStyles(),o.zoomed.one("transitionend",function(e){o.zoomed.remove(),delete o.zoomed})):(o.zoomed.remove(),delete o.zoomed))},o.exitZoom=function(){o.destroyZoomed(!0)},o.$on("$destroy",function(){o.destroyZoomed(!1)})}}}]),angular.module("atoolEngine").directive("engineEyeballButton",["underscore",function(e){return{scope:{eyeball:"=",stateId:"=",onFire:"&?"},templateUrl:"app/common/directives/engine.eyeball.button.tpl.html",link:function(t,e,n){t.fire=function(e){e.stopPropagation(),t.eyeball.fire(t.stateId),t.onFire&&t.onFire()}}}}]),angular.module("atoolEngine").directive("engineDocument",function(){return{scope:{css:"=?",link:"=",displayName:"="},templateUrl:"app/common/directives/engine.document.tpl.html",link:function(e){e.css=e.css||{}}}}),angular.module("atoolEngine").directive("engineAudio",["underscore","MediaElementPlayer","adapterProxy","afterViews","$q","asyncDigest","LoCtrlProvider",function(a,s,e,r,i,l,c){return{scope:{css:"=?",urls:"=",onStart:"&?",onEnd:"&?",engineAutoplay:"=?",features:"=?",customWidth:"=?"},templateUrl:"app/common/directives/engine.audio.tpl.html",link:function(t,n,e){var o=c.getLoCtrl();t.defaultFeatures=["playpause","rewind","current","progress","duration","tracks","volume","hacks"],o.isCptMode()&&(t.defaultFeatures=["playpause","rewind","speed","current","progress","duration","tracks","karaoke","script","volume","hacks"]),t.css=t.css||{},t.features=t.features||t.defaultFeatures,t.pendingGetPlayerRequests=[],t.flushGetPlayerRequests=function(){a.each(t.pendingGetPlayerRequests,function(e){e.resolve(t.player)}),t.pendingGetPlayerRequests=[]},t.getPlayer=function(){var e=i.defer();return t.player?e.resolve(t.player):t.pendingGetPlayerRequests.push(e),e.promise},r.chain(function(){t.player=new s(n.find("audio")[0],{features:t.features,alwaysShowControls:!0,autosizeProgress:!1,stretching:"responsive",karaokeButton:!0,defaultAudioHeight:50,defaultAudioWidth:590,speeds:["1.00","0.75","0.50"],toggleCaptionsButtonWhenOnlyOne:!0,setDimensions:!1,speedText:"Speed",rewindText:"Rewind",success:function(e){e.addEventListener("play",t.startedCallback),e.addEventListener("ended",t.endedCallback),n.find(".js-media-element").on("click",function(e){e.stopPropagation()})}}),t.flushGetPlayerRequests()}),t.$watch("urls",function(){t.getPlayer().then(function(e){e.pause(),e.setMuted(!1),t.urls&&t.urls.length?(a.isArray(t.urls)?e.setSrc(a.map(t.urls,function(e){return{src:e.url,type:e.mime}})):e.setSrc(t.urls),e.load(),t.engineAutoplay&&e.play()):(e.setMuted(!0),e.setSrc(""))})}),t.$watch("engineAutoplay",function(e){e&&t.getPlayer().then(function(e){e.play()})}),t.$on("engine-mediaPause",function(){t.getPlayer().then(function(e){e.pause()})}),t.$on("$destroy",function(){t.getPlayer().then(function(e){e.remove()})}),t.endedCallback=function(){t.onEnd&&(t.onEnd(),l.trigger())},t.startedCallback=function(){t.onStart&&(t.onStart(),l.trigger())}}}}]),angular.module("atoolEngine").directive("customCirclePlayer",["$interval","underscore","$sce","SoundProvider","LoCtrlProvider",customplayer]),angular.module("atoolEngine").directive("crossoriginManager",["adapterProxy","LoCtrlProvider",function(a,s){return{restrict:"A",priority:98,link:function(e,t,n){var o=s.getLoCtrl();a.hasExternalAssets(o.getDataCollector())?t.attr("crossorigin","anonymous"):t.removeAttr("crossorigin")}}}]),angular.module("atoolEngine").directive("autosize",["autosizeInputManager",function(o){return{restrict:"A",link:function(e,t,n){e.$eval(n.autosize)&&("ngModel"in n&&(t.val(e.$eval(n.ngModel)),e.$on("autosize-invalidate",function(){t.val(e.$eval(n.ngModel)),o.recalc(t)})),o.registerInput(t))}}}]),angular.module("atoolEngine").directive("answerOptionPopover",["$compile","$templateRequest","$q","mobileDetector",function(o,e,t,a){var s=e("app/common/directives/answerOptionPopover.tpl.html").then(function(n){return t(function(e,t){e(o(n))})});return{restrict:"E",scope:{answerOption:"=",answerTemplate:"@"},link:function(t,n,e){t.popoverTrigger=a.isMobile()?"outsideClick":"mouseenter",s.then(function(e){e(t,function(e,t){n.append(e)})})}}}]),angular.module("atoolEngine").directive("answerOption",["$compile","$templateRequest","$q","$sce",function(o,e,t,a){var s=e("app/common/directives/answerOption.tpl.html").then(function(n){return t(function(e,t){e(o(n))})});return{restrict:"E",scope:{type:"=type",option:"=option",config:"=?config"},link:function(t,n,e){s.then(function(e){e(t,function(e,t){n.append(e),n.parent().addClass("answer-option-"+t.type),t.audioPlayerType=t.config&&t.config.playerType||"default",t.handleLoad=!(t.config&&!_.isUndefined(t.config.handleLoad))||t.config.handleLoad,t.trustHtml=function(e){return a.trustAsHtml(e)}})})}}}]),angular.module("atoolEngine").directive("engineAnimate",["animateHelper","$timeout","$rootScope","adapterProxy","audioService",function(l,c,e,d,p){return{restrict:"A",require:"^lo",link:function(e,t,n,o){var a=o.getAnimateSupervisor(),s=o.getDataCollector();if(d.shouldShowAnimations(s)){var r=function(e){angular.forEach(e,function(e){switch(e.event){case"click":n.animationid==e.trigger?l.animateOnClick(t,t,e):a.registerAnimation(e.trigger,t,e);break;case"timeout":c(function(){c(function(){l.animateThis(e,t)},parseInt(e.timeout,10))})}})};if(a.registerBlock(n.animationid,t),!_.isUndefined(n.animations)&&""!==n.animations&&""!==n.animations.animation){var i=_.map(angular.fromJson(n.animations),function(e){return e.loId=o.getLoId(),e.audio&&p.registerAudio(e.loId,e.audio),e});a.animationsDeferred?e.$on("engine-startAnimations",r.bind(this,i)):r(i)}}}}}]),angular.module("atoolEngine").directive("wordpool",["$rootScope","afterViews","underscore","rfc4122",function(l,c,d,p){return{scope:{content:"="},restrict:"E",templateUrl:"app/blocks/wordpool/wordpool.tpl.html",controller:"wordpoolController",require:["^lo","^task","wordpool","?^engineSegmented"],link:function(n,e,t,o){var a=o[0],s=o[1],r=o[2],i=o[3];n.wordpoolCtrl=r,n.loState=a.getLoState(),n.elementsToShow=n.content.elements,d.each(n.elementsToShow,function(e){e.playerType=n.content.playerType}),n.randomize=function(){n.content.randomize&&(n.elementsToShow=d.shuffle(n.elementsToShow))},n.randomize(),n.handleWordpoolClick=d.noop,n.originUuid=p.v4(),r.isDnd()&&(s.registerWordpool(n.content.id,r),s.getTaskModel().addResetCallback(function(){n.randomize()}),e.find(".wordpool-content").droppable({tolerance:"pointer",accept:".wordpool-item-"+n.content.id+':not([origin-uuid="'+n.originUuid+'"])',drop:function(e,t){angular.element(t.helper).removeClass("js-wordpool-item-over-wordpool"),angular.element(t.helper).data("alreadyDropped",!0);var n=i?i.getActivityElement():s.getMainDOMElement();r.drop(t,s,n)},over:function(e,t){angular.element(t.helper).addClass("js-wordpool-item-over-wordpool")},out:function(e,t){angular.element(t.helper).removeClass("js-wordpool-item-over-wordpool")}})),r.isTapTap()&&(n.taptapSelectedItem={},n.clearTapTapSelectedItem=function(){n.taptapSelectedItem.element=null,n.taptapSelectedItem.origin="wordpool",n.taptapSelectedItem.removeFromSource=null,n.taptapSelectedItem.unselectInSource=null},n.clearTapTapSelectedItem(),d.each(n.elementsToShow,function(e){e.used=!1,e.selected=!1}),s.registerWordpool(n.content.id,r),s.getTaskModel().addResetCallback(function(){n.randomize(),d.each(n.elementsToShow,function(e){e.used=!1,e.selected=!1}),n.clearTapTapSelectedItem()}),n.switchTapTapSelection=function(e){if(!e.isExample){var t=n.taptapSelectedItem.element;e.selected=!0,n.taptapSelectedItem.element&&(n.taptapSelectedItem.unselectInSource&&n.taptapSelectedItem.unselectInSource(),r.taptap.removeSelection()),t!==e&&(n.taptapSelectedItem.element=e,n.taptapSelectedItem.origin="wordpool",n.taptapSelectedItem.removeFromSource=d.noop,n.taptapSelectedItem.unselectInSource=function(){e.selected=!1})}},n.handleWordpoolClick=function(){r.taptap.isSelected()&&(n.taptapSelectedItem.removeFromSource(),n.taptapSelectedItem.element.selected=!1,n.taptapSelectedItem.element.used=!1,n.clearTapTapSelectedItem(),c.chain(function(){l.$broadcast("engine-draggable-element-dropped")}))}),n.isHidden=!1,n.getClasses=function(){var e={solvable:!r.isStatic(),static:r.isStatic()||!n.loState.isSolving(),dynamic:!(r.isStatic()||!n.loState.isSolving())};return e["display-"+r.getDisplayType()]=!0,e},n.loState.addObserver(function(e,t){"solving"===t&&n.hasBeenSubmitted?(n.randomize(),n.hasBeenSubmitted=!1):"report"===t&&(n.hasBeenSubmitted=!0)}),n.$on("$destroy",function(){s.unregisterWordpool(n.content.id,r)})}}}]),angular.module("atoolEngine").controller("wordpoolController",["$scope","underscore","$compile","mobileDetector","draggableConfigCreator",function(r,a,i,e,l){var c={};angular.extend(this,{isCloneable:function(){return r.content.duplicate},isStickingEnabled:function(){return r.content.scrollable},registerItem:function(e,t,n){c[t.$$hashKey]={element:e,data:t,manualHandlers:n}},updateManualHandlers:function(e,t){c[e.$$hashKey].manualHandlers=t},restore:function(e,t,n){if(!this.isCloneable()){e=e.clone();var o=l.createConfig({helper:"clone",cloneable:!1,element:e,appendTo:n,appendToStructureSelector:"div.wordpool-content.solvable",containmentElement:n,scroll:!0});e.draggable(o.config).data("wordpool-item-data",t).data("should-be-clonned",!1).removeClass("dnd-item-hidden");var a='<answer-option type="elementToCompile.type" option="elementToCompile.content" config="{playerType: elementToCompile.playerType, handleLoad: false}"></answer-option>',s=r.$new(!0);s.elementToCompile={type:t.type,content:t.content,playerType:t.playerType},e.html(i(a)(s)),e.attr("origin-uuid",r.originUuid),e.detach().removeAttr("style").appendTo(c[t.$$hashKey].element),this.updateManualHandlers(t,o.manualHandlers)}},drop:function(e,t,n){var o=angular.element(e.draggable),a=o.data("wordpool-item-data");this.restore(o,a,n),r.$apply()},getElement:function(e){return this.getRegisteredElement(e).element.find(".wordpool-item")},getRegisteredElement:function(t){return a.find(c,function(e){return e.data.content===t&&0<e.element.find(".wordpool-item").size()})},getLargestImageElement:function(e){return a.find(c,function(e){return e.data.content}).element.find(".wordpool-item").has("image-answer")},getData:function(){return r.content},hide:function(){r.isHidden=!0},getDisplayType:function(){return(!r.content.display_mobile_only_phones&&e.isMobile()||r.content.display_mobile_only_phones&&e.isPhone())&&!a.isUndefined(r.content.display_type_mobile)&&"inherit"!==r.content.display_type_mobile?r.content.display_type_mobile:r.content.display_type},isStatic:function(){return"static"===this.getDisplayType()},isDnd:function(){return"dnd"===this.getDisplayType()},isTapTap:function(){return"taptap"===this.getDisplayType()},taptap:{isSelected:function(){return null!==r.taptapSelectedItem.element},claimSelected:function(){r.taptapSelectedItem.removeFromSource();var e=r.taptapSelectedItem.element;return e.used=!r.content.duplicate,this.removeSelection(),e},release:function(e){var t=a.find(r.elementsToShow,{content:e.originalOption,type:e.type,used:!r.content.duplicate,selected:!1});t&&(t.used=!1)},removeSelection:function(){r.taptapSelectedItem.element.selected=!1,r.clearTapTapSelectedItem()},getSelected:function(){return r.taptapSelectedItem.element},clearGapSelection:function(){r.taptapSelectedItem.element&&(r.taptapSelectedItem.unselectInSource&&r.taptapSelectedItem.unselectInSource(),this.removeSelection())},selectFromGap:function(e,t,n){var o=a.find(r.elementsToShow,{content:e.originalOption||e.content,type:e.type,used:!r.content.duplicate});o.selected=!0,r.taptapSelectedItem.element=o,r.taptapSelectedItem.origin="gap",r.taptapSelectedItem.unselectInSource=t,r.taptapSelectedItem.removeFromSource=n},directClaim:function(e){var t=a.find(r.elementsToShow,{content:e.originalOption||e.content,type:e.type,used:!1});return t.used=!r.content.duplicate,t}}})}]),angular.module("atoolEngine").directive("wordpoolItem",["draggableConfigCreator",function(c){return{scope:{element:"=",wordpoolId:"@",originUuid:"="},restrict:"E",require:["^wordpool","^task","?^engineSegmented"],templateUrl:"app/blocks/wordpool/wordpool-item.tpl.html",link:function(e,t,n,o){var a=o[0],s=o[1],r=o[2],i=t.find(".wordpool-item"),l=c.createConfig({helper:"clone",cloneable:a.isCloneable(),element:i,appendTo:r?r.getActivityElement():s.getMainDOMElement(),appendToStructureSelector:"div.wordpool-content.solvable",containmentElement:r?r.getActivityElement():s.getMainDOMElement(),scroll:!0});a.registerItem(t,e.element,l.manualHandlers),!0!==e.element.isExample&&i.draggable(l.config).data("wordpool-item-data",e.element).data("should-be-clonned",a.isCloneable()).attr("origin-uuid",e.originUuid)}}}]),angular.module("atoolEngine").directive("tabs",["underscore","$compile",function(e,t){return{scope:{content:"="},restrict:"E",templateUrl:"app/blocks/layoutBlocks/tabs.tpl.html",link:function(e,t,n){e.hideAll=function(){angular.forEach(e.content.blocks,function(e){e.show=!1})},e.showTab=function(n){angular.forEach(e.content.blocks,function(e,t){e.show=t===n})},e.hideAll(),e.content.initiallyHiddenContent||e.showTab(0)}}}]),angular.module("atoolEngine").directive("engineTable",["underscore",function(e){return{scope:{content:"="},restrict:"E",templateUrl:"app/blocks/layoutBlocks/table.tpl.html",link:function(e,t,n){var o=function(t){t.allClasses={},angular.forEach(t.display,function(e){t.allClasses[e]=!0})};angular.forEach(e.content.blocks,function(e){o(e),angular.forEach(e.blocks,function(e){o(e)})})}}}]),angular.module("atoolEngine").directive("list",["underscore",function(s){return{scope:{content:"="},restrict:"E",require:"^lo",templateUrl:"app/blocks/layoutBlocks/list.tpl.html",link:function(o,e,t,n){var a=n.getLoState();o.addOrderAndLimitToBlocks=function(n){s.each(o.content.blocks,function(e,t){e.order=n[t],e.parentLimit=o.limit})},o.prepareDisplayType=function(){s.each(o.content.blocks,function(e){var t="list-item";"carousel"===o.content.numbered&&(t="container"),e.type=t})},o.prepareDisplayType(),o.order=s.map(o.content.blocks,function(e,t){return t}),o.limit=angular.copy(o.content.limit),(""===o.limit||s.isNull(o.limit))&&(o.limit=o.content.blocks.length),o.addOrderAndLimitToBlocks(o.order),o.randomize=function(){o.content.randomize&&(o.order=s.shuffle(o.order),o.addOrderAndLimitToBlocks(o.order))},o.randomize(),a.addObserver(function(e,t){"solving"===t&&e!==t&&o.randomize()}),o.classes={},o.classes[o.content.numbered]=!0,o.classes["no-audio-prefix"]=s.every(o.content.blocks,function(e){return!(1<=e.blocks.length&&"asset"===e.blocks[0].type&&"audio"===e.blocks[0].model.type)}),o.orderedListStyles={},"numbered"===o.content.numbered&&s.isNumber(o.content.start)&&(o.orderedListStyles["counter-reset"]="numberedListCounter "+(o.content.start-1))}}}]),angular.module("atoolEngine").directive("engineDialog",["underscore",function(e){return{scope:{content:"="},restrict:"E",templateUrl:"app/blocks/layoutBlocks/dialog.tpl.html",link:function(e,t,n){}}}]),angular.module("atoolEngine").directive("engineContainer",function(){return{scope:{content:"="},restrict:"E",require:"^lo",templateUrl:"app/blocks/layoutBlocks/container.tpl.html",link:function(e,t,n,o){}}}).directive("engineListContainer",function(){return{scope:{content:"="},restrict:"E",require:"^lo",replace:!0,templateUrl:"app/blocks/layoutBlocks/container.list.tpl.html",link:function(e,t,n,o){}}}),angular.module("atoolEngine").directive("engineColumns",function(){return{scope:{content:"="},restrict:"E",require:"^lo",templateUrl:"app/blocks/layoutBlocks/columns.tpl.html",link:function(e,t,n,o){}}}),angular.module("atoolEngine").directive("collapsed",["adapterProxy","$sce",function(a,s){return{scope:{content:"="},restrict:"E",require:"^lo",templateUrl:"app/blocks/layoutBlocks/collapsed.tpl.html",link:function(e,t,n,o){e.down=a.shouldInitiallyExpandCollapse(o.getDataCollector())||e.content.collapsed,e.placeholderShow=s.trustAsHtml(e.content.placeholderShow),e.placeholderHide=s.trustAsHtml(e.content.placeholderHide),e.toogleCollapse=function(){t.find(".collapsed-blocks").slideToggle(),e.down=!e.down,e.down||e.$broadcast("engine-mediaPause")},e.startClass="",e.down||(e.startClass="hidden-class")}}}]),angular.module("atoolEngine").directive("engineExternalAsset",["$sce","kalturaScriptLoader","$document","$interval",function(o,s,r,i){return{scope:{content:"="},require:"^lo",restrict:"E",templateUrl:"app/blocks/externalAsset/external.asset.tpl.html",link:function(a,t,e,n){a.dataCollector=n.getDataCollector(),a.type=a.content.embedType||"empty",a.wrapYoutubeUrl=function(e){return o.trustAsResourceUrl("https://www.youtube.com/embed/"+e+"?enablejsapi=1")},"kaltura"===a.type&&(a.uniquePlayerId="kaltura-player-"+a.content.uuid,a.controlsHeight=36,s.loadKWidget(a.content.embedData).then(function(e){e.embed({targetId:a.uniquePlayerId,wid:"_"+a.content.embedData.partnerId,uiconf_id:a.content.embedData.uiconfId,entry_id:a.content.embedData.entryId,readyCallback:function(e){var t=r[0].getElementById(e),n=angular.element(t).find("iframe"),o=i(function(){var e=n.contents().find(".controlBarContainer");0<e.size()&&(a.controlsHeight=e.height(),i.cancel(o))},200,25)}}),a.$on("$destroy",function(){e.destroy(a.uniquePlayerId)})})),a.pauseVideo=function(e){"youtube"===a.type?t.find(".youtube-player")[0].contentWindow.postMessage('{"event":"command","func":"pauseVideo","args":""}',"*"):"kaltura"===a.type&&t.find("#"+a.uniquePlayerId)[0].sendNotification("doPause")},a.$on("engine-mediaPause",function(){a.pauseVideo()})}}}]),angular.module("atoolEngine").directive("task",["underscore","Task",function(a,s){return{scope:{content:"="},require:"^lo",restrict:"E",replace:"true",templateUrl:"app/task/task.tpl.html",controller:"taskController",link:function(t,e,n,o){t.taskModel=new s(t.content,o),o.addTask(t.taskModel),t.customClasses={},a.isEmpty(t.content.display)||angular.forEach(t.content.display,function(e){t.customClasses[e]=!0}),t.$on("engine-image-Loaded",function(){t.$broadcast("engine-image-Loaded-fromTask")})}}}]),angular.module("atoolEngine").controller("taskController",["$scope","$element","underscore",function(e,t,n){var a={},o={},s={};angular.extend(this,{getTaskModel:function(){return e.taskModel},registerWordpool:function(e,t){a[e]=t},unregisterWordpool:function(e,t){delete a[e]},registerDnd:function(e,t){void 0===o[e]&&(o[e]=[]),o[e].push(t)},unregisterDnd:function(e,t){o[e]=n.without(o[e],t)},registerCat:function(e,t){void 0===s[e]&&(s[e]=[]),s[e].push(t)},unregisterCat:function(e,t){s[e]=n.without(s[e],t)},resetEmptyDndGaps:function(e){null!=o[e]&&o[e].forEach(function(e){e.resetIfEmpty()})},evaluateCatGaps:function(e){null!=s[e]&&s[e].forEach(function(e){e.afterElementMove()})},restoreWordpoolElement:function(e,t,n,o){a[e].restore(t,n,o)},getWordpoolElement:function(e,t){return a[e].getElement(t)},getRegisteredWordpoolElement:function(e,t){return a[e].getRegisteredElement(t)},getWordpoolController:function(e){return a[e]},getMainDOMElement:function(){return t},getWordpoolData:function(e){return a[e].getData()},isWordpoolRegistered:function(e){return!!a[e]},hideWordpool:function(e){a[e].hide()}})}]),angular.module("atoolEngine").factory("Task",["underscore","blockTypesHelper",function(a,s){var e=function(e,t){this.loCtrl=t,this.attrs=e,this.gaps=[],this.gapsOrder=this.createGapsOrder({blocks:e.blocks||[]}),this.nonExampleGaps=[],this.reportData={points:0,pointsToGain:0,calculatePercent:function(){return 0==this.pointsToGain?0:Math.round(this.points/this.pointsToGain*100)}},this.resetCallbacks=[]};return angular.extend(e.prototype,{createGapsOrder:function(e){for(var t,n=[],o=[e];t=o.pop();)s.isGap(t.type)?n.push(t.id):t.blocks&&(o=o.concat(t.blocks.slice().reverse()));return n},sortGaps:function(n,e){var o=[];return a.each(e,function(t){var e=a.find(n,function(e){return e.attrs.id===t});e&&o.push(e)}),o=o.concat(a.difference(n,o))},addGap:function(e){this.loCtrl.getCpt().isEnabled()?this.loCtrl.getCpt().registerGap(e):(this.gaps.push(e),this.gaps=this.sortGaps(this.gaps,this.gapsOrder),e.isExample()||this.nonExampleGaps.push(e))},calculatePoints:function(){this.reportData.pointsToGain=a.reduce(this.nonExampleGaps,function(e,t){return e+t.getPointsToGain()},0),this.reportData.points=a.reduce(this.nonExampleGaps,function(e,t){return e+t.getPoints()},0)},reset:function(){this.reportData.points=0,this.reportData.pointsToGain=0,this.gaps.forEach(function(e){e.reset()}),this.resetCallbacks.forEach(function(e){e()})},createStructureToSend:function(){var t=this;return a.map(this.gaps,function(e){return a.extend(e.createStructureToSend(),{taskId:t.attrs.id})})},saveData:function(){return a.object(a.map(this.gaps,function(e){return[e.attrs.id,e.saveData()]}))},restoreData:function(t,n){a.each(this.gaps,function(e){e.restoreData(t[e.attrs.id],n)})},addResetCallback:function(e){this.resetCallbacks.push(e)},isCompleted:function(){return a.all(this.gaps,function(e){return e.isCompleted()})}}),e}]),angular.module("atoolEngine").factory("State",["underscore",function(e){var t=function(e,t,n){this.state="missing",this.missingCondition=e,this.correctCondition=t,this.pointsCallback=n};return angular.extend(t.prototype,{isCorrect:function(){return"correct"===this.state},isWrong:function(){return"wrong"===this.state},isMissing:function(){return"missing"===this.state},setCorrect:function(){this.state="correct"},setWrong:function(){this.state="wrong"},setMissing:function(){this.state="missing"},evaluateState:function(){this.missingCondition()?this.setMissing():this.correctCondition()?this.setCorrect():this.setWrong()},calculatePoints:function(){return this.pointsCallback(this)}}),t}]),angular.module("atoolEngine").factory("Gap",["underscore","State","mobileDetector","GapState","Eyeball",function(s,r,e,i,l){var t=function(e,t,n,o,a){this.scope=e,this.attrs=t,this.deps=o,this._userAnswer=null,this.userAnswerSetterTransformer=s.identity,this.userAnswerGetterTransformer=s.identity,Object.defineProperty(this,"userAnswer",{set:function(e){this._userAnswer=this.userAnswerSetterTransformer(e)},get:function(){return this.userAnswerGetterTransformer(this._userAnswer)}}),this.states={},this.globalState=new r(s.noop,s.noop,s.noop),this.preEvaluate=void 0,this.postEvaluate=void 0,this.correctAnswers=n,this.customReset=a,this.customSave=void 0,this.customRestore=void 0,this.gapState=new i(this.isExample(),this.deps.loState),this.eyeball=new l(this.gapState,this.deps.loState),this.shouldTreatMissingsAsWrongs=!0,"string"==typeof this.attrs.pointsToGain&&(this.attrs.pointsToGain=parseFloat(this.attrs.pointsToGain)),this.cachedPoints=null,this.registerScopeEvents()};return angular.extend(t.prototype,{getId:function(){return this.attrs.id},setShouldTreatMissingsAsWrongs:function(e){this.shouldTreatMissingsAsWrongs=e},registerScopeEvents:function(){var n=this;this.scope.$on("engine-GapResult",function(e,t){n.isExample()||t.stateCallback(n.globalState.state,n.getPoints(),n.getPointsToGain())})},isNonMarkable:function(){return this.attrs.nonmarkableBlockController&&this.attrs.nonmarkableBlockController.shouldNotBeMarked()||"non-marked"===this.attrs.markedBy},registerEvaluateLifecycleCallbacks:function(e,t){this.preEvaluate=e,this.postEvaluate=t},registerState:function(e,t,n,o){this.states[e]=new r(t,n,o)},evaluateStates:function(){this.cachedPoints=null,s.isFunction(this.preEvaluate)&&this.preEvaluate(),s.each(this.states,function(e){e.evaluateState()}),s.isFunction(this.postEvaluate)&&this.postEvaluate(),delete this.feedback,this.evaluateGlobalState()},evaluateGlobalState:function(){var e=this,t=s.every(this.states,function(e){return e.isMissing()}),n=s.some(this.states,function(e){return e.isMissing()}),o=s.some(this.states,function(e){return e.isWrong()});t?e.globalState.setMissing():o||n&&e.shouldTreatMissingsAsWrongs?e.globalState.setWrong():e.globalState.setCorrect()},getPointsToGain:function(){return this.isNonMarkable()?0:this.attrs.pointsToGain},getPoints:function(){return this.isNonMarkable()?0:(null===this.cachedPoints&&(this.cachedPoints=s.max([0,s.reduce(this.states,function(e,t){return e+t.calculatePoints()},0)])),this.cachedPoints)},updateCustomReset:function(e){this.customReset=e},reset:function(){this.userAnswer=null,this.cachedPoints=null,delete this.feedback,s.each(this.states,function(e){e.setMissing()}),this.globalState.setMissing(),"function"==typeof this.customReset&&this.customReset()},isExample:function(){return this.attrs.example},shouldBeRenderedAsSolving:function(){return this.gapState.shouldBeRenderedAsSolving()},shouldBeRenderedAsGivenSolving:function(e){return this.shouldBeRenderedAsSolving()&&this.attrs.markedBy===e},shouldBeRenderedAsShowAnswer:function(){return this.gapState.shouldBeRenderedAsShowAnswer()},shouldBeRenderedAsReport:function(){return this.gapState.shouldBeRenderedAsReport()},shouldBeRenderedAsGivenReport:function(e){var t=e;return s.isArray(t)||(t=[t]),this.shouldBeRenderedAsReport()&&s.includes(t,this.attrs.markedBy)},shouldBeRenderedAsExample:function(){return this.isExample()},registerCustomDataToSend:function(e){this.customDataToSend=e},getCorrectnessClasses:function(e,t){var n=this.shouldBeRenderedAsReport(),o=this.shouldBeRenderedAsSolving();return s.isUndefined(t)||(n=this.shouldBeRenderedAsGivenReport(t),o=this.shouldBeRenderedAsGivenSolving(t)),n||this.eyeball.getState(e)&&this.eyeball.shouldBeRenderedAsReport(e)?{"correct t_correct":this.states[e].isCorrect(),"wrong t_wrong":this.states[e].isWrong(),"missing t_missing":this.states[e].isMissing()}:o&&this.hasAutomaticMarking()?{"correct t_correct":this.states[e].isCorrect(),"wrong t_wrong":this.states[e].isWrong()}:{}},hasAutomaticMarking:function(){return this.attrs.markedType&&"automatic"===this.attrs.markedType},createStructureToSend:function(){var e=this._userAnswer,t=this.correctAnswers,n={};return s.isArray(e)||(e=[e]),s.isArray(t)||(t=[t]),s.isFunction(this.customDataToSend)&&(n=this.customDataToSend()),{id:this.attrs.id,correctAnswers:t,userAnswer:e,type:this.attrs.type,display:this.attrs.display,points:this.getPoints(),pointsToGain:this.getPointsToGain(),caseSensitive:!!this.attrs.caseSensitive,punctuationSensitive:!!this.attrs.punctuationSensitive,extra:n,saveData:this.saveData()}},saveData:function(){var e={regular:{states:s.object(s.map(this.states,function(e,t){return[t,e.state]})),userAnswer:this._userAnswer},custom:{}};return s.isFunction(this.customSave)&&(e.custom=this.customSave()),e},restoreData:function(n,e){e&&this.reset(),s.each(this.states,function(e,t){e.state=n.regular.states[t]}),this._userAnswer=n.regular.userAnswer,s.isFunction(this.customRestore)&&this.customRestore(n.custom),this.evaluateGlobalState()},registerCustomSave:function(e){this.customSave=e},registerCustomRestore:function(e){this.customRestore=e},getDisplayType:function(){return(!this.attrs.display_mobile_only_phones&&e.isMobile()||this.attrs.display_mobile_only_phones&&e.isPhone())&&!s.isUndefined(this.attrs.display_mobile)&&"inherit"!==this.attrs.display_mobile?this.attrs.display_mobile:this.attrs.display},retrieveFeedback:function(e){return this.attrs.feedback&&this.attrs.feedback[e]&&!s.isEmpty(this.attrs.feedback[e])?{option:this.attrs.feedback[e],type:this.attrs.feedback["type_"+e]}:null},getFeedback:function(e){return s.isUndefined(this.feedback)&&(this.feedback=this.retrieveFeedback(e)),this.feedback},getFeedbackForGap:function(e){var t="";return this.globalState.isCorrect()&&(t="correct"),(this.globalState.isWrong()||e&&this.globalState.isMissing())&&(t="wrong"),this.getFeedback(t)},isCompleted:function(){return this.isExample()||s.all(this.states,function(e){return!e.isMissing()})},getGroupName:function(){return this.attrs.groupName},setUserAnswerSetterTransformer:function(e){this.userAnswerSetterTransformer=e},setUserAnswerGetterTransformer:function(e){this.userAnswerGetterTransformer=e}}),t}]),angular.module("atoolEngine").factory("GapsGroup",["underscore",function(a){var e=function(e){this.name=e,this.correctAnswers=[],this.unusedAnswers=[]};return angular.extend(e.prototype,{getName:function(){return this.name},registerGap:function(t,e){this.correctAnswers=this.correctAnswers.concat(a.map(e,function(e){return{gap:t,gapId:t.getId(),usedBy:null,answer:e}})),this.refreshUnusedAnswers()},getUnusedAnswers:function(){return this.unusedAnswers},refreshUnusedAnswers:function(){this.unusedAnswers=a.chain(this.correctAnswers).filter(function(e){return!e.usedBy}).map(function(e){return e.answer}).value()},markAnswerAsUsed:function(t,n){var o=a.find(this.correctAnswers,function(e){return a.isEqual(e.answer,n)});a.chain(this.correctAnswers).filter(function(e){return e.gapId===o.gapId}).each(function(e){e.usedBy=t.getId()}),this.refreshUnusedAnswers()},clearForGap:function(t){a.chain(this.correctAnswers).filter(function(e){return e.usedBy===t.getId()}).each(function(e){e.usedBy=null}),this.refreshUnusedAnswers()},clearAll:function(){a.each(this.correctAnswers,function(e){e.usedBy=null}),this.refreshUnusedAnswers()},evaluateAll:function(){a.chain(this.correctAnswers).uniq(function(e){return e.gapId}).each(function(e){e.gap.evaluateStates()})}}),e}]),angular.module("atoolEngine").controller("MainCtrl",["$scope","JsonLOdescription",function(e,t){e.JsonLOdescription=t}]),angular.module("atoolEngine").directive("lo",["underscore","mobileDetector","engineBrowserDetector",function(t,o,a){return{scope:{locontent:"="},restrict:"E",require:"lo",templateUrl:"app/lo/lo.tpl.html",controller:"loController",link:function(n,e){e.addClass("browser-"+a.getBrowserName()),e.addClass("browser-"+a.getBrowserName()+"-"+a.getBrowserVersion()),n.contentSlides=[],t.each(n.locontent.content,function(e,t){(e.newScreen||0==t)&&n.contentSlides.push({tasks:[],active:!1}),n.contentSlides[n.contentSlides.length-1].tasks.push(e)}),n.isMobile=function(){return o.isMobile()}}}}]),angular.module("atoolEngine").filter("roundpoints",function(){return function(e){return Number(e.toFixed(2))}}),angular.module("atoolEngine").controller("loController",["$scope","$element","$uibModal","LOState","DataCollector","SaveManager","adapterProxy","contentAnaliticsManager","underscore","engineEventTrigger","shareManager","AnimateSupervisor","compatibleSchemaVersions","$timeout","FooterManager","objectHelper","afterViews","Cpt","StickTopManager","audioService","$window","GapsGroupManager","SRIRecorder","LoCtrlProvider","EngineRecorder",function(o,n,t,e,a,s,r,i,l,c,d,p,u,g,m,f,h,v,w,y,b,k,S,M,A){var C=this;angular.extend(this,{addTask:function(e){o.tasks.push(e)},getLoState:function(){return o.loState},getLoId:function(){return o.locontent.meta.id},getAnimateSupervisor:function(){return o.animateSupervisor},getDataCollector:function(){return o.dataCollector},getSaveManager:function(){return o.saveManager},getCpt:function(){return o.cpt},shouldShowEyeballs:function(){return this.isCptMode()&&!this.getCpt().isEnabled()},getFooterManager:function(){return o.footerManager},handleExerciseStart:function(){E()},handleExerciseFinish:function(){R()},getModalPlaceholder:function(){return n.find(".js-engine-popup-placeholder")},stopAllAudioAssets:function(){o.$broadcast("engine-mediaPause")},isTeacherReportMode:function(){return"teacherReport"===o.viewMode},getStickTopManager:function(){return o.stickTopManager},getGapsGroupManager:function(){return o.gapsGroupManager},getSRIRecorder:function(){return o.SRIRecorder},triggerFooterDirectiveLoaded:function(){o.footerDirectiveLoaded=!0,T()},getSRISpeechClient:function(){var e=r.getSRIUrls(o.dataCollector);return this.getSRIRecorder().getSRISpeechClient(e)},getRecorder:function(){return l.isUndefined(o.recorder)&&(o.recorder=this.getSRISpeechClient().Recorder({swfUrl:r.getSriFlashUri(o.dataCollector)})),o.recorder},getEngineRecorder:function(){return l.isUndefined(o.engineRecorder)&&(o.engineRecorder=new A),o.engineRecorder},isCptMode:function(){return"cpt"===o.mode},hasMultipleContentSlides:function(){return 1<o.contentSlides.length},registerSegmentedController:function(e){o.segmentedController=e},getSegmentedController:function(){return o.segmentedController}}),M.setLoCtrl(this),o.footerDirectiveLoaded=!1,o.footerDirectiveFunctions=[],o.tasks=[],o.dataCollector=new a(o.locontent),o.animateSupervisor=new p({animationsDeferred:o.locontent.meta.showStartAnimationsButton}),o.loState=new e,o.footerManager=new m,o.stickTopManager=new w(this),o.gapsGroupManager=new k,o.SRIRecorder=new S,o.segmentedController=null,o.viewMode="studentSolving",o.mode=r.getMode(o.dataCollector),o.animationsDeferred=o.locontent.meta.showStartAnimationsButton;var x=function(e){o.footerDirectiveFunctions.push(e),o.footerDirectiveLoaded&&T()},T=function(){for(var e;e=o.footerDirectiveFunctions.shift();)e()},_=function(){var e=f.hasPair(o.locontent,["pointsToGain"],function(e){return 0<e.pointsToGain},!0),t=f.hasPair(o.locontent,["type","feedback"],function(e){return"segmented"===e.type&&!l.isEmpty(e.feedback)},!0);e||x(function(){t?(o.footerManager.get("submit").modifyAttr("visible","isNonInteractive",!1),o.footerManager.get("tryAgain").modifyAttr("visible","isNonInteractive",!1),o.footerManager.get("save").modifyAttr("visible","isNonInteractive",!1),o.footerManager.get("restore").modifyAttr("visible","isNonInteractive",!1),o.footerManager.get("reportTable").modifyAttr("visible","isNonInteractive",!1),o.footerManager.get("toogleTasks").modifyAttr("visible","isNonInteractive",!1),o.footerManager.get("showAnswers").modifyAttr("visible","isNonInteractive",!1),o.footerManager.get("hideAnswers").modifyAttr("visible","isNonInteractive",!1),o.footerManager.get("share").modifyAttr("visible","isNonInteractive",!1)):o.footerManager.get("footer").modifyAttr("visible","isNonInteractive",!1),"studentSolving"===o.viewMode&&(o.dataCollector.addSolvingData([{type:"non-interactive",points:1,pointsToGain:1}]),o.loState.setStateReport(),R())})},E=function(){o.dataCollector.clear(),o.dataCollector.startDataCollecting();var e,t="";switch(o.viewMode){case"studentSolving":t="start";break;case"teacherReport":case"studentReport":t="report"}for(i.sendAnalitics(o.dataCollector,t),r.initializeLo(o.dataCollector,t),_();e=B.pop();)e()},R=function(){o.dataCollector.finishDataCollecting(),r.submitLo(o.dataCollector),i.sendAnalitics(o.dataCollector,"submit")};if(o.saveManager=new s({loId:o.locontent.meta.id,loVersion:o.locontent.meta.version,saveType:o.locontent.meta.saveType},o.tasks,this),o.cpt=new v,c.addLoController(this,o.dataCollector.getLoParams().loId),o.isCompatibleVersion=l.contains(u,o.locontent.meta.schemaVersion),o.loState.setStateSolving(),o.saveManager.canHandleAutoRestore()&&(o.saveManager.disableSaving(),t.open({templateUrl:"app/common/shouldLoadSavedData.popup.tpl.html",scope:o,backdrop:!1,keyboard:!1,controller:["$scope","$uibModalInstance",function(e,t){e.modalInstance=t}]}).result.then(function(){return g(function(){return o.saveManager.restore(!1)})}).then(function(){o.saveManager.enableSaving()}).catch(function(){o.saveManager.enableSaving()})),o.$on("$destroy",function(){o.saveManager.clearPeriodicSave(),y.pauseAudio()}),o.startAnimations=function(){if(!o.animationsStarted){o.animationsStarted=!0;var e=n.find(".js-start-animations-backdrop"),t=o.locontent.meta.startAnimationsButtonFadeoutTime||0;e.css({opacity:0,transition:"opacity "+t+"ms ease-in-out"}),g(function(){o.animationsDeferred=!1,y.loadAudioFromLo(o.locontent.meta.id),o.$broadcast("engine-startAnimations")},t)}},r.shouldShowAsReport(o.dataCollector)){switch(r.getReportType(o.dataCollector)){case"student":o.viewMode="studentReport";break;case"teacher":o.viewMode="teacherReport"}o.saveManager.disableSaving(),g(function(){r.restoreReport(o.dataCollector).then(function(e){g(function(){o.saveManager.customRestore(e,!1),o.tasks.forEach(function(e){e.calculatePoints(),o.reportData.points+=e.reportData.points,o.reportData.pointsToGain+=e.reportData.pointsToGain}),o.loState.setStateReport()})})})}o.loClasses={},o.loClasses["lo-"+o.locontent.meta.id]=!0,o.loClasses["lo-org-"+o.locontent.meta.organisation]=!0,o.loClasses["lo-mode-"+o.mode]=!0,o.loState.addObserver(function(e,t){if(delete o.loClasses["lo-state-"+e],o.loClasses["lo-state-"+t]=!0,"report"===t){var n=o.reportData.points===o.reportData.pointsToGain;o.loClasses["lo-result-correct"]=n,o.loClasses["lo-result-not-correct"]=!n}else o.loClasses["lo-result-correct"]=!1,o.loClasses["lo-result-not-correct"]=!1},!0);var I=f.hasPair(o.locontent,["type"],["segmented"],!0),P=n.closest(".exercise-wrapper");0<P.size()&&I?P.addClass("has-segmented-block"):P.removeClass("has-segmented-block");var D=n.closest(".exerciseContent");0<D.size()&&I&&D.addClass("has-segmented-block"),o.reportData={points:0,pointsToGain:0,calculatePercent:function(){return 0==this.pointsToGain?0:Math.round(this.points/this.pointsToGain*100)}};var B=[];angular.extend(this,{tryToSubmitLO:function(){var e=this;if("popup"===o.locontent.meta.preventSubmit&&!l.all(o.tasks,function(e){return e.isCompleted()}))return void t.open({templateUrl:"app/common/confirmSubmit.popup.tpl.html",scope:o,appendTo:C.getModalPlaceholder(),controller:["$scope","$uibModalInstance",function(e,t){e.modalInstance=t}]}).result.then(function(){e.submitLO()});e.submitLO()},addOnExerciseStartCallback:function(e){B.push(e)},submitLO:function(){o.tasks.forEach(function(e){e.calculatePoints(),o.reportData.points+=e.reportData.points,o.reportData.pointsToGain+=e.reportData.pointsToGain,o.dataCollector.addSolvingData(e.createStructureToSend())}),o.loState.setStateReport(),this.handleExerciseFinish()},clearLo:function(){o.gapsGroupManager.reset(),o.tasks.forEach(function(e){e.reset()}),o.reportData.points=0,o.reportData.pointsToGain=0,o.loState.setStateSolving(),o.viewMode="studentSolving"},tryAgain:function(){this.clearLo(),r.tryAgainLo(o.dataCollector),this.handleExerciseStart()},showAnswers:function(){o.loState.setStateShowAnswer()},hideAnswers:function(){o.loState.setPreviousState()},saveData:function(){o.saveManager.save(),o.footerManager.get("restore").modifyAttr("visible","canHandleManualRestore",o.saveManager.canHandleManualRestore())},restoreData:function(){this.clearLo(),o.saveManager.restore(!1).then(function(){g(function(){})})},shareExercise:function(){d.shareExercise(o.dataCollector),r.shareLo(o.dataCollector),o.footerManager.get("share").modifyAttr("visible","fromAdapter",r.isShareable(o.dataCollector))}}),angular.element(b).on("resize",function(){o.$broadcast("engine-window-Resize")}),o.$on("atoolEngine.submit",this.submitLO),this.handleExerciseStart()}]),angular.module("atoolEngine").directive("engineFooter",["underscore","adapterProxy",function(r,i){return{scope:{locontent:"=",tasks:"=",viewMode:"=",contentSlides:"="},restrict:"E",require:"^lo",templateUrl:"app/footer/footer.tpl.html",link:function(n,o,e,t){n.footerManager=t.getFooterManager(),n.loState=t.getLoState(),n.dataCollector=t.getDataCollector(),n.saveManager=t.getSaveManager();var a=t.isCptMode();n.toogleReportTableSmall=!0,n.resizeToogleTasks=function(){var e=o.find(".lo-buttons").prop("scrollHeight");n.toogleReportTableSmall=!n.toogleReportTableSmall;var t=n.toogleReportTableSmall?"100px":e+"px";o.find(".lo-buttons").animate({"max-height":t},"fast")},n.hasTaskPoints=function(e){return 0<e.reportData.pointsToGain},n.footerManager.registerElement("footer").addAttr("visible").addClass("lo-buttons").addClass("lo-buttons-small").addClass("t_buttons"),n.footerManager.registerElement("reportTable").addAttr("visible").addClass("result").addClass("t_result"),n.footerManager.registerButton("toogleTasks",0).addAttr("visible").addClass("arrow").addClass("open",function(){return n.toogleReportTableSmall}).addCallback("click",n.resizeToogleTasks),n.footerManager.registerButton("save",100).addText("save").addAttr("visible").addAttr("enabled").addClass("save-button").addClass("t_saveButton").addCallback("click",t.saveData.bind(t)),n.footerManager.registerButton("restore",200).addText("restore").addAttr("visible").addAttr("enabled").addClass("restore-button").addClass("t_restoreButton").addCallback("click",t.restoreData.bind(t)),n.footerManager.registerButton("showAnswers",300).addText(a?"cengage_cpt_show_answers":"showAnswers").addAttr("visible").addAttr("enabled").addClass("show-answer-button").addClass("t_showAnswerButton").addCallback("click",t.showAnswers.bind(t)),n.footerManager.registerButton("hideAnswers",400).addText(a?"cengage_cpt_hide_answers":"hideAnswers").addAttr("visible").addAttr("enabled").addClass("hide-answers-button").addClass("t_hideAnswersButton").addCallback("click",t.hideAnswers.bind(t)),n.footerManager.registerButton("submit",500).addText(a?"cengage_cpt_check_answers":"checkAnswers").addAttr("visible").addAttr("enabled").addClass("submit-lo-button").addClass("t_submitLOButton").addCallback("click",t.tryToSubmitLO.bind(t)),n.footerManager.registerButton("tryAgain",600).addText(a?"cengage_cpt_reset":"tryAgain").addAttr("visible").addAttr("enabled").addClass("try-again-button").addClass("t_tryAgainButton").addCallback("click",t.tryAgain.bind(t)),n.footerManager.registerButton("share",700).addText("share").addAttr("visible").addAttr("enabled").addClass("share-exercise").addClass("t_shareExercise").addCallback("click",t.shareExercise.bind(t)),n.footerManager.get("footer").modifyAttr("visible","metaMarkable",r.include(["full","show answers","check answers"],n.locontent.meta.markable)),n.footerManager.get("save").modifyAttr("visible","canHandleManualSave",n.saveManager.canHandleManualSave()),n.footerManager.get("restore").modifyAttr("visible","canHandleManualRestore",n.saveManager.canHandleManualRestore()),n.footerManager.get("save").modifyAttr("visible","disableManualSaveButtons",!i.disableManualSaveButtons(n.dataCollector)),n.footerManager.get("restore").modifyAttr("visible","disableManualSaveButtons",!i.disableManualSaveButtons(n.dataCollector)),n.footerManager.get("showAnswers").modifyAttr("visible","metaMarkable",r.include(["full","show answers"],n.locontent.meta.markable)),n.footerManager.get("showAnswers").modifyAttr("visible","fromAdapter",i.canShowAnswers(n.dataCollector)),n.footerManager.get("hideAnswers").modifyAttr("visible","metaMarkable",r.include(["full","show answers"],n.locontent.meta.markable)),n.footerManager.get("submit").modifyAttr("visible","metaMarkable",r.include(["full","check answers"],n.locontent.meta.markable)),n.footerManager.get("tryAgain").modifyAttr("visible","fromAdapter",i.canTryAgainLo(n.dataCollector)),n.footerManager.get("share").modifyAttr("visible","fromAdapter",i.isShareable(n.dataCollector));var s=function(e){var t=i.showAnswersVisibleOnlyAfterValidation(n.dataCollector);return!t||t&&("report"===e||"show answers"===n.locontent.meta.markable)};n.loState.addObserver(function(e,t){n.footerManager.get("reportTable").modifyAttr("visible","fromLoState","report"===t),n.footerManager.get("toogleTasks").modifyAttr("visible","fromLoState","report"===t),n.footerManager.get("save").modifyAttr("visible","fromLoState","solving"===t),n.footerManager.get("restore").modifyAttr("visible","fromLoState","solving"===t),n.footerManager.get("showAnswers").modifyAttr("visible","fromLoState","solving"===t||"report"===t),n.footerManager.get("showAnswers").modifyAttr("visible","validationFirst",s(t)),n.footerManager.get("hideAnswers").modifyAttr("visible","fromLoState","showAnswer"===t),n.footerManager.get("submit").modifyAttr("visible","fromLoState","solving"===t),n.footerManager.get("tryAgain").modifyAttr("visible","fromLoState","report"===t||"showAnswer"===t&&"report"===e||a),n.footerManager.get("tryAgain").modifyAttr("visible","fromAdapter",i.canTryAgainLo(n.dataCollector))},!0),n.footerManager.get("footer").attrWatchModify("visible","activeLastSlide",function(){return n.contentSlides[n.contentSlides.length-1].active}),n.footerManager.get("footer").attrWatchModify("visible","viewMode",function(){return"studentSolving"===n.viewMode||"studentReport"===n.viewMode}),n.footerManager.get("toogleTasks").attrWatchModify("visible","taskCount",function(){return 2<r.filter(n.tasks,function(e){return 0<e.reportData.pointsToGain}).length}),t.triggerFooterDirectiveLoaded()}}}]),angular.module("atoolEngine").config(["$stateProvider","$urlRouterProvider",function(e,t){e.state("home",{url:"/",views:{"neducatio-atool-engine":{templateUrl:"app/main/main.html",controller:"MainCtrl"}}}),t.otherwise("/")}]),angular.module("atoolEngine").directive("engineText",["$sce",function(a){return{scope:{content:"="},restrict:"E",replace:"true",templateUrl:"app/blocks/text.tpl.html",link:function(e,t,n){var o=(e.content.content||"").replace(/^&nbsp;/," ").replace(/&nbsp;$/," ");e.trustedHtml=a.trustAsHtml(o)}}}]),angular.module("atoolEngine").directive("rubric",["underscore","$sce",function(e,o){return{scope:{content:"="},restrict:"E",templateUrl:"app/blocks/rubric.tpl.html",link:function(e,t,n){e.trustedHtml=o.trustAsHtml(e.content.content),e.asset={model:e.content.attachment}}}}]),angular.module("atoolEngine").directive("presentationBlock",function(){return{scope:{content:"="},restrict:"E",templateUrl:"app/blocks/presentation.tpl.html",link:function(e,t){"background-img"===e.content.presentationType&&(t.css("background-size",e.content.backgroundImgSize),t.css("background-image","url('"+e.content.backgroundImg+"')"),t.addClass("atool-block-bcg-img"))}}});var classDefinition={tabs:"atool-tabs",container:"atool-container"};angular.module("atoolEngine").directive("blockElement",["$compile","underscore","animateHelper","mobileDetector","adapterProxy","blockTypesHelper","$window","$timeout",function(k,S,e,M,A,C,x,T){return{scope:{content:"=",atoolHide:"=?",atoolShow:"=?",nonmarkable:"=?"},restrict:"E",replace:!0,require:["^lo","^task","?^engineSegmented"],templateUrl:"app/blocks/block.tpl.html",link:function(t,e,n,o){var a=function(e){return M.isMobile()&&!S.isUndefined(e.display_mobile)&&"inherit"!==e.display_mobile?e.display_mobile:e.display},s=o[0],r=o[1],i=o[2];t.allClasses={},t.allStyles={},S.isEmpty(t.content.display)||angular.forEach(t.content.display,function(e){t.allClasses[e]=!0});var l=s.getDataCollector();if(A.shouldShowAnimations(l)&&(t.allClasses["atool-hidden"]=!S.isUndefined(t.content.initiallyHide)&&t.content.initiallyHide),t.allClasses.example=t.content.example,t.allClasses.t_block=!0,classDefinition[t.content.type]?t.allClasses[classDefinition[t.content.type]]=!0:t.allClasses[t.content.type]=!0,C.isContainer(t.content.type)){var c=C.isSegmentedChild(t.content.type)?"vertical":"horizontal",d=t.content.orientation||c;if(t.allClasses["default-"+d]=!0,!C.isAbsolutePositioned(t.content.type)){var p=t.content.css&&t.content.css.position||"relative";t.allClasses["position-"+p]=!0}t.allStyles=S.omit(t.content.css||{},["position"])}"list"===t.content.type&&"carousel"!==t.content.numbered&&(t.allClasses[t.content.layoutType]=!0,t.allClasses[t.content.listStyle]=!0),"columns-col"===t.content.type&&""!==t.content.width&&(t.allStyles.width=t.content.width,t.allClasses["column-custom-width"]=!0);var u=null,g="";if(C.isGap(t.content.type)){var m="";switch(t.content.type){case"GF":m="gapfill";break;case"SC":m="mc-single-answer";break;case"MC":m="mc-multiple-answers";break;case"MAT":m="matching";break;case"COR":m="sentence-correct";break;case"CAT":m="categorisation";break;case"ORD":m="ordering";break;case"WR":m="free-writing";break;case"CW":m="crossword";break;case"WS":m="wordsearch";break;case"ML":m="missing-letters";break;case"FC":m="flashcards";break;case"REC":m="engine-recording";break;case"FCWL":case"nglFCWL":m="engine-flashcards-wordlist";break;case"nglWE":m="engine-cengage-writing-experience";break;case"nglOD":m="engine-cengage-open-dialogue";break;case"nglSP":m="engine-cengage-speaking";break;case"nglDIA":m="engine-cengage-dialogue";break;case"nglCOR":m="engine-cengage-sentence-correction";break;case"nglHL":m="engine-cengage-highlighting";break;case"nglESS":m="engine-cengage-essay";break;case"nglSI":m="engine-cengage-sentence-insertion";break;case"cptQSH":m="engine-cengage-quiz-show";break;case"MEM":case"cptCON":m="engine-concentration";break;case"cptTTT":m="engine-cengage-tic-tac-toe";break;case"sriMC":m="engine-cengage-sri-multiple-choice"}var f=a(t.content);t.customGapClasses={},S.has(t.content,"horizontal")&&(t.customGapClasses.horizontal=t.content.horizontal,t.customGapClasses.vertical=!t.content.horizontal),S.isEmpty(t.content.customClasses)||angular.forEach(t.content.customClasses,function(e){t.customGapClasses[e]=!0});var h="";S.isUndefined(t.atoolHide)||(h+=' ng-hide="atoolHide"'),S.isUndefined(t.atoolShow)||(h+=' ng-show="atoolShow"'),g="<"+m+' ng-class="customGapClasses" options="content" display-type="'+f+'" '+h+"></"+m+">"}if(C.isBlock(t.content.type)){h='engine-animate animations="{{content.animations}}" animationid="{{content.id}}" ng-class="allClasses" ng-style="allStyles"';switch(S.isUndefined(t.atoolHide)||(h+=' ng-hide="atoolHide"'),S.isUndefined(t.atoolShow)||(h+=' ng-show="atoolShow"'),S.isUndefined(t.nonmarkable)||(h+=' nonmarkable-block="{{nonmarkable}}"'),t.content.type){case"wordpool":g='<stick-to-top priority="200" enabled="content.scrollable"><wordpool content="content" '+h+"></wordpool></stick-to-top>";break;case"rubric":g='<stick-to-top priority="100" enabled="content.scrollable"><rubric content="content" class="rubric-wrapper" '+h+"></rubric></stick-to-top>";break;case"tabs":g='<tabs content="content" '+h+"></tabs>";break;case"collapsed":g='<collapsed content="content" '+h+"></collapsed>";break;case"list":g='<list content="content" '+h+"></list>";break;case"presentation":g='<presentation-block content="content" '+h+"></presentation-block>";break;case"text":g='<engine-text content="content" '+h+"></engine-text>";break;case"asset":g='<engine-asset content="content" '+h+"></engine-asset>";break;case"external-asset":g='<engine-external-asset content="content" '+h+"></engine-external-asset>";break;case"table-td":case"dialog-row":case"columns-col":case"instruction":case"instruction-mobile":case"stimulus":case"activity":case"container":case"cptQS":g='<engine-container content="content" '+h+"></engine-container>";break;case"list-item":g='<engine-list-container content="content" '+h+"></engine-list-container>";break;case"model":g='<engine-cengage-model content="content" '+h+"></engine-cengage-model>";break;case"columns":g='<engine-columns content="content" '+h+"></engine-columns>";break;case"table":g='<engine-table content="content" '+h+"></engine-table>";break;case"dialog":g='<engine-dialog content="content" '+h+"></engine-dialog>";break;case"segmented":g='<engine-segmented content="content" '+h+"></engine-segmented>"}}var v={lo:{instance:s},task:{instance:r}};i&&(v.engineSegmented={instance:i}),u=k(g)(t,void 0,{transcludeControllers:v}),e.replaceWith(u);var w=S.mapObject(t.content.callbacks||{},function(e){return new Function("$","event",e)});if(w.windowResize){var y=angular.element(x),b=function(){w.windowResize.call(u,angular.element,{width:y.width(),height:y.height()})};y.resize(b),T(b),t.$on("$destroy",function(){y.off("resize",b)})}w.click&&u.on("click",function(){w.click.call(u,angular.element,{})})}}}]),angular.module("atoolEngine").directive("engineAsset",["adapterProxy","underscore",function(e,a){return{scope:{content:"=",disabledCallback:"@?"},require:"^lo",restrict:"E",templateUrl:"app/blocks/asset.tpl.html",link:function(o,e,t,n){o.dataCollector=n.getDataCollector(),o.type=o.content.model.type,o.disabledCallback=null,"audio"===o.content.model.type&&(o.content.model.playerType=o.content.model.playerType||"default",o.type+="-"+o.content.model.playerType,"circular"===o.content.model.playerType&&(o.audioUrl=o.content.model.links)),o.$on("engine-toogleAudioAvailability",function(e,t,n){"audio"===o.content.model.type&&"default"===o.content.model.playerType&&(o.type=t?"audio-default":"audio-default-disabled",o.disabledCallback=t?null:n)}),e.addClass("type-"+o.type),o.callDisabledCallback=function(){a.isFunction(o.disabledCallback)&&o.disabledCallback()}}}}]),function(){var e=tinymce.util.Tools.resolve("tinymce.PluginManager"),t={aletter:"[A-Za-zªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮͰ-ʹͶͷͺ-ͽΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁҊ-ԧԱ-Ֆՙա-ևא-תװ-׳ؠ-يٮٯٱ-ۓەۥۦۮۯۺ-ۼۿܐܒ-ܯݍ-ޥޱߊ-ߪߴߵߺࠀ-ࠕࠚࠤࠨࡀ-ࡘऄ-हऽॐक़-ॡॱ-ॷॹ-ॿঅ-ঌএঐও-নপ-রলশ-হঽৎড়ঢ়য়-ৡৰৱਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઍએ-ઑઓ-નપ-રલળવ-હઽૐૠૡଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହଽଡ଼ଢ଼ୟ-ୡୱஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹௐఅ-ఌఎ-ఐఒ-నప-ళవ-హఽౘౙౠౡಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹಽೞೠೡೱೲഅ-ഌഎ-ഐഒ-ഺഽൎൠൡൺ-ൿඅ-ඖක-නඳ-රලව-ෆༀཀ-ཇཉ-ཬྈ-ྌႠ-Ⴥა-ჺჼᄀ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚᎀ-ᎏᎠ-Ᏼᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᛮ-ᛰᜀ-ᜌᜎ-ᜑᜠ-ᜱᝀ-ᝑᝠ-ᝬᝮ-ᝰᠠ-ᡷᢀ-ᢨᢪᢰ-ᣵᤀ-ᤜᨀ-ᨖᬅ-ᬳᭅ-ᭋᮃ-ᮠᮮᮯᯀ-ᯥᰀ-ᰣᱍ-ᱏᱚ-ᱽᳩ-ᳬᳮ-ᳱᴀ-ᶿḀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼⁱⁿₐ-ₜℂℇℊ-ℓℕℙ-ℝℤΩℨK-ℭℯ-ℹℼ-ℿⅅ-ⅉⅎⅠ-ↈⒶ-ⓩⰀ-Ⱞⰰ-ⱞⱠ-ⳤⳫ-ⳮⴀ-ⴥⴰ-ⵥⵯⶀ-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞⸯ々〻〼ㄅ-ㄭㄱ-ㆎㆠ-ㆺꀀ-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘟꘪꘫꙀ-ꙮꙿ-ꚗꚠ-ꛯꜗ-ꜟꜢ-ꞈꞋ-ꞎꞐꞑꞠ-ꞩꟺ-ꠁꠃ-ꠅꠇ-ꠊꠌ-ꠢꡀ-ꡳꢂ-ꢳꣲ-ꣷꣻꤊ-ꤥꤰ-ꥆꥠ-ꥼꦄ-ꦲꧏꨀ-ꨨꩀ-ꩂꩄ-ꩋꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꯀ-ꯢ가-힣ힰ-ퟆퟋ-ퟻﬀ-ﬆﬓ-ﬗיִײַ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻﹰ-ﹴﹶ-ﻼＡ-Ｚａ-ｚﾠ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ]",midnumlet:"[-'\\.‘’․﹒＇．]",midletter:"[:··״‧︓﹕：]",midnum:"[+*/,;;։،؍٬߸⁄︐︔﹐﹔，；]",numeric:"[0-9٠-٩٫۰-۹߀-߉०-९০-৯੦-੯૦-૯୦-୯௦-௯౦-౯೦-೯൦-൯๐-๙໐-໙༠-༩၀-၉႐-႙០-៩᠐-᠙᥆-᥏᧐-᧙᪀-᪉᪐-᪙᭐-᭙᮰-᮹᱀-᱉᱐-᱙꘠-꘩꣐-꣙꤀-꤉꧐-꧙꩐-꩙꯰-꯹]",cr:"\\r",lf:"\\n",newline:"[\v\f\u2028\u2029]",extend:"[̀-ͯ҃-҉֑-ׇֽֿׁׂׅׄؐ-ًؚ-ٰٟۖ-ۜ۟-۪ۤۧۨ-ܑۭܰ-݊ަ-ް߫-߳ࠖ-࠙ࠛ-ࠣࠥ-ࠧࠩ-࡙࠭-࡛ऀ-ःऺ-़ा-ॏ॑-ॗॢॣঁ-ঃ়া-ৄেৈো-্ৗৢৣਁ-ਃ਼ਾ-ੂੇੈੋ-੍ੑੰੱੵઁ-ઃ઼ા-ૅે-ૉો-્ૢૣଁ-ଃ଼ା-ୄେୈୋ-୍ୖୗୢୣஂா-ூெ-ைொ-்ௗఁ-ఃా-ౄె-ైొ-్ౕౖౢౣಂಃ಼ಾ-ೄೆ-ೈೊ-್ೕೖೢೣംഃാ-ൄെ-ൈൊ-്ൗൢൣංඃ්ා-ුූෘ-ෟෲෳัิ-ฺ็-๎ັິ-ູົຼ່-ໍ༹༘༙༵༷༾༿ཱ-྄྆྇ྍ-ྗྙ-ྼ࿆ါ-ှၖ-ၙၞ-ၠၢ-ၤၧ-ၭၱ-ၴႂ-ႍႏႚ-ႝ፝-፟ᜒ-᜔ᜲ-᜴ᝒᝓᝲᝳា-៓៝᠋-᠍ᢩᤠ-ᤫᤰ-᤻ᦰ-ᧀᧈᧉᨗ-ᨛᩕ-ᩞ᩠-᩿᩼ᬀ-ᬄ᬴-᭄᭫-᭳ᮀ-ᮂᮡ-᯦᮪-᯳ᰤ-᰷᳐-᳔᳒-᳨᳭ᳲ᷀-ᷦ᷼-᷿‌‍⃐-⃰⳯-⵿⳱ⷠ-〪ⷿ-゙゚〯꙯-꙲꙼꙽꛰꛱ꠂ꠆ꠋꠣ-ꠧꢀꢁꢴ-꣄꣠-꣱ꤦ-꤭ꥇ-꥓ꦀ-ꦃ꦳-꧀ꨩ-ꨶꩃꩌꩍꩻꪰꪲ-ꪴꪷꪸꪾ꪿꫁ꯣ-ꯪ꯬꯭ﬞ︀-️︠-︦ﾞﾟ]",format:"[­؀-؃۝܏឴឵‎‏‪-‮⁠-⁤⁪-⁯\ufeff￹-￻]",katakana:"[〱-〵゛゜゠-ヺー-ヿㇰ-ㇿ㋐-㋾㌀-㍗ｦ-ﾝ]",extendnumlet:"[=_‿⁀⁔︳︴﹍-﹏＿∀-⋿<>]",punctuation:"[!-#%-*,-\\/:;?@\\[-\\]_{}¡«·»¿;·՚-՟։֊־׀׃׆׳״؉؊،؍؛؞؟٪-٭۔܀-܍߷-߹࠰-࠾࡞।॥॰෴๏๚๛༄-༒༺-༽྅࿐-࿔࿙࿚၊-၏჻፡-፨᐀᙭᙮᚛᚜᛫-᛭᜵᜶។-៖៘-៚᠀-᠊᥄᥅᨞᨟᪠-᪦᪨-᪭᭚-᭠᯼-᯿᰻-᰿᱾᱿᳓‐-‧‰-⁃⁅-⁑⁓-⁞⁽⁾₍₎〈〉❨-❵⟅⟆⟦-⟯⦃-⦘⧘-⧛⧼⧽⳹-⳼⳾⳿⵰⸀-⸮⸰⸱、-〃〈-】〔-〟〰〽゠・꓾꓿꘍-꘏꙳꙾꛲-꛷꡴-꡷꣎꣏꣸-꣺꤮꤯꥟꧁-꧍꧞꧟꩜-꩟꫞꫟꯫﴾﴿︐-︙︰-﹒﹔-﹡﹣﹨﹪﹫！-＃％-＊，-／：；？＠［-］＿｛｝｟-･]"},n={characterIndices:{ALETTER:0,MIDNUMLET:1,MIDLETTER:2,MIDNUM:3,NUMERIC:4,CR:5,LF:6,NEWLINE:7,EXTEND:8,FORMAT:9,KATAKANA:10,EXTENDNUMLET:11,AT:12,OTHER:13},SETS:[new RegExp(t.aletter),new RegExp(t.midnumlet),new RegExp(t.midletter),new RegExp(t.midnum),new RegExp(t.numeric),new RegExp(t.cr),new RegExp(t.lf),new RegExp(t.newline),new RegExp(t.extend),new RegExp(t.format),new RegExp(t.katakana),new RegExp(t.extendnumlet),new RegExp("@")],EMPTY_STRING:"",PUNCTUATION:new RegExp("^"+t.punctuation+"$"),WHITESPACE:/^\s+$/},s=function(e,t,n){var o,a;if(!e)return 0;if(n=n||e,void 0!==e.length){for(o=0,a=e.length;o<a;o++)if(!1===t.call(n,e[o],o,e))return 0}else for(o in e)if(e.hasOwnProperty(o)&&!1===t.call(n,e[o],o,e))return 0;return 1},o=function(n,o){var a=[];return s(n,function(e,t){a.push(o(e,t,n))}),a},a={each:s,map:o},r=n.SETS,i=n.characterIndices.OTHER,l=function(e){var t,n,o=i,a=r.length;for(t=0;t<a;++t)if((n=r[t])&&n.test(e)){o=t;break}return o},c=function(n){var o={};return function(e){if(o[e])return o[e];var t=n(e);return o[e]=t}},p={classify:function(e){var t=c(l);return a.map(e.split(""),t)}},d=n.characterIndices,u={isWordBoundary:function(e,t){var n,o,a=e[t],s=e[t+1];return!(t<0||t>e.length-1&&0!==t||a===d.ALETTER&&s===d.ALETTER||(o=e[t+2],a===d.ALETTER&&(s===d.MIDLETTER||s===d.MIDNUMLET||s===d.AT)&&o===d.ALETTER||(n=e[t-1],(a===d.MIDLETTER||a===d.MIDNUMLET||s===d.AT)&&s===d.ALETTER&&n===d.ALETTER||!(a!==d.NUMERIC&&a!==d.ALETTER||s!==d.NUMERIC&&s!==d.ALETTER)||(a===d.MIDNUM||a===d.MIDNUMLET)&&s===d.NUMERIC&&n===d.NUMERIC||a===d.NUMERIC&&(s===d.MIDNUM||s===d.MIDNUMLET)&&o===d.NUMERIC||a===d.EXTEND||a===d.FORMAT||n===d.EXTEND||n===d.FORMAT||s===d.EXTEND||s===d.FORMAT||a===d.CR&&s===d.LF||a!==d.NEWLINE&&a!==d.CR&&a!==d.LF&&s!==d.NEWLINE&&s!==d.CR&&s!==d.LF&&(a===d.KATAKANA&&s===d.KATAKANA||s===d.EXTENDNUMLET&&(a===d.ALETTER||a===d.NUMERIC||a===d.KATAKANA||a===d.EXTENDNUMLET)||a===d.EXTENDNUMLET&&(s===d.ALETTER||s===d.NUMERIC||s===d.KATAKANA)||a===d.AT))))}},g=n.EMPTY_STRING,m=n.WHITESPACE,f=n.PUNCTUATION,h=function(e){return"http"===e||"https"===e},v=function(e,t){var n;for(n=t;n<e.length;++n){var o=e.charAt(n);if(m.test(o))break}return n},w=function(e,t,n){var o=v(t,n+1),a=t.substring(n+1,o);return"://"===a.substr(0,3)?{word:e+a,index:o}:{word:e,index:n}},y=function(e,t){var n,o,a,s=0,r=p.classify(e),i=r.length,l=[],c=[];for(t||(t={}),t.ignoreCase&&(e=e.toLowerCase()),o=t.includePunctuation,a=t.includeWhitespace;s<i;++s)if(n=e.charAt(s),l.push(n),u.isWordBoundary(r,s)){if((l=l.join(g))&&(a||!m.test(l))&&(o||!f.test(l)))if(h(l)){var d=w(l,e,s);c.push(d.word),s=d.index}else c.push(l);l=[]}return c},b={getWords:function(e,t){return y(e.replace(/\ufeff/g,""),t)}},k=function(e){return e.removed?"":e.getBody().innerText},S={getCount:function(e){return b.getWords(k(e)).length}},M={get:function(e){return{getCount:function(){return S.getCount(e)}}}},A=tinymce.util.Tools.resolve("tinymce.util.Delay"),C=tinymce.util.Tools.resolve("tinymce.util.I18n"),x={setup:function(n){var o=function(e){return C.translate(["{0} words",S.getCount(e)])},a=function(){n.theme.panel.find("#wordcount").text(o(n))};n.on("init",function(){var e=n.theme.panel&&n.theme.panel.find("#statusbar")[0],t=A.debounce(a,300);e&&A.setEditorTimeout(n,function(){e.insert({type:"label",name:"wordcount",text:o(n),classes:"wordcount",disabled:n.settings.readonly},0),n.on("setcontent beforeaddundo undo redo keyup",t)},0)})}};e.add("enginetinywordcount",function(e){return x.setup(e),M.get(e)})}(),angular.module("atoolEngine").service("UAParser",function(){return new window.UAParser}),angular.module("atoolEngine").directive("offClick",["$rootScope","$parse",function(c,d){var p=0,u={},e=!1;function a(t,e){if(!t||!e)return!1;for(var n=e.length,o=0;o<n;++o){var a=e[o],s=!1;try{s=a.contains(t)}catch(e){void 0!==a.compareDocumentPosition&&(s=a===t||Boolean(16&a.compareDocumentPosition(t)))}if(s)return!0}return!1}function t(n){if("touchmove"===n.type)return!(e=!0);if(e)return e=!1;var o=n.target||n.srcElement;angular.forEach(u,function(e,t){e.elm.contains(o)||a(o,e.offClickFilter)||c.$evalAsync(function(){e.cb(e.scope,{$event:n})})})}function n(n){if(9===n.keyCode){if("touchmove"===n.type)return!(e=!0);if(e)return e=!1;var o=n.target||n.srcElement;angular.forEach(u,function(e,t){e.elm.contains(o)||a(o,e.offClickFilter)||c.$evalAsync(function(){e.cb(e.scope,{$event:n})})})}}return document.addEventListener("touchmove",t,!0),document.addEventListener("touchend",t,!0),document.addEventListener("click",t,!0),document.addEventListener("mousedown",t,!0),document.addEventListener("keyup",n,!0),{restrict:"A",compile:function(e,i){var l=d(i.offClick);return function(t,e){var n,o,a=p++;function s(){u[a]={elm:e[0],cb:l,scope:t,offClickFilter:n}}function r(){u[a]=null,delete u[a]}n=document.querySelectorAll(t.$eval(i.offClickFilter)),i.offClickIf?o=c.$watch(function(){return d(i.offClickIf)(t)},function(e){e?s():e||r()}):s(),i.$observe("offClickFilter",function(e){n=document.querySelectorAll(t.$eval(e))}),t.$on("$destroy",function(){r(),o&&o(),e=null})}}}}]),angular.module("atoolEngine").value("uiSortableConfig",{}).directive("customSortable",["uiSortableConfig","$timeout","$log","underscore",function(t,n,v,w){return{require:"?ngModel",scope:{ngModel:"=",customSortable:"="},link:function(i,l,e,c){var d;function o(e,t){return t&&"function"==typeof t?function(){e.apply(this,arguments),t.apply(this,arguments)}:e}function a(e){var t=e.data("ui-sortable");return t&&"object"==typeof t&&"ui-sortable"===t.widgetFullName?t:null}function s(e,t){var n=e.sortable("option","helper");return"clone"===n||"function"==typeof n&&t.item.sortable.isCustomHelperUsed()}function r(e){return/left|right/.test(e.css("float"))||/inline|table-cell/.test(e.css("display"))}function p(e,t){for(var n=null,o=0;o<e.length;o++){var a=e[o];if(a.element[0]===t[0]){n=a.scope;break}}return n}function u(e,t){t.item.sortable._destroy()}var g={},m={"ui-floating":void 0},f={receive:null,remove:null,start:null,stop:null,update:null},h={helper:null};angular.extend(g,m,t,i.customSortable),angular.element.fn&&angular.element.fn.jquery?(c?(i.$watch("ngModel.length",function(){n(function(){a(l)&&l.sortable("refresh")},0,!1)}),f.start=function(e,n){if("auto"===g["ui-floating"]){var t=n.item.siblings();a(angular.element(e.target)).floating=r(t)}n.item.sortable={model:w.sortBy(c.$modelValue,"showOrder")[n.item.index()],index:n.item.index(),source:n.item.parent(),sourceModel:c.$modelValue,cancel:function(){n.item.sortable._isCanceled=!0},isCanceled:function(){return n.item.sortable._isCanceled},isCustomHelperUsed:function(){return!!n.item.sortable._isCustomHelperUsed},_isCanceled:!1,_isCustomHelperUsed:n.item.sortable._isCustomHelperUsed,_destroy:function(){angular.forEach(n.item.sortable,function(e,t){n.item.sortable[t]=void 0})}}},f.activate=function(e,t){d=l.contents();var n=l.sortable("option","placeholder");if(n&&n.element&&"function"==typeof n.element){var o=n.element();o=angular.element(o);var a=l.find('[class="'+o.attr("class")+'"]:not([ng-repeat], [data-ng-repeat])');d=d.not(a)}var s=t.item.sortable._connectedSortables||[];s.push({element:l,scope:i}),t.item.sortable._connectedSortables=s},f.update=function(e,t){if(!t.item.sortable.received){t.item.sortable.dropindex=t.item.index();var n=t.item.parent();t.item.sortable.droptarget=n;var o=p(t.item.sortable._connectedSortables,n);t.item.sortable.droptargetModel=o.ngModel,l.sortable("cancel")}s(l,t)&&!t.item.sortable.received&&"parent"===l.sortable("option","appendTo")&&(d=d.not(d.last())),d.appendTo(l),t.item.sortable.received&&(d=null),t.item.sortable.received&&!t.item.sortable.isCanceled()&&i.$apply(function(){c.$modelValue.splice(t.item.sortable.dropindex,0,t.item.sortable.moved)})},f.stop=function(e,r){!r.item.sortable.received&&"dropindex"in r.item.sortable&&!r.item.sortable.isCanceled()?i.$apply(function(){var t=r.item.sortable.index+g.orderKeyStart,n=r.item.sortable.dropindex+g.orderKeyStart,o=w.min([t,n]),a=w.max([t,n]),s=n<t?1:-1;w.each(c.$modelValue,function(e){e[g.orderKey]==t?e[g.orderKey]=n:e[g.orderKey]>=o&&e[g.orderKey]<=a&&(e[g.orderKey]+=s)})}):"dropindex"in r.item.sortable&&!r.item.sortable.isCanceled()||s(l,r)||d.appendTo(l),d=null},f.receive=function(e,t){t.item.sortable.received=!0},f.remove=function(e,t){"dropindex"in t.item.sortable||(l.sortable("cancel"),t.item.sortable.cancel()),t.item.sortable.isCanceled()||i.$apply(function(){t.item.sortable.moved=c.$modelValue.splice(t.item.sortable.index,1)[0]})},h.helper=function(o){return o&&"function"==typeof o?function(e,t){var n=o.apply(this,arguments);return t.sortable._isCustomHelperUsed=t!==n,n}:o},i.$watch("customSortable",function(e){var n=a(l);n&&angular.forEach(e,function(e,t){if(t in m)return"ui-floating"!==t||!1!==e&&!0!==e||(n.floating=e),void(g[t]=e);f[t]?("stop"===t&&(e=o(e=o(e,function(){i.$apply()}),u)),e=o(f[t],e)):h[t]&&(e=h[t](e)),g[t]=e,l.sortable("option",t,e)})},!0),angular.forEach(f,function(e,t){g[t]=o(e,g[t]),"stop"===t&&(g[t]=o(g[t],u))})):v.info("ui.sortable: ngModel not provided!",l),l.sortable(g)):v.error("ui.sortable: jQuery should be included before AngularJS!")}}}]),angular.module("atoolEngine").constant("underscore",window._).constant("Modernizr",window.Modernizr).constant("SRISpeechClient",window.SRISpeechClient).constant("MediaElementPlayer",window.MediaElementPlayer).constant("JsonLOdescription",window.JsonLOdescription).constant("Mousetrap",window.Mousetrap).constant("socketIO",window.io).constant("ResizeObserver",window.ResizeObserver).constant("analiticsUrl","https://ca-entry.n-educatio.pl:4443/parse/").constant("sharemoteUrls",{share:"https://sharemote.n-educatio.pl/server/exercise/share",dashboard:"https://sharemote.n-educatio.pl/#/dashboard/:uuid",loader:"https://sharemote.n-educatio.pl/#/loader"}).constant("SRIUrls",{host:"myelt-dynaspeak.cengage.com",wsEndpoint:"/sristream/websocket",dynaBucket:"https://dynaspeak-prod.s3.amazonaws.com/"}).constant("recordingBackendWebsocket","wss://audio-service.n-educatio.pl").constant("cptPopupTimeout",4e3).constant("dataVersion",2).constant("engineVersion",2).constant("compatibleSchemaVersions",[2]),angular.module("atoolEngine").run(["$templateCache",function(e){e.put("app/blocks/asset.audio-circular.tpl.html",'<custom-circle-player urls="audioUrl"></custom-circle-player>'),e.put("app/blocks/asset.audio-default-disabled.tpl.html",'<div ng-click="callDisabledCallback()"><engine-audio style="pointer-events: none" urls="content.model.links" css="content.css"></engine-audio></div>'),e.put("app/blocks/asset.audio-default.tpl.html",'<engine-audio urls="content.model.links" css="content.css"></engine-audio>'),e.put("app/blocks/asset.document.tpl.html",'<engine-document link="content.model.links[0]" display-name="content.displayName" css="content.css"></engine-document>'),e.put("app/blocks/asset.image.tpl.html",'<engine-image url="content.model.links[0].url" css="content.css" alt="content.alt" external-zoom-enabled="content.model.externalZoomEnabled" zoom-enabled="content.model.zoomEnabled"></engine-image>'),e.put("app/blocks/asset.tpl.html","<ng-include src=\"'app/blocks/asset.' + type + '.tpl.html'\"></ng-include>"),e.put("app/blocks/asset.video.tpl.html",'<engine-video urls="content.model.links" css="content.css" video-poster="content.model.attachment" subtitles="content.model.subtitles"></engine-video>'),e.put("app/blocks/block.tpl.html",'<div class="atool-block t_block"></div>'),e.put("app/blocks/presentation.tpl.html",'<div class="{{content.presentationType}}"><div class="{{content.presentationType}}-blocks"><block-element ng-repeat="block in content.blocks" content="block"></block-element></div></div>'),e.put("app/blocks/rubric.tpl.html",'<div class="rubric-content atool-block t_block t_rubric"><span ng-bind-html="trustedHtml"></span><engine-asset ng-if="asset.model.type" content="asset"></engine-asset></div>'),e.put("app/blocks/text.tpl.html",'<ng-bind-html ng-bind-html="trustedHtml"></ng-bind-html>'),e.put("app/common/audioCheck.popup.tpl.html",'<div class="modal-body audio-check-popup"><button class="btn btn-cross" ng-click="closeModal()"></button><div class="audio-check-icon"></div><div class="audio-check-text"><p>{{ \'cengage_audio_check_message\' | engineTranslate:dataCollector }}</p></div><div class="audio-check-btns"><button ng-if="!recording && !busy" ng-disabled="playing" ng-click="startRecording()" class="audio-check-start btn">{{ \'cengage_audio_check_record\' | engineTranslate:dataCollector }}</button> <button ng-if="recording && !busy" ng-click="stopRecording()" class="audio-check-stop btn">{{ \'cengage_audio_check_recording_stop\' | engineTranslate:dataCollector }}</button> <button ng-if="busy" class="audio-check-start btn busy" disabled=""></button> <button ng-if="!playing" ng-disabled="!recordingUrl || recording" ng-click="startPlayback()" class="audio-check-playback-start btn">{{ \'cengage_audio_check_playback\' | engineTranslate:dataCollector }}</button> <button ng-if="playing" ng-click="stopPlayback()" class="audio-check-playback-stop btn">{{ \'cengage_audio_check_playbacking_stop\' | engineTranslate:dataCollector }}</button></div></div>'),e.put("app/common/confirmSubmit.popup.tpl.html",'<div class="modal-body"><p>{{ \'preventSubmit_notAnswered\' | engineTranslate:dataCollector }}<br>{{ \'preventSubmit_sure\' | engineTranslate:dataCollector }}</p></div><div class="modal-footer text-right"><button class="btn btn-primary" ng-click="modalInstance.close()">{{ \'preventSubmit_submit\' | engineTranslate:dataCollector }}</button> <button class="btn btn-default" ng-click="modalInstance.dismiss(\'cancel\')">{{ \'preventSubmit_cancel\' | engineTranslate:dataCollector }}</button></div>'),e.put("app/common/my-carousel-slide.html",'<div ng-class="{\'active\': active}" class="item" ng-transclude=""></div>'),e.put("app/common/my-carousel.html",'<div ng-mouseenter="pause()" ng-mouseleave="play()" class="carousel" ng-swipe-right="prev()" ng-swipe-left="next()"><div class="carousel-inner" ng-transclude=""></div><div class="carousel-controls"><a role="button" href="" class="left carousel-control" ng-click="prev()" ng-show="slides.length > 1 && !slides[0].active"><span>&lt;</span> <span class="sr-only">previous</span></a> <a role="button" href="" class="right carousel-control" ng-click="next()" ng-show="slides.length > 1 && !slides[slides.length-1].active"><span>&gt;</span> <span class="sr-only">next</span></a></div></div>'),e.put("app/common/shouldLoadSavedData.popup.tpl.html",'<div class="modal-body"><p ng-bind-html="\'shouldLoadSavedData\' | engineTranslate:dataCollector"></p></div><div class="modal-footer text-right"><button class="btn btn-primary" ng-click="modalInstance.close()">{{ \'shouldLoadSavedData_load\' | engineTranslate:dataCollector }}</button> <button class="btn btn-default" ng-click="modalInstance.dismiss(\'cancel\')">{{ \'shouldLoadSavedData_dismiss\' | engineTranslate:dataCollector }}</button></div>'),e.put("app/footer/footer.tpl.html",'<div ng-show="footerManager.get(\'footer\').is(\'visible\')" ng-class="footerManager.get(\'footer\').getClasses()"><div ng-show="footerManager.get(\'reportTable\').is(\'visible\')" ng-class="footerManager.get(\'reportTable\').getClasses()"><div class="overall-result" ng-if="reportData.pointsToGain > 0"><span class="title">{{ \'overallPoints\' | engineTranslate:dataCollector }}</span> <span class="points"><strong>{{reportData.points | roundpoints}}</strong>/{{reportData.pointsToGain}}</span> <span class="percent" percent-color="{{ reportData.calculatePercent() }}">{{ reportData.calculatePercent() }}%</span></div><div class="detailed-result"><ul><li ng-repeat="task in tasks | filter: hasTaskPoints" class="t_taskresult task-result"><span><span class="title">{{task.attrs.title}}</span> <span class="points"><strong>{{task.reportData.points | roundpoints}}</strong>/{{task.reportData.pointsToGain}}</span> <span class="percent" percent-color="{{ task.reportData.calculatePercent() }}">{{ task.reportData.calculatePercent() }}%</span></span></li></ul></div><div ng-if="reportData.pointsToGain == 0">{{ \'notMarked\' | engineTranslate:dataCollector }}</div></div><div class="lo-btns"><button ng-repeat="button in footerManager.orderedButtons track by button.name" ng-show="button.is(\'visible\')" ng-disabled="!button.is(\'enabled\')" class="btn" ng-class="button.getClasses()" ng-click="button.on(\'click\')" ng-bind-html="button.text | engineTranslate:dataCollector:button.getSimplifiedData()"></button></div></div>'),e.put("app/lo/lo.tpl.html",'<section class="invalid-version" ng-if="!isCompatibleVersion"><h2>{{ \'invalid_json_version\' | engineTranslate:dataCollector }}</h2></section><section ng-if="isCompatibleVersion" ng-class="loClasses"><style>\n    {{ locontent.meta.styles }}\n  </style><div class="js-engine-popup-placeholder"></div><div class="lo-section-wrapper block-removal-test"><header class="lo-header"><div ng-if="locontent.meta.heading" class="title t_loheading">{{locontent.meta.heading}}</div></header><div class="lo-content" ng-class="{\'no-buttons\': !showButtons.all || !contentSlides[contentSlides.length - 1].active, \'mobile-view\': isMobile(), \'desktop-view\': !isMobile(), \'animations-started\': !animationsDeferred}"><engine-carousel><span ng-repeat="contentSlide in contentSlides" engine-carousel-slide="{{$index}}" engine-carousel-slide-active="contentSlide.active" class="carousel-slide"><task content="task" ng-repeat="task in contentSlide.tasks"></task></span></engine-carousel></div></div><engine-footer locontent="locontent" tasks="tasks" view-mode="viewMode" content-slides="contentSlides"></engine-footer><div ng-if="animationsDeferred" class="start-animations-backdrop js-start-animations-backdrop"><button class="start-animations-button" ng-click="startAnimations()"></button></div></section><lo-summary></lo-summary>'),e.put("app/main/main.html",'<article class="exercise-content"><lo locontent="JsonLOdescription"></lo></article>'),e.put("app/task/task.tpl.html",'<div class="t_task task" ng-class="customClasses" sticktotop-positioning-container=""><block-element ng-if="content.blocks.length" ng-repeat="block in content.blocks" content="block"></block-element><stick-to-top priority="1" enabled="true"></stick-to-top></div>'),e.put("app/blocks/externalAsset/empty.tpl.html","<div></div>"),e.put("app/blocks/externalAsset/external.asset.tpl.html","<ng-include src=\"'app/blocks/externalAsset/' + type + '.tpl.html'\"></ng-include>"),e.put("app/blocks/externalAsset/kaltura.tpl.html",'<div class="kaltura-wrapper" ng-class="{responsive: content.responsive}"><div id="kaltura-ratio-holder" ng-style="content.responsive && {marginTop: \'calc(\' + (100/content.assetRatio) + \'%\' + \' + \' + controlsHeight + \'px)\'}"></div><div class="kaltura-player" id="{{ uniquePlayerId }}" ng-style="!content.responsive && { width: content.size.width, height: content.size.height }"></div></div>'),e.put("app/blocks/externalAsset/youtube.tpl.html",'<div class="youtube-wrapper" ng-class="{responsive: content.responsive}"><div id="youtube-ratio-holder" ng-style="content.responsive && {marginTop: (100/content.assetRatio) + \'%\'}"></div><iframe class="youtube-player" type="text/html" ng-style="!content.responsive && { width: content.size.width, height: content.size.height }" ng-src="{{ wrapYoutubeUrl(content.embedData.movieId) }}" frameborder="0" allowfullscreen="" webkitallowfullscreen=""></iframe></div>'),e.put("app/blocks/layoutBlocks/blocklist-carousel-slide.html",'<div ng-class="{\'active\': active}" class="item" ng-transclude=""></div>'),e.put("app/blocks/layoutBlocks/blocklist-carousel.html",'<div ng-mouseenter="pause()" ng-mouseleave="play()" class="carousel" ng-swipe-right="prev()" ng-swipe-left="next()"><div class="carousel-inner" ng-transclude=""></div><div class="carousel-controls" ng-if="slides.length > 1"><a role="button" href="" class="left carousel-control t_carousel-left" ng-click="prev()" ng-show="!slides[0].active"><span>&lt;</span> <span class="sr-only">previous</span></a> <a role="button" href="" class="right carousel-control t_carousel-right" ng-click="next()" ng-show="!slides[slides[0].actual.parentLimit-1].active"><span>&gt;</span> <span class="sr-only">next</span></a></div></div>'),e.put("app/blocks/layoutBlocks/collapsed.tpl.html",'<div class="t_collapsed"><div ng-click="toogleCollapse()" ng-class="{\'open\' : down}" class="t_toogleCollapsed toogle-collapsed collapse-wrapper"><span class="title" ng-show="down" ng-bind-html="placeholderShow"></span> <span class="title" ng-hide="down" ng-bind-html="placeholderHide"></span> <span class="arrow" ng-class="{\'open\' : down}"></span></div><div ng-if="content.blocks.length" class="collapsed-blocks subblocks {{startClass}}"><block-element ng-repeat="block in content.blocks" content="block"></block-element></div></div>'),e.put("app/blocks/layoutBlocks/columns.tpl.html",'<block-element ng-repeat="block in content.blocks" content="block"></block-element>'),e.put("app/blocks/layoutBlocks/container.list.tpl.html",'<li><block-element ng-repeat="block in content.blocks" content="block"></block-element></li>'),e.put("app/blocks/layoutBlocks/container.tpl.html",'<block-element ng-repeat="block in content.blocks" content="block"></block-element>'),e.put("app/blocks/layoutBlocks/dialog.table.tpl.html",'<table><tr ng-repeat="dialogRow in content.blocks"><td><answer-option type="dialogRow.person.type" option="dialogRow.person.option" config="{playerType: content.playerType}"></answer-option></td><td><block-element content="dialogRow"></block-element></td></tr></table>'),e.put("app/blocks/layoutBlocks/dialog.tpl.html","<ng-include src=\"'app/blocks/layoutBlocks/dialog.' + content.displayType + '.tpl.html'\"></ng-include>"),e.put("app/blocks/layoutBlocks/list.tpl.html",'<ol ng-if="content.numbered === \'numbered\'" class="t_list list-block" ng-class="classes" ng-style="orderedListStyles"><block-element ng-repeat="block in content.blocks | orderBy: \'order\'" atool-hide="limit <= $index" content="block" nonmarkable="limit <= $index"></block-element></ol><ul ng-if="content.numbered === \'non-numbered\'" class="t_list list-block" ng-class="classes"><block-element ng-repeat="block in content.blocks | orderBy: \'order\'" atool-hide="limit <= $index" content="block" nonmarkable="limit <= $index"></block-element></ul><engine-carousel ng-if="content.numbered === \'carousel\'" class="t_list list-block block-carousel" ng-class="classes" limit="limit" counter="true"><span ng-repeat="block in content.blocks | orderBy: \'order\'" engine-carousel-slide="{{$index}}" class="carousel-slide"><block-element content="block" nonmarkable-block="{{limit <= $index}}"></block-element></span></engine-carousel>'),e.put("app/blocks/layoutBlocks/table.tpl.html",'<table width="{{content.width}}"><tr ng-repeat="trblock in content.blocks" ng-class="trblock.allClasses"><td ng-repeat="tdblock in trblock.blocks" ng-class="tdblock.allClasses" colspan="{{tdblock.colspan}}" rowspan="{{tdblock.rowspan}}" width="{{tdblock.width}}"><block-element content="tdblock"></block-element></td></tr></table>'),e.put("app/blocks/layoutBlocks/tabs.tpl.html",'<div class="atool-tabs"><div class="atool-tabs-bar"><div ng-repeat="tab in content.blocks" ng-click="showTab($index)" ng-class="{\'active\': tab.show}" class="atool-tab"><span class="dot"></span></div></div><div ng-repeat="tab in content.blocks" class="t_tab-content" ng-class="{\'active\': tab.show}"><block-element atool-show="tab.show" content="tab" class="atool-tab-content"></block-element></div></div>'),e.put("app/blocks/wordpool/wordpool-item.tpl.html",'<span class="wordpool-item wordpool-item-{{wordpoolId}} t_wordpool-item" ng-class="{\'wordpool-item-asExample\': element.isExample === true}"><answer-option type="element.type" option="element.content" config="{playerType: element.playerType}"></answer-option></span>'),e.put("app/blocks/wordpool/wordpool.tpl.html",'<div class="wordpool-content t_wordpool" ng-class="getClasses()" ng-show="!isHidden" ng-click="handleWordpoolClick()"><span ng-show="wordpoolCtrl.isStatic() || !loState.isSolving()" class="wordpool-item t_wordpool-item wordpool-item-dnd" ng-class="{example: element.isExample}" ng-repeat="element in elementsToShow"><answer-option type="element.type" option="element.content" config="{playerType: content.playerType}"></answer-option></span><wordpool-item ng-show="wordpoolCtrl.isDnd() && loState.isSolving()" ng-repeat="element in elementsToShow" element="element" wordpool-id="{{content.id}}" origin-uuid="originUuid"></wordpool-item><span ng-show="wordpoolCtrl.isTapTap() && loState.isSolving() && !element.used" class="wordpool-item t_wordpool-item wordpool-item-taptap" ng-repeat="element in elementsToShow" ng-click="switchTapTapSelection(element); $event.stopPropagation();" ng-class="{\'wordpool-item-asExample\': element.isExample, selected: element.selected && taptapSelectedItem.origin === \'wordpool\'}"><answer-option type="element.type" option="element.content" config="{playerType: content.playerType}"></answer-option></span></div>'),e.put("app/common/directives/answerOption.tpl.html",'<span ng-if="type === \'text\'" ng-bind-html="trustHtml(option)" class="t_text-answer"></span> <span class="image-answer t_image-answer" ng-if="type === \'image\'"><engine-image undraggable="" url="option" class="image-answer" handle-load="handleLoad"></engine-image></span> <span class="audio-answer t_audio-answer" ng-if="type === \'audio\' && audioPlayerType === \'default\'"><engine-audio urls="option" features="[\'playpause\']" custom-width="\'51px\'"></engine-audio></span> <span class="audio-answer t_audio-answer" ng-if="type === \'audio\' && audioPlayerType === \'circular\'"><custom-circle-player urls="option"></custom-circle-player></span>'),e.put("app/common/directives/answerOptionPopover.tpl.html",'<span class="t_feedback atool-feedback" popover-class="exercise-wrapper-body" popover-append-to-body="true" uib-popover-template="answerTemplate" popover-trigger="popoverTrigger" popover-placement="auto top"></span>'),e.put("app/common/directives/answerOptionPopoverPopup.tpl.html",'<answer-option option="answerOption.option" type="answerOption.type" config="{playerType: answerOption.playerType}"></answer-option>'),e.put("app/common/directives/custom-player.tpl.html",'<div class="custom-player"><round-progress max="durationTime" current="currentTime" color="#5cbba8" bgcolor="#d4e2e3" radius="{{ radius || 14 }}" stroke="{{ stroke || 3 }}" duration="0"></round-progress><button ng-if="playToggle === false" class="cp-button cp-play" ng-click="play($event)"></button> <button ng-if="playToggle === true" class="cp-button cp-pause" ng-click="pause($event)"></button><audio ng-show="false" ng-if="!useSharedAudio"><source ng-repeat="source in trustedSources" ng-src="{{ source.url }}" type="{{ source.type }}"></audio></div>'),e.put("app/common/directives/engine.audio.tpl.html",'<audio class="js-media-element" ng-style="css" width="{{customWidth}}"></audio>'),e.put("app/common/directives/engine.document.tpl.html",'<div ng-style="css" class="engine-document"><a ng-href="{{link.url}}" class="document-link" ng-class="link.format" target="_blank"><span ng-if="displayName" class="document-displayname" ng-bind-html="displayName"></span></a></div>'),e.put("app/common/directives/engine.eyeball.button.tpl.html",'<button class="btn eyeball" ng-class="eyeball.getClasses(stateId)" ng-click="fire($event)"></button>'),e.put("app/common/directives/engine.image.fullscreen.tpl.html",'<div class="fullscreen-image-backdrop" ng-class="{\'enable-fullscreen\': enableFullscreen}"><div class="fullscreen-image js-fullscreen-image" ng-style="zoomedImageStyles"></div><button class="btn fullscreen-exit" ng-if="showExitButton" ng-click="exitZoom()" ng-style="exitButtonPosition"></button></div>'),e.put("app/common/directives/engine.image.tpl.html",'<div class="image-container"><div class="image-inner-container"><img ng-src="{{url}}" ng-style="css" alt="{{alt}}" crossorigin-manager="" ng-click="zoomExternal()" ng-class="{\'external-zoom-enabled\': externalZoomEnabled}"> <button class="btn zoom-button" ng-if="zoomEnabled" ng-click="zoomImage()"></button></div></div>'),e.put("app/common/directives/engine.video.tpl.html",'<video crossorigin-manager="" ng-style="css" width="{{customWidth}}" height="{{customHeight}}" preload="none" playsinline="" webkit-playsinline=""><track ng-repeat="(lang, subtitle) in subtitles" ng-if="!content.displaySubs[lang]" ng-src="{{subtitle | trustUrl}}" kind="subtitles" srclang="{{lang}}" label="{{ \'lang_\'+lang | engineTranslate:dataCollector }}"></track></video>'),e.put("app/common/directives/keyboard.items.tpl.html",'<div ng-attr-id="{{\'keyboard_\' + uniqueId}}" style="position: absolute;" class="fillin-keyboard"><table><tr><td class="kitem" ng-repeat="sign in specialSigns | filter:filterSigns"><span class="kitem" ng-click="addSpecialSign(sign)">{{sign.sign}}</span></td><td class="kitem"><span ng-click="shiftSpecialSigns()" class="kitem" ng-class="{\'shift-pressed\': areSignsUp}">⇧</span></td><td class="kitem" ng-repeat="lang in languagesList"><span ng-click="languageChange(lang)" class="kitem" ng-class="{\'shift-pressed\': isLangChosen(lang) }"><span class="kitem flag" ng-class="\'flag-\' + lang"></span></span></td></tr></table></div>'),e.put("app/common/directives/keyboard.tpl.html",'<span off-click="hideKeyboard(false, $event)" class="gap-keyboard-container t_keyboard" ng-class="customClasses || {}"><span ng-class="customClasses || {}" ng-transclude=""></span></span>'),e.put("app/common/directives/loSummary.tpl.html",'<div class="lo-summary lo-summary-hidden"><b>id:</b> {{ loId }}<br><b>organization:</b> {{ organization }}<br><b>elapsed time:</b> {{ ("00"+elapsedMinutes).slice(-2) }}:{{ ("00"+elapsedSeconds).slice(-2) }}<br><b>marking options:</b> {{ markingOptions }}<br><ul ng-if="!hasSegmented"><li ng-repeat="task in tasks"><b>task {{ $index }}:</b> {{ task.reportData.points }}/{{ task.reportData.pointsToGain }}</li></ul><ul ng-if="hasSegmented"><li ng-repeat="screen in screens"><b>screen {{ $index }}:</b> {{ screen.state.points }}/{{ screen.state.pointsToGain }}</li></ul></div>'),e.put("app/common/directives/stickToTop.directive.tpl.html",'<div class="js-sticker-fixed-container sticker-fixed-container"><div class="js-sticker-original sticker-original" ng-transclude=""></div></div><div class="js-sticker-placeholder sticker-placeholder"></div>'),e.put("app/formats/categorisation/categorisation.tpl.html","<span class=\"categorisation t_categorisation\"><categorisation-choosable ng-if=\"gapModel.getDisplayType() == 'radio' || gapModel.getDisplayType() == 'checkboxes' || gapModel.getDisplayType() == 'dropdown'\"></categorisation-choosable><categorisation-assign ng-class=\"{'categorisation-image-only': true}\" ng-if=\"gapModel.getDisplayType() == 'fillin' || gapModel.getDisplayType() == 'dnd'\"></categorisation-assign><categorisation-taptap ng-if=\"gapModel.getDisplayType() == 'taptap'\"></categorisation-taptap></span>"),e.put("app/formats/categorisation/categorisationAssign.tpl.html","<span class=\"t_catAssign\"><ng-include src=\"'app/formats/categorisation/templates/categorisationAssign-' + gapModel.getDisplayType() + '.tpl.html'\"></ng-include></span>"),e.put("app/formats/categorisation/categorisationChoosable.tpl.html","<span class=\"t_catChoosable\"><ng-include src=\"'app/formats/categorisation/templates/categorisationChoosable-' + gapModel.getDisplayType() + '.tpl.html'\"></ng-include></span>"),e.put("app/formats/categorisation/categorisationTaptap.tpl.html",'<div ng-if="gapModel.shouldBeRenderedAsSolving()"><div ng-repeat="category in options.answers.categories" class="sort-option-wrapper sort-category-id-{{category.id}}"><div ng-click="toggleCollapse(category, true)" ng-class="{\'isOpen\' : category.isOpen}" class="sort-option-toggle"><span class="title"><answer-option type="category.type" option="category.category" config="{playerType: options.playerType}"></answer-option></span> <span class="arrow" ng-class="{\'isOpen\' : category.isOpen}"></span></div><div class="js-collapsed-blocks" data-id="{{category.id}}" style="display: none"><div ng-click="!selected.option || selectCategory(category)" class="sort-selected-container" ng-class="{\'sort-container-option-selected\': selected.option}"><span ng-if="isCategoryEmpty(category)" class="sort-placeholder-cat"></span><div ng-repeat="option in examplesForCategory(category)" class="sort-matched-option example" data-title="{{option.option}}"><answer-option type="option.type" option="option.option" config="{playerType: options.playerType}" data-title="{{option.option}}"></answer-option></div><div ng-class="{\'selected-to-unmatch\': selectedToUnmatch === option}" ng-repeat="option in wordpoolElementsForCategory(category)" class="sort-matched-option" data-title="{{option.content}}"><answer-option ng-click="selectOptionToUnmatch(option)" type="option.type" option="option.content" config="{playerType: options.playerType}" data-title="{{option.content}}"></answer-option></div></div><div class="sort-options-container" ng-click="unmatchOption(category)"><div class="sort-option-in-container" ng-repeat="option in wordpoolElements" ng-class="{\'sort-option-selected\': selected.option === option}" ng-click="selectOption($event, option)" ng-if="!option.category_selected || option.category_selected.length === 0 || wordpool.duplicate" data-title="{{option.content}}"><answer-option type="option.type" option="option.content" config="{playerType: options.playerType}" data-title="{{option.content}}"></answer-option></div></div></div></div></div><div ng-if="gapModel.shouldBeRenderedAsReport()" ng-class="{\'correct\': gapModel.shouldBeRenderedAsGivenReport(\'system\') && gapModel.states[0].isCorrect(), \'wrong\': gapModel.shouldBeRenderedAsGivenReport(\'system\') && gapModel.states[0].isWrong(), \'missing\': gapModel.shouldBeRenderedAsGivenReport(\'system\') && gapModel.states[0].isMissing()}"><div ng-repeat="category in options.answers.categories" ng-class="{\'correct\': gapModel.shouldBeRenderedAsGivenReport(\'system-category\') && gapModel.states[category.id].isCorrect(), \'wrong\': gapModel.shouldBeRenderedAsGivenReport(\'system-category\') && gapModel.states[category.id].isWrong(), \'missing\': gapModel.shouldBeRenderedAsGivenReport(\'system-category\') && gapModel.states[category.id].isMissing()}" class="sort-option-wrapper sort-category-id-{{category.id}}"><div class="isOpen sort-option-toggle hide-arrow"><span class="title"><answer-option type="category.type" option="category.category" config="{playerType: options.playerType}"></answer-option></span></div><div class="js-collapsed-blocks" data-id="{{category.id}}"><div class="sort-options-container"><div ng-repeat="option in examplesForCategory(category)" class="sort-report-answer example" data-title="{{option.option}}"><answer-option type="option.type" option="option.option" config="{playerType: options.playerType}" data-title="{{option.option}}"></answer-option></div><div ng-class="getReportClassForOption(option, category)" ng-repeat="option in wordpoolElementsForCategory(category)" class="sort-report-answer" data-title="{{option.content}}"><answer-option type="option.type" option="option.content" config="{playerType: options.playerType}" data-title="{{option.content}}"></answer-option></div></div></div></div></div><div class="showAnswer" ng-if="gapModel.shouldBeRenderedAsShowAnswer()" ng-class="{\'correct\': options.markedBy === \'system\'}"><div ng-repeat="category in options.answers.categories" ng-class="{\'correct\': options.markedBy === \'system-category\'}" class="sort-option-wrapper sort-category-id-{{category.id}}"><div class="isOpen sort-option-toggle hide-arrow"><span class="title"><answer-option type="category.type" option="category.category" config="{playerType: options.playerType}"></answer-option></span></div><div class="js-collapsed-blocks" data-id="{{category.id}}"><div class="sort-options-container"><div ng-repeat="option in examplesForCategory(category)" ng-class="{\'correct\': options.markedBy === \'system-option\' || options.markedBy === \'system-option-part\'}" class="sort-report-answer example" data-title="{{option.option}}"><answer-option type="option.type" option="option.option" config="{playerType: options.playerType}" data-title="{{option.option}}"></answer-option></div><div ng-repeat="option in optionsForCategory(category)" ng-class="{\'correct\': options.markedBy === \'system-option\' || options.markedBy === \'system-option-part\'}" class="sort-report-answer" data-title="{{option.content}}"><answer-option type="option.type" option="option.option" config="{playerType: options.playerType}" data-title="{{option.content}}"></answer-option></div></div></div></div></div>'),e.put("app/formats/categorisation/category-dnd.tpl.html",'<div class="category_drop dnd-gap" data-cat="{{category.id}}" data-origin-uuid="{{originUuid}}" ng-click="categorisationScope.handleTapTapClick(category.id)"><span ng-repeat="example in examples[category.id]"><span class="example dnd-item"><answer-option type="example.type" option="example.option" config="{playerType: options.playerType}"></answer-option></span></span> <span ng-repeat="answer in $parent.answersWithoutExamples | filter : {category: category.id}" ng-if="$index < $parent.$parent.gapModel.eyeball.getAnswersToShowCounter(category.id)"><span class="show-answer dnd-item t_show-answer"><answer-option type="answer.type" option="answer.option" config="{playerType: options.playerType}"></answer-option></span></span> <span ng-repeat="input in categorisationScope.answerInputs[category.id]" ng-if="categorisationScope.wordpoolType === \'taptap\'" ng-click="categorisationScope.handleTapTapClick(category.id, $index); $event.stopPropagation();"><span class="dnd-item" ng-class="categorisationScope.reportClasses(input, category)"><answer-option type="input.type" option="input.answer" config="{playerType: options.playerType}"></answer-option></span></span> <span ng-repeat="input in categorisationScope.answerInputs[category.id]" ng-if="$index < categorisationScope.gapModel.eyeball.getAnswersToCheckCounter(category.id)"><span class="dnd-item" ng-class="categorisationScope.reportClasses(input, category)"><answer-option type="input.type" option="input.answer" config="{playerType: options.playerType}"></answer-option></span></span></div>'),e.put("app/formats/concentration/concentration.tpl.html",'<div class="concentration"><div class="con-container" ng-class="{animated: useAnimations}"><div class="con-card js-con-card" ng-repeat="card in cards"><div class="flipper" card-id="{{card.id}}" ng-class="{flipped: card.state === \'flipped\'}"><div class="front" ng-class="{active: card.state === \'initial\'}" ng-click="flipCard(card)"><span class="card-front"></span></div><div class="back" ng-class="{active: card.state === \'flipped\'}"><span class="con-card-text" ng-if="card.type === \'name\' || card.type === \'name2\'" ng-bind-html="card.option"></span> <img class="con-card-image" ng-if="card.type === \'image\'" ng-src="{{ card.option.links[0].url }}"></div></div></div></div></div>'),e.put("app/formats/concentration/finish.popup.tpl.html",'<div class="submitted-popup memory-popup"><div class="memory-checkmark-container"></div><div class="memory-popup-text"><div class="memory-popup-title">{{ \'memory_win_title\' | engineTranslate:dataCollector }}</div><div class="memory-popup-subtitle">{{ \'memory_win_subtitle\' | engineTranslate:dataCollector }}</div></div></div>'),e.put("app/formats/crossword/crossword.tpl.html",'<div><div ng-if="structureGenerated" class="crossword t_crossword"><crossword-general ng-if="getMainDisplayType() == \'general\'"></crossword-general><crossword-horizontal ng-if="getMainDisplayType() == \'horizontal\'"></crossword-horizontal></div><div ng-if="!structureGenerated" class="crossword-msg">Can not generate crossword</div></div>'),e.put("app/formats/crossword/crosswordGeneral.tpl.html",'<span class="crossword-general t_crossword-general"><div class="grid-container"><span ng-if="gapModel.shouldBeRenderedAsSolving()"><table><tbody><tr ng-repeat="row in crosswordStructure"><td ng-repeat="letter in row" ng-click="highlightWords(letter.word)" ng-class="{\'no-border\': isEmpty(letter), \'border\': !isEmpty(letter), \'active\': letter.focus, \'hiddenLetter\': letter.hidden, \'space-horizontal\': spaceAfter(letter, \'horizontal\'), \'space-vertical\': spaceAfter(letter, \'vertical\')}"><span class="number" ng-if="hasFirst(letter)">{{getNumber(letter)}}</span><keyboard ng-if="gapModel.getDisplayType() === \'general-keyboard\' && !letter.example && !isEmpty(letter) && !letter.fixed" class="cw-letter" keyboard-key-press="onLetterChangeFromKeyboard($event, letter)" parent-sizing="getElementSizing(letter)" custom-classes="{\'cw-letter-keyboard\': true}"><input spellcheck="false" class="t_solvingInput input-field cw-letter" type="text" maxlength="1" focus-on="letter.focusIn" ng-focus="highlightWords(letter.word)" ng-keydown="keyDown($event, letter)" ng-keypress="onLetterChange($event, letter)" ng-model="letter.userLetter" ng-blur="setLetter(letter)"></keyboard><input ng-if="gapModel.getDisplayType() === \'general\' && !letter.example && !isEmpty(letter) && !letter.fixed" spellcheck="false" class="t_solvingInput input-field cw-letter" type="text" maxlength="1" focus-on="letter.focusIn" ng-focus="highlightWords(letter.word)" ng-keydown="keyDown($event, letter)" ng-keypress="onLetterChange($event, letter)" ng-model="letter.userLetter" ng-blur="setLetter(letter)"> <span class="example cw-letter t_example" ng-if="letter.example || letter.fixed">{{letter.letter}}</span></td></tr></tbody></table></span> <span ng-if="gapModel.shouldBeRenderedAsShowAnswer()"><table><tbody><tr ng-repeat="row in crosswordStructure"><td ng-repeat="letter in row" ng-click="highlightWords(letter.word)" ng-class="{\'no-border\': isEmpty(letter), \'border\': !isEmpty(letter), \'active\': letter.focus, \'hiddenLetter\': letter.hidden, \'space-horizontal\': spaceAfter(letter, \'horizontal\'), \'space-vertical\': spaceAfter(letter, \'vertical\')}"><span class="number" ng-if="hasFirst(letter)">{{getNumber(letter)}}</span> <span class="show-answers cw-letter t_showAnswers" ng-if="!letter.example && !letter.fixed">{{letter.letter}}</span> <span class="example cw-letter t_example" ng-if="letter.example || letter.fixed">{{letter.letter}}</span></td></tr></tbody></table></span> <span ng-if="gapModel.shouldBeRenderedAsReport()"><span ng-class="{\'correct t_correct\': gapModel.shouldBeRenderedAsGivenReport(\'system\') && gapModel.states[0].isCorrect(), \'wrong t_wrong\': gapModel.shouldBeRenderedAsGivenReport(\'system\') && gapModel.states[0].isWrong(), \'missing t_missing\': gapModel.shouldBeRenderedAsGivenReport(\'system\') && gapModel.states[0].isMissing()}"><table><tbody><tr ng-repeat="row in crosswordStructure"><td ng-repeat="letter in row" ng-click="highlightWords(letter.word)" ng-class="getReportClasses(letter)"><span class="number" ng-if="hasFirst(letter)">{{getNumber(letter)}}</span> <span ng-if="!letter.example && !letter.fixed" class="report cw-letter t_report">{{letter.userLetter}}</span> <span class="example cw-letter t_example" ng-if="letter.example || letter.fixed">{{letter.letter}}</span></td></tr></tbody></table></span></span> <span ng-if="gapModel.shouldBeRenderedAsExample()"><table><tbody><tr ng-repeat="row in crosswordStructure"><td ng-repeat="letter in row" ng-click="highlightWords(letter.word)" ng-class="{\'no-border\': isEmpty(letter), \'border\': !isEmpty(letter), \'active\': letter.focus, \'hiddenLetter\': letter.hidden, \'space-horizontal\': spaceAfter(letter, \'horizontal\'), \'space-vertical\': spaceAfter(letter, \'vertical\')}"><span class="number" ng-if="hasFirst(letter)">{{getNumber(letter)}}</span> <span class="example cw-letter">{{letter.letter}}</span></td></tr></tbody></table></span></div><div class="clues t_clues"><div class="clues-col across t_cluesAcross"><h3>Across:</h3><ol><li ng-repeat="clue in cluesStructure | horizontal | orderBy: \'number\'" ng-click="highlightWord(clue.id)" ng-class="{\'active\': clue.focus}"><span class="number t_cluesNumber">{{clue.number}}</span><span><answer-option type="clue.type" option="clue.clue" config="{playerType: options.playerType}"></answer-option></span></li></ol></div><div class="clues-col down t_cluesDown"><h3>Down:</h3><ol><li ng-repeat="clue in cluesStructure | vertical | orderBy: \'number\'" ng-click="highlightWord(clue.id)" ng-class="{\'active\': clue.focus}"><span class="number t_cluesNumber">{{clue.number}}</span><span><answer-option type="clue.type" option="clue.clue" config="{playerType: options.playerType}"></answer-option></span></li></ol></div></div></span>'),e.put("app/formats/crossword/crosswordHorizontal.tpl.html",'<span class="crossword-horizontal t_crossword-horizontal"><div class="grid-container"><span ng-if="gapModel.shouldBeRenderedAsSolving()"><table><tbody><tr ng-repeat="row in crosswordStructure"><td ng-repeat="letter in row" ng-click="highlightWords(letter.word)" ng-class="{\'no-border\': isEmpty(letter), \'border\': !isEmpty(letter), \'active\': letter.focus, \'hiddenLetter\': letter.hidden, \'space-horizontal\': spaceAfter(letter, \'horizontal\'), \'space-vertical\': spaceAfter(letter, \'vertical\')}"><span class="number" ng-if="hasFirst(letter)">{{getNumber(letter)}}</span><keyboard ng-if="gapModel.getDisplayType() === \'horizontal-keyboard\' && !letter.example && !isEmpty(letter) && !letter.fixed" class="cw-letter" keyboard-key-press="onLetterChangeFromKeyboard($event, letter)" parent-sizing="getElementSizing(letter)" custom-classes="{\'cw-letter-keyboard\': true}"><input spellcheck="false" class="input-field cw-letter" type="text" maxlength="1" focus-on="letter.focusIn" ng-focus="highlightWords(letter.word)" ng-keydown="keyDown($event, letter)" ng-keypress="onLetterChange($event, letter)" ng-model="letter.userLetter" ng-blur="setLetter(letter)"></keyboard><input ng-if="gapModel.getDisplayType() === \'horizontal\' && !letter.example && !isEmpty(letter) && !letter.fixed" spellcheck="false" class="input-field cw-letter" type="text" maxlength="1" focus-on="letter.focusIn" ng-focus="highlightWords(letter.word)" ng-keydown="keyDown($event, letter)" ng-keypress="onLetterChange($event, letter)" ng-model="letter.userLetter" ng-blur="setLetter(letter)"> <span class="example cw-letter" ng-if="letter.example || letter.fixed">{{letter.letter}}</span></td></tr></tbody></table></span> <span ng-if="gapModel.shouldBeRenderedAsShowAnswer()"><table><tbody><tr ng-repeat="row in crosswordStructure"><td ng-repeat="letter in row" ng-click="highlightWords(letter.word)" ng-class="{\'no-border\': isEmpty(letter), \'border\': !isEmpty(letter), \'active\': letter.focus, \'hiddenLetter\': letter.hidden, \'space-horizontal\': spaceAfter(letter, \'horizontal\'), \'space-vertical\': spaceAfter(letter, \'vertical\')}"><span class="number" ng-if="hasFirst(letter)">{{getNumber(letter)}}</span> <span class="show-answers cw-letter" ng-if="!letter.example && !letter.fixed">{{letter.letter}}</span> <span class="example cw-letter" ng-if="letter.example || letter.fixed">{{letter.letter}}</span></td></tr></tbody></table></span> <span ng-if="gapModel.shouldBeRenderedAsReport()"><span ng-class="{\'correct t_correct\': gapModel.shouldBeRenderedAsGivenReport(\'system\') && gapModel.states[0].isCorrect(), \'wrong t_wrong\': gapModel.shouldBeRenderedAsGivenReport(\'system\') && gapModel.states[0].isWrong(), \'missing t_missing\': gapModel.shouldBeRenderedAsGivenReport(\'system\') && gapModel.states[0].isMissing()}"><table><tbody><tr ng-repeat="row in crosswordStructure"><td ng-repeat="letter in row" ng-click="highlightWords(letter.word)" ng-class="getReportClasses(letter)"><span class="number" ng-if="hasFirst(letter)">{{getNumber(letter)}}</span> <span ng-if="!letter.example && !letter.fixed" class="report cw-letter">{{letter.userLetter}}</span> <span class="example cw-letter" ng-if="letter.example || letter.fixed">{{letter.letter}}</span></td></tr></tbody></table></span></span> <span ng-if="gapModel.shouldBeRenderedAsExample()"><table><tbody><tr ng-repeat="row in crosswordStructure"><td ng-repeat="letter in row" ng-click="highlightWords(letter.word)" ng-class="{\'no-border\': isEmpty(letter), \'border\': !isEmpty(letter), \'active\': letter.focus, \'hiddenLetter\': letter.hidden, \'space-horizontal\': spaceAfter(letter, \'horizontal\'), \'space-vertical\': spaceAfter(letter, \'vertical\')}"><span class="number" ng-if="hasFirst(letter)">{{getNumber(letter)}}</span> <span class="example cw-letter">{{letter.letter}}</span></td></tr></tbody></table></span></div><div class="clues"><div class="clues-col single"><h3>Clues:</h3><ol><li ng-repeat="clue in cluesStructure | orderBy: \'number\'" ng-click="highlightWord(clue.id)" ng-class="{\'active\': clue.focus}"><span class="number">{{clue.number}}</span><span><answer-option type="clue.type" option="clue.clue" config="{playerType: options.playerType}"></answer-option></span></li></ol></div></div></span>'),e.put("app/formats/flashcards/flashcards.tpl.html",'<span class="flashcards t_flashcards"><span ng-if="gapModel.shouldBeRenderedAsSolving()"><div class="flip-container" ng-click="flipSide()" ng-class="{flipped: currentSide == \'back\'}"><div class="front t_front"><div class="card-content"><span ng-repeat="item in gapModel.attrs.answers.front"><answer-option type="item.type" option="item.option" config="{playerType: options.playerType}"></answer-option></span></div></div><div class="back t_back"><div class="card-content"><span ng-repeat="item in gapModel.attrs.answers.back"><answer-option type="item.type" option="item.option" config="{playerType: options.playerType}"></answer-option></span></div><div class="card-btns"><a class="correct-btn t_known-button" ng-class="{\'active\': gapModel.userAnswer.isKnown === true}" ng-click="setKnown($event)"></a> <a class="wrong-btn t_unknown-button" ng-class="{\'active\': gapModel.userAnswer.isKnown === false}" ng-click="setUnknown($event)"></a></div></div></div></span> <span ng-if="gapModel.shouldBeRenderedAsReport() || gapModel.shouldBeRenderedAsShowAnswer() || gapModel.shouldBeRenderedAsExample()"><div class="flip-container" ng-click="flipSide()" ng-class="{flipped: currentSide == \'back\'}"><div class="front t_front"><div class="card-content"><span ng-repeat="item in gapModel.attrs.answers.front"><answer-option type="item.type" option="item.option" config="{playerType: options.playerType}"></answer-option></span></div></div><div class="back t_back"><div class="card-content"><span ng-repeat="item in gapModel.attrs.answers.back"><answer-option type="item.type" option="item.option" config="{playerType: options.playerType}"></answer-option></span></div></div></div></span></span>'),e.put("app/formats/flashcardsWordlist/confirmRemoveFlashcard.popup.tpl.html",'<div class="modal-body warning-popup"><h3 class="warning-popup-header">{{ \'cengage_fcwl_deck_remove_warning\' | engineTranslate:dataCollector }}</h3><p ng-bind-html="\'cengage_fcwl_deck_remove_text\' | engineTranslate:dataCollector"></p><div class="warning-popup-dontshowagain"><label class="wordlist-checkbox"><input class="warning-popup-checkbox" type="checkbox" ng-model="popupConfig.dontShowConfirmationModal"><span class="option">{{ \'cengage_fcwl_deck_remove_dontshowagain\' | engineTranslate:dataCollector }}</span></label></div><div class="warning-popup-buttons"><button class="btn btn-popup-confirm" ng-click="confirm()">{{ \'cengage_fcwl_deck_remove_confirm\' | engineTranslate:dataCollector }}</button> <button class="btn btn-default btn-cancel" ng-click="modalInstance.dismiss(\'cancel\')">{{ \'cengage_fcwl_deck_remove_cancel\' | engineTranslate:dataCollector }}</button></div></div>'),e.put("app/formats/flashcardsWordlist/flashcards.activity.tpl.html","<div><ng-include src=\"'app/formats/flashcardsWordlist/flashcards.' + mode + '.tpl.html'\"></ng-include></div>"),e.put("app/formats/flashcardsWordlist/flashcards.deck.tpl.html",'<div class="flashcard-wrapper"><div class="flashcard-card-wrapper"><div ng-if="selectedCards.length > config.currentCardIndex + 2" class="flashcard-card-container flashcard-deck2"></div><div ng-if="selectedCards.length > config.currentCardIndex + 1" class="flashcard-card-container flashcard-deck1"></div><div class="flashcard-card-container" ng-class="{\'has-audio-global\': config.currentAudio, \'has-image-global\': config.currentImage}"><div class="flashcard-counter">{{ config.currentCardIndex + 1 }} {{ \'cengage_fcwl_deck_of\' | engineTranslate:dataCollector }} {{ selectedCards.length }}</div><div class="flashcard-remove-btn"><button ng-click="tryToRemoveCurrentCardFromDeck()" ng-disabled="selectedCards.length <= 1" class="btn btn-remove"></button></div><div ng-if="selectedCards[config.currentCardIndex].side == \'term\'" class="flashcard-card-front"><p><custom-circle-player ng-if="config.currentAudio" urls="config.currentAudio" radius="48" stroke="6"></custom-circle-player></p><p class="flashcard-front-text">{{ selectedCards[config.currentCardIndex].name }}</p></div><div ng-if="selectedCards[config.currentCardIndex].side == \'definition\'" class="flashcard-card-back"><div ng-if="config.currentImage" style="background-image: url({{config.currentImage}})" class="flashcard-back-image"></div><div class="flashcard-text"><p class="flashcard-text-repeated-term" ng-if="options.repeat"><custom-circle-player ng-if="config.currentAudio" urls="config.currentAudio"></custom-circle-player><strong>{{ selectedCards[config.currentCardIndex].name }}</strong></p><div class="flashcard-scrollable-definition" ng-class="{\'has-audio\': config.currentAudio}"><p ng-bind-html="selectedCards[config.currentCardIndex].definition" class="flashcard-back-definition"></p><p ng-if="selectedCards[config.currentCardIndex].translation" ng-bind-html="selectedCards[config.currentCardIndex].translation" class="flashcard-back-translation"></p></div></div></div><button ng-click="flipCard()" class="btn btn-flip btn-flip-card">{{ \'cengage_fcwl_deck_flip\' | engineTranslate:dataCollector }}</button></div><button ng-click="changeCard(config.currentCardIndex - 1)" class="btn btn-prev"></button> <button ng-click="changeCard(config.currentCardIndex + 1)" class="btn btn-next-fl"></button></div><div class="flashcard-controls"><button ng-click="flipDeck()" class="btn btn-flip-deck">{{ \'cengage_fcwl_deck_flipdeck\' | engineTranslate:dataCollector }}</button> <button ng-click="shuffle()" class="btn btn-shuffle-deck">{{ \'cengage_fcwl_deck_shuffle\' | engineTranslate:dataCollector }}</button> <button ng-if="options.wordlist" ng-click="goToWordlist()" class="btn btn-word-list">{{ \'cengage_fcwl_wordlist\' | engineTranslate:dataCollector }}</button></div></div>'),e.put("app/formats/flashcardsWordlist/flashcards.tpl.html","<div><ng-include src=\"'app/formats/flashcardsWordlist/flashcards.' + mode + '.tpl.html'\"></ng-include></div>"),e.put("app/formats/flashcardsWordlist/flashcards.wordlist.tpl.html",'<div class="wordlist-wrapper flashcard-wrapper"><h2 class="wordlist-header">{{ \'cengage_fcwl_wordlist\' | engineTranslate:dataCollector }}</h2><p class="wordlist-instruction">{{ \'cengage_fcwl_wordlist_instruction\' | engineTranslate:dataCollector }}</p><label class="wordlist-select-all wordlist-checkbox"><input type="checkbox" ng-model="config.selectAllChecked" ng-change="selectAll()"><span class="option">{{ \'cengage_fcwl_wordlist_selectall\' | engineTranslate:dataCollector }}</span></label><div class="wordlist-list-wrapper"><ul class="wordlist-list"><li ng-repeat="card in options.cards"><label class="wordlist-select-single wordlist-checkbox"><input type="checkbox" ng-model="card.selected" ng-change="selectCard()"><span class="option">{{ card.name }}</span></label></li></ul></div><div class="wordlist-btn-container"><button ng-disabled="selectedCards.length === 0" ng-click="createFlashcards()" class="btn btn-create-flashcards"><span>{{ \'cengage_fcwl_wordlist_createflashcards\' | engineTranslate:dataCollector }}</span></button></div></div>'),e.put("app/formats/freeWriting/freeWriting.tpl.html",'<span class="free-writing t_free-writing"><span ng-if="gapModel.shouldBeRenderedAsSolving()"><textarea spellcheck="false" ng-model="gapModel.userAnswer" rows="6" cols="50" ng-change="onChangeUserAnswer()" maxlength="{{charaktersLimit}}" ng-trim="false" class="t_solving"></textarea></span> <span ng-if="gapModel.shouldBeRenderedAsShowAnswer()" class="show-answer"><textarea spellcheck="false" ng-model="modelAnswer" disabled="" rows="6" cols="50" class="t_showAnswer"></textarea></span> <span ng-if="gapModel.shouldBeRenderedAsReport()" ng-class="gapModel.getCorrectnessClasses(0)"><textarea spellcheck="false" ng-model="gapModel.userAnswer" disabled="" rows="6" cols="50" class="t_report"></textarea></span> <span ng-if="gapModel.shouldBeRenderedAsExample()" class="example t_example"><textarea spellcheck="false" ng-model="modelAnswer" disabled="" rows="6" cols="50" class="example t_example"></textarea></span></span>'),e.put("app/formats/gapfill/gapfill-dnd.tpl.html",'<span class="dnd-droppable dnd-gap"></span>'),e.put("app/formats/gapfill/gapfill.tpl.html","<span class=\"gapfill t_gapfill\"><ng-include src=\"'app/formats/gapfill/templates/gapfill-' + getGFDisplayType() + '.tpl.html'\"></ng-include></span>"),e.put("app/formats/matching/matLine.tpl.html","<g><path></path></g>"),e.put("app/formats/matching/matching.matching.tpl.html",'<span class="matching t_matching" mat-model="" ng-class="getAutonumberingClasses()"><div class="mat-wrapper t_matching_wrapper" ng-class="{ \'report wrong\': gapModel.shouldBeRenderedAsGivenReport(\'system\') && gapModel.states[0].isWrong(), \'report correct\': gapModel.shouldBeRenderedAsGivenReport(\'system\') && gapModel.states[0].isCorrect(), \'report missing\': gapModel.shouldBeRenderedAsGivenReport(\'system\') && gapModel.states[0].isMissing()}"><div class="mat-options"><div class="mat-option t_option" ng-if="option.option !== null" ng-repeat="option in gapModel.attrs.answers" ng-click="option.example || select(option, \'option\')" ng-class="getOptionClass(option, \'option\')" mat-register="" mat-register-type="\'option\'" mat-register-option="option"><answer-option type="option.type_option" option="option.option" config="{playerType: options.playerType}"></answer-option></div></div><div class="mat-matches"><div class="mat-match t_match" ng-if="option.match !== null" ng-repeat="option in gapModel.attrs.answers | orderBy: \'order\'" ng-click="option.example || select(option, \'match\')" ng-class="getOptionClass(option, \'match\')" mat-register="" mat-register-type="\'match\'" mat-register-option="option"><answer-option type="option.type_match" option="option.match" config="{playerType: options.playerType}"></answer-option><engine-eyeball-button on-fire="fireEyeball(option)" ng-if="shouldShowEyeballs && gapModel.shouldBeRenderedAsSolving() && !option.example" eyeball="gapModel.eyeball" state-id="option.id"></engine-eyeball-button></div></div><svg xmlns="http://www.w3.org/2000/svg" class="mat-connections" shape-rendering="geometricPrecision"><mat-line ng-class="\'t_matline\'" ng-if="gapModel.shouldBeRenderedAsSolving() && !gapModel.eyeball.shouldBeRenderedAsReport(connected.match.id)" ng-repeat="connected in matched" mat-usemodel="{option: connected.option, match: connected.match}" ng-click="removeMatched(connected)"></mat-line><mat-line class="t_matline show-answer" ng-if="gapModel.shouldBeRenderedAsShowAnswer() && connected.option && connected.match" ng-repeat="connected in gapModel.attrs.answers | filter:{example:false}" mat-usemodel="{option: connected, match: connected}"></mat-line><mat-line class="t_matline show-answer" ng-if="gapModel.eyeball.shouldBeRenderedAsShowAnswer(connected.match.id)" ng-repeat="connected in eyeballMatched" mat-usemodel="{option: connected.option, match: connected.match}"></mat-line><mat-line ng-if="gapModel.shouldBeRenderedAsReport() && gapModel.attrs.markedBy !== \'non-marked\'" ng-repeat="connected in matched" mat-usemodel="{option: connected.option, match: connected.match}" ng-class="{ \'t_matline\': true, \'correct\': connected.correct && gapModel.shouldBeRenderedAsGivenReport(\'system-option\'), \'wrong\': !connected.correct && gapModel.shouldBeRenderedAsGivenReport(\'system-option\') }"></mat-line><mat-line class="t_matline" ng-if="gapModel.shouldBeRenderedAsReport() && gapModel.attrs.markedBy === \'non-marked\'" ng-repeat="connected in matched" mat-usemodel="{option: connected.option, match: connected.match}"></mat-line><mat-line ng-if="gapModel.eyeball.shouldBeRenderedAsReport(connected.match.id)" ng-repeat="connected in eyeballMatched" mat-usemodel="{option: connected.option, match: connected.match}" ng-class="{ \'t_matline\': true, \'correct\': connected.correct, \'wrong\': !connected.correct}"></mat-line><mat-line class="example t_matline" ng-repeat="connected in gapModel.attrs.answers | filter:{example:true}" mat-usemodel="{option: connected, match: connected}"></mat-line><mat-line ng-if="gapModel.shouldBeRenderedAsExample()" class="example t_matline" ng-repeat="connected in gapModel.attrs.answers" mat-usemodel="{option: connected, match: connected}"></mat-line></svg><div class="clear"></div></div></span>'),e.put("app/formats/matching/matching.taptap.tpl.html",'<div ng-if="gapModel.shouldBeRenderedAsSolving()"><div ng-repeat="option in filteredAnswers" class="mat-option-wrapper mat-option-id-{{option.id}}" ng-class="{example: option.example}"><div ng-click="toggleCollapse(option, true)" ng-class="{\'isOpen\' : option.isOpen}" class="mat-option-toggle"><span class="title"><answer-option type="option.type_match" option="option.match" config="{playerType: options.playerType}"></answer-option></span> <span class="arrow" ng-class="{\'isOpen\' : option.isOpen}"></span></div><div class="js-collapsed-blocks" style="display: none"><div ng-click="option.example || !selected.option || selectMatch(option)" class="mat-selected-container" ng-class="getContainerClassInTapTap(option)"><span ng-if="!(option.selectedOptionId >= 0)" class="mat-placeholder-cat"></span><div ng-class="{\'selected-to-unmatch\': selectedToUnmatch}" ng-if="option.selectedOptionId >= 0 && !option.example" class="mat-matched-option" data-title="{{options.answers[option.selectedOptionId].option}}"><answer-option ng-click="selectOptionToUnmatch(options.answers[option.selectedOptionId])" type="options.answers[option.selectedOptionId].type_option" option="options.answers[option.selectedOptionId].option" config="{playerType: options.playerType}" data-title="{{options.answers[option.selectedOptionId].option}}"></answer-option></div><div ng-if="option.example" class="mat-matched-option example" data-title="{{option.option}}"><answer-option type="option.type_option" option="option.option" config="{playerType: options.playerType}"></answer-option></div></div><div class="mat-options-container" ng-click="option.example || unmatchOption()"><div class="mat-option-in-container" ng-repeat="answer in options.answers | orderBy: \'order\'" ng-class="getOptionClassInTapTap(answer)" ng-click="option.example || selectOption($event, answer)" ng-if="answer.match !== null && answer.option !== null && !(answer.selectedMatchId >=0) && !answer.example" data-title="{{answer.option}}"><answer-option type="answer.type_option" option="answer.option" config="{playerType: options.playerType}" data-title="{{answer.option}}"></answer-option></div></div></div></div></div><div class="report" ng-if="gapModel.shouldBeRenderedAsReport()" ng-class="{ \'wrong\': gapModel.shouldBeRenderedAsGivenReport(\'system\') && gapModel.states[0].isWrong(), \'correct\': gapModel.shouldBeRenderedAsGivenReport(\'system\') && gapModel.states[0].isCorrect(), \'missing\': gapModel.shouldBeRenderedAsGivenReport(\'system\') && gapModel.states[0].isMissing()}"><div ng-repeat="option in filteredAnswers" class="mat-option-wrapper mat-option-id-{{option.id}}"><div ng-click="toggleCollapse(option, false)" ng-class="{\'isOpen\' : option.isOpen}" class="mat-option-toggle"><span class="title"><answer-option type="option.type_match" option="option.match" config="{playerType: options.playerType}"></answer-option></span> <span class="arrow" ng-class="{\'isOpen\' : option.isOpen}"></span></div><div class="js-collapsed-blocks"><div class="mat-options-container" ng-class="\'mat-option-\' + options.answers[option.selectedOptionId].type_option"><div ng-class="getReportOptionClass(options.answers[option.selectedOptionId], \'option\')" ng-if="option.selectedOptionId >= 0 && !option.example" class="mat-report-answer" data-title="{{answer.option}}"><answer-option type="options.answers[option.selectedOptionId].type_option" option="options.answers[option.selectedOptionId].option" config="{playerType: options.playerType}"></answer-option></div><div ng-if="option.example" class="mat-matched-option example" data-title="{{option.option}}"><answer-option type="option.type_option" option="option.option" config="{playerType: options.playerType}"></answer-option></div></div></div></div></div><div class="showAnswer" ng-if="gapModel.shouldBeRenderedAsShowAnswer()"><div ng-repeat="option in filteredAnswers" class="mat-option-wrapper mat-option-id-{{option.id}}"><div ng-click="toggleCollapse(option, false)" ng-class="{\'isOpen\' : option.isOpen}" class="mat-option-toggle"><span class="title"><answer-option type="option.type_match" option="option.match" config="{playerType: options.playerType}"></answer-option></span> <span class="arrow" ng-class="{\'isOpen\' : option.isOpen}"></span></div><div class="js-collapsed-blocks"><div class="mat-options-container" ng-class="\'mat-option-\' + option.type_option"><div class="mat-report-answer" ng-class="{example: option.example, correct: !option.example}" data-title="{{answer.option}}"><answer-option type="option.type_option" option="option.option" config="{playerType: options.playerType}"></answer-option></div></div></div></div></div>'),e.put("app/formats/matching/matching.tpl.html","<div><ng-include src=\"'app/formats/matching/matching.' + gapModel.getDisplayType() + '.tpl.html'\"></ng-include></div>"),e.put("app/formats/missingLetters/missingLetters.tpl.html",'<span class="missing-letters t_missing-letters"><span class="hangman t_hangman"><span ng-if="gapModel.shouldBeRenderedAsSolving()"><span ng-repeat="userAnswer in userAnswers track by $index"><keyboard ng-if="!userAnswer.fixed && gapModel.getDisplayType() === \'hangman-keyboard\'" keyboard-key-press="onLetterChangeFromKeyboard($event, $index)" parent-sizing="getElementSizing($index)"><input spellcheck="false" type="text" focus-on="userAnswer.focus" select-on-events="[\'focus\', \'keydown\']" ng-keydown="onKeyDown($event, $index)" ng-keypress="onKeyPress($event, $index)" ng-change="onLetterChange($index)" maxlength="1" ng-blur="evaluate()" size="1" ng-model="userAnswer.letter" class="input-field"></keyboard><input spellcheck="false" type="text" ng-if="!userAnswer.fixed && gapModel.getDisplayType() === \'hangman\'" focus-on="userAnswer.focus" select-on-events="[\'focus\', \'keydown\']" ng-keydown="onKeyDown($event, $index)" ng-keypress="onKeyPress($event, $index)" ng-change="onLetterChange($index)" maxlength="1" ng-blur="evaluate()" size="1" ng-model="userAnswer.letter" ng-class="{\'capitalize\': gapModel.attrs.capitalize && $index === 0}" class="input-field"> <input spellcheck="false" type="text" ng-if="userAnswer.fixed" maxlength="1" disabled="" size="1" ng-model="userAnswer.letter" class="fixed input-field"></span></span> <span ng-if="gapModel.shouldBeRenderedAsShowAnswer()" class="show-answer"><span ng-repeat="userAnswer in gapModel.attrs.answers.answers[0].option track by $index"><input spellcheck="false" type="text" maxlength="1" disabled="" size="1" ng-model="userAnswer" class="input-field" ng-class="{\'capitalize\': gapModel.attrs.capitalize && $index === 0, \'fixed\': isFixed($index)}"></span></span> <span ng-if="gapModel.shouldBeRenderedAsReport()" ng-class="{\'correct t_correct\': gapModel.shouldBeRenderedAsGivenReport(\'system\') && gapModel.states[0].isCorrect(), \'wrong t_wrong\': gapModel.shouldBeRenderedAsGivenReport(\'system\') && gapModel.states[0].isWrong(), \'missing t_missing\': gapModel.shouldBeRenderedAsGivenReport(\'system\') && gapModel.states[0].isMissing()}"><span ng-repeat="userAnswer in userAnswers track by $index"><input spellcheck="false" type="text" maxlength="1" disabled="" size="1" ng-model="userAnswer.letter" ng-class="{\'capitalize\': gapModel.attrs.capitalize && $index === 0, \'fixed\': userAnswer.fixed}" class="input-field"></span><answer-option-popover ng-if="gapModel.shouldBeRenderedAsGivenReport(\'system\') && gapModel.getFeedbackForGap() != null" answer-option="gapModel.getFeedbackForGap()" answer-template="app/common/directives/answerOptionPopoverPopup.tpl.html"></answer-option-popover></span> <span ng-if="gapModel.shouldBeRenderedAsExample()"><span ng-repeat="userAnswer in gapModel.attrs.answers.answers[0].option track by $index"><input spellcheck="false" class="example input-field" type="text" maxlength="1" disabled="" size="1" ng-model="userAnswer" ng-class="{\'capitalize\': gapModel.attrs.capitalize && $index === 0, \'fixed\': isFixed($index)}"></span></span></span></span>'),e.put("app/formats/ordering/ordering.tpl.html","<span class=\"ordering t_ordering\"><ng-include src=\"'app/formats/ordering/templates/ordering-' + gapModel.getDisplayType() + '.tpl.html'\"></ng-include></span>"),e.put("app/formats/recording/recording.error.popup.tpl.html",'<div class="modal-body"><p>{{ error | engineTranslate:dataCollector }}</p></div><div class="modal-footer text-right"><button class="btn btn-default" ng-click="modalInstance.dismiss()">{{ \'recorder_error_close\' | engineTranslate:dataCollector }}</button></div>'),e.put("app/formats/recording/recording.tpl.html",'<div class="rec-wrapper"><div class="rec-container"><div class="rec-button-bar"><button ng-if="hasModelAnswer && !playingModelAnswer" ng-click="playModelAnswer()" ng-disabled="!audioContextAvailable() || recording || playingRecording" class="rec-play-model-btn btn">{{ \'recording_listen\' | engineTranslate:dataCollector }}</button> <button ng-if="hasModelAnswer && playingModelAnswer" ng-click="stopPlaying()" class="rec-stop-btn-2 rec-play-model-stop-btn btn">{{ \'recording_listening_stop\' | engineTranslate:dataCollector }}</button> <button ng-if="!recording && !busy" ng-click="startRecording()" ng-disabled="!isEngineRecorderConnected() || !audioContextAvailable() || playingModelAnswer || playingRecording || gapModel.shouldBeRenderedAsReport() || gapModel.shouldBeRenderedAsShowAnswer()" class="rec-record-btn btn" title="{{ engineRecorder.connected ? \'\' : (\'recorder_unable_to_connect\' | engineTranslate:dataCollector) }}">{{ \'recording_record\' | engineTranslate:dataCollector }}</button> <button ng-if="recording && !busy" ng-click="stopRecording()" class="rec-stop-btn rec-record-stop-btn btn">{{ \'recording_recording_stop\' | engineTranslate:dataCollector }}</button> <button ng-if="busy" class="rec-record-btn btn busy" disabled=""></button> <button ng-if="!playingRecording" ng-click="playRecording()" ng-disabled="!audioContextAvailable() || !gapModel.userAnswer.length || recording || playingModelAnswer" class="rec-playback-btn btn">{{ \'recording_playback\' | engineTranslate:dataCollector }}</button> <button ng-if="playingRecording" ng-click="stopPlaying()" class="rec-stop-btn-2 rec-playback-stop-btn btn">{{ \'recording_playbacking_stop\' | engineTranslate:dataCollector }}</button></div><div class="timer-container" ng-if="recording"><div class="timer-bar"><div class="timer-bar-spent" ng-style="{width: engineRecorder.currentTimePercent + \'%\'}"></div></div><div class="timer-time-left">{{ engineRecorder.currentTime || 0 }}/{{ timeLimit }}</div></div></div></div>'),e.put("app/formats/sentenceCorrect/corClickable.tpl.html",'<span class="t_corClickable sentence-corect"><span ng-if="gapModel.shouldBeRenderedAsSolving()" class="solving t_solving"><span ng-repeat="singleElement in splitted"><span ng-if="singleElement.type == \'static\'" class="cor-part t_static_span static">{{ singleElement.value }}</span> <span ng-if="singleElement.type == \'clickable\'" class="cor-part clickable"><span ng-if="singleElement.state == \'correct\'" ng-click="setStateWrong($index)" class="t_answer_span clickable-answer">{{ singleElement.value }}</span> <span ng-if="gapModel.getDisplayType() === \'clickable-text\'"><input spellcheck="false" ng-if="singleElement.state == \'wrong\'" ng-model="singleElement.userAnswer" ng-blur="mergeAndEvaluate()" type="text" class="t_answer_input input-field" focus-on="singleElement.focusInput" autosize="true"> <span ng-if="singleElement.state == \'wrong\'" ng-click="setStateCorrect($index)"><span class="cor-cross t_cross_span"></span></span></span><keyboard ng-if="gapModel.getDisplayType() === \'clickable-text-keyboard\'" parent-sizing="getElementSizing($index)"><input spellcheck="false" insert-caret="" ng-show="singleElement.state == \'wrong\'" ng-model="singleElement.userAnswer" ng-blur="mergeAndEvaluate()" type="text" class="t_answer_input input-field cor-input" focus-on="singleElement.focusInput" autosize="true"></keyboard><span ng-if="gapModel.getDisplayType() === \'clickable-text-keyboard\'" ng-show="singleElement.state == \'wrong\'" ng-click="setStateCorrect($index)"><span class="cor-cross t_cross_span"></span></span></span></span></span> <span ng-if="gapModel.shouldBeRenderedAsShowAnswer()" class="show-answer t_showAnswer"><span class="t_answer_span" ng-if="options.answers.correctAnswers[0] == defaultAnswer">{{ options.answers.correctAnswers[0] }}</span> <input spellcheck="false" class="input-field t_answer_input" disabled="" ng-if="options.answers.correctAnswers[0] != defaultAnswer" ng-model="options.answers.correctAnswers[0]" type="text" title="{{defaultAnswer}}" autosize="true"></span> <span ng-if="gapModel.shouldBeRenderedAsReport()" ng-class="getReportClass()" class="t_showReport report"><span ng-repeat="singleElement in splitted"><span ng-if="singleElement.type == \'static\'" class="t_static_span static">{{ singleElement.value }}</span> <span ng-if="singleElement.type == \'clickable\'" class="clickable"><span ng-if="singleElement.state == \'correct\'" class="t_answer_span">{{ singleElement.value }}</span> <input spellcheck="false" ng-if="singleElement.state == \'wrong\'" ng-model="singleElement.userAnswer" type="text" class="t_answer_input input-field" disabled="" title="{{ singleElement.value }}" autosize="true"></span></span><answer-option-popover ng-if="gapModel.shouldBeRenderedAsGivenReport(\'system\') && gapModel.getFeedbackForGap() != null" answer-option="gapModel.getFeedbackForGap()" answer-template="app/common/directives/answerOptionPopoverPopup.tpl.html"></answer-option-popover></span> <span ng-if="gapModel.shouldBeRenderedAsExample()" class="example t_example"><span class="t_answer_span" ng-if="options.answers.correctAnswers[0] == defaultAnswer">{{ options.answers.correctAnswers[0] }}</span> <input spellcheck="false" class="input-field t_answer_input" disabled="" ng-if="options.answers.correctAnswers[0] != defaultAnswer" ng-model="options.answers.correctAnswers[0]" type="text" title="{{defaultAnswer}}" autosize="true"></span></span>'),e.put("app/formats/sentenceCorrect/corEditable.tpl.html",'<span class="t_corEditable sentence-corect"><span ng-if="gapModel.shouldBeRenderedAsSolving()" class="solving t_solving"><span class="t_answer_span" ng-if="gapInternals.state != \'wrong\'">{{ gapModel.userAnswer }}</span> <input spellcheck="false" class="editable input-field t_answer_input" ng-if="gapInternals.state == \'wrong\' && gapModel.getDisplayType() === \'editable-text\'" ng-model="gapModel.userAnswer" ng-blur="evaluate()" type="text" focus-on-cor="focusInput" autosize="true"><keyboard ng-if="gapModel.getDisplayType() === \'editable-text-keyboard\'" parent-sizing="getElementSizing(0)"><input spellcheck="false" insert-caret="" class="editable cor-part cor-input input-field t_answer_input" ng-show="gapInternals.state == \'wrong\'" ng-model="gapModel.userAnswer" ng-blur="evaluate()" type="text" focus-on-cor="focusInput" autosize="true"></keyboard><span class="state-btns" ng-class="{\'non-active\' : gapInternals.state==\'undetermined\' }"><button class="t_button_correct btn-correct" ng-class="{\'active t_active\' : gapInternals.state==\'correct\' }" ng-click="enterStateCorrect()"></button><button class="t_button_wrong btn-wrong" ng-class="{\'active t_active\' : gapInternals.state==\'wrong\' }" ng-click="enterStateWrong()"></button></span></span> <span ng-if="gapModel.shouldBeRenderedAsShowAnswer()" class="show-answer t_showAnswer"><span class="t_answer_span" ng-if="options.answers.correctAnswers[0] == options.answers.defaultAnswer">{{ options.answers.correctAnswers[0] }}</span> <input spellcheck="false" class="input-field t_answer_input" disabled="" ng-if="options.answers.correctAnswers[0] != options.answers.defaultAnswer" ng-model="options.answers.correctAnswers[0]" type="text" title="{{options.answers.defaultAnswer}}" autosize="true"> <span class="state-btns"><button class="t_button_correct btn-correct" ng-class="{\'active t_active\' : options.answers.correctAnswers[0] == options.answers.defaultAnswer }" disabled=""></button><button class="t_button_wrong btn-wrong" ng-class="{\'active t_active\' : options.answers.correctAnswers[0] != options.answers.defaultAnswer }" disabled=""></button></span></span> <span ng-if="gapModel.shouldBeRenderedAsReport()" ng-class="getReportClass()" class="t_showReport report"><span class="t_answer_span" ng-if="gapInternals.state != \'wrong\'">{{ gapModel.userAnswer }}</span> <input spellcheck="false" class="input-field t_answer_input" disabled="" ng-if="gapInternals.state == \'wrong\'" ng-model="gapModel.userAnswer" type="text" title="{{options.answers.defaultAnswer}}" autosize="true"> <span class="state-btns" ng-class="{\'non-active\' : gapInternals.state==\'undetermined\' }"><button class="t_button_correct btn-correct" ng-class="{\'active t_active\' : gapInternals.state==\'correct\' }" disabled=""></button><button class="t_button_wrong btn-wrong" ng-class="{\'active t_active\' : gapInternals.state==\'wrong\' }" disabled=""></button></span><answer-option-popover ng-if="gapModel.shouldBeRenderedAsGivenReport(\'system\') && gapModel.getFeedbackForGap() != null" answer-option="gapModel.getFeedbackForGap()" answer-template="app/common/directives/answerOptionPopoverPopup.tpl.html"></answer-option-popover></span> <span ng-if="gapModel.shouldBeRenderedAsExample()" class="example t_example"><span class="t_answer_span" ng-if="options.answers.correctAnswers[0] == options.answers.defaultAnswer">{{ options.answers.correctAnswers[0] }}</span> <input spellcheck="false" class="input-field t_answer_input" disabled="" ng-if="options.answers.correctAnswers[0] != options.answers.defaultAnswer" ng-model="options.answers.correctAnswers[0]" type="text" title="{{options.answers.defaultAnswer}}" autosize="true"> <span class="state-btns"><button class="t_button_correct btn-correct" ng-class="{\'active t_active\' : options.answers.correctAnswers[0] == options.answers.defaultAnswer }" disabled=""></button><button class="t_button_wrong btn-wrong" ng-class="{\'active t_active\' : options.answers.correctAnswers[0] != options.answers.defaultAnswer }" disabled=""></button></span></span></span>'),e.put("app/formats/sentenceCorrect/sentenceCorrect.tpl.html","<span class=\"sentence-correct t_sentence-correct\"><cor-editable ng-if=\"gapModel.getDisplayType() == 'editable-text' || gapModel.getDisplayType() == 'editable-text-keyboard'\"></cor-editable><cor-clickable ng-if=\"gapModel.getDisplayType() == 'clickable-text' || gapModel.getDisplayType() == 'clickable-text-keyboard'\"></cor-clickable></span>"),e.put("app/formats/wordsearch/wordsearch.tpl.html",'<span class="wordsearch t_wordsearch"><span class="general t_general"><span ng-if="gapModel.shouldBeRenderedAsSolving()" class="solving"><table off-click="deselectLetter()"><tbody><tr ng-repeat="row in gapModel.attrs.answers.structure"><td ng-repeat="letter in row" ng-mousedown="selectFirstLetter(letter, $parent.$index, $index)" ng-mouseup="selectLetter(letter, $parent.$index, $index)" ng-mouseleave="clearActive(\'active\')" ng-mouseover="activateWord($parent.$index, $index, \'active\')" ng-class="getLetterClasses(letter, $parent.$index, $index)"><span>{{letter.letter}}</span> <strong ng-repeat="direction in letter.directions" ng-class="getDirectionClasses(direction)" class="highlight"></strong></td></tr></tbody></table><div class="wordpool-content"><div class="wordpool-item" ng-repeat="answer in answerWords" ng-mouseover="activateAnswerWord(answer)" ng-mouseleave="deactivateAnswerWord(answer)" ng-class="{\'example\': answer.example}">{{answer.answer}}<span ng-click="deleteAnswer(answer)" ng-if="!answer.example" class="answer-remove"></span></div></div></span> <span ng-if="gapModel.shouldBeRenderedAsShowAnswer() || gapModel.shouldBeRenderedAsExample()"><table><tbody><tr ng-repeat="row in structure"><td ng-repeat="letter in row" ng-class="getLetterClasses(letter, $parent.$index, $index)"><span>{{letter.letter}}</span> <strong ng-repeat="direction in letter.directions" ng-class="getDirectionClasses(direction)" class="highlight"></strong></td></tr></tbody></table><div class="wordpool-content"><div class="wordpool-item" ng-class="{\'example\': answer.example}" ng-repeat="answer in gapModel.attrs.answers.answers" ng-mouseover="activateShowAnswerWord(answer)" ng-mouseleave="deactivateShowAnswerWord(answer)">{{answer.answer}}</div></div></span> <span ng-if="gapModel.shouldBeRenderedAsReport()"><table><tbody><tr ng-repeat="row in gapModel.attrs.answers.structure"><td ng-repeat="letter in row" ng-class="getLetterClasses(letter, $parent.$index, $index)"><span>{{letter.letter}}</span> <strong ng-repeat="direction in letter.directions" ng-class="getDirectionClasses(direction)" class="highlight"></strong></td></tr></tbody></table><span ng-class="{\'correct t_correct\': gapModel.shouldBeRenderedAsGivenReport(\'system\') && gapModel.states[0].isCorrect(), \'wrong t_wrong\': gapModel.shouldBeRenderedAsGivenReport(\'system\') && gapModel.states[0].isWrong(), \'missing t_missing\': gapModel.shouldBeRenderedAsGivenReport(\'system\') && gapModel.states[0].isMissing()}"><div class="wordpool-content"><div class="wordpool-item" ng-repeat="answer in answerWords" ng-mouseover="activateAnswerWord(answer)" ng-mouseleave="deactivateAnswerWord(answer)" ng-class="{\'correct\': gapModel.shouldBeRenderedAsGivenReport(\'system-option\') && (answer.isCorrect && !answer.example), \'wrong\': gapModel.shouldBeRenderedAsGivenReport(\'system-option\') && (!answer.isCorrect && !answer.example), \'example\': answer.example }">{{answer.answer}}</div></div></span></span></span></span>'),e.put("app/blocks/cengage/model/model.tpl.html",'<div class="model-container" ng-class="{\'model-collapsed\': collapsed}"><div class="js-model-content"><div class="model-content-wrapper"><block-element ng-repeat="block in content.blocks" content="block"></block-element></div><div ng-click="toogleCollapsed()" class="model-toggle-container"><span class="model-toggle">{{ \'cengage_we_model\' | engineTranslate:dataCollector }}</span></div></div></div>'),e.put("app/blocks/cengage/segmented/feedback.popup.tpl.html",'<button class="btn btn-cross" ng-click="modalInstance.dismiss()"></button><div class="segmented-feedback-popup"><h3>{{ \'cengage_segmented_feedback\' | engineTranslate:dataCollector }}</h3><p ng-bind-html="content.feedback"></p></div>'),e.put("app/blocks/cengage/segmented/segmented-pager.tpl.html",'<div class="segmented-pager js-segmented-pager"><button ng-disabled="currentScreen <= 0" ng-click="handleChangeScreen(currentScreen-1)" class="btn btn-previous js-first-segmented-button">&lt;</button> <button ng-if="firstScreensTruncated" class="btn btn-disabled" disabled="true">...</button><ul><li ng-repeat="screen in screens" ng-if="screen.pager.visible"><button ng-click="handleChangeScreen($index)" ng-class="{\'btn-active\': $index == currentScreen, \'btn-visited\': screens[$index].state.visited, \'btn-correct\': loState.isShowAnswer() || screens[$index].state.correct, \'btn-wrong\': !loState.isShowAnswer() && screens[$index].state.wrong}" class="btn">{{$index+1}}</button></li></ul><button ng-if="lastScreensTruncated" class="btn btn-disabled" disabled="true">...</button> <button ng-disabled="currentScreen >= screens.length - 1" ng-click="handleChangeScreen(currentScreen+1)" class="btn btn-next">&gt;</button></div>'),e.put("app/blocks/cengage/segmented/segmented.desktop.tpl.html",'<div class="segmented segmented-desktop" ng-class="segmentedClasses"><div ng-if="header && (header.sectionNumber || header.sectionName || header.sectionTopic)" class="header-container segmented-header-container"><span class="segmented-header-section-num" ng-if="header.sectionNumber" ng-bind-html="header.sectionNumber"></span> <span class="segmented-header-section-name" ng-if="header.sectionName" ng-bind-html="header.sectionName"></span> <span class="segmented-header-section-topic" ng-if="header.sectionTopic" ng-bind-html="header.sectionTopic"></span></div><div class="instruction-container"><div><span ng-class="instructionSwitchState" ng-click="toogleInstruction()" class="instruction-switch"></span> <span class="instruction-header">{{ \'instructions\' | engineTranslate:dataCollector }}</span> <a class="icon-pdf" ng-if="instruction.externalDocument && instruction.externalDocument.links.length" ng-href="{{ instruction.externalDocument.links[0].url }}" target="_blank"></a></div><block-element content="instruction" atool-show="instructionSwitchState == \'open\'"></block-element></div><div class="js-extended-header" ng-if="hasExtendedFunctionality"></div><div ng-if="hasExtendedFunctionality && customModelData" class="js-extended-model"><block-element content="customModelData"></block-element></div><div class="columns-wrapper"><div class="columns-container" ng-class="{\'segmented-frame\': content.embedContentInFrame && !isCptMode}"><div class="stimulus-container js-stimulus-container" ng-if="hasGlobalStimulus && !hasExtendedFunctionality"><block-element content="globalStimulus"></block-element></div><div class="stimulus-container js-stimulus-container js-stimulus" ng-if="!hasGlobalStimulus && !hasExtendedFunctionality" ng-repeat="stimulus in stimuluses" ng-show="stimulus.index == currentScreen && hasContent(stimulus.data)"><block-element content="stimulus.data"></block-element></div><div class="stimulus-container js-stimulus-container" ng-if="hasExtendedFunctionality && customStimulusData"><block-element content="customStimulusData"></block-element></div><div class="stimulus-container js-stimulus-container js-extended-stimulus" ng-if="hasExtendedFunctionality && customStimulus"></div><div class="activity-container js-activity-container" sticktotop-positioning-container="" ng-show="hasActivity"><div class="js-activity activity" ng-if="!hasExtendedFunctionality" ng-repeat="activity in activities" ng-show="activity.index == currentScreen && hasContent(activity.data)" ng-class="{\'activity-with-stimulus\': hasScreenStimulus(activity.index) || hasGlobalStimulus, \'activity-without-stimulus\': !hasScreenStimulus(activity.index) && !hasGlobalStimulus}"><block-element content="activity.data"></block-element></div><div class="js-extended-activity" ng-if="hasExtendedFunctionality"></div></div></div></div><engine-segmented-pager ng-if="!hasExtendedFunctionality && hasMultipleScreens"></engine-segmented-pager><div class="js-extended-menu" ng-if="hasExtendedFunctionality" ng-show="customMenu"></div></div>'),e.put("app/blocks/cengage/segmented/segmented.phone.tpl.html",'<div class="segmented segmented-phone" ng-class="segmentedClasses"><div ng-if="header && (header.sectionNumber || header.sectionName || header.sectionTopic)" class="header-container segmented-header-container"><span class="segmented-header-section-num" ng-if="header.sectionNumber" ng-bind-html="header.sectionNumber"></span> <span class="segmented-header-section-name" ng-if="header.sectionName" ng-bind-html="header.sectionName"></span> <span class="segmented-header-section-topic" ng-if="header.sectionTopic" ng-bind-html="header.sectionTopic"></span></div><uib-tabset active="currentTab" class="current-tab"><uib-tab index="0" select="tabSelect(0)"><uib-tab-heading class="tab tab-instruction"></uib-tab-heading><div class="instruction-container"><span class="instruction-header">{{ \'instructions\' | engineTranslate:dataCollector }}</span><block-element ng-if="!instructionMobile" content="instruction"></block-element><block-element ng-if="instructionMobile" content="instructionMobile"></block-element><a class="icon-pdf" ng-if="instruction.externalDocument && instruction.externalDocument.links.length" ng-href="{{ instruction.externalDocument.links[0].url }}" target="_blank"></a></div></uib-tab><uib-tab index="1" select="tabSelect(1)" ng-show="hasStimulus"><uib-tab-heading class="tab tab-stimulus" ng-class="{\'content-changed\': hasNewStimulus}"></uib-tab-heading><div class="stimulus-container" ng-if="hasGlobalStimulus && !hasExtendedFunctionality"><block-element content="globalStimulus"></block-element></div><div class="stimulus-container js-stimulus" ng-if="!hasGlobalStimulus && !hasExtendedFunctionality" ng-repeat="stimulus in stimuluses" ng-show="stimulus.index == currentScreen && hasContent(stimulus.data)"><block-element content="stimulus.data"></block-element></div><div class="stimulus-container" ng-if="hasExtendedFunctionality && customStimulusData"><block-element content="customStimulusData"></block-element></div><div class="stimulus-container js-extended-stimulus" ng-if="hasExtendedFunctionality && customStimulus"></div></uib-tab><uib-tab index="2" select="tabSelect(2)" ng-show="hasActivity"><uib-tab-heading class="tab tab-activity" ng-class="{\'content-changed\': hasNewActivity}"></uib-tab-heading><div class="activity-container js-activity-container" sticktotop-positioning-container=""><div class="js-activity activity" ng-if="!hasExtendedFunctionality" ng-repeat="activity in activities" ng-show="activity.index == currentScreen && hasContent(activity.data)"><block-element content="activity.data"></block-element></div><div class="js-extended-activity" ng-if="hasExtendedFunctionality"></div></div></uib-tab></uib-tabset><engine-segmented-pager class="segmented-pager-phone" ng-if="!hasExtendedFunctionality && hasMultipleScreens" ng-show="currentTab != 0"></engine-segmented-pager><div class="js-extended-menu segmented-extended-menu" ng-if="hasExtendedFunctionality" ng-show="currentTab != 0 && customMenu"></div><div ng-if="hasExtendedFunctionality && customModelData" class="js-extended-model" ng-show="currentTab != 0"><block-element content="customModelData"></block-element></div></div>'),e.put("app/blocks/cengage/segmented/segmented.tablet.tpl.html",'<div class="segmented segmented-tablet" ng-class="segmentedClasses"><div ng-if="header && (header.sectionNumber || header.sectionName || header.sectionTopic)" class="header-container segmented-header-container"><span class="segmented-header-section-num" ng-if="header.sectionNumber" ng-bind-html="header.sectionNumber"></span> <span class="segmented-header-section-name" ng-if="header.sectionName" ng-bind-html="header.sectionName"></span> <span class="segmented-header-section-topic" ng-if="header.sectionTopic" ng-bind-html="header.sectionTopic"></span></div><div class="instruction-container"><div><span ng-class="instructionSwitchState" ng-click="toogleInstruction()" class="instruction-switch"></span> <span class="instruction-header">{{ \'instructions\' | engineTranslate:dataCollector }}</span> <a class="icon-pdf" ng-if="instruction.externalDocument && instruction.externalDocument.links.length" ng-href="{{ instruction.externalDocument.links[0].url }}" target="_blank"></a></div><block-element content="instruction" atool-show="instructionSwitchState == \'open\'"></block-element></div><div class="js-extended-header" ng-if="hasExtendedFunctionality"></div><div ng-if="hasExtendedFunctionality && customModelData" class="js-extended-model"><block-element content="customModelData"></block-element></div><div class="columns-wrapper"><div class="columns-container" ng-class="{\'segmented-frame\': content.embedContentInFrame && !isCptMode}"><div class="stimulus-container" ng-if="hasGlobalStimulus && !hasExtendedFunctionality"><block-element content="globalStimulus"></block-element></div><div class="stimulus-container js-stimulus" ng-if="!hasGlobalStimulus && !hasExtendedFunctionality" ng-repeat="stimulus in stimuluses" ng-show="stimulus.index == currentScreen && hasContent(stimulus.data)"><block-element content="stimulus.data"></block-element></div><div class="stimulus-container" ng-if="hasExtendedFunctionality && customStimulusData"><block-element content="customStimulusData"></block-element></div><div class="stimulus-container js-extended-stimulus" ng-if="hasExtendedFunctionality && customStimulus"></div><div class="activity-container js-activity-container" sticktotop-positioning-container="" ng-show="hasActivity"><div class="js-activity activity" ng-if="!hasExtendedFunctionality" ng-repeat="activity in activities" ng-show="activity.index == currentScreen && hasContent(activity.data)" ng-class="{\'activity-with-stimulus\': hasScreenStimulus(activity.index) || hasGlobalStimulus, \'activity-without-stimulus\': !hasScreenStimulus(activity.index) && !hasGlobalStimulus}"><block-element content="activity.data"></block-element></div><div class="js-extended-activity" ng-if="hasExtendedFunctionality"></div></div></div></div><engine-segmented-pager ng-if="!hasExtendedFunctionality && hasMultipleScreens"></engine-segmented-pager><div class="js-extended-menu" ng-if="hasExtendedFunctionality" ng-show="customMenu"></div></div>'),e.put("app/blocks/cengage/segmented/segmented.tpl.html","<ng-include src=\"'app/blocks/cengage/segmented/segmented.' + detectedType + '.tpl.html'\"></ng-include>"),e.put("app/common/directives/carousel/engineCarousel.tpl.html",'<div class="carousel"><div class="carousel-inner"><div ng-transclude="" class="carousel-inner-inner"></div></div><div class="carousel-controls" ng-if="carouselCtrl.getMaxSize() > 1"><a ng-click="carouselCtrl.prevSlide()" ng-if="!carouselCtrl.isFirst()" class="t_carousel-left left carousel-control"><span>&lt;</span></a> <a ng-click="carouselCtrl.nextSlide()" ng-if="!carouselCtrl.isLast()" class="t_carousel-right right carousel-control"><span>&gt;</span></a></div><div class="counter" ng-if="hasCounter">{{ carouselCtrl.getCurrentPosition() }}/{{ carouselCtrl.getMaxSize() }}</div></div>'),e.put("app/formats/categorisation/templates/categorisationAssign-dnd.tpl.html",'<span class="dnd t_dnd"><span class="categories-container" ng-class="{\'report t_report\': gapModel.shouldBeRenderedAsReport(), \'correct t_correct\': gapModel.shouldBeRenderedAsGivenReport(\'system\') && gapModel.states[0].isCorrect(), \'wrong t_wrong\': gapModel.shouldBeRenderedAsGivenReport(\'system\') && gapModel.states[0].isWrong(), \'missing t_missing\': gapModel.shouldBeRenderedAsGivenReport(\'system\') && gapModel.states[0].isMissing()}"><div class="category category_dnd t_category category-{{category.id}}" ng-repeat="category in gapModel.attrs.answers.categories" ng-class="{\'correct\': gapModel.shouldBeRenderedAsGivenReport(\'system-category\') && gapModel.states[category.id].isCorrect(), \'wrong\': gapModel.shouldBeRenderedAsGivenReport(\'system-category\') && gapModel.states[category.id].isWrong(), \'missing\': gapModel.shouldBeRenderedAsGivenReport(\'system-category\') && gapModel.states[category.id].isMissing()}"><div class="category-title"><answer-option type="category.type" option="category.category" config="{playerType: options.playerType}"></answer-option><engine-eyeball-button on-fire="fireEyeball(category.id)" ng-if="shouldShowEyeballs && gapModel.shouldBeRenderedAsSolving()" eyeball="gapModel.eyeball" state-id="category.id"></engine-eyeball-button></div><div class="category-content" ng-show="gapModel.shouldBeRenderedAsSolving()"><category-dnd category="category"></category-dnd></div><div class="category-content" ng-show="gapModel.shouldBeRenderedAsReport()"><span ng-repeat="example in examples[category.id]"><span class="example dnd-item"><answer-option type="example.type" option="example.option" config="{playerType: options.playerType}"></answer-option></span></span> <span ng-repeat="input in answerInputs[category.id]"><span class="dnd-item" ng-class="reportClasses(input, category)"><answer-option type="input.type" option="input.answer" config="{playerType: options.playerType, handleLoad: false}"></answer-option></span></span></div><div class="category-content cat-show-answers" ng-show="gapModel.shouldBeRenderedAsShowAnswer()"><span ng-repeat="example in examples[category.id]"><span class="example dnd-item"><answer-option type="example.type" option="example.option" config="{playerType: options.playerType, handleLoad: false}"></answer-option></span></span> <span ng-repeat="answer in answersWithoutExamples | filter : {category: category.id}"><span class="show-answer dnd-item t_show-answer"><answer-option type="answer.type" option="answer.option" config="{playerType: options.playerType}"></answer-option></span></span></div><div class="category-content" ng-show="gapModel.shouldBeRenderedAsExample()"><span class="example" ng-repeat="answer in gapModel.attrs.answers.options | filter : {category: category.id}"><span class="example dnd-item t_example"><answer-option type="answer.type" option="answer.option" config="{playerType: options.playerType}"></answer-option></span></span></div></div></span></span>'),e.put("app/formats/categorisation/templates/categorisationAssign-fillin.tpl.html",'<span class="fillin t_fillin"><span class="t_report" ng-class="{\'correct t_correct\': gapModel.shouldBeRenderedAsGivenReport(\'system\') && gapModel.states[0].isCorrect(), \'wrong t_wrong\': gapModel.shouldBeRenderedAsGivenReport(\'system\') && gapModel.states[0].isWrong(), \'missing t_missing\': gapModel.shouldBeRenderedAsGivenReport(\'system\') && gapModel.states[0].isMissing()}"><div class="category {{category.id}} t_category" ng-repeat="category in gapModel.attrs.answers.categories" ng-class="{\'correct\': gapModel.shouldBeRenderedAsGivenReport(\'system-category\') && gapModel.states[category.id].isCorrect(), \'wrong\': gapModel.shouldBeRenderedAsGivenReport(\'system-category\') && gapModel.states[category.id].isWrong(), \'missing\': gapModel.shouldBeRenderedAsGivenReport(\'system-category\') && gapModel.states[category.id].isMissing()}"><div class="category-title"><answer-option type="category.type" option="category.category" config="{playerType: options.playerType}"></answer-option></div><span class="category-content solving" ng-if="gapModel.shouldBeRenderedAsSolving()"><span ng-repeat="example in examples[category.id]"><input spellcheck="false" type="text" disabled="" ng-model="example.option" class="example t_example input-field" autosize="true"></span> <span ng-repeat="input in answerInputs[category.id]"><input spellcheck="false" ng-if="input.solvable" type="text" focus-on="input.focus" ng-blur="evaluateAndAddNew(category.id, $index, input.focusNext)" ui-keypress="{13:\'evaluateAndAddNewAndFocus(category.id, $index, $event)\', 9:\'evaluateAndAddNewAndFocus(category.id, $index, $event)\'}" class="solving-input input-field t_input" ng-model="input.answer" autosize="true"> <span ng-hide="input.solvable" ng-click="changeToSolvable(input)" class="answer t_answer">{{input.answer}} <span ng-click="removeInput(category.id, $index)" class="t_removeInput answer-remove"></span></span></span></span> <span class="category-content" ng-if="gapModel.shouldBeRenderedAsShowAnswer()"><span ng-repeat="example in examples[category.id]"><input spellcheck="false" type="text" disabled="" ng-model="example.option" class="example input-field" autosize="true"></span> <span ng-repeat="answer in answersWithoutExamples | filter : {category: category.id}"><span class="show-answer answer t_show-answer">{{answer.option}}</span></span></span> <span class="category-content" ng-if="gapModel.shouldBeRenderedAsReport()"><span ng-repeat="example in examples[category.id]"><input spellcheck="false" type="text" disabled="" ng-model="example.option" class="example input-field" autosize="true"></span> <span ng-repeat="input in answerInputs[category.id] | filter:emptyOrNull"><span class="show-answer answer" ng-class="reportClasses(input, category)">{{input.answer}}</span></span></span> <span class="category-content" ng-if="gapModel.shouldBeRenderedAsExample()"><span class="example" ng-repeat="answer in gapModel.attrs.answers.options | filter : {category: category.id}"><span class="example answer t_example">{{answer.option}}</span></span></span></div></span></span>'),e.put("app/formats/categorisation/templates/categorisationChoosable-checkboxes.tpl.html",'<table class="checkboxes t_checkboxes" ng-class="{\'correct t_correct\': gapModel.shouldBeRenderedAsGivenReport(\'system\') && gapModel.states[0].isCorrect(), \'wrong t_wrong\': gapModel.shouldBeRenderedAsGivenReport(\'system\') && gapModel.states[0].isWrong(), \'missing t_missing\': gapModel.shouldBeRenderedAsGivenReport(\'system\') && gapModel.states[0].isMissing()}"><thead><tr><th><span ng-if="options.header">{{ options.header }}</span></th><th ng-repeat="category in gapModel.attrs.answers.categories" ng-class="{\'correct\': gapModel.shouldBeRenderedAsGivenReport(\'system-category\') && gapModel.states[category.id].isCorrect(), \'wrong\': gapModel.shouldBeRenderedAsGivenReport(\'system-category\') && gapModel.states[category.id].isWrong(), \'missing\': gapModel.shouldBeRenderedAsGivenReport(\'system-category\') && gapModel.states[category.id].isMissing()}"><answer-option type="category.type" option="category.category" config="{playerType: options.playerType}"></answer-option></th></tr></thead><tbody><tr ng-repeat="option in gapModel.attrs.answers.options" ng-class="{\'correct\': gapModel.shouldBeRenderedAsGivenReport(\'system-option\') && gapModel.states[$index].isCorrect(), \'wrong\': gapModel.shouldBeRenderedAsGivenReport(\'system-option\') && gapModel.states[$index].isWrong(), \'missing\': gapModel.shouldBeRenderedAsGivenReport(\'system-option\') && gapModel.states[$index].isMissing()}"><td><answer-option type="option.type" option="option.option" config="{playerType: options.playerType}"></answer-option></td><td ng-repeat="category in gapModel.attrs.answers.categories" ng-class="{\'correct\': gapModel.shouldBeRenderedAsGivenReport([\'system-option-part\', \'system-option-alternative\']) && gapModel.states[$parent.$index + \'-\' + $index].isCorrect() && answer.selected[option.option][category.id], \'wrong\': gapModel.shouldBeRenderedAsGivenReport([\'system-option-part\', \'system-option-alternative\']) && gapModel.states[$parent.$index + \'-\' + $index].isWrong(), \'missing\': gapModel.shouldBeRenderedAsGivenReport([\'system-option-part\', \'system-option-alternative\']) && gapModel.states[$parent.$index + \'-\' + $index].isMissing()}"><span ng-if="gapModel.shouldBeRenderedAsSolving() && !option.example" class="t_solving option"><input type="checkbox" ng-change="mapAndEvaluate(option)" ng-model="answer.selected[option.option][category.id]" ng-checked="answer.selected[option.option][category.id]"><span ng-click="checkAndEvaluate(option, category.id)"></span></span> <span ng-if="(gapModel.shouldBeRenderedAsSolving() || gapModel.shouldBeRenderedAsReport())&& option.example" class="t_example"><input type="checkbox" disabled="" ng-checked="isInAnswers(option, category.id)" class="example"><span></span></span> <span ng-if="gapModel.shouldBeRenderedAsShowAnswer()" class="t_showAnswer"><input type="checkbox" disabled="" ng-checked="isInAnswers(option, category.id)"><span></span></span> <span ng-if="gapModel.shouldBeRenderedAsReport() && !option.example"><input type="checkbox" disabled="" ng-checked="answer.selected[option.option][category.id]"><span></span></span> <span ng-if="gapModel.shouldBeRenderedAsExample()"><input type="checkbox" disabled="" ng-checked="isInAnswers(option, category.id)" class="example"><span></span></span></td></tr></tbody></table>'),e.put("app/formats/categorisation/templates/categorisationChoosable-dropdown.tpl.html",'<table class="dropdown-cat t_dropdown" ng-class="{\'correct t_correct\': gapModel.shouldBeRenderedAsGivenReport(\'system\') && gapModel.states[0].isCorrect(), \'wrong t_wrong\': gapModel.shouldBeRenderedAsGivenReport(\'system\') && gapModel.states[0].isWrong(), \'missing t_missing\': gapModel.shouldBeRenderedAsGivenReport(\'system\') && gapModel.states[0].isMissing()}"><tr ng-repeat="option in gapModel.attrs.answers.options" ng-class="{\'correct\': gapModel.shouldBeRenderedAsGivenReport(\'system-option\') && gapModel.states[$index].isCorrect(), \'wrong\': gapModel.shouldBeRenderedAsGivenReport(\'system-option\') && gapModel.states[$index].isWrong(), \'missing\': gapModel.shouldBeRenderedAsGivenReport(\'system-option\') && gapModel.states[$index].isMissing()}"><td><answer-option type="option.type" option="option.option" config="{playerType: options.playerType}"></answer-option></td><td ng-class="{\'correct\': gapModel.shouldBeRenderedAsGivenReport(\'system-option-alternative\') && gapModel.states[generateStateIdForDropdownAlternatives($index, option)].isCorrect(), \'wrong\': gapModel.shouldBeRenderedAsGivenReport(\'system-option-alternative\') && gapModel.states[generateStateIdForDropdownAlternatives($index, option)].isWrong(), \'missing\': gapModel.shouldBeRenderedAsGivenReport(\'system-option-alternative\') && gapModel.states[generateStateIdForDropdownAlternatives($index, option)].isMissing()}"><span ng-if="gapModel.shouldBeRenderedAsSolving() && !option.example" class="t_solving dropdown"><select ng-change="mapDropdownAndEvaluate(option)" ng-model="answer.selectedDropDown[option.option]"><option selected="" disabled="" hidden="" value=""></option><option ng-repeat="category in gapModel.attrs.answers.categories" ng-value="$index">{{category.category}}</option></select></span> <span ng-if="(gapModel.shouldBeRenderedAsSolving() || gapModel.shouldBeRenderedAsReport()) && option.example" class="t_solving t_example dropdown"><select class="example"><option ng-repeat="category in gapModel.attrs.answers.categories" ng-selected="option.full_category == category" disabled="">{{category.category}}</option></select></span> <span ng-if="gapModel.shouldBeRenderedAsShowAnswer()" class="t_showAnswer dropdown"><select class="show-answer" ng-model="option.full_category" ng-options="category.category for category in gapModel.attrs.answers.categories track by category.category" disabled=""></select></span> <span ng-if="gapModel.shouldBeRenderedAsReport() && !option.example" ng-class="{\'correct\': gapModel.shouldBeRenderedAsGivenReport(\'system-category\') && gapModel.states[option.category[0]].isCorrect(), \'wrong\': gapModel.shouldBeRenderedAsGivenReport(\'system-category\') && gapModel.states[option.category[0]].isWrong(), \'missing\': gapModel.shouldBeRenderedAsGivenReport(\'system-category\') && gapModel.states[option.category[0]].isMissing()}"><select ng-model="answer.selected[option.option]" ng-options="category.category for category in gapModel.attrs.answers.categories track by category.category" ng-class="answer.selected[option.option] === option.full_category ? \'correct_option\' : \'wrong_option\'" disabled=""></select></span> <span ng-if="gapModel.shouldBeRenderedAsExample()" class="example t_example dropdown"><select class="example"><option ng-repeat="category in gapModel.attrs.answers.categories" ng-selected="option.full_category == category" disabled="">{{category.category}}</option></select></span></td></tr></table>'),e.put("app/formats/categorisation/templates/categorisationChoosable-radio.tpl.html",'<table class="radio t_radio" ng-class="{\'correct t_correct\': gapModel.shouldBeRenderedAsGivenReport(\'system\') && gapModel.states[0].isCorrect(), \'wrong t_wrong\': gapModel.shouldBeRenderedAsGivenReport(\'system\') && gapModel.states[0].isWrong(), \'missing t_missing\': gapModel.shouldBeRenderedAsGivenReport(\'system\') && gapModel.states[0].isMissing()}"><thead><tr><th><span ng-if="options.header">{{ options.header }}</span></th><th ng-repeat="category in gapModel.attrs.answers.categories" ng-class="{\'correct\': gapModel.shouldBeRenderedAsGivenReport(\'system-category\') && gapModel.states[category.id].isCorrect(), \'wrong\': gapModel.shouldBeRenderedAsGivenReport(\'system-category\') && gapModel.states[category.id].isWrong(), \'missing\': gapModel.shouldBeRenderedAsGivenReport(\'system-category\') && gapModel.states[category.id].isMissing()}"><answer-option type="category.type" option="category.category" config="{playerType: options.playerType}"></answer-option></th></tr></thead><tbody><tr ng-repeat="option in gapModel.attrs.answers.options" ng-class="{\'correct\': gapModel.shouldBeRenderedAsGivenReport(\'system-option\') && gapModel.states[$index].isCorrect(), \'wrong\': gapModel.shouldBeRenderedAsGivenReport(\'system-option\') && gapModel.states[$index].isWrong(), \'missing\': gapModel.shouldBeRenderedAsGivenReport(\'system-option\') && gapModel.states[$index].isMissing()}"><td><answer-option type="option.type" option="option.option" config="{playerType: options.playerType}"></answer-option></td><td ng-repeat="category in gapModel.attrs.answers.categories" ng-class="{\'correct\': gapModel.shouldBeRenderedAsGivenReport([\'system-option-part\', \'system-option-alternative\']) && gapModel.states[$parent.$index + \'-\' + $index].isCorrect() && answer.selected[option.option] === category.id, \'wrong\': gapModel.shouldBeRenderedAsGivenReport([\'system-option-part\', \'system-option-alternative\']) && gapModel.states[$parent.$index + \'-\' + $index].isWrong(), \'missing\': gapModel.shouldBeRenderedAsGivenReport([\'system-option-part\', \'system-option-alternative\']) && gapModel.states[$parent.$index + \'-\' + $index].isMissing()}"><span ng-if="gapModel.shouldBeRenderedAsSolving() && !option.example" class="t_solving option"><input type="radio" ng-change="mapRadioAndEvaluate(option)" ng-value="category.id" ng-model="answer.selected[option.option]" ng-checked="option.selected[option.option] === category.id"><span ng-click="checkRadioAndEvaluate(option, category.id)" class="t_categoryName"></span></span> <span ng-if="(gapModel.shouldBeRenderedAsSolving() || gapModel.shouldBeRenderedAsReport()) && option.example" class="t_example"><input type="radio" disabled="" ng-checked="isInAnswers(option, category.id)" class="example"><span></span></span> <span ng-if="gapModel.shouldBeRenderedAsShowAnswer()" class="t_showAnswer"><input type="radio" disabled="" ng-checked="isInAnswers(option, category.id)"><span></span></span> <span ng-if="gapModel.shouldBeRenderedAsReport() && !option.example"><input type="radio" disabled="" ng-checked="answer.selected[option.option] === category.id"><span></span></span> <span ng-if="gapModel.shouldBeRenderedAsExample()"><input type="radio" disabled="" ng-checked="isInAnswers(option, category.id)" class="example"><span></span></span></td></tr></tbody></table>'),e.put("app/formats/cengage/dialogue/dialogue.first.tpl.html",'<div class="dialogue-container"><div class="dialogue-play-btn-container"><button ng-if="!conversation.playing" ng-click="startConversation(\'playback\')" class="btn dialogue-btn dialogue-play-btn">{{ \'cengage_dia_listening_play\' | engineTranslate:dataCollector }}</button> <button ng-if="conversation.playing" ng-click="clearConversation()" class="btn dialogue-btn dialogue-stop-btn">{{ \'cengage_dia_listening_stop\' | engineTranslate:dataCollector }}</button></div><div ng-repeat="sentence in options.sentences" ng-class="{active: conversation.sentence == sentence}" class="dialogue-line js-dialogue-line"><custom-circle-player ng-if="conversation.sentence == sentence" urls="conversation.audio" on-end="moveToNextSentence()" engine-autoplay="true" use-shared-audio="true" class="dialogue-circle-player"></custom-circle-player><span class="dialogue-sentence-label">{{sentence.label}}</span> <span class="dialogue-sentence-text">{{sentence.text}}</span></div></div>'),e.put("app/formats/cengage/dialogue/dialogue.record.tpl.html",'<div class="dialogue-container"><div class="dialogue-select-part-container"><div ng-if="!options.config.userLabel" class="dialogue-select-part">{{ \'cengage_dia_select_part\' | engineTranslate:dataCollector }}<div class="dialogue-select-part-labels"><label ng-repeat="label in config.labels" class="dialogue-select-part-checkbox"><input type="radio" ng-value="label.value" ng-disabled="config.started" name="choosing-label" ng-model="config.label"><span class="option">{{ label.value }}</span></label></div></div><div class="dialogue-select-part-button-container"><button ng-if="config.conversationRecorded && !conversation.playing" ng-click="startConversation(\'playback\')" class="btn dialogue-btn dialogue-playback-btn">{{ \'cengage_dia_playback\' | engineTranslate:dataCollector }}</button> <button ng-if="config.conversationRecorded && conversation.playing" ng-click="clearConversation()" class="btn dialogue-btn dialogue-playback-stop-btn">{{ \'cengage_dia_playbacking_stop\' | engineTranslate:dataCollector }}</button> <button ng-if="!config.conversationRecorded" ng-click="startConversation(\'recording\')" ng-disabled="config.started || !config.label" class="btn dialogue-btn dialogue-start-recording-btn">{{ \'cengage_dia_start\' | engineTranslate:dataCollector }}</button></div></div><div ng-repeat="sentence in options.sentences" ng-class="{\'active-user\': conversation.index == $index && sentence.label === config.label, \'active-host\': conversation.index == $index && sentence.label !== config.label}" class="dialogue-line js-dialogue-line"><span ng-if="conversation.index == $index"><custom-circle-player ng-if="sentence.label !== config.label" urls="conversation.audio" on-end="moveToNextSentence()" engine-autoplay="true" use-shared-audio="true" class="dialogue-circle-player"></custom-circle-player><custom-circle-player ng-if="sentence.label === config.label && config.conversationRecorded" urls="recordings[$index]" on-end="moveToNextSentence()" engine-autoplay="true" use-shared-audio="true" class="dialogue-circle-player"></custom-circle-player><button ng-if="!config.conversationRecorded && sentence.label === config.label && !recording && !recorded && !busy" ng-click="startRecordingSentence()" class="btn dialogue-btn dialogue-record-btn">{{ \'cengage_dia_record\' | engineTranslate:dataCollector }}</button> <button ng-if="!config.conversationRecorded && sentence.label === config.label && recording && !busy" ng-click="stopRecordingSentence()" ng-disabled="!isRecordingStoppable" class="btn dialogue-btn dialogue-record-stop-btn">{{ \'cengage_dia_recording_stop\' | engineTranslate:dataCollector }}</button> <button ng-if="!config.conversationRecorded && sentence.label === config.label && busy" class="btn dialogue-btn dialogue-busy-btn busy" disabled=""></button></span> <span class="dialogue-sentence-label">{{sentence.label}}</span> <span class="dialogue-sentence-text">{{sentence.text}}</span></div></div>'),e.put("app/formats/cengage/dialogue/dialogue.tpl.html","<div><ng-include src=\"'app/formats/cengage/dialogue/dialogue.' + config.screen + '.tpl.html'\"></ng-include></div>"),e.put("app/formats/cengage/dialogue/redo.popup.tpl.html",'<div class="warning-popup"><h3 class="warning-popup-header">Warning</h3><p ng-bind-html="\'cengage_dia_redo_popup_text\' | engineTranslate:dataCollector"></p><div class="warning-popup-buttons"><button class="btn btn-popup-confirm" ng-click="modalInstance.close()">{{ \'cengage_dia_redo_popup_ok\' | engineTranslate:dataCollector }}</button> <button class="btn btn-default btn-cancel" ng-click="modalInstance.dismiss(\'cancel\')">{{ \'cengage_dia_redo_popup_cancel\' | engineTranslate:dataCollector }}</button></div></div>'),e.put("app/formats/cengage/dialogue/submitted.popup.tpl.html",'<button ng-if="showCross" class="btn btn-cross" ng-click="modalInstance.dismiss()"></button><div class="submitted-popup">{{ \'cengage_dia_submitted\' | engineTranslate:dataCollector }}</div>'),e.put("app/formats/cengage/essay/essay.tpl.html",'<div class="essay"><div ng-repeat="stem in stems" class="essay-container"><div ng-if="stem.question" class="essay-question"><span>{{ stem.question }}</span></div><p class="essay-word-count">{{ \'cengage_ess_wordcount\' | engineTranslate:dataCollector }} {{ stem.editor.plugins.enginetinywordcount.getCount() }}</p><textarea spellcheck="false" ui-tinymce="stem.tinymceOptions" ng-model="gapModel.userAnswer[$index]" ng-change="gapModel.evaluateStates()"></textarea></div></div>'),e.put("app/formats/cengage/highlighting/highlighting.tpl.html",'<div class="ngl-highlighting"><p class="highlighting-question-stem" ng-bind-html="options.questionStem"></p><div class="solving js-solving" ng-show="gapModel.shouldBeRenderedAsSolving()"></div><div class="report js-report" ng-show="gapModel.shouldBeRenderedAsReport()"></div><div class="show-answer js-show-answer" ng-show="gapModel.shouldBeRenderedAsShowAnswer()"></div></div>'),e.put("app/formats/cengage/openDialogue/audioNotAvailable.popup.tpl.html",'<button ng-if="showCross" class="btn btn-cross" ng-click="modalInstance.dismiss()"></button><div class="popup-modal"><p>{{ \'cengage_od_model_audionotavailable\' | engineTranslate:dataCollector }}</p></div>'),e.put("app/formats/cengage/openDialogue/openDialogue.activity.tpl.html","<div><ng-include src=\"'app/formats/cengage/openDialogue/openDialogue.' + currentScreen.type + '.tpl.html'\"></ng-include></div>"),e.put("app/formats/cengage/openDialogue/openDialogue.header.tpl.html",'<div class="od-screen-prompt"><p ng-if="currentScreen.prompt" ng-bind-html="currentScreen.prompt"></p></div>'),e.put("app/formats/cengage/openDialogue/openDialogue.menu.tpl.html",'<div class="breadcrumbs-container" ng-class="{\'finish-screen\': isFinishScreen()}"><div class="breadcrumbs-inner-container"><ul class="breadcrumbs"><li ng-if="shouldShowLeftEllipsis" class="breadcrumbs-list-item breadcrumbs-list-item-ellipsis breadcrumbs-list-item-ellipsis-left"><span class="breadcrumbs-text">...</span></li><li ng-repeat="screen in options.blocks" ng-show="screen.visible" class="breadcrumbs-list-item breadcrumbs-list-item-screen" ng-class="{active: screen.active, visited: screen.visited, \'last-visited\': $index == currentScreenIndex - 1}"><span class="breadcrumbs-text">{{screen.pageName}}</span></li><li ng-if="shouldShowRightEllipsis" class="breadcrumbs-list-item breadcrumbs-list-item-ellipsis breadcrumbs-list-item-ellipsis-right"><span class="breadcrumbs-text">...</span></li><li ng-if="shouldShowNextButton()" class="breadcrumbs-list-item breadcrumbs-list-btn breadcrumbs-list-item-arrow" ng-class="{inactive: shouldNextButtonBeInactive()}"><button ng-click="switchToNextScreen()" class="btn breadcrumbs-btn-next" ng-disabled="shouldNextButtonBeInactive()">&raquo;</button></li></ul><ul class="breadcrumbs breadcrumbs-ghost" style="display: inline-block; height: 0px; overflow: hidden; position: absolute; left: 0px; top: 0px; visibility: hidden; white-space: nowrap;"><li ng-repeat="screen in options.blocks" class="breadcrumbs-list-item" ng-class="{active: false, visited: screen.visited, \'last-visited\': $index == currentScreenIndex - 1}"><span class="breadcrumbs-text">{{screen.pageName}}</span></li><li class="breadcrumbs-list-item breadcrumbs-list-item-ellipsis"><span class="breadcrumbs-text">...</span></li><li class="breadcrumbs-list-item breadcrumbs-list-btn breadcrumbs-list-item-arrow" ng-class="{inactive: shouldNextButtonBeInactive()}"><button ng-click="switchToNextScreen()" class="btn breadcrumbs-btn-next" ng-disabled="shouldNextButtonBeInactive()">&raquo;</button></li></ul><ul class="breadcrumbs breadcrumbs-ghost-active" style="display: inline-block; height: 0px; overflow: hidden; position: absolute; left: 0px; top: 0px; visibility: hidden; white-space: nowrap;"><li ng-repeat="screen in options.blocks" class="breadcrumbs-list-item" ng-class="{active: true}"><span class="breadcrumbs-text">{{screen.pageName}}</span></li><li class="breadcrumbs-list-item breadcrumbs-list-item-ellipsis"><span class="breadcrumbs-text">...</span></li><li class="breadcrumbs-list-item breadcrumbs-list-btn breadcrumbs-list-item-arrow" ng-class="{inactive: shouldNextButtonBeInactive()}"><button ng-click="switchToNextScreen()" class="btn breadcrumbs-btn-next" ng-disabled="shouldNextButtonBeInactive()">&raquo;</button></li></ul></div></div>'),e.put("app/formats/cengage/openDialogue/openDialogue.nglOD-final.tpl.html",'<div class="od-final"><div class="od-final-container"><div ng-if="options.host.type === \'audio\'"><div class="od-avatars-container" ng-class="firstSpeaker"><div><h2 class="od-host-name" ng-class="{active: finalRecording.type === \'host\' && finalRecording.playing}">{{ options.host.name }}</h2><div style="background-image: url({{options.host.avatar}})" ng-class="{active: finalRecording.type === \'host\' && finalRecording.playing}" class="od-avatar-final od-avatar"></div></div><div><h2 class="od-user-name" ng-class="{active: finalRecording.type === \'user\' && finalRecording.playing}">{{ commons.name }}</h2><div ng-if="!userAvatar.default" style="background-image: url({{userAvatar.links[0].url}})" ng-class="{active: finalRecording.type === \'user\' && finalRecording.playing}" class="od-avatar-final od-avatar"></div><div ng-if="userAvatar.default" ng-class="mergeClasses({active: finalRecording.type === \'user\' && finalRecording.playing}, defaultAvatarClass(userAvatar))" class="od-avatar-final od-avatar"></div></div></div><engine-audio ng-show="false" on-end="onFinalRecordingPartEnded()" urls="finalRecording.media.links" engine-autoplay="finalRecording.playing"></engine-audio></div><div ng-if="options.host.type === \'video\'" class="od-host-container-video od-host-container-final-video"><engine-video ng-if="finalRecording.media" ng-show="finalRecording.type === \'host\'" on-start="onFinalRecordingPartStarted()" on-end="onFinalRecordingPartEnded()" urls="finalRecording.media.links" engine-autoplay="finalRecording.type === \'host\' && finalRecording.playing" video-poster="finalRecording.media.poster" subtitles="finalRecording.media.subtitles"></engine-video><div ng-if="!userAvatar.default && finalRecording.media && finalRecording.type === \'user\'" ng-class="{active: finalRecording.type === \'user\'}" class="od-avatar-final od-avatar" ng-style="{\'background-image\': \'url(\' + userAvatar.links[0].url +\')\'}"></div><div ng-if="userAvatar.default && finalRecording.media && finalRecording.type === \'user\'" ng-class="mergeClasses({active: finalRecording.type === \'user\'}, defaultAvatarClass(userAvatar))" class="od-avatar-final od-avatar"></div><engine-audio class="active" ng-show="false" on-end="onFinalRecordingPartEnded()" urls="finalRecording.media.links" engine-autoplay="finalRecording.type === \'user\' && finalRecording.playing"></engine-audio></div><div><button ng-if="!finalRecording.playing" ng-click="startFinalPlayback()" class="btn od-btn od-final-playback-btn">{{ \'cengage_od_final_playback\' | engineTranslate:dataCollector }}</button> <button ng-if="finalRecording.playing" ng-click="stopPlayingFinalRecording()" class="btn od-btn od-final-playback-btn-stop">{{ \'cengage_od_final_playback_stop\' | engineTranslate:dataCollector }}</button></div></div></div>'),e.put("app/formats/cengage/openDialogue/openDialogue.nglOD-host.tpl.html",'<div ng-if="options.host.type === \'audio\'" class="od-host-container"><h2 class="od-host-name">{{ options.host.name }}</h2><div ng-style="{\'background-image\': \'url({{options.host.avatar}})\'}" class="od-host-avatar od-avatar"></div><engine-audio urls="currentScreen.media.links" class="od-host-audio"></engine-audio></div><div ng-if="options.host.type === \'video\'" class="od-host-container-video"><engine-video urls="currentScreen.media.links" video-poster="currentScreen.media.poster" subtitles="currentScreen.media.subtitles"></engine-video></div>'),e.put("app/formats/cengage/openDialogue/openDialogue.nglOD-user.tpl.html",'<div class="od-user-container"><div><h2 class="od-user-name">{{ commons.name }}</h2><div ng-if="!userAvatar.default" ng-style="{\'background-image\': \'url(\' + userAvatar.links[0].url +\')\'}" class="od-user-avatar od-avatar"></div><div ng-if="userAvatar.default" class="od-user-avatar od-avatar" ng-class="defaultAvatarClass(userAvatar)"></div><div class="od-user-name-btns-container"><button ng-if="!recording && !busy" ng-disabled="playing && !sriSpeechClient.isConnected()" ng-click="startRecording()" class="btn od-btn btn-record-start">{{ \'cengage_od_user_record\' | engineTranslate:dataCollector }}</button> <button ng-if="recording && !busy" ng-click="stopRecording()" class="btn od-btn btn-record-stop">{{ \'cengage_od_user_record_stop\' | engineTranslate:dataCollector }}</button> <button ng-if="busy" class="btn od-btn btn-record-start busy" disabled=""></button> <button ng-if="!playing" ng-disabled="!currentScreen.recording" ng-click="playRecording()" class="btn od-btn btn-playback-start">{{ \'cengage_od_user_playback\' | engineTranslate:dataCollector }}</button> <button ng-if="playing" ng-disabled="!currentScreen.recording" ng-click="stopPlayingRecording()" class="btn od-btn btn-playback-stop">{{ \'cengage_od_user_playback_stop\' | engineTranslate:dataCollector }}</button></div></div></div>'),e.put("app/formats/cengage/openDialogue/openDialogue.nglOD-welcome.tpl.html",'<div class="od-welcome-rubric"><h1 class="od-welcome-rubric-heading">{{ currentScreen.header }}</h1><p ng-bind-html="currentScreen.text" class="od-welcome-rubric-text"></p><div class="od-welcome-start-btn-container"><input ng-click="scrollNameInput()" ui-keypress="{13:\'!commons.name || !userAvatar || switchToNextScreen()\'}" ng-model="commons.name" placeholder="{{ \'cengage_od_welcome_name_placeholder\' | engineTranslate:dataCollector }}" class="od-welcome-start-input"> <button ng-click="openSelectAvatarPopup()" uib-popover-template="selectAvatarPopupUrl" popover-append-to-body="true" popover-placement="auto top" popover-trigger="\'none\'" popover-is-open="commons.selectingAvatar" popover-class="exercise-wrapper-body od-avatars-popup" class="btn od-welcome-avatar-btn">{{ \'cengage_od_welcome_select_avatar\' | engineTranslate:dataCollector }}</button> <button ng-click="switchToNextScreen()" ng-disabled="!commons.name || !userAvatar" class="btn od-welcome-start-btn">{{ \'cengage_od_welcome_start\' | engineTranslate:dataCollector }}</button></div></div>'),e.put("app/formats/cengage/openDialogue/openDialogue.tpl.html","<div><p>{{ 'cengage_segmented_wrapper_needed' | engineTranslate:dataCollector }}</p></div>"),e.put("app/formats/cengage/openDialogue/select-avatar-popup.tpl.html",'<div class="od-popup-avatars-container"><div ng-repeat="avatar in avatars" ng-class="{\'avatar-selected\': avatar === userAvatar}" class="od-select-avatar"><div ng-if="!avatar.default" style="background-image: url({{avatar.links[0].url}})" ng-click="selectAvatar(avatar)" class="od-select-avatar-image"></div><div ng-if="avatar.default" ng-click="selectAvatar(avatar)" class="od-select-avatar-image" ng-class="defaultAvatarClass(avatar)"></div></div></div>'),e.put("app/formats/cengage/openDialogue/submitted.popup.tpl.html",'<button ng-if="showCross" class="btn btn-cross" ng-click="modalInstance.dismiss()"></button><div class="submitted-popup">{{ \'cengage_od_submitted\' | engineTranslate:dataCollector }}</div>'),e.put("app/formats/cengage/quizShow/finish.popup.tpl.html",'<div class="submitted-popup qs-finish-screen"><div ng-if="!isItADraw"><div class="team-{{winner.name}}-color qs-winning-team">{{ \'cengage_qs_team_wins\' | engineTranslate:dataCollector:winner }}</div><div>{{ \'cengage_qs_congratulations\' | engineTranslate:dataCollector }}</div></div><div ng-if="isItADraw">{{ \'cengage_qs_draw\' | engineTranslate:dataCollector }}</div></div>'),e.put("app/formats/cengage/quizShow/quizShow.tpl.html",'<div class="quiz-show"><div ng-if="mode === \'quiz\' || mode === \'finish\'"><div class="teams"><div ng-repeat="team in game.teams" ng-class="getClassesForTeam(team, $index)" class="team"><div class="inner-team"><span class="team-name">{{ \'cengage_qs_team\' | engineTranslate:dataCollector }} {{ team.name }}</span> <span>{{ team.score }} {{ \'cengage_qs_pts\' | engineTranslate:dataCollector }}</span></div><div class="active-team"></div></div></div><div class="quiz-categories"><div class="quiz-columns"><div ng-repeat="category in categories" class="quiz-column quiz-column-name"><span>{{ category.name }}</span></div></div><div class="quiz-columns"><div ng-repeat="category in categories" class="quiz-column"><div ng-repeat="question in category.questions"><button ng-click="showGap(question)" ng-disabled="shouldQuestionBeDisabled(question)" ng-class="getClassesForQuestion(question)" class="question-btn">{{ question.pointsToGet }}</button></div></div></div></div></div><div class="exercise-popup segmented-frame" ng-class="exerciseClass" ng-if="mode === \'exercise\'"><div class="execise-popup-header"><span><span class="exercise-popup-badge exercise-popup-badge-{{ game.teams[game.turn].name }} qs-team">{{ \'cengage_qs_team\' | engineTranslate:dataCollector }} {{ game.teams[game.turn].name }}</span> <span>{{ game.currentQuestion.category }}</span></span> <span class="exercise-popup-badge">{{ game.currentQuestion.pointsToGet }} {{ \'cengage_qs_points\' | engineTranslate:dataCollector }}</span></div><div class="exercise-popup-body"><block-element content="game.currentQuestion.exercise"></block-element></div></div></div>'),e.put("app/formats/cengage/sentence-correction/edit-answer-popup.tpl.html",'<input focus-on="true" ng-model="answer.tmpValue" ui-keypress="{13:\'acceptEditedAnswer(answer)\'}"> <button class="btn btn-confirm" ng-click="acceptEditedAnswer(answer, $event)">{{ \'cengage_cor_edit_ok\' | engineTranslate:dataCollector }}</button> <button class="btn btn-cross" ng-click="rejectEditedAnswer(answer)"></button>'),e.put("app/formats/cengage/sentence-correction/reset-modal.tpl.html",'<div class="modal-body warning-popup"><h3 class="warning-popup-header">{{ \'cengage_cor_reset_title\' | engineTranslate:dataCollector }}</h3><p ng-bind-html="\'cengage_cor_reset_text\' | engineTranslate:dataCollector"></p><div class="warning-popup-buttons"><button class="btn btn-popup-confirm" ng-click="modalInstance.close()">{{ \'cengage_cor_reset_ok\' | engineTranslate:dataCollector }}</button> <button class="btn btn-default btn-cancel" ng-click="modalInstance.dismiss(\'cancel\')">{{ \'cengage_cor_reset_cancel\' | engineTranslate:dataCollector }}</button></div></div>'),e.put("app/formats/cengage/sentence-correction/sentence-correction.tpl.html",'<div class="ngl-sen-cor"><div class="solving" ng-show="gapModel.shouldBeRenderedAsSolving()"><div class="ngl-sen-cor-btn-container"><button ng-if="options.showOriginalText" class="btn ngl-sen-cor-original" ng-click="showOriginalText()">{{ \'cengage_cor_original_text\' | engineTranslate:dataCollector }}</button> <button class="btn ngl-sen-cor-reset" ng-disabled="disableReset" ng-click="showResetModal()"></button></div><div class="ngl-sen-cor-text"><span class="js-solving"></span><answer-option-popover ng-if="isChecked && gapModel.getFeedbackForGap(true)" answer-option="gapModel.getFeedbackForGap(true)" answer-template="app/common/directives/answerOptionPopoverPopup.tpl.html" class="ngl-sen-cor-popover-container"></answer-option-popover></div></div><div class="report" ng-class="gapModel.getCorrectnessClasses(0)" ng-show="gapModel.shouldBeRenderedAsReport()"><span class="js-report"></span><answer-option-popover ng-if="gapModel.getFeedbackForGap(true)" answer-option="gapModel.getFeedbackForGap(true)" answer-template="app/common/directives/answerOptionPopoverPopup.tpl.html" class="ngl-sen-cor-popover-container"></answer-option-popover></div><div class="showAnswers correct" ng-show="gapModel.shouldBeRenderedAsShowAnswer()"><span class="js-show-answer"></span></div></div>'),e.put("app/formats/cengage/sentence-correction/show-original-text-modal.tpl.html",'<button class="btn btn-cross" ng-click="modalInstance.dismiss()"></button><div class="popup-modal popup-original-text" ng-bind-html="originalText"></div>'),e.put("app/formats/cengage/sentence-insertion/sentence-insertion.tpl.html",'<div class="sentence-insertion"><div class="sen-ins-wordpool"><span class="sen-ins-wordpool-item">{{correctAnswer.value}}</span></div><div class="solving js-solving" ng-show="gapModel.shouldBeRenderedAsSolving()"></div><div class="report js-report" ng-show="gapModel.shouldBeRenderedAsReport()"></div><div class="show-answer js-show-answer" ng-show="gapModel.shouldBeRenderedAsShowAnswer()"></div></div>'),e.put("app/formats/cengage/speaking/speaking.tpl.html",'<div class="sp-wrapper"><div class="sp-container"><div class="sp-button-bar"><button ng-if="hasModelAnswer && !playingModelAnswer" ng-click="playModelAnswer()" ng-disabled="!audioContextAvailable() || recording || playingRecording" class="sp-play-model-btn btn">{{ \'cengage_sp_listen\' | engineTranslate:dataCollector }}</button> <button ng-if="hasModelAnswer && playingModelAnswer" ng-click="stopPlaying()" class="sp-stop-btn-2 sp-play-model-stop-btn btn">{{ \'cengage_sp_listening_stop\' | engineTranslate:dataCollector }}</button> <button ng-if="!recording && !busy" ng-click="startRecording()" ng-disabled="!audioContextAvailable() || !sriSpeechClient.isConnected() || playingModelAnswer || playingRecording || gapModel.shouldBeRenderedAsReport()" class="sp-record-btn btn">{{ \'cengage_sp_record\' | engineTranslate:dataCollector }}</button> <button ng-if="recording && !busy" ng-click="stopRecording()" class="sp-stop-btn sp-record-stop-btn btn">{{ \'cengage_sp_recording_stop\' | engineTranslate:dataCollector }}</button> <button ng-if="busy" class="sp-record-btn btn busy" disabled=""></button> <button ng-if="!playingRecording" ng-click="playRecording()" ng-disabled="!audioContextAvailable() || !gapModel.userAnswer || recording || playingModelAnswer" class="sp-playback-btn btn">{{ \'cengage_sp_playback\' | engineTranslate:dataCollector }}</button> <button ng-if="playingRecording" ng-click="stopPlaying()" class="sp-stop-btn-2 sp-playback-stop-btn btn">{{ \'cengage_sp_playbacking_stop\' | engineTranslate:dataCollector }}</button></div><div class="timer-container" ng-if="recording"><div class="timer-bar"><div class="timer-bar-spent" ng-style="{width: currentTimePercent + \'%\'}"></div></div><div class="timer-time-left">{{ currentTime || 0 }}/{{ recordingLimit }}</div></div></div></div>'),e.put("app/formats/cengage/sri-multiple-choice/error.popup.tpl.html",'<button ng-if="showCross" class="btn btn-cross" ng-click="modalInstance.dismiss()"></button><div class="sri-recording-popup"><h3 class="sri-recording-popup-header">Recording Failed</h3>{{ \'cengage_sri_mc_error_\' + errorCode | engineTranslate:dataCollector }}</div>'),e.put("app/formats/cengage/sri-multiple-choice/sri-multiple-choice.tpl.html",'<div ng-class="getClassesForGap()" class="sri-mc-container"><div class="question" ng-class="{\'missing\': gapModel.shouldBeRenderedAsReport() && gapModel.states[0].isMissing()}"><custom-circle-player urls="options.question.audio.links" ng-if="options.question.audio.links[0]"></custom-circle-player><span ng-bind-html="options.question.text"></span></div><div class="inner-box"><div class="answers"><ul><li ng-repeat="answer in options.answers" ng-class="getClassesForAnswer(answer)"><custom-circle-player urls="answer.audio.links" ng-if="answer.audio.links[0]"></custom-circle-player>{{answer.option}}</li></ul></div><div class="sri-mc-btns-timer"><div class="sri-mc-btn-container"><button ng-if="!recording && !busy" ng-disabled="startButtonDisabled || playing || !gapModel.shouldBeRenderedAsSolving()" ng-click="startRecording()" class="btn sri-mc-record-btn">{{ \'cengage_sri_mc_record\' | engineTranslate:dataCollector }}</button> <button ng-if="recording && !busy" ng-disabled="stopButtonDisabled" ng-click="stopRecording()" class="btn sri-mc-record-stop-btn">{{ \'cengage_sri_mc_recording_stop\' | engineTranslate:dataCollector }}</button> <button ng-if="busy" class="btn sri-mc-record-btn busy" disabled=""></button> <button ng-if="!playing" ng-disabled="!audioUri" ng-click="startPlayback()" class="btn sri-mc-playback-btn">{{ \'cengage_sri_mc_playback\' | engineTranslate:dataCollector }}</button> <button ng-if="playing" ng-click="stopPlayback()" class="btn sri-mc-playback-stop-btn">{{ \'cengage_sri_mc_playbacking_stop\' | engineTranslate:dataCollector }}</button></div><div class="sri-mc-timer-wrapper" ng-if="recording"><div class="sri-mc-timer-bar-container"><div class="sri-mc-timer-bar" ng-style="{width: currentTimePercent + \'%\'}"></div></div><div class="sri-mc-time">{{ currentRecordingTime || 0 }}/{{ recordingTimeLimit }}</div></div></div></div></div>'),e.put("app/formats/cengage/sri-multiple-choice/warning.popup.tpl.html",'<button ng-if="showCross" class="btn btn-cross" ng-click="modalInstance.dismiss()"></button><div class="sri-recording-popup"><h3 class="sri-recording-popup-header">Recording Failed</h3>{{ \'cengage_sri_mc_warning_\' + warningCode | engineTranslate:dataCollector }}</div>'),e.put("app/formats/cengage/tic-tac-toe/finish.popup.tpl.html",'<div class="submitted-popup"><div class="ttt-winning-team" ng-if="!isItADraw"><span class="team-{{winner.name}}">{{ \'cengage_ttt_team_wins\' | engineTranslate:dataCollector:winner }}</span></div><div ng-if="isItADraw">{{ \'cengage_ttt_draw\' | engineTranslate:dataCollector }}</div></div>'),e.put("app/formats/cengage/tic-tac-toe/tic-tac-toe.tpl.html",'<div class="tic-tac-toe"><div ng-if="mode === \'ttt\' || mode === \'finish\'"><div class="teams"><div ng-repeat="team in game.teams" ng-class="getClassesForTeam(team, $index)" class="team"><div class="inner-team"><span class="team-name">{{ \'cengage_ttt_team\' | engineTranslate:dataCollector }} {{ team.name }}</span></div><div class="active-team"></div></div></div><div class="questions board-wrapper"><div class="board"><div class="board-row" ng-repeat="i in [0,1,2] track by i"><div class="board-cell-wrapper" ng-repeat="j in [0,1,2] track by j"><button class="board-cell" ng-click="showGap(questions[i*3 + j])" ng-disabled="shouldQuestionBeDisabled(questions[i*3 + j])" ng-class="getClassesForQuestion(questions[i*3 + j])"><span class="ttt-question-label">{{ getQuestionLabel(questions[i*3 + j]) }}</span></button></div></div></div><svg ng-if="mode === \'finish\'" xmlns="http://www.w3.org/2000/svg" class="board-overlay"><g><line class="board-strike"></line></g></svg></div></div><div class="exercise-popup segmented-frame" ng-class="exerciseClass" ng-if="mode === \'exercise\'"><div class="execise-popup-header"><span class="ttt-team exercise-popup-badge exercise-popup-badge-{{game.teams[game.turn].name}}">{{ \'cengage_ttt_team\' | engineTranslate:dataCollector }} {{ game.teams[game.turn].name }}</span></div><div class="exercise-popup-body"><block-element content="game.currentQuestion.exercise"></block-element></div></div></div>'),e.put("app/formats/cengage/writingExperience/viewTimeSpent.popup.tpl.html","<div class=\"we-time-modal\"><button ng-click=\"modalInstance.dismiss('cancel')\" class=\"we-time-modal-dismiss btn\">x</button><table class=\"we-time-table\"><tr><th>{{ 'cengage_we_timespent_section' | engineTranslate:dataCollector }}</th><th>{{ 'cengage_we_timespent_recommended' | engineTranslate:dataCollector }}</th><th>{{ 'cengage_we_timespent_timespent' | engineTranslate:dataCollector }}</th></tr><tr ng-repeat=\"section in sections\"><td>{{ section.name }}</td><td>{{ section.total | milisecondsToMinutes }} {{ 'cengage_we_min' | engineTranslate:dataCollector }}</td><td ng-class=\"{overtimed: section.overtimed}\">{{ section.spent | milisecondsToMinutes }} {{ 'cengage_we_min' | engineTranslate:dataCollector }}</td></tr><tr><td>{{ 'cengage_we_timespent_total' | engineTranslate:dataCollector }}</td><td>{{ summary.total | milisecondsToMinutes }} {{ 'cengage_we_min' | engineTranslate:dataCollector }}</td><td ng-class=\"{overtimed: summary.overtimed}\">{{ summary.spent | milisecondsToMinutes }} {{ 'cengage_we_min' | engineTranslate:dataCollector }}</td></tr></table></div>"),e.put("app/formats/cengage/writingExperience/writingExperience.activity.tpl.html","<div><ng-include src=\"'app/formats/cengage/writingExperience/writingExperience.' + currentScreen.type + '.tpl.html'\" class=\"{{currentScreen.type}}\"></ng-include></div>"),e.put("app/formats/cengage/writingExperience/writingExperience.custom.stimulus.tpl.html",'<div><div ng-repeat="prompt in customStimulusPrompts"><strong ng-bind-html="prompt.name"></strong><p>{{ prompt.value }}</p></div></div>'),e.put("app/formats/cengage/writingExperience/writingExperience.header.tpl.html",'<div ng-if="currentScreen.instruction" class="we-instruction-container"><h3 class="we-instruction" ng-bind-html="currentScreen.instruction"></h3></div>'),e.put("app/formats/cengage/writingExperience/writingExperience.menu.tpl.html",'<div class="breadcrumbs-container"><ul class="breadcrumbs"><li ng-repeat="screen in options.blocks" class="breadcrumbs-list-item" ng-class="{active: screen.active, visited: screen.visited && options.forwardOnlyNavigation, \'last-visited\': $index == currentScreenIndex - 1, \'free-navigation\': canNavigateFree($index)}"><span class="breadcrumbs-text" ng-click="canNavigateFree($index) && switchToNextScreen($index)">{{screen.pageName}} <span ng-if="options.timer && screen.time" class="breadcrumbs-time">{{screen.time}} {{ \'cengage_we_min\' | engineTranslate:dataCollector }}</span></span></li><li ng-if="shouldShowNextButton()" class="breadcrumbs-list-item breadcrumbs-list-btn"><button ng-click="switchToNextScreen()" class="btn breadcrumbs-btn-next"></button></li></ul></div><div><ng-include ng-if="options.timer" src="\'app/formats/cengage/writingExperience/writingExperience.timer.tpl.html\'"></ng-include></div>'),e.put("app/formats/cengage/writingExperience/writingExperience.nglWE-final.tpl.html",'<div class="we-final-heading"><strong>{{ \'cengage_we_finish_finalwriting\' | engineTranslate:dataCollector }}</strong></div><div ng-bind-html="gapModel.userAnswer" class="we-user-answer"></div>'),e.put("app/formats/cengage/writingExperience/writingExperience.nglWE-plan.tpl.html",'<div class="we-plan-screen"><div class="we-screen-name-container"><span class="we-screen-name">{{ currentScreen.pageName }}</span></div><div class="we-plan-main-area"><div class="we-plan-prompt"><div ng-repeat="prompt in currentScreen.prompts"><p ng-bind-html="prompt.name"></p><textarea spellcheck="false" rows="{{prompt.rows}}" ng-model="prompt.value" class="we-plan-textarea"></textarea></div></div></div></div>'),e.put("app/formats/cengage/writingExperience/writingExperience.nglWE-welcome.tpl.html",'<div class="we-welcome-container"><div class="we-welcome-rubric"><h1 class="we-welcome-rubric-heading">{{ currentScreen.header }}</h1><p ng-bind-html="currentScreen.text" class="we-welcome-rubric-text"></p><button ng-click="switchToNextScreen()" class="btn we-start-btn">{{ \'cengage_we_welcome_start\' | engineTranslate:dataCollector }}</button></div></div>'),e.put("app/formats/cengage/writingExperience/writingExperience.nglWE-write-edit.tpl.html",'<div class="we-write-edit-screen"><div class="we-write-edit-main-area"><div class="we-write-edit-prompt"><div><span class="we-screen-name">{{ currentScreen.pageName }}</span></div><p class="we-word-count">{{ \'cengage_we_write_wordcount\' | engineTranslate:dataCollector }} {{ editor.plugins.wordcount.getCount() }}</p><textarea spellcheck="false" ui-tinymce="tinymceOptions" ng-model="gapModel.userAnswer"></textarea></div></div></div>'),e.put("app/formats/cengage/writingExperience/writingExperience.phone.tpl.html","<div class=\"we-not-supported\"><p>{{ 'cengage_we_not_supported' | engineTranslate:dataCollector }}</p></div>"),e.put("app/formats/cengage/writingExperience/writingExperience.timer.tpl.html",'<div class="timer-container"><div class="timer-bar"><div class="timer-bar-spent" ng-style="{width: timerData.percent + \'%\'}" ng-class="{\'timer-finish\': timerData.percent >= 100}"></div></div><div class="timer-time-left" ng-class="{\'timer-finish\': timerData.percent >= 100}">{{ timerData.left | milisecondsToMinutes }} {{ \'cengage_we_minutesleft\' | engineTranslate:dataCollector }}</div></div>'),e.put("app/formats/cengage/writingExperience/writingExperience.tpl.html","<div class=\"we-not-in-segmented\"><p>{{ 'cengage_segmented_wrapper_needed' | engineTranslate:dataCollector }}</p></div>"),e.put("app/formats/gapfill/templates/gapfill-dnd.tpl.html",'<span class="dnd t_dnd" ng-class="{\'has-suffix\': !!options.suffix}"><span ng-if="options.prefix" class="option-prefix">{{options.prefix}}</span> <span ng-show="gapModel.shouldBeRenderedAsSolving() && gapModel.eyeball.shouldBeRenderedAsSolving(0)"><gapfill-dnd ng-if="wordpoolType === \'dnd\'" ng-class="gapModel.getCorrectnessClasses(0)" class="t_gapfill-dnd"></gapfill-dnd><span ng-if="wordpoolType === \'taptap\'" ng-class="getClassesForTapTap()" class="dnd-droppable dnd-gap taptap-gap t_gapfill-taptap" ng-click="handleTapTapClick()"><span class="wordpool-item wordpool-item-taptap" ng-if="gapModel.userAnswer.option"><answer-option type="gapModel.userAnswer.type" option="gapModel.userAnswer.option" config="{playerType: options.playerType}"></answer-option></span></span><answer-option-popover ng-if="gapModel.hasAutomaticMarking() && gapModel.getFeedbackForGap() != null" answer-option="gapModel.getFeedbackForGap()" answer-template="app/common/directives/answerOptionPopoverPopup.tpl.html"></answer-option-popover></span> <span ng-if="gapModel.shouldBeRenderedAsShowAnswer() || gapModel.eyeball.shouldBeRenderedAsShowAnswer(0)" class="dnd-gap show-answer t_showAnswer show-answer-icon"><answer-option type="gapModel.attrs.answers[0].type" option="gapModel.attrs.answers[0].option" config="{playerType: options.playerType}"></answer-option></span> <span ng-if="gapModel.shouldBeRenderedAsReport() || gapModel.eyeball.shouldBeRenderedAsReport(0)" ng-class="gapModel.getCorrectnessClasses(0)" class="dnd-gap t_showReport"><answer-option type="gapModel.userAnswer.type" option="gapModel.userAnswer.option" config="{playerType: options.playerType}"></answer-option></span><answer-option-popover ng-if="gapModel.shouldBeRenderedAsGivenReport(\'system\') && gapModel.getFeedbackForGap() != null" answer-option="gapModel.getFeedbackForGap()" answer-template="app/common/directives/answerOptionPopoverPopup.tpl.html"></answer-option-popover><span ng-if="gapModel.shouldBeRenderedAsExample()" class="example dnd-gap t_example"><answer-option type="gapModel.attrs.answers[0].type" option="gapModel.attrs.answers[0].option" config="{playerType: options.playerType}"></answer-option></span> <span ng-if="options.suffix" class="option-suffix">{{options.suffix}}</span><engine-eyeball-button ng-if="shouldShowEyeballs && gapModel.shouldBeRenderedAsSolving()" eyeball="gapModel.eyeball" state-id="0" on-fire="onEyeballFire()"></engine-eyeball-button></span>'),e.put("app/formats/gapfill/templates/gapfill-fillin.tpl.html",'<span class="fillin t_fillin" ng-class="{\'has-suffix\': !!options.suffix}"><span ng-if="options.prefix" class="option-prefix">{{options.prefix}}</span> <span ng-if="gapModel.shouldBeRenderedAsSolving() && gapModel.eyeball.shouldBeRenderedAsSolving(0)" class="solving"><span ng-if="gapModel.getDisplayType() === \'fillin\'" ng-class="gapModel.getCorrectnessClasses(0)"><input spellcheck="false" ng-keyup="onKeyUp()" ng-model="gapModel.userAnswer.option" ng-blur="evaluate()" ng-change="evaluate()" type="text" class="t_solving input-field js-fillin-input" autosize="!gapModel.attrs.disableAutosize"></span><keyboard ng-if="gapModel.getDisplayType() === \'fillin-keyboard\'" keyboard-key-press="onKeyUp()" parent-sizing="getElementSizing()"><span ng-class="gapModel.getCorrectnessClasses(0)"><input spellcheck="false" insert-caret="" ng-model="gapModel.userAnswer.option" ng-keyup="onKeyUp()" ng-blur="evaluate()" ng-change="evaluate()" type="text" class="t_solving input-field js-fillin-input" autosize="!gapModel.attrs.disableAutosize"></span></keyboard><answer-option-popover ng-if="gapModel.hasAutomaticMarking() && gapModel.getFeedbackForGap() != null" answer-option="gapModel.getFeedbackForGap()" answer-template="app/common/directives/answerOptionPopoverPopup.tpl.html"></answer-option-popover></span> <span ng-if="gapModel.shouldBeRenderedAsShowAnswer() || gapModel.eyeball.shouldBeRenderedAsShowAnswer(0)" class="show-answer-icon"><span class="show-answer input-field t_showAnswer" type="text" disabled=""><span>{{gapModel.attrs.answers[0].option}}</span></span></span> <span ng-if="(gapModel.shouldBeRenderedAsReport() || gapModel.eyeball.shouldBeRenderedAsReport(0)) && gapModel.attrs.markedBy === \'system\'"><span ng-class="gapModel.getCorrectnessClasses(0)" class="input-field t_showReport"><span>{{ gapModel.userAnswer.option || \'&nbsp;\' }}</span></span></span> <span ng-if="(gapModel.shouldBeRenderedAsReport() || gapModel.eyeball.shouldBeRenderedAsReport(0)) && gapModel.attrs.markedBy === \'non-marked\'"><span class="input-field t_showReport">{{ gapModel.userAnswer.option || \'&nbsp;\' }}</span></span><answer-option-popover ng-if="gapModel.shouldBeRenderedAsGivenReport(\'system\') && gapModel.getFeedbackForGap() != null" answer-option="gapModel.getFeedbackForGap()" answer-template="app/common/directives/answerOptionPopoverPopup.tpl.html"></answer-option-popover><span ng-if="gapModel.shouldBeRenderedAsExample()"><span class="input-field example t_example" type="text" readonly="">{{gapModel.attrs.answers[0].option}}</span></span> <span ng-if="options.suffix" class="option-suffix">{{options.suffix}}</span><engine-eyeball-button ng-if="shouldShowEyeballs && gapModel.shouldBeRenderedAsSolving()" eyeball="gapModel.eyeball" state-id="0"></engine-eyeball-button></span>'),e.put("app/formats/mcMultipleAnswers/templates/mcMultipleAnswers-checkboxes.tpl.html",'<span class="mcma mc-multiple-answers t_mcma"><span class="t_report" ng-class="getClassesForCheckboxes()"><span class="selectable-option checkboxes t_checkboxes"><span ng-repeat="option in gapModel.attrs.answers" ng-class="{\'asset-answer\': option.type !== \'text\'}"><span ng-if="gapModel.shouldBeRenderedAsSolving() && gapModel.eyeball.shouldBeRenderedAsSolving(0)" class="checkbox-block active t_solving" ng-class="getOptionClasses(option, \'system-option\')"><input type="checkbox" ng-change="evaluate()" ng-model="answer.selected[option.customId]" ng-value="option.option" ng-checked="option.selected"> <span class="option" ng-click="checkAndEvaluate(option)"><answer-option type="option.type" option="option.option" config="{playerType: options.playerType}"></answer-option></span><answer-option-popover ng-if="option.selected === true && getOptionFeedback(option) != null && gapModel.hasAutomaticMarking()" answer-option="getOptionFeedback(option)" answer-template="app/common/directives/answerOptionPopoverPopup.tpl.html"></answer-option-popover></span> <span ng-if="gapModel.shouldBeRenderedAsShowAnswer() || gapModel.eyeball.shouldBeRenderedAsShowAnswer(0)" ng-class="{\'show-answer\': option.isCorrect}" class="checkbox-block t_showAnswer"><input type="checkbox" disabled="" ng-checked="option.isCorrect"> <span class="option"><answer-option type="option.type" option="option.option" config="{playerType: options.playerType}"></answer-option></span></span> <span ng-if="gapModel.shouldBeRenderedAsReport() || gapModel.eyeball.shouldBeRenderedAsReport(0)" class="checkbox-block t_showReport" ng-class="getCorrectnessClasses(option)"><input type="checkbox" disabled="" ng-checked="answer.selected[option.customId] === true"> <span class="option"><answer-option type="option.type" option="option.option" config="{playerType: options.playerType}"></answer-option></span><answer-option-popover ng-if="option.selected === true && getOptionFeedback(option) != null" answer-option="getOptionFeedback(option)" answer-template="app/common/directives/answerOptionPopoverPopup.tpl.html"></answer-option-popover></span> <span ng-if="gapModel.shouldBeRenderedAsExample()" class="answer-option-{{option.type}}"><input type="checkbox" disabled="" ng-checked="option.isCorrect"> <span class="option"><answer-option type="option.type" option="option.option" config="{playerType: options.playerType}"></answer-option></span></span></span></span><answer-option-popover ng-if="shouldRenderGlobalFeedback()" answer-option="gapModel.getFeedbackForGap()" answer-template="app/common/directives/answerOptionPopoverPopup.tpl.html"></answer-option-popover></span><engine-eyeball-button ng-if="shouldShowEyeballs && gapModel.shouldBeRenderedAsSolving()" eyeball="gapModel.eyeball" state-id="0"></engine-eyeball-button></span>'),e.put("app/formats/mcMultipleAnswers/templates/mcMultipleAnswers-cross-out.tpl.html",'<span class="mcma mc-multiple-answers t_mcma"><span class="t_report" ng-class="getClassesForMultipleChoice()"><span class="selectable-option cross-out"><span ng-repeat="option in gapModel.attrs.answers" ng-class="{\'asset-answer\': option.type !== \'text\'}"><span ng-if="gapModel.shouldBeRenderedAsSolving()" ng-class="gapModel.getCorrectnessClasses(option.customId, \'system-option\')"><span class="active" ng-class="{\'selected\': option.selected}" ng-click="checkAndEvaluate(option)"><span class="option"><answer-option type="option.type" option="option.option" config="{playerType: options.playerType}"></answer-option></span></span><answer-option-popover ng-if="option.selected === true && getOptionFeedback(option) != null && gapModel.hasAutomaticMarking()" answer-option="getOptionFeedback(option)" answer-template="app/common/directives/answerOptionPopoverPopup.tpl.html"></answer-option-popover></span> <span ng-if="gapModel.shouldBeRenderedAsShowAnswer()" ng-class="{ \'show-answer selected\': option.isCorrect }"><span class="option"><answer-option type="option.type" option="option.option" config="{playerType: options.playerType}"></answer-option></span></span> <span ng-if="gapModel.shouldBeRenderedAsReport()" ng-class="getCorrectnessClasses(option)"><span class="option"><answer-option type="option.type" option="option.option" config="{playerType: options.playerType}"></answer-option></span><answer-option-popover ng-if="option.selected === true && getOptionFeedback(option) != null" answer-option="getOptionFeedback(option)" answer-template="app/common/directives/answerOptionPopoverPopup.tpl.html"></answer-option-popover></span> <span ng-if="gapModel.shouldBeRenderedAsExample()" ng-class="{ \'selected\': option.isCorrect }"><span class="option"><answer-option type="option.type" option="option.option" config="{playerType: options.playerType}"></answer-option></span></span></span></span><answer-option-popover ng-if="shouldRenderGlobalFeedback()" answer-option="gapModel.getFeedbackForGap()" answer-template="app/common/directives/answerOptionPopoverPopup.tpl.html"></answer-option-popover></span></span>'),e.put("app/formats/mcMultipleAnswers/templates/mcMultipleAnswers-highlight.tpl.html",'<span class="mcma mc-multiple-answers t_mcma"><span class="t_report" ng-class="getClassesForMultipleChoice()"><span class="selectable-option highlight"><span ng-repeat="option in gapModel.attrs.answers" ng-class="{\'asset-answer\': option.type !== \'text\'}"><span ng-if="gapModel.shouldBeRenderedAsSolving()" ng-class="gapModel.getCorrectnessClasses(option.customId, \'system-option\')"><span class="active" ng-class="{\'selected\': option.selected}" ng-click="checkAndEvaluate(option)"><span class="option"><answer-option type="option.type" option="option.option" config="{playerType: options.playerType}"></answer-option></span></span><answer-option-popover ng-if="option.selected === true && getOptionFeedback(option) != null && gapModel.hasAutomaticMarking()" answer-option="getOptionFeedback(option)" answer-template="app/common/directives/answerOptionPopoverPopup.tpl.html"></answer-option-popover></span> <span ng-if="gapModel.shouldBeRenderedAsShowAnswer()" ng-class="{ \'show-answer selected\': option.isCorrect }"><span class="option"><answer-option type="option.type" option="option.option" config="{playerType: options.playerType}"></answer-option></span></span> <span ng-if="gapModel.shouldBeRenderedAsReport()" ng-class="getCorrectnessClasses(option)"><span class="option"><answer-option type="option.type" option="option.option" config="{playerType: options.playerType}"></answer-option></span><answer-option-popover ng-if="option.selected === true && getOptionFeedback(option) != null" answer-option="getOptionFeedback(option)" answer-template="app/common/directives/answerOptionPopoverPopup.tpl.html"></answer-option-popover></span> <span ng-if="gapModel.shouldBeRenderedAsExample()" ng-class="{ \'selected\': option.isCorrect }"><span class="option"><answer-option type="option.type" option="option.option" config="{playerType: options.playerType}"></answer-option></span></span></span></span><answer-option-popover ng-if="shouldRenderGlobalFeedback()" answer-option="gapModel.getFeedbackForGap()" answer-template="app/common/directives/answerOptionPopoverPopup.tpl.html"></answer-option-popover></span></span>'),e.put("app/formats/mcMultipleAnswers/templates/mcMultipleAnswers-underline.tpl.html",'<span class="mcma mc-multiple-answers t_mcma"><span class="t_report" ng-class="getClassesForMultipleChoice()"><span class="selectable-option underline t_underline"><span ng-repeat="option in gapModel.attrs.answers" ng-class="{\'asset-answer\': option.type !== \'text\'}"><span ng-if="gapModel.shouldBeRenderedAsSolving()" ng-class="gapModel.getCorrectnessClasses(option.customId, \'system-option\')"><span class="active t_solving" ng-class="{\'selected\': option.selected}" ng-click="checkAndEvaluate(option)"><span class="option"><answer-option type="option.type" option="option.option" config="{playerType: options.playerType}"></answer-option></span></span><answer-option-popover ng-if="option.selected === true && getOptionFeedback(option) != null && gapModel.hasAutomaticMarking()" answer-option="getOptionFeedback(option)" answer-template="app/common/directives/answerOptionPopoverPopup.tpl.html"></answer-option-popover></span> <span class="t_showAnswer" ng-if="gapModel.shouldBeRenderedAsShowAnswer()" ng-class="{ \'show-answer selected\': option.isCorrect }"><span class="option"><answer-option type="option.type" option="option.option" config="{playerType: options.playerType}"></answer-option></span></span> <span ng-if="gapModel.shouldBeRenderedAsReport()" ng-class="getCorrectnessClasses(option)"><span class="t_showReport"><span class="option"><answer-option type="option.type" option="option.option" config="{playerType: options.playerType}"></answer-option></span></span><answer-option-popover ng-if="option.selected === true && getOptionFeedback(option) != null" answer-option="getOptionFeedback(option)" answer-template="app/common/directives/answerOptionPopoverPopup.tpl.html"></answer-option-popover></span> <span ng-if="gapModel.shouldBeRenderedAsExample()" ng-class="{ \'selected\': option.isCorrect }"><span class="option"><answer-option type="option.type" option="option.option" config="{playerType: options.playerType}"></answer-option></span></span></span></span><answer-option-popover ng-if="shouldRenderGlobalFeedback()" answer-option="gapModel.getFeedbackForGap()" answer-template="app/common/directives/answerOptionPopoverPopup.tpl.html"></answer-option-popover></span></span>'),e.put("app/formats/mcSingleAnswer/templates/mcSingleAnswer-cross-out.tpl.html",'<span class="mc-single-answer t_mcsa"><span class="t_report" ng-class="getClassesForSingleChoice()"><span class="selectable-option cross-out" ng-if="gapModel.getDisplayType() === \'cross-out\'"><span ng-repeat="option in gapModel.attrs.answers" ng-class="{\'asset-answer\': option.type !== \'text\'}"><span ng-if="gapModel.shouldBeRenderedAsSolving()"><span class="active" ng-class="{\'selected\': option.selected}" ng-click="checkAndEvaluate(option)"><span class="option"><answer-option type="option.type" option="option.option" config="{playerType: options.playerType}"></answer-option></span></span><answer-option-popover ng-if="option.selected && getOptionFeedback(answer.selected) != null && gapModel.hasAutomaticMarking()" answer-option="getOptionFeedback(answer.selected)" answer-template="app/common/directives/answerOptionPopoverPopup.tpl.html"></answer-option-popover></span> <span ng-if="gapModel.shouldBeRenderedAsShowAnswer()" ng-class="{ \'show-answer selected\': option.option === correctAnswer[0].option }"><span class="option"><answer-option type="option.type" option="option.option" config="{playerType: options.playerType}"></answer-option></span></span> <span ng-if="gapModel.shouldBeRenderedAsReport()"><span ng-class="{ \'correct_option\': answer.selected.option === option.option && option.isCorrect, \'wrong_option\': answer.selected.option === option.option && !option.isCorrect, \'selected\': option.selected }"><span class="option"><answer-option type="option.type" option="option.option" config="{playerType: options.playerType}"></answer-option></span></span><answer-option-popover ng-if="option.selected && getOptionFeedback(answer.selected) != null" answer-option="getOptionFeedback(answer.selected)" answer-template="app/common/directives/answerOptionPopoverPopup.tpl.html"></answer-option-popover></span> <span ng-if="gapModel.shouldBeRenderedAsExample()" ng-class="{ \'selected\': option.option === correctAnswer[0].option }"><span class="option"><answer-option type="option.type" option="option.option" config="{playerType: options.playerType}"></answer-option></span></span></span></span><answer-option-popover ng-if="shouldRenderGlobalFeedback()" answer-option="gapModel.getFeedbackForGap()" answer-template="app/common/directives/answerOptionPopoverPopup.tpl.html"></answer-option-popover></span></span>'),e.put("app/formats/mcSingleAnswer/templates/mcSingleAnswer-dropdown.tpl.html",'<span class="mc-single-answer t_mcsa"><span ng-if="options.prefix" class="option-prefix">{{options.prefix}}</span> <span class="t_report" ng-class="gapModel.getCorrectnessClasses(0)"><span class="selectable-option dropdown t_dropdown" ng-class="{ \'show-answer\': gapModel.shouldBeRenderedAsShowAnswer() || gapModel.eyeball.shouldBeRenderedAsShowAnswer(0)}"><span ng-if="gapModel.shouldBeRenderedAsSolving() && gapModel.eyeball.shouldBeRenderedAsSolving(0)"><select class="t_solving" ng-change="evaluate()" ng-model="answer.selected" ng-options="option.option for option in gapModel.attrs.answers"></select><answer-option-popover ng-if="getOptionFeedback(answer.selected) != null && gapModel.hasAutomaticMarking()" answer-option="getOptionFeedback(answer.selected)" answer-template="app/common/directives/answerOptionPopoverPopup.tpl.html"></answer-option-popover></span> <span ng-if="gapModel.shouldBeRenderedAsShowAnswer() || gapModel.eyeball.shouldBeRenderedAsShowAnswer(0)"><select class="t_showAnswer" ng-model="correctAnswer[0]" ng-options="option.option for option in gapModel.attrs.answers track by option.option" disabled=""></select></span> <span ng-if="gapModel.shouldBeRenderedAsReport() || gapModel.eyeball.shouldBeRenderedAsReport(0)"><select class="t_showReport" ng-model="answer.selected" ng-options="option.option for option in gapModel.attrs.answers track by option.option" ng-class="{\'correct_option\': gapModel.eyeball.shouldBeRenderedAsReport(0) || (answer.selected.option && answer.selected.option === correctAnswer[0].option), \'wrong_option\': !gapModel.eyeball.shouldBeRenderedAsReport(0) && answer.selected.option && answer.selected.option !== correctAnswer[0].option}" disabled=""></select><answer-option-popover ng-if="getOptionFeedback(answer.selected) != null" answer-option="getOptionFeedback(answer.selected)" answer-template="app/common/directives/answerOptionPopoverPopup.tpl.html"></answer-option-popover></span> <span ng-if="gapModel.shouldBeRenderedAsExample()"><select class="example"><option ng-repeat="option in gapModel.attrs.answers" disabled="" ng-selected="option.isCorrect">{{option.option}}</option></select></span></span><answer-option-popover ng-if="shouldRenderGlobalFeedback()" answer-option="gapModel.getFeedbackForGap()" answer-template="app/common/directives/answerOptionPopoverPopup.tpl.html"></answer-option-popover></span> <span ng-if="options.suffix" class="option-suffix">{{options.suffix}}</span><engine-eyeball-button ng-if="shouldShowEyeballs && gapModel.shouldBeRenderedAsSolving()" eyeball="gapModel.eyeball" state-id="0"></engine-eyeball-button></span>'),e.put("app/formats/mcSingleAnswer/templates/mcSingleAnswer-highlight.tpl.html",'<span class="mc-single-answer t_mcsa"><span class="t_report" ng-class="getClassesForSingleChoice()"><span class="selectable-option highlight"><span ng-repeat="option in gapModel.attrs.answers" ng-class="{\'asset-answer\': option.type !== \'text\'}"><span ng-if="gapModel.shouldBeRenderedAsSolving()"><span class="active" ng-class="{\'selected\': option.selected}" ng-click="checkAndEvaluate(option)"><span class="option"><answer-option type="option.type" option="option.option" config="{playerType: options.playerType}"></answer-option></span></span><answer-option-popover ng-if="option.selected && getOptionFeedback(answer.selected) != null && gapModel.hasAutomaticMarking()" answer-option="getOptionFeedback(answer.selected)" answer-template="app/common/directives/answerOptionPopoverPopup.tpl.html"></answer-option-popover></span> <span ng-if="gapModel.shouldBeRenderedAsShowAnswer()" ng-class="{ \'show-answer selected\': option.option === correctAnswer[0].option }"><span class="option"><answer-option type="option.type" option="option.option" config="{playerType: options.playerType}"></answer-option></span></span> <span ng-if="gapModel.shouldBeRenderedAsReport()"><span ng-class="{ \'correct_option\': answer.selected.option === option.option && option.isCorrect, \'wrong_option\': answer.selected.option === option.option && !option.isCorrect, \'selected\': option.selected }"><span class="option"><answer-option type="option.type" option="option.option" config="{playerType: options.playerType}"></answer-option></span></span><answer-option-popover ng-if="option.selected && getOptionFeedback(answer.selected) != null" answer-option="getOptionFeedback(answer.selected)" answer-template="app/common/directives/answerOptionPopoverPopup.tpl.html"></answer-option-popover></span> <span ng-if="gapModel.shouldBeRenderedAsExample()" ng-class="{ \'selected\': option.option === correctAnswer[0].option }"><span class="option"><answer-option type="option.type" option="option.option" config="{playerType: options.playerType}"></answer-option></span></span></span></span><answer-option-popover ng-if="shouldRenderGlobalFeedback()" answer-option="gapModel.getFeedbackForGap()" answer-template="app/common/directives/answerOptionPopoverPopup.tpl.html"></answer-option-popover></span></span>'),e.put("app/formats/mcSingleAnswer/templates/mcSingleAnswer-radio.tpl.html",'<span class="mc-single-answer t_mcsa"><span class="t_report" ng-class="getClassesForRadioButtons()"><span class="selectable-option radio t_radio"><span ng-repeat="option in gapModel.attrs.answers" ng-class="{\'asset-answer\': option.type !== \'text\'}"><span class="radio-block active t_solving" ng-if="gapModel.shouldBeRenderedAsSolving() && gapModel.eyeball.shouldBeRenderedAsSolving(0)" ng-class="{\'selected\': option.selected}"><input type="radio" ng-change="evaluate()" ng-model="answer.selected" ng-value="option" ng-checked="option.selected"> <span ng-click="checkAndEvaluate(option)" class="option"><answer-option type="option.type" option="option.option" config="{playerType: options.playerType}"></answer-option></span><answer-option-popover ng-if="answer.selected.option === option.option && getOptionFeedback(answer.selected) != null && gapModel.hasAutomaticMarking()" answer-option="getOptionFeedback(option)" answer-template="app/common/directives/answerOptionPopoverPopup.tpl.html"></answer-option-popover></span> <span class="radio-block t_showAnswer" ng-if="gapModel.shouldBeRenderedAsShowAnswer() || gapModel.eyeball.shouldBeRenderedAsShowAnswer(0)" ng-class="{\'show-answer\': option.isCorrect}"><input type="radio" disabled="" ng-checked="option.isCorrect" value="{{option.option}}"> <span class="option"><answer-option type="option.type" option="option.option" config="{playerType: options.playerType}"></answer-option></span></span> <span class="radio-block t_showReport" ng-if="gapModel.shouldBeRenderedAsReport() || gapModel.eyeball.shouldBeRenderedAsReport(0)" ng-class="{\'correct_option\': answer.selected.option === option.option && option.isCorrect, \'wrong_option\': answer.selected.option === option.option && !option.isCorrect}"><input type="radio" disabled="" ng-checked="answer.selected.option === option.option"> <span class="option"><answer-option type="option.type" option="option.option" config="{playerType: options.playerType}"></answer-option></span><answer-option-popover ng-if="answer.selected.option === option.option && getOptionFeedback(option) != null" answer-option="getOptionFeedback(option)" answer-template="app/common/directives/answerOptionPopoverPopup.tpl.html"></answer-option-popover></span> <span class="radio-block" ng-if="gapModel.shouldBeRenderedAsExample()"><input type="radio" disabled="" ng-checked="option.isCorrect"> <span class="option"><answer-option type="option.type" option="option.option" config="{playerType: options.playerType}"></answer-option></span></span></span></span><answer-option-popover ng-if="shouldRenderGlobalFeedback()" answer-option="gapModel.getFeedbackForGap()" answer-template="app/common/directives/answerOptionPopoverPopup.tpl.html"></answer-option-popover></span><engine-eyeball-button ng-if="shouldShowEyeballs && gapModel.shouldBeRenderedAsSolving()" eyeball="gapModel.eyeball" state-id="0"></engine-eyeball-button></span>'),e.put("app/formats/mcSingleAnswer/templates/mcSingleAnswer-underline.tpl.html",'<span class="mc-single-answer t_mcsa"><span class="t_report" ng-class="getClassesForSingleChoice()"><span class="selectable-option underline t_underline" ng-if="gapModel.getDisplayType() === \'underline\'"><span ng-repeat="option in gapModel.attrs.answers" ng-class="{\'asset-answer\': option.type !== \'text\'}"><span ng-if="gapModel.shouldBeRenderedAsSolving()"><span class="active t_solving" ng-class="{\'selected\': option.selected}" ng-click="checkAndEvaluate(option)"><span class="option"><answer-option type="option.type" option="option.option" config="{playerType: options.playerType}"></answer-option></span></span><answer-option-popover ng-if="option.selected && getOptionFeedback(answer.selected) != null && gapModel.hasAutomaticMarking()" answer-option="getOptionFeedback(answer.selected)" answer-template="app/common/directives/answerOptionPopoverPopup.tpl.html"></answer-option-popover></span> <span class="t_showAnswer" ng-if="gapModel.shouldBeRenderedAsShowAnswer()" ng-class="{ \'show-answer selected\': option.option === correctAnswer[0].option }"><span class="option"><answer-option type="option.type" option="option.option" config="{playerType: options.playerType}"></answer-option></span></span> <span ng-if="gapModel.shouldBeRenderedAsReport()"><span class="t_showReport" ng-class="{ \'correct_option\': answer.selected.option === option.option && option.isCorrect, \'wrong_option\': answer.selected.option === option.option && !option.isCorrect, \'selected\': option.selected }"><span class="option"><answer-option type="option.type" option="option.option" config="{playerType: options.playerType}"></answer-option></span></span><answer-option-popover ng-if="option.selected && getOptionFeedback(answer.selected) != null" answer-option="getOptionFeedback(answer.selected)" answer-template="app/common/directives/answerOptionPopoverPopup.tpl.html"></answer-option-popover></span> <span ng-if="gapModel.shouldBeRenderedAsExample()" ng-class="{ \'selected\': option.option === correctAnswer[0].option }"><span class="option"><answer-option type="option.type" option="option.option" config="{playerType: options.playerType}"></answer-option></span></span></span></span><answer-option-popover ng-if="shouldRenderGlobalFeedback()" answer-option="gapModel.getFeedbackForGap()" answer-template="app/common/directives/answerOptionPopoverPopup.tpl.html"></answer-option-popover></span></span>'),e.put("app/formats/ordering/templates/ordering-clickable.tpl.html",'<span class="clickable t_clickable"><span ng-if="gapModel.shouldBeRenderedAsSolving()" ng-class="{\'fixed\': option.fixed}" ng-repeat="option in gapModel.attrs.answers.options | orderBy: \'showOrder\'" class="clickable-block t_solving"><span class="move-back" ng-hide="$index <= firstMovableIndex || option.fixed" ng-click="moveBack(option); evaluate()"></span><span class="t_option ordering-option"><answer-option type="option.type" option="prepareText(option, $index)" config="{playerType: options.playerType}"></answer-option></span><span class="move-forward" ng-hide="$index >= lastMovableIndex || option.fixed" ng-click="moveForward(option); evaluate()"></span></span> <span ng-if="gapModel.shouldBeRenderedAsShowAnswer()" ng-repeat="option in gapModel.attrs.answers.options | orderBy: \'correctOrders[0][0]\'" class="show-answer clickable-block t_showAnswer ordering-option" ng-class="{\'fixed\': option.fixed}"><answer-option type="option.type" option="prepareText(option, $index)" config="{playerType: options.playerType}"></answer-option></span> <span ng-if="gapModel.shouldBeRenderedAsReport()" class="t_report" ng-class="{\'correct t_correct\': gapModel.shouldBeRenderedAsGivenReport(\'system\') && gapModel.states[0].isCorrect(), \'wrong t_wrong\': gapModel.shouldBeRenderedAsGivenReport(\'system\') && gapModel.states[0].isWrong(), \'missing t_missing\': gapModel.shouldBeRenderedAsGivenReport(\'system\') && gapModel.states[0].isMissing()}"><span ng-if="gapModel.shouldBeRenderedAsReport()" ng-repeat="option in gapModel.attrs.answers.options | orderBy: \'showOrder\'" class="clickable-block ordering-option t_report" ng-class="{\'correct t_correct\': gapModel.shouldBeRenderedAsGivenReport(\'system-option\') && gapModel.states[option.initialOrder].isCorrect(), \'wrong t_wrong\': gapModel.shouldBeRenderedAsGivenReport(\'system-option\') && gapModel.states[option.initialOrder].isWrong(), \'missing t_missing\': gapModel.shouldBeRenderedAsGivenReport(\'system-option\') && gapModel.states[option.initialOrder].isMissing(), \'fixed\': option.fixed}"><answer-option type="option.type" option="prepareText(option, $index)" config="{playerType: options.playerType}"></answer-option></span><answer-option-popover ng-if="gapModel.shouldBeRenderedAsGivenReport(\'system\') && gapModel.getFeedbackForGap() != null" answer-option="gapModel.getFeedbackForGap()" answer-template="app/common/directives/answerOptionPopoverPopup.tpl.html"></answer-option-popover></span> <span ng-if="gapModel.shouldBeRenderedAsExample()" ng-repeat="option in gapModel.attrs.answers.options | orderBy: \'correctOrders[0][0]\'" class="example clickable-block t_example" ng-class="{\'fixed\': option.fixed}"><span class="move-back" ng-hide="$index <= firstMovableIndex || option.fixed" ng-click="moveBack(option)"></span> <span class="t_option ordering-option"><answer-option type="option.type" option="prepareText(option, $index)" config="{playerType: options.playerType}"></answer-option></span> <span class="move-forward" ng-hide="$index >= lastMovableIndex || option.fixed"></span></span></span>'),e.put("app/formats/ordering/templates/ordering-dnd.tpl.html",'<span class="dnd t_dnd"><span ng-show="gapModel.shouldBeRenderedAsSolving()" custom-sortable="sortableOptions" ng-model="gapModel.attrs.answers.options" class="sortable-block t_solving"><span ng-repeat="option in gapModel.attrs.answers.options | orderBy: \'showOrder\'" class="t_option option" ng-class="{\'fixed\': option.fixed}"><answer-option type="option.type" option="prepareText(option, $index)" config="{playerType: options.playerType}"></answer-option></span> <span ng-show="gapModel.shouldBeRenderedAsSolving()" class="ordering-suffix" ng-if="options.suffix">{{ options.suffix }}</span></span> <span ng-if="gapModel.shouldBeRenderedAsShowAnswer()" ng-repeat="option in gapModel.attrs.answers.options | orderBy: \'correctOrders[0][0]\'" class="show-answer sortable-block t_showAnswer option" ng-class="{\'fixed\': option.fixed}"><answer-option type="option.type" option="prepareText(option, $index)" config="{playerType: options.playerType}"></answer-option></span><span class="ordering-suffix" ng-if="gapModel.shouldBeRenderedAsShowAnswer() && options.suffix">{{ options.suffix }}</span> <span ng-if="gapModel.shouldBeRenderedAsReport()" class="t_report" ng-class="{\'correct t_correct\': gapModel.shouldBeRenderedAsGivenReport(\'system\') && gapModel.states[0].isCorrect(), \'wrong t_wrong\': gapModel.shouldBeRenderedAsGivenReport(\'system\') && gapModel.states[0].isWrong(), \'missing t_missing\': gapModel.shouldBeRenderedAsGivenReport(\'system\') && gapModel.states[0].isMissing()}"><span ng-repeat="option in gapModel.attrs.answers.options | orderBy: \'showOrder\'" class="sortable-block option t_report" ng-class="{\'correct t_correct\': gapModel.shouldBeRenderedAsGivenReport(\'system-option\') && gapModel.states[option.initialOrder].isCorrect(), \'wrong t_wrong\': gapModel.shouldBeRenderedAsGivenReport(\'system-option\') && gapModel.states[option.initialOrder].isWrong(), \'missing t_missing\': gapModel.shouldBeRenderedAsGivenReport(\'system-option\') && gapModel.states[option.initialOrder].isMissing(), \'fixed\': option.fixed }"><answer-option type="option.type" option="prepareText(option, $index)" config="{playerType: options.playerType}"></answer-option></span><span class="ordering-suffix" ng-if="options.suffix">{{ options.suffix }}</span><answer-option-popover ng-if="gapModel.shouldBeRenderedAsGivenReport(\'system\') && gapModel.getFeedbackForGap() != null" answer-option="gapModel.getFeedbackForGap()" answer-template="app/common/directives/answerOptionPopoverPopup.tpl.html"></answer-option-popover></span> <span ng-if="gapModel.shouldBeRenderedAsExample()" ng-repeat="option in gapModel.attrs.answers.options | orderBy: \'correctOrders[0][0]\'" class="example option sortable-block t_example" ng-class="{\'fixed\': option.fixed}"><answer-option type="option.type" option="prepareText(option, $index)" config="{playerType: options.playerType}"></answer-option></span><span ng-if="gapModel.shouldBeRenderedAsExample()" class="ordering-suffix">{{ options.suffix }}</span></span>'),e.put("app/formats/ordering/templates/ordering-hangman.tpl.html",'<span class="hangman t_hangman"><span ng-if="gapModel.shouldBeRenderedAsSolving()" ng-repeat="option in gapModel.attrs.answers.options | orderBy: \'showOrder\'" class="hangman-block t_solving"><input ng-if="!option.fixed" type="number" class="input-field" min="1" max="{{gapModel.attrs.answers.options.length}}" ng-blur="evaluate()" ng-change="inputChanged($event, option)" ng-model="option.userOrder" ng-keypress="keyPressed($event)" size="2"> <input ng-if="option.fixed" type="number" disabled="" ng-model="option.userOrder" size="2" class="fixed input-field"> <span class="t_option"><answer-option type="option.type" option="option.option" config="{playerType: options.playerType}"></answer-option></span></span> <span ng-if="gapModel.shouldBeRenderedAsShowAnswer()" ng-repeat="option in gapModel.attrs.answers.options | orderBy: \'showOrder\'" class="show-answer hangman-block t_showAnswer" ng-class="{\'fixed\': option.fixed}"><span class="input-field number">{{option.correctOrders[0][0]}}</span><answer-option type="option.type" option="option.option" config="{playerType: options.playerType}"></answer-option></span> <span ng-if="gapModel.shouldBeRenderedAsReport()" class="t_report" ng-class="{\'correct t_correct\': gapModel.shouldBeRenderedAsGivenReport(\'system\') && gapModel.states[0].isCorrect(), \'wrong t_wrong\': gapModel.shouldBeRenderedAsGivenReport(\'system\') && gapModel.states[0].isWrong(), \'missing t_missing\': gapModel.shouldBeRenderedAsGivenReport(\'system\') && gapModel.states[0].isMissing()}"><span ng-repeat="option in gapModel.attrs.answers.options | orderBy: \'showOrder\'" class="hangman-block t_report" ng-class="{\'correct t_correct\': gapModel.shouldBeRenderedAsGivenReport(\'system-option\') && gapModel.states[option.initialOrder].isCorrect(), \'wrong t_wrong\': gapModel.shouldBeRenderedAsGivenReport(\'system-option\') && gapModel.states[option.initialOrder].isWrong(), \'missing t_missing\': gapModel.shouldBeRenderedAsGivenReport(\'system-option\') && gapModel.states[option.initialOrder].isMissing(), \'fixed\': option.fixed}"><span class="input-field number">{{option.userOrder}}</span><answer-option type="option.type" option="option.option" config="{playerType: options.playerType}"></answer-option></span><answer-option-popover ng-if="gapModel.shouldBeRenderedAsGivenReport(\'system\') && gapModel.getFeedbackForGap() != null" answer-option="gapModel.getFeedbackForGap()" answer-template="app/common/directives/answerOptionPopoverPopup.tpl.html"></answer-option-popover></span> <span ng-if="gapModel.shouldBeRenderedAsExample()" ng-repeat="option in gapModel.attrs.answers.options | orderBy: \'showOrder\'" class="example hangman-block" ng-class="{\'fixed\': option.fixed}"><input type="number" class="input-field" disabled="" ng-model="option.correctOrders[0][0]"><answer-option type="option.type" option="option.option" config="{playerType: options.playerType}"></answer-option></span></span>'),e.put("app/formats/ordering/templates/ordering-sentenceScramble.tpl.html",'<div class="sentence-scramble"><div class="solving" ng-if="gapModel.shouldBeRenderedAsSolving() && gapModel.eyeball.shouldBeRenderedAsSolving(0)"><div class="box-droppable" ng-model="draggableOptions" data-drop="true" jqyoui-droppable="{multiple: true, onDrop: \'onOrderingDrop(true)\'}" data-jqyoui-options="{accept: \'.word-draggable.\' + options.id}"><span class="word-draggable" ng-class="options.id" ng-repeat="answer in draggableOptions" ng-model="draggableOptions" data-drag="true" jqyoui-draggable="{index: {{$index}}, animate: false, onStart: \'onSentenceScrambleDraggableStart\'}" data-jqyoui-options="{revert: \'invalid\', scroll: false}"><answer-option type="answer.type" option="answer.option" config="{playerType: options.playerType}"></answer-option></span></div><div class="box-draggable"><span class="sentence-scramble-prefix" ng-if="options.audioPrefix && options.audioPrefix.links.length"><answer-option type="\'audio\'" option="options.audioPrefix.links" config="{playerType: options.playerType}"></answer-option></span> <span ng-repeat="answer in droppableOptions"><span class="word-droppable" ng-class="{\'word-droppable-populated\': answer.holder.type}" ng-model="answer.holder" data-drop="true" jqyoui-droppable="{onDrop: \'onOrderingDrop(true)\'}" data-jqyoui-options="{accept: \'.word-draggable.\' + options.id, hoverClass: \'droppable-hover\'}"><span class="word-draggable" ng-class="options.id" ng-show="answer.holder.type" data-drag="true" jqyoui-draggable="{placeholder:true, animate: false, onStart: \'onSentenceScrambleDraggableStart\'}" data-jqyoui-options="{revert: \'invalid\', scroll: false}" ng-model="answer.holder"><answer-option type="answer.holder.type" option="prepareText(answer.holder, $index)" config="{playerType: options.playerType}"></answer-option></span></span><span class="sentence-scramble-suffix" ng-if="$last && options.suffix">{{ options.suffix }}</span></span></div></div><div class="report" ng-if="gapModel.shouldBeRenderedAsReport() || gapModel.eyeball.shouldBeRenderedAsReport(0)"><span class="sentence-scramble-prefix" ng-if="options.audioPrefix && options.audioPrefix.links.length"><answer-option type="\'audio\'" option="options.audioPrefix.links" config="{playerType: options.playerType}"></answer-option></span> <span ng-repeat="answer in droppableOptions"><span ng-class="answer.reportClasses"><answer-option type="answer.holder.type" option="prepareText(answer.holder, $index)" config="{playerType: options.playerType}"></answer-option></span></span><span class="sentence-scramble-suffix" ng-if="options.suffix">{{ options.suffix }}</span><answer-option-popover ng-if="gapModel.getFeedbackForGap() != null" answer-option="gapModel.getFeedbackForGap()" answer-template="app/common/directives/answerOptionPopoverPopup.tpl.html"></answer-option-popover></div><div class="show-answer" ng-if="gapModel.shouldBeRenderedAsShowAnswer() || gapModel.eyeball.shouldBeRenderedAsShowAnswer(0)"><span class="sentence-scramble-prefix" ng-if="options.audioPrefix && options.audioPrefix.links.length"><answer-option type="\'audio\'" option="options.audioPrefix.links" config="{playerType: options.playerType}"></answer-option></span> <span ng-repeat="answer in gapModel.attrs.answers.options | orderBy: \'correctOrders[0][0]\'"><span class="correct"><answer-option type="answer.type" option="prepareText(answer, $index)" config="{playerType: options.playerType}"></answer-option></span><span class="sentence-scramble-suffix" ng-if="$last && options.suffix">{{ options.suffix }}</span></span></div><engine-eyeball-button ng-if="shouldShowEyeballs && gapModel.shouldBeRenderedAsSolving()" eyeball="gapModel.eyeball" state-id="0"></engine-eyeball-button></div>'),e.put("app/formats/ordering/templates/ordering-sequencing.tpl.html",'<div class="sequencing"><div class="solving" ng-if="gapModel.shouldBeRenderedAsSolving()"><ol class="seq-list js-seq-list seq-list-style-{{ options.sequencingListType }}"><li ng-repeat="answer in droppableOptions" class="seq-list-item" ng-class="classesForEyebeallReport(answer)"><span ng-if="gapModel.eyeball.shouldBeRenderedAsSolving(answer.holder.initialOrder)" class="word-droppable" ng-model="answer.holder" data-drop="true" jqyoui-droppable="{onDrop: \'onOrderingDrop\'}" data-jqyoui-options="{accept: \'.word-draggable\', hoverClass: \'seq-option-hover\'}"><span class="word-draggable" ng-show="answer.holder.type" data-drag="true" jqyoui-draggable="{placeholder:true, animate: false, onStart: \'onOrderingDraggableStart\'}" data-jqyoui-options="{revert: \'invalid\', scroll: true}" ng-model="answer.holder"><answer-option type="answer.holder.type" option="prepareText(answer.holder, $index)" config="{playerType: options.playerType}"></answer-option><span class="seq-arrow seq-arrow-up" ng-if="options.sequencingShowArrows && !$first" ng-click="moveDroppableUp($index)"></span> <span class="seq-arrow seq-arrow-down" ng-if="options.sequencingShowArrows && !$last" ng-click="moveDroppableDown($index)"></span></span></span><answer-option ng-if="gapModel.eyeball.shouldBeRenderedAsReport(answer.holder.initialOrder)" type="answer.holder.type" option="prepareText(answer.holder, $index)" class="seq-answer-display" config="{playerType: options.playerType}"></answer-option><engine-eyeball-button ng-if="shouldShowEyeballs && gapModel.shouldBeRenderedAsSolving()" eyeball="gapModel.eyeball" state-id="answer.holder.initialOrder"></engine-eyeball-button></li></ol></div><div class="report" ng-if="gapModel.shouldBeRenderedAsReport()"><ol class="seq-list seq-list-style-{{ options.sequencingListType }}"><li ng-repeat="answer in droppableOptions" ng-class="answer.reportClasses" class="seq-list-item seq-answer-container"><answer-option type="answer.holder.type" option="prepareText(answer.holder, $index)" class="seq-answer-display" config="{playerType: options.playerType}"></answer-option></li></ol><answer-option-popover ng-if="gapModel.getFeedbackForGap() != null" answer-option="gapModel.getFeedbackForGap()" answer-template="app/common/directives/answerOptionPopoverPopup.tpl.html"></answer-option-popover></div><div class="show-answer" ng-if="gapModel.shouldBeRenderedAsShowAnswer()"><ol class="seq-list seq-list-style-{{ options.sequencingListType }}"><li ng-repeat="answer in gapModel.attrs.answers.options | orderBy: \'correctOrders[0][0]\'" class="seq-list-item seq-answer-container correct"><answer-option type="answer.type" option="prepareText(answer, $index)" class="seq-answer-display" config="{playerType: options.playerType}"></answer-option></li></ol></div></div>')}]);